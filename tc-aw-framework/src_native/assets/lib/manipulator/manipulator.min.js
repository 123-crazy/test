!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Navigator=e():t.Navigator=e()}(window,function(){return function(t){var e={};function i(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(a,o,function(e){return t[e]}.bind(null,o));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var a="Â© 2017 Siemens Product Lifecycle Management Software Inc.";function o(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n={setAllLoggers:function(t){if("string"!=typeof t)throw new TypeError("[ Argument 1 | Expected type: string | Input type: "+r(t)+" ]");var e,i=s.Level[t];if(null!=i&&i instanceof Object)for(var a in n)n.hasOwnProperty(a)&&(e=n[a])instanceof s&&(e.level=i);else console.warn("Logger levels were not set. Invalid level [ "+t+" ] inputted. Acceptable levels are "+s.getLoggingLevels())}},s=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e,this._level=null,this.setLevel(i)}var e,i,a;return e=t,a=[{key:"_getFormattedDate",value:function(){var t=new Date,e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" ",i=t.getHours();i<10&&(e+="0"),e+=i+":";var a=t.getMinutes();a<10&&(e+="0"),e+=a+":";var o=t.getSeconds();o<10&&(e+="0"),e+=o+".";var r=t.getMilliseconds();return r<100&&(e+="0"),r<10&&(e+="0"),e+=r}},{key:"getLogger",value:function(e,i){var a;return t.loggerMap.has(e)?(a=t.loggerMap.get(e)).setLevel(i):(a=new t(e,i),t.loggerMap.set(e,a),n[e]=a),a}},{key:"printLoggingLevels",value:function(){console.log("Acceptable levels are "+t.getLoggingLevels())}},{key:"getLoggingLevels",value:function(){var e=[];for(var i in t.Level)t.Level[i]&&e.push(i);return e}}],(i=[{key:"setLevel",value:function(e){e&&("string"==typeof e&&t.Level[e]?this._level=t.Level[e]:e.name&&t.Level[e.name]&&(this._level=t.Level[e.name]))}},{key:"isLoggable",value:function(t){return t.intValue>=this.level.intValue}},{key:"_log",value:function(e){if(this.isLoggable(e)){for(var i="["+t._getFormattedDate()+"|"+this.name+"|"+e.name+"]:",a=arguments.length,o=new Array(a>1?a-1:0),r=1;r<a;r++)o[r-1]=arguments[r];var n=[i].concat(o);e.intValue===t.Level.SEVERE.intValue?console.error.apply(console,n):e.intValue===t.Level.WARNING.intValue?console.warn.apply(console,n):console.log.apply(console,n)}}},{key:"severe",value:function(){this._log(t.Level.SEVERE,arguments)}},{key:"error",value:function(){this._log(t.Level.ERROR,arguments)}},{key:"performance",value:function(){this._log(t.Level.PERFORMANCE,arguments)}},{key:"perf",value:function(){this._log(t.Level.PERFORMANCE,arguments)}},{key:"warning",value:function(){this._log(t.Level.WARNING,arguments)}},{key:"warn",value:function(){this._log(t.Level.WARN,arguments)}},{key:"info",value:function(){this._log(t.Level.INFO,arguments)}},{key:"config",value:function(){this._log(t.Level.CONFIG,arguments)}},{key:"debug",value:function(){this._log(t.Level.DEBUG,arguments)}},{key:"fine",value:function(){this._log(t.Level.FINE,arguments)}},{key:"finer",value:function(){this._log(t.Level.FINER,arguments)}},{key:"trace",value:function(){this._log(t.Level.TRACE,arguments)}},{key:"finest",value:function(){this._log(t.Level.FINEST,arguments)}},{key:"level",get:function(){return this._level},set:function(t){this._level=t}},{key:"name",get:function(){return this._name}}])&&o(e.prototype,i),a&&o(e,a),t}();s.loggerMap=new Map,s.Level={OFF:{intValue:90,name:"OFF"},SEVERE:{intValue:80,name:"SEVERE"},ERROR:{intValue:80,name:"ERROR"},WARNING:{intValue:70,name:"WARNING"},WARN:{intValue:70,name:"WARN"},PERFORMANCE:{intValue:65,name:"PERFORMANCE"},INFO:{intValue:60,name:"INFO"},CONFIG:{intValue:50,name:"CONFIG"},DEBUG:{intValue:40,name:"DEBUG"},FINE:{intValue:30,name:"FINE"},FINER:{intValue:30,name:"FINER"},TRACE:{intValue:20,name:"TRACE"},FINEST:{intValue:20,name:"FINEST"}};var u={FIXED:0,AREASELECT:1,AREAZOOMREADY:2,AREAZOOM:3,ROTATE:4,XROLL:5,YROLL:6,ZROLL:7,ZOOM:8,TRANSLATE:9,EXPLORE:10,LOOK:11,GESTURE:12,DRAGGING:13,AREAQUERY:14};Object.freeze(u);var l={NONE:0,LEFT:1,RIGHT:2,LEFT_RIGHT:3,MIDDLE:4,LEFT_MIDDLE:5,RIGHT_MIDDLE:6,LEFT_RIGHT_MIDDLE:7,CONTROL:8,ALT:16,SHIFT:32};Object.freeze(l);var c={ROTATE:0,TRANSLATE:1,ZOOM:2,AREA_SELECT:3,AREA_QUERY:4};Object.freeze(c);var h={ExploreManipulator:0,SPLMManipulator:1,TouchManipulator:2};Object.freeze(h);var p={DOWN:0,MOVE:1,UP:2};Object.freeze(p);var g={NONE:0,START:1,EXPLORE:2,PAN:3,LOOK:4};Object.freeze(g);var v={DEFAULT:0,LAST:1,LASTPLUSFIXED:2,LASTPLUSNOISE:3};Object.freeze(v);var A={BEGIN:0,END_CANCELED:1,END_MOVED:2};Object.freeze(A);var m={EXPLORE_END:0,EXPLORE_START:1,EXPLORE_CONTINUE:2,EXPLORE_PAN:3,EXPLORE_LOOK:4,EXPLORE_ROTATE:5};Object.freeze(m);var E={CANVAS:0,ROOT:1};Object.freeze(E);var f={NONE:0,ZOOMAREA:1,ROTATE:2,XROLL:3,YROLL:4,ZROLL:5,ZOOM:6,TRANSLATE:7,EXPLORE:8,LOOK:9,DRAG:10};Object.freeze(f);var y={IE:0,OTHER:1};Object.freeze(y);var N=Math.PI/180,d=180/Math.PI;function T(t,e,i){this.schedule=null==t?function(t){this.scheduleDefault(t)}:t,this.cancel=null==e?function(){this.cancelDefault()}:e,this.run=null==i?function(){this.cancelDefault()}:i,this.isRepeating=!1,this.timerId=null,this.cancelCounter=0}T.prototype={constructor:T},T.prototype.isRunning=function(){return null!==this.timerId},T.prototype.cancelDefault=function(){this.isRunning()&&(this.cancelCounter++,this.isRepeating?clearInterval(this.timerId):clearTimeout(this.timerId),this.timerId=null)},T.prototype.scheduleDefault=function(t){if(!(t<0)){this.isRunning()&&this.cancel(),this.isRepeating=!1;this.timerId=setTimeout(function(){(function(t,e){t.fire(e)}).call(this,this,this.cancelCounter)}.bind(this),t)}},T.prototype.scheduleRepeating=function(t){if(!(t<=0)){this.isRunning()&&this.cancel(),this.isRepeating=!0;this.timerId=setInterval(function(){(function(t,e){t.fire(e)}).call(this,this,this.cancelCounter)}.bind(this),t)}},T.prototype.fire=function(t){if(this.isRunning()){if(t!==this.cancelCounter)return;this.isRepeating||(this.timerId=null),this.run()}};var S=T;function L(t){this.renderStatusSrc=null,this.currentMousePositionAsPercentage=new THREE.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),this.clickTimer=null,this.eExploreAction=Navigator.ExploreAction.EXPLORE_END,this.camera=t.camera,this.manipulator=t,this.manipulator.activeManipulator=this,this.mouseManipulator=new Navigator.MouseManipulator(this.manipulator),this.manipulator.setDefaultAction(Navigator.DefaultAction.ZOOM);var e=function(){var t=Navigator.ExploreMode.NONE;switch(this.eExploreAction){case Navigator.ExploreAction.EXPLORE_PAN:t=Navigator.ExploreMode.PAN;break;case Navigator.ExploreAction.EXPLORE_LOOK:t=Navigator.ExploreMode.LOOK;break;case Navigator.ExploreAction.EXPLORE_CONTINUE:t=Navigator.ExploreMode.EXPLORE;break;default:t=Navigator.ExploreMode.NONE}if(null===this.renderStatusSrc||null!==this.renderStatusSrc&&!this.renderStatusSrc.isRenderBusy()){var e=this.mouseManipulator.explore(t,this.currentMousePositionAsPercentage);this.manipulator.redrawIfNeeded(e)}}.bind(this);this.exploreTimer=new S(null,null,e)}function M(t){return t.x<Navigator.edgeWidth||t.x>1-Navigator.edgeWidth?Navigator.NavigationState.XROLL:t.y<Navigator.edgeWidth?Navigator.NavigationState.ZROLL:t.y>1-Navigator.edgeWidth?Navigator.NavigationState.YROLL:Navigator.NavigationState.EXPLORE}function R(t,e,i){var a=null!==t,o=!1;if(this.manipulator.getState()===Navigator.NavigationState.DRAGGING)return this.manipulator.move(i),this.mouseManipulator.setLastMousePos(i),o;if(this.eExploreAction===Navigator.ExploreAction.EXPLORE_ROTATE){if(!this.manipulator.isRotateState(this.manipulator.getState())){var r=M.call(this,i);o=this.manipulator.setState(r)}return a&&(o=function(t){var e=!1;switch(this.manipulator.getState()){case Navigator.NavigationState.XROLL:e=this.mouseManipulator.xRoll(t);break;case Navigator.NavigationState.YROLL:e=this.mouseManipulator.yRoll(t);break;case Navigator.NavigationState.ZROLL:e=this.mouseManipulator.zRoll(t)}return e}.call(this,t)),this.mouseManipulator.setLastMousePos(i),o}switch(this.eExploreAction===Navigator.ExploreAction.EXPLORE_START&&(this.exploreTimer.isRunning()||this.exploreTimer.scheduleRepeating(100),this.eExploreAction=Navigator.ExploreAction.EXPLORE_CONTINUE,this.manipulator.setState(Navigator.NavigationState.EXPLORE)),e){case Navigator.MouseButtons.LEFT|Navigator.MouseButtons.CONTROL:this.eExploreAction!==Navigator.ExploreAction.EXPLORE_CONTINUE&&this.eExploreAction!==Navigator.ExploreAction.EXPLORE_LOOK||(this.mouseManipulator.setLastMousePos(i),this.manipulator.setState(Navigator.NavigationState.TRANSLATE)),this.eExploreAction=Navigator.ExploreAction.EXPLORE_PAN;break;case Navigator.MouseButtons.LEFT|Navigator.MouseButtons.SHIFT:this.eExploreAction!==Navigator.ExploreAction.EXPLORE_CONTINUE&&this.eExploreAction!==Navigator.ExploreAction.EXPLORE_PAN||(this.mouseManipulator.setLastMousePos(i),this.manipulator.setState(Navigator.NavigationState.LOOK)),this.eExploreAction=Navigator.ExploreAction.EXPLORE_LOOK;break;case Navigator.MouseButtons.LEFT|Navigator.MouseButtons.SHIFT|Navigator.MouseButtons.CONTROL:this.eExploreAction!==Navigator.ExploreAction.EXPLORE_PAN&&this.eExploreAction!==Navigator.ExploreAction.EXPLORE_LOOK||(this.mouseManipulator.setLastMousePos(i),this.manipulator.setState(Navigator.NavigationState.EXPLORE)),this.eExploreAction=Navigator.ExploreAction.EXPLORE_CONTINUE;break;default:this.manipulator.isDefaultAction(Navigator.DefaultAction.ROTATE)?(this.eExploreAction!==Navigator.ExploreAction.EXPLORE_CONTINUE&&this.eExploreAction!==Navigator.ExploreAction.EXPLORE_PAN||(this.mouseManipulator.setLastMousePos(i),this.manipulator.setState(Navigator.NavigationState.LOOK)),this.eExploreAction=Navigator.ExploreAction.EXPLORE_LOOK):this.manipulator.isDefaultAction(Navigator.DefaultAction.TRANSLATE)?(this.eExploreAction!==Navigator.ExploreAction.EXPLORE_CONTINUE&&this.eExploreAction!==Navigator.ExploreAction.EXPLORE_LOOK||(this.mouseManipulator.setLastMousePos(i),this.manipulator.setState(Navigator.NavigationState.TRANSLATE)),this.eExploreAction=Navigator.ExploreAction.EXPLORE_PAN):(this.manipulator.isDefaultAction(Navigator.DefaultAction.ZOOM)||this.eExploreAction===Navigator.ExploreAction.EXPLORE_PAN||this.eExploreAction===Navigator.ExploreAction.EXPLORE_LOOK)&&(this.eExploreAction=Navigator.ExploreAction.EXPLORE_CONTINUE,this.manipulator.setState(Navigator.NavigationState.EXPLORE))}return this.eExploreAction!==Navigator.ExploreAction.EXPLORE_PAN&&this.eExploreAction!==Navigator.ExploreAction.EXPLORE_LOOK&&this.eExploreAction!==Navigator.ExploreAction.EXPLORE_CONTINUE||this.currentMousePositionAsPercentage.set(i.x,i.y),o}L.prototype={constructor:L},L.prototype.setDefaultAction=function(){this.manipulator.setDefaultAction(Navigator.DefaultAction.ZOOM)},Object.defineProperties(L.prototype,{manipulatorType:{get:function(){return Navigator.ManipulatorType.ExploreManipulator}}}),L.prototype.bindRenderStatusSrc=function(t){this.renderStatusSrc=t},L.prototype.processEvent=function(t,e){var i=null,a=!1;if(t instanceof Navigator.HoverManipulatorEvent){var o=t.getState();o===Navigator.HoverState.BEGIN?this.manipulator.hover(t.getPosition(),t.getButton()):this.manipulator.hoverEnd(o===Navigator.HoverState.END_MOVED)}else{var r=t.getEvent();if(r){if(t instanceof Navigator.KeyboardManipulatorEvent&&e.nativeEvent.target){var n=t,s=Navigator.Utilities.getMousePositionAsPercentage(e.getEvent(),this.manipulator.relativeElement);return(n.isKeyUpEvent()||n.isKeyDownEvent())&&this.manipulator.isMovingState(this.manipulator.getState())?(i=e.getButtonsDown()&Navigator.MouseButtons.LEFT_RIGHT_MIDDLE,void R.call(this,null,n.getButton()|i,s)):void 0}if(t instanceof Navigator.MouseManipulatorEvent){if("mousemove"===r.type)a=function(t){if(!t.isDragging())return!1;var e=t.getEvent(),i=Navigator.Utilities.getMousePositionAsPercentage(e,this.manipulator.relativeElement);return R.call(this,e,t.getButton(),i)}.call(this,t);else if("mousedown"===r.type)(function(t){this.eExploreAction=Navigator.ExploreAction.EXPLORE_END;var e=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement);this.mouseManipulator.setLastMousePos(e),M.call(this,e)===Navigator.NavigationState.EXPLORE?(this.eExploreAction=Navigator.ExploreAction.EXPLORE_START,this.mouseManipulator.explore(Navigator.ExploreMode.START,e)):this.eExploreAction=Navigator.ExploreAction.EXPLORE_ROTATE;return!0}).call(this,r,t);else if("mouseup"===r.type)a=function(t){var e=t.getEvent();this.eExploreAction=Navigator.ExploreAction.EXPLORE_END,this.currentMousePositionAsPercentage.set(Number.MAX_VALUE,Number.MAX_VALUE),this.exploreTimer.cancel();var i=!1;if(this.manipulator.getState()!==Navigator.NavigationState.DRAGGING){if(t.isClicking()){null===this.clickTimer&&(this.clickTimer=new O);var a=t.getReleasedButton()===Navigator.MouseButtons.LEFT&&t.isLongPress(),o=new Navigator.KeyboardModifier;o.KeyboardModifierForMouse(e),this.clickTimer.updateInfo(t,Navigator.Utilities.getMousePositionAsPercentage(e,this.manipulator.relativeElement),o,a,this),this.clickTimer.run()}else t.getModifiedButton()===Navigator.MouseButtons.LEFT&&this.manipulator.getState()===Navigator.NavigationState.AREAZOOM&&this.manipulator.areaZoomEnd();t.getButton()===Navigator.MouseButtons.NONE&&(i=this.manipulator.setState(Navigator.NavigationState.FIXED))}else this.manipulator.setState(Navigator.NavigationState.FIXED),this.manipulator.moveEnd();return i}.call(this,t);else{if("mouseout"!==r.type)return;this.eExploreAction=Navigator.ExploreAction.EXPLORE_END,this.currentMousePositionAsPercentage.set(Number.MAX_VALUE,Number.MAX_VALUE),this.exploreTimer.cancel(),a=this.manipulator.setState(Navigator.NavigationState.FIXED)}this.manipulator.redrawIfNeeded(a)}}}};function O(){}O.prototype=new S(null,null,function(){switch(this.mouseManipulatorEvent.getClickCount()){case 1:switch(this.mouseManipulatorEvent.getReleasedButton()){case Navigator.MouseButtons.LEFT:this.keyboardModifier.isShiftKeyDown()&&this.keyboardModifier.updateLocalFlags(!0,!1,!1),(this.longPress||this.keyboardModifier.isControlKeyDown())&&this.currentManipulator.manipulator.notifyLongPress(),this.currentManipulator.manipulator.raySelect(this.clickPos,this.keyboardModifier);break;case Navigator.MouseButtons.MIDDLE:this.currentManipulator.manipulator.seek(this.mouseManipulatorEvent.nativeEvent)}}this.currentManipulator.clickTimer=null}),O.prototype.constructor=O,O.prototype.updateInfo=function(t,e,i,a,o){this.mouseManipulatorEvent=t,this.clickPos=e,this.keyboardModifier=i,this.longPress=a,this.currentManipulator=o};var P=L;function w(t,e,i,a){this.currentPos=t,this.originPos=e,this.button=i,this.hoverState=a}w.prototype={constructor:w},w.prototype.getPosition=function(){return this.currentPos},w.prototype.getOrigin=function(){return this.originPos},w.prototype.getButton=function(){return this.button},w.prototype.getState=function(){return this.hoverState},w.prototype.hasEnded=function(){return this.hoverState>=Navigator.HoverState.END_CANCELED};var I=w;function D(t,e,i){this.mouseManipulatorEvent=i,this.domElement=e,this.activeManipulator=t,this.HOVER_TIMER=Navigator.MIN_HOVER_TIME,this.HOVER_PIXEL_DELTA=Navigator.HOVER_PIXEL_DELTA,this.INVALID_POS=-(this.HOVER_PIXEL_DELTA+1),this.hoverOriginPt=[this.INVALID_POS,this.INVALID_POS],this.hoverCurrentPt=[this.INVALID_POS,this.INVALID_POS],this.bHovering=!1}D.prototype=new S(null,function(){this.cancelHover(Navigator.HoverState.END_CANCELED)},function(){this.bHovering=!0,this.sendHoverEvent(Navigator.HoverState.BEGIN)}),D.prototype.constructor=D,D.prototype.cancelHover=function(t){this.bHovering&&(this.bHovering=!1,this.sendHoverEvent(t)),this.hoverOriginPt[0]=this.INVALID_POS,this.hoverOriginPt[1]=this.INVALID_POS,this.hoverCurrentPt[0]=this.INVALID_POS,this.hoverCurrentPt[1]=this.INVALID_POS,this.cancelDefault()},D.prototype.updatePosition=function(t,e){this.hoverCurrentPt[0]=t,this.hoverCurrentPt[1]=e,Math.abs(t-this.hoverOriginPt[0])<=this.HOVER_PIXEL_DELTA&&Math.abs(e-this.hoverOriginPt[1])<=this.HOVER_PIXEL_DELTA||this.resetTimerHover(t,e,Navigator.HoverState.END_MOVED)},D.prototype.resetTimer=function(t,e){this.resetTimerHover(t,e,Navigator.HoverState.END_CANCELED)},D.prototype.resetTimerHover=function(t,e,i){this.cancelHover(i),this.hoverOriginPt[0]=t,this.hoverOriginPt[1]=e,this.hoverCurrentPt[0]=t,this.hoverCurrentPt[1]=e,this.schedule(this.HOVER_TIMER)},D.prototype.sendHoverEvent=function(t){var e=this.mouseManipulatorEvent.getButtonsDown(),i=Navigator.Utilities.getMousePositionAsPercentageFromValues(this.hoverOriginPt[0],this.hoverOriginPt[1],this.domElement.offsetWidth,this.domElement.offsetHeight),a=Navigator.Utilities.getMousePositionAsPercentageFromValues(this.hoverCurrentPt[0],this.hoverCurrentPt[1],this.domElement.offsetWidth,this.domElement.offsetHeight),o=new Navigator.HoverManipulatorEvent(a,i,e,t);this.activeManipulator.processEvent(o)};var C=D;function V(t,e){this.defaultInterval=null!=t?t:100,this.algorithm=null!=e?e:v.DEFAULT,this.debugKeepSampleHistory=!1,this.lastSample=-1,this.intervalSequence=[],this.debugSampleHistory=[],this.secondDiffs=[0,0,0,0,0,0,0,0,0,0],this.secondDiffsIndex=0,this.lastInterval=-1}V.prototype={constructor:V},V.prototype.addSample=function(t){this.debugKeepSampleHistory&&this.debugSampleHistory.push(t),this.needsSamples()&&(-1===this.lastSample?this.lastSample=t:(this.addInterval(t-this.lastSample),this.lastSample=t))},V.prototype.needsSamples=function(){return this.algorithm!==Navigator.Algorithm.DEFAULT},V.prototype.addInterval=function(t){this.needsSamples()&&(this.intervalSequence.push(t),this.addSecondDiff(t))},V.prototype.clear=function(){this.debugKeepSampleHistory&&this.debugSampleHistory.push(-1),this.lastSample=-1,this.intervalSequence.length=0,this.lastInterval=-1},V.prototype.getNextIntervalEstimate=function(){var t=0;if(this.algorithm===Navigator.Algorithm.DEFAULT||0===this.intervalSequence.length)t=this.defaultInterval;else switch(this.algorithm){case Navigator.Algorithm.LAST:t=this.intervalSequence[this.intervalSequence.length-1];break;case Navigator.Algorithm.LASTPLUSFIXED:t=this.intervalSequence[this.intervalSequence.length-1]+50;break;case Navigator.Algorithm.LASTPLUSNOISE:t=this.intervalSequence[this.intervalSequence.length-1]+this.getMaxSecondDiff()+10}return t},V.prototype.addSecondDiff=function(t){if(-1===this.lastInterval)this.lastInterval=t;else{var e=this.lastInterval-t;this.secondDiffs[this.secondDiffsIndex]=e>=0?e:-e,this.secondDiffsIndex++,this.secondDiffsIndex===this.secondDiffs.length&&(this.secondDiffsIndex=0)}},V.prototype.getMaxSecondDiff=function(){for(var t=0,e=0;e<this.secondDiffs.length;e++)this.secondDiffs[e]>t&&(t=this.secondDiffs[e]);return t};var x=V;function b(t){this.button=this.detectKeyboardButtons(t),this.event=t}b.prototype={constructor:b},b.prototype.getEvent=function(){return this.event},b.prototype.isKeyUpEvent=function(){return"keyup"===this.event.type},b.prototype.isKeyDownEvent=function(){return"keydown"===this.event.type},b.prototype.detectKeyboardButtons=function(t){var e=0;return e&=~Navigator.MouseButtons.CONTROL,t.ctrlKey&&(e|=Navigator.MouseButtons.CONTROL),e&=~Navigator.MouseButtons.ALT,t.altKey&&(e|=Navigator.MouseButtons.ALT),e&=~Navigator.MouseButtons.SHIFT,t.shiftKey&&(e|=Navigator.MouseButtons.SHIFT),e},b.prototype.getButton=function(){return this.button},b.prototype.getButtonsDown=function(){return this.button};var U=b;function B(){this.flags,this.CTRL_MOD=1,this.SHFT_MOD=2,this.ALT_MOD=4}B.prototype={constructor:B},B.prototype.KeyboardModifierForMouse=function(t){var e=0;t.ctrlKey&&(e|=this.CTRL_MOD),t.shiftKey&&(e|=this.SHFT_MOD),t.altKey&&(e|=this.ALT_MOD),this.flags=e},B.prototype.KeyboardModifierForTouch=function(t){var e=0;t.ctrlKey&&(e|=this.CTRL_MOD),t.shiftKey&&(e|=this.SHFT_MOD),t.altKey&&(e|=this.ALT_MOD),this.flags=e},B.prototype.updateLocalFlags=function(t,e,i){var a=0;a|=t?this.CTRL_MOD:0,a|=e?this.ALT_MOD:0,a|=i?this.SHFT_MOD:0,this.flags=a},B.prototype.getFlags=function(){return this.flags},B.prototype.isControlKeyDown=function(){return(this.flags&this.CTRL_MOD)>0},B.prototype.isShiftKeyDown=function(){return(this.flags&this.SHFT_MOD)>0},B.prototype.isAltKeyDown=function(){return(this.flags&this.ALT_MOD)>0};var k=B;function H(t){this.htmlPanel=t.parentElement,this.bWidth=t.width,this.bHeight=t.height,this.bZindex=t.style.zIndex,this.layeredCanvas=null,this.resetHTMLPanelPosition=!1}H.prototype.enable=function(){return this.layeredCanvas=document.createElement("canvas"),this.layeredCanvas.width=this.bWidth,this.layeredCanvas.height=this.bHeight,this.layeredCanvas.style.position="absolute",this.layeredCanvas.style.left="0px",this.layeredCanvas.style.top="0px",this.layeredCanvas.style.pointerEvents="none",this.layeredCanvas.style.width=this.bWidth.toString()+"px",this.layeredCanvas.style.height=this.bHeight.toString()+"px",this.layeredCanvas.style.zIndex=this.bZindex?parseInt(this.bZindex)+1e3:1e3,this.htmlPanel.appendChild(this.layeredCanvas),this.htmlPanel.style.position||(this.htmlPanel.style.position="relative",this.resetHTMLPanelPosition=!0),this.layeredCanvas},H.prototype.disable=function(t){null!==t&&(this.clearRect(t),this.htmlPanel.removeChild(this.layeredCanvas)),this.resetHTMLPanelPosition&&(this.htmlPanel.style.position=null,this.resetHTMLPanelPosition=!1)},H.prototype.clearRect=function(t){null!==t&&t.clearRect(this.layeredCanvas,this.bWidth,this.bHeight)},H.prototype.getLayeredCanvas=function(){return this.layeredCanvas};var F=H;function _(t,e){this.cursorManager=new Navigator.CursorManager(t.canvas,e),this.relativeElementVal=t.canvas,this.state=Navigator.NavigationState.FIXED,this.controller=t,this.manipulatorListeners=[],this.exploreTargetPotision=new THREE.Vector2,this.areaZoomStartPos=new THREE.Vector2,this.areaZoomUpdatePos=new THREE.Vector2,this.screenCoverage=new Navigator.ScreenCoverage,this.lastPosition=new THREE.Vector2,this.zoomReversed=!1,this.defaultAction=Navigator.DefaultAction.ROTATE,this.activeManipulator=null,this.viewPointVal=new Navigator.Viewpoint(this)}function Z(t,e,i){return this.viewPoint.rotate(t.toArray(),e.toArray(),i),this.setCursor(),!0}_.prototype={constructor:_},Object.defineProperties(_.prototype,{camera:{get:function(){return this.controller.camera}},fov:{get:function(){return this.controller.fov}},camLookAt:{get:function(){return this.controller.camLookAt}},viewPoint:{get:function(){return this.viewPointVal}},relativeElement:{get:function(){return this.relativeElementVal}}}),_.prototype.setState=function(t){var e=!1;if(this.getState()!==t){if(this.isMovingState(this.state)&&!this.isMovingState(t)&&(e=!0),this.getState()===Navigator.NavigationState.AREASELECT)for(var i=0;i<this.manipulatorListeners.length;++i)this.manipulatorListeners[i].areaSelectionStop&&this.manipulatorListeners[i].areaSelectionStop();else if(this.getState()===Navigator.NavigationState.AREAQUERY)for(i=0;i<this.manipulatorListeners.length;++i)this.manipulatorListeners[i].areaQueryStop&&this.manipulatorListeners[i].areaQueryStop();else if(this.getState()===Navigator.NavigationState.AREAZOOM)for(i=0;i<this.manipulatorListeners.length;++i)this.manipulatorListeners[i].areaZoomStop&&this.manipulatorListeners[i].areaZoomStop();this.state=t,this.setCursor()}return e},_.prototype.getState=function(){return this.state},_.prototype.updateActiveManipulator=function(t){this.activeManipulator=t,t.setDefaultAction()},_.prototype.getActiveManipulatorType=function(){return this.activeManipulator.manipulatorType},_.prototype.setCursor=function(){if(this.activeManipulator.manipulatorType!==Navigator.ManipulatorType.TouchManipulator)switch(this.getState()){case Navigator.NavigationState.FIXED:case Navigator.NavigationState.AREASELECT:case Navigator.NavigationState.AREAQUERY:this.cursorManager.clearCursors();break;case Navigator.NavigationState.AREAZOOMREADY:this.cursorManager.setCursor(Navigator.Target.CANVAS,Navigator.Type.ZOOMAREA);break;case Navigator.NavigationState.AREAZOOM:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.ZOOMAREA);break;case Navigator.NavigationState.ROTATE:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.ROTATE);break;case Navigator.NavigationState.XROLL:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.XROLL);break;case Navigator.NavigationState.YROLL:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.YROLL);break;case Navigator.NavigationState.ZROLL:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.ZROLL);break;case Navigator.NavigationState.ZOOM:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.ZOOM);break;case Navigator.NavigationState.TRANSLATE:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.TRANSLATE);break;case Navigator.NavigationState.EXPLORE:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.EXPLORE);break;case Navigator.NavigationState.LOOK:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.LOOK);break;case Navigator.NavigationState.GESTURE:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.NONE);break;case Navigator.NavigationState.DRAGGING:this.cursorManager.setCursor(Navigator.Target.ROOT,Navigator.Type.DRAG);break;default:PLMVisRL.logger.warning("Unexpected State")}else this.cursorManager.clearCursors()},_.prototype.isMovingState=function(t){return t===Navigator.NavigationState.ROTATE||t===Navigator.NavigationState.XROLL||t===Navigator.NavigationState.YROLL||t===Navigator.NavigationState.ZROLL||t===Navigator.NavigationState.ZOOM||t===Navigator.NavigationState.TRANSLATE||t===Navigator.NavigationState.EXPLORE||t===Navigator.NavigationState.LOOK||t===Navigator.NavigationState.GESTURE},_.prototype.isRotateState=function(t){return t===Navigator.NavigationState.ROTATE||t===Navigator.NavigationState.XROLL||t===Navigator.NavigationState.YROLL||t===Navigator.NavigationState.ZROLL||t===Navigator.NavigationState.LOOK},_.prototype.redrawIfNeeded=function(t){if(t){var e=this.getState(),i=this.isMovingState(e);this.controller.render(void 0,i)}},_.prototype.addManipulatorListener=function(t){return this.manipulatorListeners.push(t)},_.prototype.removeManipulatorListener=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)if(this.manipulatorListeners[e]===t)return this.manipulatorListeners.splice(e,1)},_.prototype.setLookAt=function(t){this.controller.setLookAt(t)};var X=new THREE.Vector3,G=new THREE.Vector3;_.prototype.rotate=function(t){if(null!==this.controller.camLookAt)return G.fromArray(this.controller.camLookAt),X.set(-t.y,-t.x,0),Z.call(this,G,this.viewPoint.VPCSToWCSVector(X),200*t.length())},_.prototype.rotateYawOnly=function(t){var e=t.x>0?-1:1;return X.set(0,1,0),Z.call(this,this.camera.position.clone(),this.viewPoint.VPCSToWCSVector(X),100*t.length()*e)},_.prototype.rotateLookAt=function(t){return X.set(-t.y,-t.x,0),Z.call(this,this.camera.position.clone(),this.viewPoint.VPCSToWCSVector(X),100*t.length())},_.prototype.xRoll=function(t){return X.set(1,0,0),G.fromArray(this.controller.camLookAt),Z.call(this,G,this.viewPoint.VPCSToWCSVector(X),t*Navigator.RadiansToDegrees)},_.prototype.yRoll=function(t){return X.set(0,1,0),G.fromArray(this.controller.camLookAt),Z.call(this,G,this.viewPoint.VPCSToWCSVector(X),t*Navigator.RadiansToDegrees)};var z=new THREE.Vector3;_.prototype.zRoll=function(t){return G.fromArray(this.controller.camLookAt),z.subVectors(G,this.camera.position).normalize(),Z.call(this,G,z,-t*Navigator.RadiansToDegrees)},_.prototype.zRollAboutPoint=function(t,e){var i=this.controller.getRayFromPoint(t);return Z.call(this,i.origin,i.direction,-e*Navigator.RadiansToDegrees)};var W=new THREE.Vector3,Q=new THREE.Vector3;function K(t){this.viewPoint.translateLookFrom(t.toArray()),this.setCursor()}function Y(t){this.camera.left*=t,this.camera.right*=t,this.camera.top*=t,this.camera.bottom*=t,this.updateCameraMatrices(),this.updateCameraMatrices()}_.prototype.translate=function(t){if(Navigator.Utilities.epsilonIsZero(Navigator.Epsilon,t))return!1;var e=1,i=0,a=0;if(this.camera instanceof THREE.PerspectiveCamera){a=(i=2*Math.tan(this.camera.fov/2*Navigator.DegreesToRadians)*.79)*this.camera.aspect,W.fromArray(this.controller.camLookAt);var o=this.camera.position.clone();e=Q.subVectors(W,o).length()}else i=this.camera.top,a=this.camera.right;return t.x=t.x*a,t.y=t.y*i,this.translateViewPoint(this.viewPoint.VPCSToWCSVector(new THREE.Vector3(-t.x*e,t.y*e,0)).toArray())},_.prototype.updateCameraMatrices=function(){this.controller.updateCameraMatrices()},_.prototype.computeNearFarClip=function(){this.controller.computeNearFarClip()},_.prototype.translateViewPoint=function(t){return this.viewPoint.translate(t),this.setCursor(),!0},_.prototype.explore_init=function(t){return this.exploreTargetPotision.set(t.x-.5,t.y-.5),!0},_.prototype.zoom=function(t){if(this.controller.camLookAt)return this.isZoomReversed()&&t.negate(),this.zoomByScale(t.y)},_.prototype.zoomByScale=function(t){t=1/(1+t),Navigator.Utilities.epsilonCompare(t,Navigator.OneThousandth)<0&&(t=Navigator.OneThousandth);var e=this.camera.position.clone();W.fromArray(this.controller.camLookAt);var i=Q.subVectors(W,e).length()*(t-1);return K.call(this,this.viewPoint.VPCSToWCSVector(new THREE.Vector3(0,0,i))),this.camera instanceof THREE.OrthographicCamera&&Y.call(this,t),!0},_.prototype.explore=function(t){this.screenCoverage.setup(this.camera.matrixWorldInverse.clone(),this.camera.projectionMatrix.clone());var e=t.y*this.screenCoverage.getFarClipDistance()*.1,i=.1*t.x;return(0!==e||0!==i)&&(this.rotateYawOnly(new THREE.Vector2(i,0)),this.translateViewPoint(this.viewPoint.VPCSToWCSVector(new THREE.Vector3(0,0,e)).toArray()),!0)},_.prototype.explore_pan=function(t){var e=-1*t.x*.05,i=-1*t.y*.05;return(0!==e||0!==i)&&(t.set(e,i),this.translate(t),!0)},_.prototype.explore_look=function(t){var e=.1*t.x,i=.1*t.y;return(0!==e||0!==i)&&(t.set(e,i),this.rotateLookAt(t),!0)},_.prototype.setDefaultAction=function(t){this.defaultAction=t},_.prototype.isDefaultAction=function(t){var e=!1;switch(t){case Navigator.DefaultAction.ROTATE:this.defaultAction===Navigator.DefaultAction.ROTATE&&(e=!0);break;case Navigator.DefaultAction.TRANSLATE:this.defaultAction===Navigator.DefaultAction.TRANSLATE&&(e=!0);break;case Navigator.DefaultAction.ZOOM:this.defaultAction===Navigator.DefaultAction.ZOOM&&(e=!0);break;case Navigator.DefaultAction.AREA_SELECT:this.defaultAction===Navigator.DefaultAction.AREA_SELECT&&(e=!0);break;case Navigator.DefaultAction.AREA_QUERY:this.defaultAction===Navigator.DefaultAction.AREA_QUERY&&(e=!0)}return e},_.prototype.getDefaultAction=function(){return this.defaultAction},_.prototype.setZoomReversed=function(t){this.zoomReversed=t},_.prototype.isZoomReversed=function(){return this.zoomReversed};var q=new THREE.Vector2;_.prototype.areaZoomEnd=function(){var t=Math.abs(this.areaZoomUpdatePos.x-this.areaZoomStartPos.x),e=Math.abs(this.areaZoomUpdatePos.y-this.areaZoomStartPos.y);if(e>t&&(t=e),Navigator.Utilities.epsilonCompare(t,Navigator.Epsilon)>0){var i=this.camera.position;W.fromArray(this.controller.camLookAt),q.setX(.5*(this.areaZoomUpdatePos.x+this.areaZoomStartPos.x)),q.setY(.5*(this.areaZoomUpdatePos.y+this.areaZoomStartPos.y));var a,o,r=(new THREE.Vector2).subVectors(q,new THREE.Vector2(.5,.5)),n=1;this.camera instanceof THREE.PerspectiveCamera?(o=(a=2*Math.tan(this.camera.fov/2)*this.camera.far)*this.camera.aspect,translateVector.x=translateVector.x*a,translateVector.y=translateVector.y*o,n=Q.subVectors(W,i).length()):(a=this.camera.top,o=this.camera.right),r.setX(r.x*a),r.setY(r.y*o),this.translateViewPoint(this.viewPoint.VPCSToWCSVector(new THREE.Vector3(r.x*n,-r.y*n,0)).toArray());var s=Q.subVectors(W,i).length()*(t-1);K.call(this,this.viewPoint.VPCSToWCSVector(new THREE.Vector3(0,0,s))),this.camera instanceof THREE.OrthographicCamera&&Y.call(this,t)}for(var u=0;u<this.manipulatorListeners.length;++u)this.manipulatorListeners[u].areaZoomEnd&&this.manipulatorListeners[u].areaZoomEnd(this.areaZoomUpdatePos)},_.prototype.seek=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)this.manipulatorListeners[e].seek&&this.manipulatorListeners[e].seek(t)},_.prototype.raySelect=function(t,e){for(var i=0;i<this.manipulatorListeners.length;++i)this.manipulatorListeners[i].raySelect&&this.manipulatorListeners[i].raySelect(t,e)},_.prototype.move=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)this.manipulatorListeners[e].move&&this.manipulatorListeners[e].move(t)},_.prototype.moveEnd=function(){for(var t=0;t<this.manipulatorListeners.length;++t)this.manipulatorListeners[t].moveEnd&&this.manipulatorListeners[t].moveEnd()},_.prototype.deselect=function(){for(var t=0;t<this.manipulatorListeners.length;++t)this.manipulatorListeners[t].deselect&&this.manipulatorListeners[t].deselect()},_.prototype.areaSelectStart=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)this.manipulatorListeners[e].areaSelectionStart&&this.manipulatorListeners[e].areaSelectionStart(t)},_.prototype.areaSelectUpdate=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)this.manipulatorListeners[e].areaSelectionUpdate&&this.manipulatorListeners[e].areaSelectionUpdate(t)},_.prototype.areaSelectEnd=function(t,e){for(var i=0;i<this.manipulatorListeners.length;++i)this.manipulatorListeners[i].areaSelectionEnd&&this.manipulatorListeners[i].areaSelectionEnd(t,e)},_.prototype.areaQueryStart=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)this.manipulatorListeners[e].areaQueryStart&&this.manipulatorListeners[e].areaQueryStart(t)},_.prototype.areaQueryUpdate=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)this.manipulatorListeners[e].areaQueryUpdate&&this.manipulatorListeners[e].areaQueryUpdate(t)},_.prototype.areaQueryEnd=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)this.manipulatorListeners[e].areaQueryEnd&&this.manipulatorListeners[e].areaQueryEnd(t)},_.prototype.areaQueryStop=function(){for(var t=0;t<this.manipulatorListeners.length;++t)this.manipulatorListeners[t].areaQueryStop&&this.manipulatorListeners[t].areaQueryStop(position)},_.prototype.areaZoomStart=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)this.manipulatorListeners[e].areaZoomStart&&this.manipulatorListeners[e].areaZoomStart(t);this.areaZoomStartPos.copy(t)},_.prototype.areaZoomUpdate=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)this.manipulatorListeners[e].areaZoomUpdate&&this.manipulatorListeners[e].areaZoomUpdate(t);this.areaZoomUpdatePos.copy(t)},_.prototype.notifyLongPress=function(){for(var t=0;t<this.manipulatorListeners.length;++t)this.manipulatorListeners[t].notifyLongPress&&this.manipulatorListeners[t].notifyLongPress()},_.prototype.hover=function(t,e){for(var i=0;i<this.manipulatorListeners.length;++i)this.manipulatorListeners[i].hover&&this.manipulatorListeners[i].hover(t,e)},_.prototype.hoverEnd=function(t){for(var e=0;e<this.manipulatorListeners.length;++e)this.manipulatorListeners[e].hoverEnd&&this.manipulatorListeners[e].hoverEnd(t)},_.prototype.viewAll=function(){for(var t=0;t<this.manipulatorListeners.length;++t)this.manipulatorListeners[t].viewAll&&this.manipulatorListeners[t].viewAll()},_.prototype.viewSelected=function(){for(var t=0;t<this.manipulatorListeners.length;++t)this.manipulatorListeners[t].viewSelected&&this.manipulatorListeners[t].viewSelected()},_.prototype.redraw=function(t){this.redrawIfNeeded(t)},_.prototype.setFrustumByFOV=function(t,e){t<=0&&PLMVisRL.logger.error("The FOV value must be greator than 0"),e<=0&&PLMVisRL.logger.error("The aspect ratio value must be greator than 0");var i=.5*t,a=i;e>=1?i*=e:a/=e,this.camera.left=-i,this.camera.right=i,this.camera.top=a,this.camera.bottom=-a},_.prototype.viewSphere=function(t){var e,i=this.camera.right-this.camera.left,a=this.camera.top-this.camera.bottom;e=0===a?1:i/a,this.setFrustumByFOV(2*t.radius,e)};var j=_;function J(t){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var $=function(t){null!=t&&J(t)===J({})&&(this.viewImpl=t,this.manipulator=this.viewImpl.GetBaseManipulator,this.raySelectEventHandler=null,this.preSelectionTimer=new tt,this.preSelectionTimer.updateInfo(this.viewImpl))};$.prototype.setRaySelectEventHandler=function(t){if(null!==t&&!(t.serialize instanceof Function))throw new Error("Assert failure!");this.raySelectEventHandler=t},$.prototype.initDrag=function(t,e){void 0!==this.dragQuerySent&&!1!==this.dragQuerySent&&this.manipulator.getState()===Navigator.NavigationState.FIXED&&(!0===t?(this.manipulator.setState(Navigator.NavigationState.DRAGGING),this.objectBeingDragged=e,this.dragQuerySent=!1):this.objectBeingDragged===e&&(this.objectBeingDragged=null))},$.prototype.raySelect=function(t,e){var i=t.x,a=t.y,o=e.getFlags();this.viewImpl.multiSelectState()&&(o|=1);var r=null,n=!1;if(null!==this.raySelectEventHandler&&(this.raySelectEventHandler.isEventHandlingBlocked instanceof Function&&(n=this.raySelectEventHandler.isEventHandlingBlocked()),r=this.raySelectEventHandler.serialize()),!n){var s=function(t){null!==this.raySelectEventHandler&&this.raySelectEventHandler.blockEventHandling instanceof Function&&this.raySelectEventHandler.blockEventHandling(t)}.bind(this);s(!0),this.viewImpl.sendLMBEventWithHandler(i,a,o,r).then(function(){s(!1)},function(t){s(!1),PLMVisRL.logger.warning("Cannot raySelect: "+t)})}},$.prototype.deselect=function(){PLMVisRL.logger.info("Deselect");this.viewImpl.setSelected([])},$.prototype.notifyLongPress=function(){this.viewImpl.notifyLongPress()},$.prototype.hover=function(t,e){var i=t.x,a=t.y,o=this.manipulator.getActiveManipulatorType()===Navigator.ManipulatorType.TouchManipulator;PLMVisRL.logger.fine("Hover Start at "+t+",  touch:  "+o+", manipulator state:  "+this.manipulator.getState()),o||0!=(Navigator.MouseButtons.LEFT_RIGHT_MIDDLE&e)?!o&&e!==Navigator.MouseButtons.LEFT||this.manipulator.isMovingState(this.manipulator.getState())||this.manipulator.getState()===Navigator.NavigationState.DRAGGING||(this.dragQuerySent=!0,PLMVisRL.logger.fine("Sending pick event on hover with LMB"),this.viewImpl.sendPickEventWithContext(i,a)):null!==this.raySelectEventHandler?(this.preSelectionTimer.cancel(),this.viewImpl.preSelect(i,a)):this.viewImpl.onHover(t,e)},$.prototype.hoverEnd=function(t){PLMVisRL.logger.fine("Hover End"),null!==this.raySelectEventHandler?this.viewImpl.preSelectEnd(this.preSelectionTimer,t):this.viewImpl.hoverEnd()},$.prototype.move=function(t){null!==this.objectBeingDragged&&void 0!==this.objectBeingDragged?(PLMVisRL.logger.fine("Move at "+JSON.stringify(t)),this.viewImpl.send3DEntityMoveEvent(t.x,t.y,this.objectBeingDragged)):PLMVisRL.logger.fine("Unexpected: Move at "+JSON.stringify(t)+" but there is no object to move")},$.prototype.moveEnd=function(){null!==this.objectBeingDragged&&void 0!==this.objectBeingDragged?(PLMVisRL.logger.fine("Move end "),this.viewImpl.send3DEntityMoveEvent(0,0,this.objectBeingDragged,!0)):PLMVisRL.logger.fine("Unexpected: MoveEnd but there is no object to move")},$.prototype.endAreaSelection=function(t,e){var i=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement);this.areaSelection.areaSelectionEnd(i,this.viewImpl,e)},$.prototype.stopAreaSelection=function(){this.areaSelection.disable()},$.prototype.startAreaQuery=function(t){var e=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement);this.areaSelection=new Navigator.VolumeSelectQueryRectangle(this.manipulator.relativeElementVal),this.areaSelection.areaSelectionStart(e)},$.prototype.startQueryUpdate=function(t){var e=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement);this.areaSelection.areaSelectionUpdate(e)},$.prototype.endAreaQuery=function(t){var e=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement);this.areaSelection.areaQueryEnd(e,this.viewImpl)},$.prototype.stopAreaQuery=function(){this.areaSelection.disable()};function tt(){}tt.prototype=new S(function(t,e){PLMVisRL.logger.fine("Preselection timer scheduled"),this.contextEntity=e,this.scheduleDefault(t)},function(){PLMVisRL.logger.fine("Preselection timer canceled"),this.contextEntity=null,this.cancelDefault()},function(){void 0!==this.contextEntity&&null!==this.contextEntity&&(PLMVisRL.logger.fine("Preselection timer sending EMM"),this.viewImpl.sendPickEventWithContext(0,0,this.contextEntity))}),tt.prototype.constructor=tt,tt.prototype.updateInfo=function(t){this.viewImpl=t,this.contextEntity=null};var et=$,it=[];it[0]=0,it[1]=1,it[2]=2,it[3]=3,it[10]=4,it[11]=5,it[12]=6,it[13]=7,it[20]=8,it[21]=9,it[22]=10,it[23]=11,it[30]=12,it[31]=13,it[32]=14,it[33]=15;var at=[];at[0]=0,at[1]=4,at[2]=8,at[3]=12,at[10]=1,at[11]=5,at[12]=9,at[13]=13,at[20]=2,at[21]=6,at[22]=10,at[23]=14,at[30]=3,at[31]=7,at[32]=11,at[33]=15;var ot={rotateMatrix4:function(t,e,i){var a=new THREE.Matrix4;Navigator.Utilities.setRotationMatrix4(t,e,a),i.transpose().multiply(a),i.transpose()},setRotationMatrix4:function(t,e,i){i.identity();var a=new THREE.Matrix3;Navigator.Utilities.setRotationMatrix3(t,e,a),Navigator.Utilities.setUpper3x3(a,i)},normalizeWithVector:function(t,e){var i=1/t.length();return e.x=t.x*i,e.y=t.y*i,e.z=t.z*i,e},setUpper3x3:function(t,e){var i=t.elements[0],a=t.elements[3],o=t.elements[6],r=t.elements[1],n=t.elements[4],s=t.elements[7],u=t.elements[2],l=t.elements[5],c=t.elements[8];e.set(i,a,o,0,r,n,s,0,u,l,c,0,0,0,0,1)},setRotationMatrix3:function(t,e,i){var a=new THREE.Vector3;Navigator.Utilities.normalizeWithVector(t,a);var o=a.x,r=a.y,n=a.z,s=o*n,u=o*r,l=r*n,c=Math.sin(e),h=Math.cos(e),p=1-h,g=p*o*o+h,v=p*u+c*n,A=p*s-c*r,m=p*u-c*n,E=p*r*r+h,f=p*l+c*o,y=p*s+c*r,N=p*l-c*o,d=p*n*n+h;return i.set(g,v,A,m,E,f,y,N,d),i},mulVector:function(t,e){var i=e.elements,a=t.x*i[it[0]]+t.y*i[it[10]]+t.z*i[it[20]],o=t.x*i[it[1]]+t.y*i[it[11]]+t.z*i[it[21]],r=t.x*i[it[2]]+t.y*i[it[12]]+t.z*i[it[22]];return t.x=a,t.y=o,t.z=r,t},mulPoint:function(t,e){var i=e.elements,a=t.x*i[it[0]]+t.y*i[it[10]]+t.z*i[it[20]]+i[it[30]],o=t.x*i[it[1]]+t.y*i[it[11]]+t.z*i[it[21]]+i[it[31]],r=t.x*i[it[2]]+t.y*i[it[12]]+t.z*i[it[22]]+i[it[32]];return t.x=a,t.y=o,t.z=r,t},mulAndUnhomo:function(t,e){var i=e.elements,a=t.x*i[it[3]]+t.y*i[it[13]]+t.z*i[it[23]]+i[it[33]],o=(t.x*i[it[0]]+t.y*i[it[10]]+t.z*i[it[20]]+i[it[30]])/a,r=(t.x*i[it[1]]+t.y*i[it[11]]+t.z*i[it[21]]+i[it[31]])/a,n=(t.x*i[it[2]]+t.y*i[it[12]]+t.z*i[it[22]]+i[it[32]])/a;t.x=o,t.y=r,t.z=n},epsilonIsZero:function(t,e){return!(e.x>t||e.x<-t)&&(!(e.y>t||e.y<-t)&&(!e.z||!(e.z>t||e.z<-t)))},epsilon:function(t,e){return e?Math.max(Navigator.Utilities.epsilon(t),Navigator.Utilities.epsilon(e)):null!=t&&null==e?1e-6*Math.abs(t):void 0},epsilonCompare:function(t,e){var i=!isNaN(t),a=!isNaN(e);if(i&&a){var o=Navigator.Utilities.epsilon(t,e);return t>e+o?1:t<e-o?-1:0}return i?-1:a?1:0},epsilonAreEqual:function(t,e){return 0===Navigator.Utilities.epsilonCompare(t.x,e.x)&&0===Navigator.Utilities.epsilonCompare(t.y,e.y)&&0===Navigator.Utilities.epsilonCompare(t.z,e.z)},isUpVecTooClose:function(t,e){var i=Math.abs(e.angleTo(t));return i<Math.PI/16||i>15*Math.PI/16},pointAngle:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},vectorAngle:function(t,e){if(Navigator.Utilities.isVectorZero(t)||Navigator.Utilities.isVectorZero(e))return PLMVisRL.logger.warning("You cannot get an angle from a zero vector."),null;var i=Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x);return i<-Math.PI&&(i+=2*Math.PI),i>Math.PI&&(i-=2*Math.PI),i},isVectorZero:function(t){if(null!==t.z&&void 0!==t.z){if(0===t.x&&0===t.y&&0===t.z)return!0}else if(0===t.x&&0===t.y)return!0;return!1},epsilonEquals:function(t,e,i){return!(t.x>e.x+i||t.x<e.x-i)&&(!(t.y>e.y+i||t.y<e.y-i)&&!(t.z&&e.z&&(t.z>e.z+i||t.z<e.z-i)))},getMousePositionAsPercentage:function(t,e){var i=Navigator.Utilities.getX(t,e),a=Navigator.Utilities.getY(t,e);return new THREE.Vector2(i/Navigator.Utilities.getTargetWidth(e),a/Navigator.Utilities.getTargetHeight(e))},getMousePositionAsPercentageFromValues:function(t,e,i,a){return new THREE.Vector2(t/i,e/a)},getMouseButton:function(t){var e=Navigator.MouseButtons.NONE;switch(t){case 0:e=Navigator.MouseButtons.LEFT;break;case 1:e=Navigator.MouseButtons.MIDDLE;break;case 2:e=Navigator.MouseButtons.RIGHT}return e},getSubPixelAbsoluteLeft:function(t){for(var e=0,i=t;i.offsetParent;)e-=i.scrollLeft,i=i.parentNode;for(;t;)e+=t.offsetLeft,t=t.offsetParent;return e},getSubPixelAbsoluteTop:function(t){for(var e=0,i=t;i.offsetParent;)e-=i.scrollTop,i=i.parentNode;for(;t;)e+=t.offsetTop,t=t.offsetParent;return e},getViewportElement:function(t){return"CSS1Compat"===t.compatMode?t.documentElement:t.body},getownerScrollLeft:function(t){return("CSS1Compat"===t.ownerDocument.compatMode?t.ownerDocument.documentElement:document.body).scrollLeft||0},getownerScrollTop:function(t){return("CSS1Compat"===t.ownerDocument.compatMode?t.ownerDocument.documentElement:document.body).scrollTop||0},getRelativeX:function(t,e){var i=parseInt(Navigator.Utilities.getSubPixelAbsoluteLeft(e)),a=parseInt(e.scrollLeft||0),o=parseInt(Navigator.Utilities.getownerScrollLeft(e));return parseInt(t.clientX)-i+a+o},getRelativeY:function(t,e){var i=parseInt(Navigator.Utilities.getSubPixelAbsoluteTop(e)),a=parseInt(e.scrollTop||0),o=parseInt(Navigator.Utilities.getownerScrollTop(e));return parseInt(t.clientY)-i+a+o},getX:function(t,e){return null!=e?Navigator.Utilities.getRelativeX(t,e):t.clientX},getY:function(t,e){return null!=e?Navigator.Utilities.getRelativeY(t,e):t.clientY},getTargetWidth:function(t){return null==t?window.innerWidth:0===t.clientWidth||void 0===t.clientWidth?parseInt(t.width):parseInt(t.clientWidth)},getTargetHeight:function(t){return null==t?window.innerHeight:0===t.clientHeight||void 0===t.clientHeight?parseInt(t.height):parseInt(t.clientHeight)},ObjectExtend:function(t,e){t.prototype=new e,t.prototype.constructor=t}},rt=function(t){Navigator.ManipulatorListenerViewImpl.call(this,t)};ot.ObjectExtend(rt,et),rt.prototype.seek=function(t){var e=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement),i=e.x,a=e.y;PLMVisRL.logger.info("Seek: at "+i+","+a),this.viewImpl.sendMMBEvent(i,a).then(function(){},function(t){PLMVisRL.logger.warning("Cannot seek: "+t)})},rt.prototype.areaSelectionStart=function(t){this.areaQueryStart(t)},rt.prototype.areaSelectionUpdate=function(t){this.areaQueryUpdate(t)},rt.prototype.areaSelectionEnd=function(t,e){this.endAreaSelection(t,e)},rt.prototype.areaSelectionStop=function(){this.stopAreaSelection()},rt.prototype.areaQueryStart=function(t){this.startAreaQuery(t)},rt.prototype.areaQueryUpdate=function(t){this.startQueryUpdate(t)},rt.prototype.areaQueryEnd=function(t){this.endAreaQuery(t)},rt.prototype.areaQueryStop=function(){this.stopAreaQuery()};var nt=rt,st=function(t){Navigator.ManipulatorListenerViewImpl.call(this,t)};ot.ObjectExtend(st,et),Object.defineProperties(st.prototype,{selectedBBox:{get:function(){return this.manipulator.controller.rli.selectedBBox}}}),st.prototype.seek=function(t){var e=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement),i=e.x,a=e.y;PLMVisRL.logger.info("Seek: at "+i+","+a),this.viewImpl.sendMMBEvent(i,a).then(function(){},function(t){PLMVisRL.logger.warning("Cannot seek: "+t)})},st.prototype.viewAll=function(t){var e=null!=t?t:this.manipulator.controller.boundingSphere;e||PLMVisRL.logger.error("The current bounding sphere is invalid.");var i=(new THREE.Vector3).fromArray(this.manipulator.controller.camLookAt),a=(new THREE.Vector3).subVectors(i,this.manipulator.camera.position);a.normalize();var o=e.center.clone(),r=this.manipulator.controller.getSize(),n=r.height;r.width<r.height&&(n=r.width),a.multiplyScalar(r.height*e.radius/(n*Math.tan(Navigator.DegreesToRadians*this.manipulator.fov/2)));var s=o.clone();s.sub(a),this.manipulator.viewPoint.setLookFrom(s.toArray()),this.manipulator.camera instanceof THREE.OrthographicCamera&&this.manipulator.viewSphere(e),this.manipulator.viewPoint.setLookAt(o.toArray()),this.manipulator.setCursor(),this.manipulator.controller.render()},st.prototype.viewSelected=function(){if(this.selectedBBox){if(null!==this.manipulator.camera){var t=new THREE.Vector3;t.sub(this.selectedBBox.center(),this.selectedBBox.max),this.viewAll(new THREE.Sphere(this.selectedBBox.center(),t.length())),this.manipulator.controller.render(!1,null)}}else this.viewAll(null)},st.prototype.setCameraOrientation=function(t){var e=(new THREE.Vector3).fromArray(this.manipulator.viewPoint.getViewVec()).length(),i=(new THREE.Vector3).fromArray(this.manipulator.controller.camLookAt),a=(new THREE.Vector3).fromArray(this.manipulator.controller.camLookAt);a.sub((new THREE.Vector3).fromArray(t.ViewVec)),this.manipulator.camera.position.copy(a),this.manipulator.viewPoint.setFromDistance(e),this.manipulator.viewPoint.setUpVec(t.UpVector),this.manipulator.viewPoint.setLookAt(i.toArray()),this.manipulator.controller.render()},st.prototype.areaSelectionStart=function(t){this.areaQueryStart(t)},st.prototype.areaSelectionUpdate=function(t){this.areaQueryUpdate(t)},st.prototype.areaSelectionEnd=function(t,e){this.endAreaSelection(t,e)},st.prototype.areaSelectionStop=function(){this.stopAreaSelection()},st.prototype.areaQueryStart=function(t){this.startAreaQuery(t)},st.prototype.areaQueryUpdate=function(t){this.startQueryUpdate(t)},st.prototype.areaQueryEnd=function(t){this.endAreaQuery(t)},st.prototype.areaQueryStop=function(){this.stopAreaQuery()};var ut=st;function lt(t){this.manipulator=t}lt.prototype={constructor:lt},lt.prototype.xRoll=function(t){if(t){var e=Navigator.Utilities.getY(t,this.manipulator.relativeElement)/Navigator.Utilities.getTargetHeight(this.manipulator.relativeElement);return this.manipulator.xRoll((this.manipulator.lastPosition.y-e)*(Math.PI/2))}},lt.prototype.yRoll=function(t){if(t){var e=Navigator.Utilities.getX(t,this.manipulator.relativeElement);return this.manipulator.yRoll((this.manipulator.lastPosition.x-e/Navigator.Utilities.getTargetWidth(this.manipulator.relativeElement))*(Math.PI/2))}},lt.prototype.zRoll=function(t){if(t){var e=new THREE.Vector2(.5,.5),i=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement),a=Navigator.Utilities.pointAngle(this.manipulator.lastPosition,e)-Navigator.Utilities.pointAngle(i,e);return this.manipulator.zRoll(a)}},lt.prototype.setLastMousePos=function(t){t&&(this.manipulator.lastPosition=t)},lt.prototype.rotate=function(t){if(t){var e=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement),i=new THREE.Vector2(e.x-this.manipulator.lastPosition.x,e.y-this.manipulator.lastPosition.y);return this.manipulator.rotate(i)}},lt.prototype.translate=function(t){if(t){var e=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement);return this.manipulator.translate(new THREE.Vector3(e.x-this.manipulator.lastPosition.x,e.y-this.manipulator.lastPosition.y,0))}},lt.prototype.zoom=function(t){var e=Navigator.Utilities.getMousePositionAsPercentage(t,this.manipulator.relativeElement),i=new THREE.Vector2(e.x-this.manipulator.lastPosition.x,e.y-this.manipulator.lastPosition.y);return this.manipulator.isZoomReversed()&&i.negate(),this.manipulator.zoomByScale(i.y)},lt.prototype.scrollWheelZoom=function(t){var e=t.wheelDelta?t.wheelDelta:50*-t.detail;return e/=-40,e/=50,this.manipulator.isZoomReversed()&&(e=-e),this.manipulator.zoomByScale(e)},lt.prototype.explore=function(t,e){if(t===Navigator.ExploreMode.NONE||e.x===Number.MAX_VALUE||e.y===Number.MAX_VALUE)return!1;if(t===Navigator.ExploreMode.START)return this.manipulator.explore_init(e),!0;var i=new THREE.Vector2(e.x-this.manipulator.lastPosition.x,e.y-this.manipulator.lastPosition.y),a=Math.abs(i.x)>.01?i.x:0,o=Math.abs(i.y)>.01?i.y:0;if(0===a&&0===o)return!1;i.set(a,o);var r=!1;return t===Navigator.ExploreMode.EXPLORE?r=this.manipulator.explore(i):t===Navigator.ExploreMode.LOOK?r=this.manipulator.explore_look(i):t===Navigator.ExploreMode.PAN&&(r=this.manipulator.explore_pan(i)),r};var ct=lt;function ht(){this.button=0,this.modifiedButton=Navigator.MouseButtons.NONE,this.releasedButton=null,this.isDraggingNow=!1,this.isALongPress=!0,this.downPos=new THREE.Vector2,this.movePos=new THREE.Vector2,this.previousUpPos=null,this.prevReleasedBtn=null,this.clickCount=0,this.multiClickTimer=null,this.longPressTimer=null,this.MAX_TIME_BETWEEN_CLICKS=250,this.MIN_TIME_FOR_LONG_PRESS=1e3,this.relativeElement=null}ht.prototype={constructor:ht},ht.prototype.updateEvent=function(t){if(this.nativeEvent=t,this.detectKeyboardButtons(t),"mousedown"===t.type){var e=Navigator.Utilities.getMouseButton(t.button);if(this.setButton(this.button|e),this.downPos=new THREE.Vector2(Navigator.Utilities.getX(t,this.relativeElement),Navigator.Utilities.getY(t,this.relativeElement)),null===this.multiClickTimer&&(this.clickCount=0),null===this.longPressTimer){this.isALongPress=!1;var i=function(){this.isALongPress=!0,this.longPressTimer.cancel(),this.longPressTimer=null}.bind(this);this.longPressTimer=new S(null,null,i),this.longPressTimer.schedule(this.MIN_TIME_FOR_LONG_PRESS)}}else if("mouseup"===t.type){var a=Navigator.Utilities.getMouseButton(t.button);if((a&this.button)>0){if(this.releasedButton=a,this.setButton(this.button^a),null!==this.longPressTimer&&(this.longPressTimer.cancel(),this.longPressTimer=null),this.isALongPress)new THREE.Vector2(Navigator.Utilities.getX(t,this.relativeElement),Navigator.Utilities.getY(t,this.relativeElement)).distanceTo(this.downPos)>1&&(this.isALongPress=!1);if(this.isDraggingNow)null!==this.multiClickTimer&&(this.multiClickTimer.cancel(),this.multiClickTimer=null);else{var o=new THREE.Vector2(Navigator.Utilities.getX(t,this.relativeElement),Navigator.Utilities.getY(t,this.relativeElement));if(null!==this.previousUpPos&&Navigator.Utilities.epsilonEquals(o,this.previousUpPos,5)&&this.releasedButton===this.prevReleasedBtn?this.clickCount++:this.clickCount=1,null===this.multiClickTimer){var r=function(t){this.multiClickTimer.scheduleDefault(t),this.prevReleasedBtn=this.releasedButton,this.previousUpPos=o}.bind(this);i=function(){this.multiClickTimer.cancelDefault(),this.multiClickTimer=null}.bind(this);var n=function(){this.multiClickTimer.cancelDefault(),this.previousUpPos=null}.bind(this);this.multiClickTimer=new S(r,n,i)}this.multiClickTimer.schedule(this.MAX_TIME_BETWEEN_CLICKS)}this.isDraggingNow=!!this.isDraggingNow&&this.button!==Navigator.MouseButtons.NONE}this.isAnyButtonDown(Navigator.MouseButtons.LEFT_RIGHT_MIDDLE)||(this.setButton(0),this.isDraggingNow=!1)}else"mousemove"===t.type?(o=new THREE.Vector2(Navigator.Utilities.getX(t,this.relativeElement),Navigator.Utilities.getY(t,this.relativeElement)),this.isDraggingNow=this.isDraggingNow||!Navigator.Utilities.epsilonEquals(this.downPos,o,1.0001),this.isDraggingNow&&(this.movePos=o),null!==this.multiClickTimer&&(this.multiClickTimer.cancel(),this.multiClickTimer=null)):"mouseleave"===t.type&&this.setButton(0)},ht.prototype.detectKeyboardButtons=function(t){this.button&=~Navigator.MouseButtons.CONTROL,t.ctrlKey&&(this.button|=Navigator.MouseButtons.CONTROL),this.button&=~Navigator.MouseButtons.ALT,t.altKey&&(this.button|=Navigator.MouseButtons.ALT),this.button&=~Navigator.MouseButtons.SHIFT,t.shiftKey&&(this.button|=Navigator.MouseButtons.SHIFT)},ht.prototype.getButton=function(){return this.button},ht.prototype.setButton=function(t){this.modifiedButton=t^this.button,this.button=t},ht.prototype.setRelativeElement=function(t){this.relativeElement=t},ht.prototype.getModifiedButton=function(){return this.modifiedButton},ht.prototype.isLeftDown=function(){return this.isAnyButtonDown(Navigator.MouseButtons.LEFT)},ht.prototype.isRightDown=function(){return this.isAnyButtonDown(Navigator.MouseButtons.RIGHT)},ht.prototype.isMiddleDown=function(){return this.isAnyButtonDown(Navigator.MouseButtons.MIDDLE)},ht.prototype.isAnyButtonDown=function(t){return(t&this.button)>0},ht.prototype.getButtonsDown=function(){return this.button},ht.prototype.getMouseMovePos=function(){return this.movePos},ht.prototype.areAllButtonsDown=function(t){return(t&this.button)===t},ht.prototype.isClicking=function(){return null!==this.multiClickTimer},ht.prototype.getClickCount=function(){return this.clickCount},ht.prototype.isDragging=function(){return this.isDraggingNow},ht.prototype.isLongPress=function(){return this.isALongPress},ht.prototype.getReleasedButton=function(){return this.releasedButton},ht.prototype.getButtonsDownCount=function(){return(1&this.button)+(this.button>>1&1)+(this.button>>2&1)},ht.prototype.getEvent=function(){return this.nativeEvent},ht.prototype.getClickedButton=function(){return this.releasedButton};var pt=ht;function gt(){this.isPerspective=!0,this.nearClipDistance=0,this.farClipDistance=0,this.eyePoint=new THREE.Vector3,this.screenArea=-1}gt.prototype={constructor:gt},gt.prototype.setup=function(t,e){var i=e.elements;this.isPerspective=0!==i[11].toFixed(1);var a=(new THREE.Matrix4).copy(t),o=(new THREE.Matrix4).getInverse(a,!0).elements,r=new THREE.Vector4(o[12],o[13],o[14],o[15]);this.eyePoint.set(r.x,r.y,r.z);var n=[];n[0]=new THREE.Vector3(-1,1,-1),n[1]=new THREE.Vector3(1,1,-1),n[2]=new THREE.Vector3(-1,-1,-1);var s=(new THREE.Matrix4).copy(e);s.multiply(t.clone()),s=(new THREE.Matrix4).getInverse(s,!0);for(var u=0;u<3;u++)Navigator.Utilities.mulAndUnhomo(n[u],s);this.screenArea=n[0].distanceTo(n[1])*n[0].distanceTo(n[2]);var l=new THREE.Vector3(0,0,-1),c=new THREE.Vector3(0,0,1);Navigator.Utilities.mulAndUnhomo(l,s),Navigator.Utilities.mulAndUnhomo(c,s),this.nearClipDistance=this.eyePoint.distanceTo(l),this.farClipDistance=this.eyePoint.distanceTo(c)},gt.prototype.compute=function(t,e){var i=this.computeCoverage(t);if(0===i)return 0;var a=t.radius,o=e/(a*a*4*Math.PI);return o>1&&(o=1),i*=o},gt.prototype.computeCoverage=function(t){var e=t.radius;return e<=0?0:(this.isPerspective&&(e*=this.nearClipDistance/this.eyePoint.distanceTo(t.center)),e*e*Math.PI/this.screenArea)},gt.prototype.isInitialized=function(){return this.screenArea>=0},gt.prototype.getFarClipDistance=function(){return this.farClipDistance};var vt=gt;function At(t,e,i,a){this.x=t,this.y=e,this.w=i,this.h=a}At.prototype.drawRect=function(t,e,i,a){if(t){var o=t.getContext("2d");e>0&&(null!==i&&(o.strokeStyle=i),o.lineWidth=e,o.strokeRect(this.x,this.y,this.w,this.h)),null!==a&&(o.fillStyle=a,o.fillRect(this.x,this.y,this.w,this.h))}},At.prototype.drawRectWithGradient=function(t,e){if(t){var i=t.getContext("2d");i.fillStyle=e,i.fillRect(this.x,this.y,this.w,this.h)}},At.prototype.clearRect=function(t,e,i){t&&t.getContext("2d").clearRect(0,0,e,i)};var mt=At;function Et(t){this.clickTimer=null,this.camera=t.camera,this.manipulator=t,this.manipulator.activeManipulator=this,this.mouseManipulator=new Navigator.MouseManipulator(this.manipulator),this.mouseWheelIntervalSequence=new Navigator.IntervalSequence(100,Navigator.Algorithm.LASTPLUSNOISE),this.manipulator.setDefaultAction(Navigator.DefaultAction.ROTATE);var e=function(){this.mouseWheelIntervalSequence.clear()}.bind(this);this.mouseWheelSequenceClearTimer=new S(null,null,e);var i=function(){this.mouseWheelSequenceClearTimer.schedule(500),this.manipulator.setState(Navigator.NavigationState.FIXED),this.manipulator.redrawIfNeeded(!0)}.bind(this);this.mouseWheelFinalRedrawTimer=new S(null,null,i)}function ft(t,e,i,a){var o=null!==t,r=!1;switch(e){case Navigator.MouseButtons.LEFT_RIGHT:case Navigator.MouseButtons.LEFT:switch(this.manipulator.getState()){case Navigator.NavigationState.AREAZOOMREADY:r=this.manipulator.setState(Navigator.NavigationState.AREAZOOM),this.manipulator.areaZoomStart(t),this.manipulator.areaZoomUpdate(t);break;case Navigator.NavigationState.AREAZOOM:this.manipulator.areaZoomUpdate(t);break;default:if(!i)break;this.manipulator.isDefaultAction(Navigator.DefaultAction.AREA_SELECT)?(this.manipulator.getState()!==Navigator.NavigationState.AREASELECT&&this.manipulator.areaSelectStart(t),r=this.manipulator.setState(Navigator.NavigationState.AREASELECT),this.manipulator.areaSelectUpdate(t)):this.manipulator.isDefaultAction(Navigator.DefaultAction.AREA_QUERY)?(this.manipulator.getState()!==Navigator.NavigationState.AREAQUERY&&this.manipulator.areaQueryStart(t),r=this.manipulator.setState(Navigator.NavigationState.AREAQUERY),this.manipulator.areaQueryUpdate(t)):this.manipulator.isDefaultAction(Navigator.DefaultAction.ROTATE)?(this.manipulator.isRotateState(this.manipulator.getState())||(r=Nt.call(this,a)),o&&(r=r||yt.call(this,t))):this.manipulator.isDefaultAction(Navigator.DefaultAction.TRANSLATE)?(r=this.manipulator.setState(Navigator.NavigationState.TRANSLATE),o&&(r=r||this.mouseManipulator.translate(t))):this.manipulator.isDefaultAction(Navigator.DefaultAction.ZOOM)?(r=this.manipulator.setState(Navigator.NavigationState.ZOOM),o&&(r=r||this.mouseManipulator.zoom(t))):PLMVisRL.logger.warning("Unexpected defaultState")}break;case Navigator.MouseButtons.LEFT_RIGHT|Navigator.MouseButtons.CONTROL|Navigator.MouseButtons.SHIFT:case Navigator.MouseButtons.LEFT|Navigator.MouseButtons.CONTROL|Navigator.MouseButtons.SHIFT:this.manipulator.isRotateState(this.manipulator.getState())||(r=Nt.call(this,a)),o&&(r=r||yt.call(this,t));break;case Navigator.MouseButtons.LEFT_RIGHT_MIDDLE|Navigator.MouseButtons.CONTROL|Navigator.MouseButtons.SHIFT:case Navigator.MouseButtons.LEFT_RIGHT_MIDDLE|Navigator.MouseButtons.CONTROL:case Navigator.MouseButtons.LEFT_RIGHT_MIDDLE|Navigator.MouseButtons.SHIFT:case Navigator.MouseButtons.LEFT_RIGHT_MIDDLE:case Navigator.MouseButtons.RIGHT_MIDDLE|Navigator.MouseButtons.CONTROL|Navigator.MouseButtons.SHIFT:case Navigator.MouseButtons.RIGHT_MIDDLE|Navigator.MouseButtons.CONTROL:case Navigator.MouseButtons.RIGHT_MIDDLE|Navigator.MouseButtons.SHIFT:case Navigator.MouseButtons.RIGHT_MIDDLE:case Navigator.MouseButtons.MIDDLE|Navigator.MouseButtons.CONTROL|Navigator.MouseButtons.SHIFT:case Navigator.MouseButtons.MIDDLE|Navigator.MouseButtons.CONTROL:case Navigator.MouseButtons.MIDDLE|Navigator.MouseButtons.SHIFT:case Navigator.MouseButtons.LEFT|Navigator.MouseButtons.CONTROL:case Navigator.MouseButtons.MIDDLE:this.manipulator.isDefaultAction(Navigator.DefaultAction.AREA_SELECT)?(this.manipulator.getState()!==Navigator.NavigationState.AREASELECT&&this.manipulator.areaSelectStart(t),r=this.manipulator.setState(Navigator.NavigationState.AREASELECT),this.manipulator.areaSelectUpdate(t)):(r=this.manipulator.setState(Navigator.NavigationState.TRANSLATE),o&&(r=r||this.mouseManipulator.translate(t)));break;case Navigator.MouseButtons.LEFT_MIDDLE:case Navigator.MouseButtons.LEFT_RIGHT|Navigator.MouseButtons.SHIFT:case Navigator.MouseButtons.LEFT|Navigator.MouseButtons.SHIFT:r=this.manipulator.setState(Navigator.NavigationState.ZOOM),o&&(r=r||this.mouseManipulator.zoom(t));break;default:this.manipulator.setState(Navigator.NavigationState.FIXED)}return o&&this.mouseManipulator.setLastMousePos(a),r}function yt(t){var e=!1;switch(this.manipulator.getState()){case Navigator.NavigationState.XROLL:e=this.mouseManipulator.xRoll(t);break;case Navigator.NavigationState.YROLL:e=this.mouseManipulator.yRoll(t);break;case Navigator.NavigationState.ZROLL:e=this.mouseManipulator.zRoll(t);break;case Navigator.NavigationState.ROTATE:e=this.mouseManipulator.rotate(t);break;default:PLMVisRL.logger.warning("Unexpected defaultState")}return e}function Nt(t){return this.manipulator.viewPoint.getUpVecLocked()?this.manipulator.setState(Navigator.NavigationState.ROTATE):t.x<Navigator.edgeWidth||t.x>1-Navigator.edgeWidth?this.manipulator.setState(Navigator.NavigationState.XROLL):t.y<Navigator.edgeWidth?this.manipulator.setState(Navigator.NavigationState.ZROLL):t.y>1-Navigator.edgeWidth?this.manipulator.setState(Navigator.NavigationState.YROLL):this.manipulator.setState(Navigator.NavigationState.ROTATE)}Et.prototype={constructor:Et},Object.defineProperties(Et.prototype,{manipulatorType:{get:function(){return Navigator.ManipulatorType.SPLMManipulator}}}),Et.prototype.setDefaultAction=function(){this.manipulator.setDefaultAction(Navigator.DefaultAction.ROTATE)},Et.prototype.processEvent=function(t,e){var i=function(){this.doRender=!0,this.animationId=requestAnimationFrame(i)}.bind(this),a=null,o=null,r=null,n=!1;if(t instanceof Navigator.HoverManipulatorEvent){var s=t.getState();s===Navigator.HoverState.BEGIN?this.manipulator.hover(t.getPosition(),t.getButton()):this.manipulator.hoverEnd(s===Navigator.HoverState.END_MOVED)}else{var u=t.getEvent();if(u&&u.target&&(a=Navigator.Utilities.getMousePositionAsPercentage(u,this.manipulator.relativeElement)),t instanceof Navigator.KeyboardManipulatorEvent){if(((r=t).isKeyUpEvent()||r.isKeyDownEvent())&&this.manipulator.isMovingState(this.manipulator.getState())&&e.nativeEvent.target)return a=Navigator.Utilities.getMousePositionAsPercentage(e.getEvent(),this.manipulator.relativeElement),o=e.getButtonsDown()&Navigator.MouseButtons.LEFT_RIGHT_MIDDLE,ft.call(this,null,r.getButton()|o,!0,a);if(!r.isKeyUpEvent())return;if(27===u.keyCode)return void this.manipulator.deselect()}t instanceof Navigator.MouseManipulatorEvent&&("mousemove"===u.type?this.manipulator.getState()===Navigator.NavigationState.DRAGGING?(PLMVisRL.logger.fine("Mouse drag at"+JSON.stringify(a)),this.manipulator.move(a),this.mouseManipulator.setLastMousePos(a)):this.doRender&&(this.doRender=!1,n=function(t){var e=t.getEvent();if(e)return ft.call(this,e,t.getButton(),t.isDragging(),Navigator.Utilities.getMousePositionAsPercentage(e,this.manipulator.relativeElement))}.call(this,t)):"mousedown"===u.type?(i(),this.mouseManipulator.setLastMousePos(a)):"mouseup"===u.type?(cancelAnimationFrame(this.animationId),n=function(t){var e=t.getEvent(),i=!1;if(this.manipulator.getState()!==Navigator.NavigationState.DRAGGING){if(t.isClicking()){null===this.clickTimer&&(this.clickTimer=new dt);var a=t.getReleasedButton()===Navigator.MouseButtons.LEFT&&t.isLongPress(),o=new Navigator.KeyboardModifier;o.KeyboardModifierForMouse(e),this.clickTimer.updateInfo(t,Navigator.Utilities.getMousePositionAsPercentage(e,this.manipulator.relativeElement),o,a,this),this.clickTimer.run()}else if(this.manipulator.getState()===Navigator.NavigationState.AREAZOOM)this.manipulator.areaZoomEnd();else if(this.manipulator.getState()===Navigator.NavigationState.AREASELECT){var o=new Navigator.KeyboardModifier;o.KeyboardModifierForMouse(e);var r=o.isControlKeyDown();this.manipulator.areaSelectEnd(e,r)}else this.manipulator.getState()===Navigator.NavigationState.AREAQUERY&&this.manipulator.areaQueryEnd(e);t.getButton()===Navigator.MouseButtons.NONE&&(i=this.manipulator.setState(Navigator.NavigationState.FIXED))}else this.manipulator.setState(Navigator.NavigationState.FIXED),this.manipulator.moveEnd();return i}.call(this,t)):"mousewheel"===u.type||"DOMMouseScroll"===u.type?(this.mouseWheelIntervalSequence.addSample(Date.now()),this.mouseWheelFinalRedrawTimer.schedule(this.mouseWheelIntervalSequence.getNextIntervalEstimate()),this.mouseWheelSequenceClearTimer.cancel(),this.manipulator.setState(Navigator.NavigationState.ZOOM),n=!0,this.mouseManipulator.scrollWheelZoom(u)):"mouseout"===u.type&&(n=this.manipulator.setState(Navigator.NavigationState.FIXED)),this.manipulator.redrawIfNeeded(n))}};function dt(){}dt.prototype=new S(null,null,function(){switch(this.mouseManipulatorEvent.getClickCount()){case 1:switch(this.mouseManipulatorEvent.getReleasedButton()){case Navigator.MouseButtons.LEFT:this.keyboardModifier.isShiftKeyDown()&&this.keyboardModifier.updateLocalFlags(!0,!1,!1),(this.longPress||this.keyboardModifier.isControlKeyDown())&&this.currentManipulator.manipulator.notifyLongPress(),this.currentManipulator.manipulator.raySelect(this.clickPos,this.keyboardModifier);break;case Navigator.MouseButtons.MIDDLE:this.currentManipulator.manipulator.seek(this.mouseManipulatorEvent.nativeEvent)}}this.currentManipulator.clickTimer=null}),dt.prototype.constructor=dt,dt.prototype.updateInfo=function(t,e,i,a,o){this.mouseManipulatorEvent=t,this.clickPos=e,this.keyboardModifier=i,this.longPress=a,this.currentManipulator=o};var Tt=Et;function St(t){this.manipulator=t,this.manipulator.activeManipulator=this,this.tapTimer=null,this.manipulator.setDefaultAction(Navigator.DefaultAction.ROTATE)}function Lt(t,e){2!==t.currentTouches.touches.length&&console.log("GesturetouchManipulatorEvent only handles exactly two touches"),this.manipulator=e;var i=t.currentTouches.getByIndex(0),a=t.currentTouches.getByIndex(1),o=t.currentTouches.touches[0].getPositionPercent(),r=t.currentTouches.touches[1].getPositionPercent(),n=new THREE.Vector2((o.x+r.x)/2,(o.y+r.y)/2);this.rotateGestureCenter=new THREE.Vector2(n.x,n.y);var s=t.previousTouches.getById(i.getId()),u=t.previousTouches.getById(a.getId()),l=s.getPositionPercent(),c=u.getPositionPercent(),h=new THREE.Vector2((l.x+c.x)/2,(l.y+c.y)/2),p=new THREE.Vector2(o.x-r.x,o.y-r.y),g=new THREE.Vector2(l.x-c.x,l.y-c.y);if(this.dragGesture=new THREE.Vector2(n.x-h.x,n.y-h.y),Navigator.Utilities.isVectorZero(p)||Navigator.Utilities.isVectorZero(g))return this.rotateGestureAngle=0,void(this.pinchGestureAmount=0);this.rotateGestureAngle=Navigator.Utilities.vectorAngle(p,g),this.pinchGestureAmount=p.length()-g.length()}function Mt(t,e,i){this.touchManipulatorEvent=t,this.longTouch=i,this.manipulator=e}St.prototype={constructor:St},Object.defineProperties(St.prototype,{manipulatorType:{get:function(){return Navigator.ManipulatorType.TouchManipulator}}}),St.prototype.setDefaultAction=function(){this.manipulator.setDefaultAction(Navigator.DefaultAction.ROTATE)},St.prototype.processEvent=function(t){var e=!1;if(t instanceof Navigator.HoverManipulatorEvent){var i=t.getState();i===Navigator.HoverState.BEGIN?this.manipulator.hover(t.getPosition(),t.getButton()):this.manipulator.hoverEnd(i===Navigator.HoverState.END_MOVED)}else if(t instanceof Navigator.TouchManipulatorEvent){switch(t.currentTouches.eventType){case Navigator.TouchEventType.MOVE:switch(t.currentTouches.touches.length){case 1:if(!t.isDragging)break;var a=t.getCurrentTouchPos(0),o=t.getPreviousTouchPos(0),r=new THREE.Vector2(o.x-a.x,o.y-a.y),n=this.manipulator.getState();if(n===Navigator.NavigationState.DRAGGING)this.manipulator.move(a),e=!1;else if(n===Navigator.NavigationState.AREAZOOMREADY)e=this.manipulator.setState(Navigator.NavigationState.AREAZOOM),this.manipulator.areaZoomStart(o),this.manipulator.areaZoomUpdate(a);else if(n===Navigator.NavigationState.AREAZOOM)e=this.manipulator.setState(Navigator.NavigationState.AREAZOOM),this.manipulator.areaZoomUpdate(a);else if(this.manipulator.isDefaultAction(Navigator.DefaultAction.ROTATE)){if(!this.manipulator.isRotateState(n)){if(this.manipulator.viewPoint.getUpVecLocked())return e=this.manipulator.setState(Navigator.NavigationState.ROTATE),void this.manipulator.redrawIfNeeded(e);e=Navigator.Utilities.epsilonCompare(o.x,Navigator.edgeWidth)<0||Navigator.Utilities.epsilonCompare(o.x,1-Navigator.edgeWidth)>0?this.manipulator.setState(Navigator.NavigationState.XROLL):Navigator.Utilities.epsilonCompare(o.y,Navigator.edgeWidth)<0?this.manipulator.setState(Navigator.NavigationState.ZROLL):Navigator.Utilities.epsilonCompare(o.y,1-Navigator.edgeWidth)>0?this.manipulator.setState(Navigator.NavigationState.YROLL):this.manipulator.setState(Navigator.NavigationState.ROTATE)}switch(this.manipulator.getState()){case Navigator.NavigationState.XROLL:e=this.xRoll(r);break;case Navigator.NavigationState.YROLL:e=this.yRoll(r);break;case Navigator.NavigationState.ZROLL:e=this.zRoll(o,a);break;case Navigator.NavigationState.ROTATE:r.negate(),e=this.manipulator.rotate(r);break;default:PLMVisRL.logger.warning("Unexpected State")}}else this.manipulator.isDefaultAction(Navigator.DefaultAction.TRANSLATE)?(r.negate(r),e=this.manipulator.setState(Navigator.NavigationState.TRANSLATE)||this.manipulator.translate(r)):this.manipulator.isDefaultAction(Navigator.DefaultAction.ZOOM)?e=this.manipulator.setState(Navigator.NavigationState.ZOOM)||this.manipulator.zoom(r):PLMVisRL.logger.warning("Unexpected default State");break;case 2:var s=new Lt(t,this.manipulator);e=this.manipulator.zoomByScale(s.pinchGestureAmount)||e,e=this.manipulator.zRollAboutPoint(s.rotateGestureCenter,s.rotateGestureAngle)||e,e=this.manipulator.translate(s.dragGesture)||e,e=this.manipulator.setState(Navigator.NavigationState.GESTURE)||e}break;case Navigator.TouchEventType.UP:if(null!==this.tapTimer&&this.tapTimer.cancel(),this.manipulator.getState()===Navigator.NavigationState.AREAZOOM)return this.manipulator.areaZoomEnd(),this.manipulator.setState(Navigator.NavigationState.FIXED),void this.manipulator.redrawIfNeeded(!0);t.isLongTouch?(this.tapTimer=new Mt(t,this.manipulator,!0),this.tapTimer.run()):t.isTapping&&(this.tapTimer=new Mt(t,this.manipulator,!1),this.tapTimer.schedule(250)),0===t.getTouchCount()&&(this.manipulator.getState()===Navigator.NavigationState.DRAGGING?(this.manipulator.setState(Navigator.NavigationState.FIXED),this.manipulator.moveEnd()):e=this.manipulator.setState(Navigator.NavigationState.FIXED))}this.manipulator.redrawIfNeeded(e)}else PLMVisRL.logger.info("Not a touchManipulatorEvent. Early out.")},St.prototype.xRoll=function(t){return this.manipulator.xRoll(t.y*(Math.PI/2))},St.prototype.yRoll=function(t){return this.manipulator.yRoll(t.x*(Math.PI/2))},St.prototype.zRoll=function(t,e){var i=new THREE.Vector2(.5,.5),a=Navigator.Utilities.pointAngle(t,i)-Navigator.Utilities.pointAngle(e,i);return this.manipulator.zRoll(a)},Lt.prototype={constructor:Lt};Mt.prototype=new S(null,null,function(){if(this.touchManipulatorEvent.tapCanceled)PLMVisRL.logger.info("Tap Canceled.");else if(this.longTouch||1===this.touchManipulatorEvent.tapCount){var t=new Navigator.KeyboardModifier;this.longTouch&&this.manipulator.notifyLongPress(),t.updateLocalFlags(!1,!1,!1),this.manipulator.raySelect(this.touchManipulatorEvent.lastTapPos,t)}else 2===this.touchManipulatorEvent.tapCount&&this.manipulator.viewAll()}),Mt.prototype.constructor=Mt;var Rt=St;function Ot(){this.button,this.previousTouches,this.currentTouches,this.latestTouches=null,this.firstTouchStartPos=new THREE.Vector2,this.lastTouchStartPos=new THREE.Vector2,this.lastTapPos,this.isDragging=!1,this.isLongTouch=!1,this.isTapping=!1,this.tapTimerMap=new Map,this.tapThreshold=.03,this.tapCount=0,this.tapCanceled,this.multiTapTimer,this.tapTimer}function Pt(){this.latestTouches=null,this.currentTouches=null,PLMVisRL.logger.warning("A move event occured on a touch we aren't tracking. Most likely caused by having one finger down outside the canvas,then putting another down inside the canvas.")}function wt(t){null!=t&&(this.button&=~Navigator.MouseButtons.CONTROL,t.ctrlKey&&(this.button|=Navigator.MouseButtons.CONTROL),this.button&=~Navigator.MouseButtons.ALT,t.atlKey&&(this.button|=Navigator.MouseButtons.ALT),this.button&=~Navigator.MouseButtons.SHIFT,t.shiftKey&&(this.button|=Navigator.MouseButtons.SHIFT))}function It(){this.previousTouches=this.latestTouches,this.latestTouches=this.currentTouches}function Dt(){switch(this.currentTouches.eventType){case Navigator.TouchEventType.DOWN:if(this.currentTouches.getNumTouches()>0){var t=this.currentTouches.getNumTouches()-1,e=this.currentTouches.getByIndex(t);this.lastTouchStartPos=e.getPositionPercent(),0===t&&(this.firstTouchStartPos=this.lastTouchStartPos,this.isDragging=!1),this.tapTimer=new Ut(e.getId(),this),this.tapTimerMap.set(e.getId(),this.tapTimer),this.tapTimer.schedule(500),this.isLongTouch=!1;break}break;case Navigator.TouchEventType.UP:0===this.currentTouches.getNumTouches&&(this.isDragging=!1,this.latestTouches=null);var i=this.previousTouches.getTouches();for(var a in i)if(i[a].getId){var o=i[a],r=i[a].getId();if(null!==this.currentTouches.getById(r))continue;if(!this.tapTimerMap.has(r)){var n=o.getPositionPercent();this.isLongTouch=Navigator.Utilities.epsilonEquals(n,this.lastTouchStartPos,this.tapThreshold),this.isLongTouch&&(this.lastTapPos=n)}}if(0===this.tapTimerMap.size)return this.isTapping=!1,void(this.tapCount=0);var s=function(t,e){if(null===this.currentTouches.getById(e))if(null!==this.previousTouches.getById(e)){PLMVisRL.logger.info("TouchManipEvent - touchId: "+e),PLMVisRL.logger.info("previousTouches size: "+this.previousTouches.getNumTouches());var i=this.previousTouches.getById(e).getPositionPercent();this.isTapping?(this.multiTapTimer.cancel(),Navigator.Utilities.epsilonEquals(i,this.lastTapPos,this.tapThreshold)?(this.tapCount++,this.multiTapTimer.schedule(250)):(this.isTapping=!1,this.tapCount=0,this.tapCanceled=!0)):Navigator.Utilities.epsilonEquals(i,this.lastTouchStartPos,this.tapThreshold)?(this.isTapping=!0,this.tapCount=1,this.multiTapTimer=new Bt(this),this.multiTapTimer.schedule(250),this.tapCanceled=!1):(this.isTapping=!1,this.tapCount=0,this.tapCanceled=!0),this.lastTapPos=i,this.tapTimerMap.get(e).cancel(),this.tapTimerMap.delete(e),PLMVisRL.logger.info("TouchManipEvent - 1-7")}else PLMVisRL.logger.info("This should never happen, previousTouches doesn't have the existingTouchId")}.bind(this);this.tapTimerMap.forEach(s);break;case Navigator.TouchEventType.MOVE:var u=this.currentTouches.getByIndex(0).getPositionPercent();this.isDragging=this.isDragging||!Navigator.Utilities.epsilonEquals(u,this.firstTouchStartPos,this.tapThreshold)}}Ot.prototype={constructor:Ot},Ot.prototype.updateTouchEvent=function(t){null!=t&&(wt.call(this,t),this.currentTouches=new Vt(t,this.relativeElement),It.call(this),Dt.call(this))},Ot.prototype.updatePointerEvent=function(t,e,i){this.pointerId=t.pointerId;var a=t.pageX-Navigator.Utilities.getSubPixelAbsoluteLeft(i),o=t.pageY-Navigator.Utilities.getSubPixelAbsoluteTop(i);this.currentTouches=null!==this.latestTouches?this.latestTouches.clone():new Vt;var r=this.currentTouches.getById(t.pointerId);switch(e!==Navigator.TouchEventType.MOVE&&e!==Navigator.TouchEventType.UP||null!==r||Pt.call(this),wt.call(this,t),e){case Navigator.TouchEventType.DOWN:try{this.currentTouches.addTouch(new xt(null,this.relativeElement,i,a,o,t.pointerId),e)}catch(t){Pt.call(this)}break;case Navigator.TouchEventType.UP:this.currentTouches.removeTouch(t.pointerId,e);break;case Navigator.TouchEventType.MOVE:(function(t,e,i,a,o){this.currentTouches.removeTouch(i,o);var r=new xt(null,this.relativeElement,a,t,e,i);this.currentTouches.addTouch(r,o)}).call(this,a,o,t.pointerId,i,e);break;default:return}It.call(this),Dt.call(this)},Ot.prototype.getCurrentTouchPos=function(t){return this.currentTouches.getByIndex(t).getPositionPercent()},Ot.prototype.getPreviousTouchPos=function(t){return this.previousTouches.getByIndex(t).getPositionPercent()},Ot.prototype.getTouchCount=function(){return this.currentTouches.getNumTouches()},Ot.prototype.setRelativeElement=function(t){this.relativeElement=t},Ot.prototype.clearLatestTouches=function(){this.latestTouches=null};var Ct=Ot;function Vt(t,e){if(this.touches=[],this.eventType=null,t){this.relativeElement=e;for(var i=t.touches,a=0;a<i.length;a++)this.touches.push(new xt(i[a],this.relativeElement));"touchmove"===t.type?this.eventType=Navigator.TouchEventType.MOVE:"touchstart"===t.type?this.eventType=Navigator.TouchEventType.DOWN:"touchend"!==t.type&&"touchcancel"!==t.type||(this.eventType=Navigator.TouchEventType.UP)}}function xt(t,e,i,a,o,r){i?(this.target=i,this.position=new THREE.Vector2(a,o),this.touchId=r):(this.target=t.target,this.position=new THREE.Vector2(Navigator.Utilities.getRelativeX(t,this.target),Navigator.Utilities.getRelativeY(t,this.target)),this.touchId=t.identifier)}Vt.prototype={constructor:Vt},Vt.prototype.addTouch=function(t,e){null!==this.getById(t.getId())&&PLMVisRL.logger.warning("Cannot add a new touch with the same ID as a current touch"),this.touches.push(t),this.eventType=e},Vt.prototype.removeTouch=function(t,e){for(var i in this.eventType=e,this.touches)if(this.touches[i].getId()===t)return void this.touches.splice(i,1)},Vt.prototype.clone=function(){var t=new Vt;return t.touches=this.touches.slice(0),t},Vt.prototype.getById=function(t){for(var e in this.touches)if(this.touches[e].getId()===t)return this.touches[e];return null},Vt.prototype.getNumTouches=function(){return this.touches.length},Vt.prototype.getByIndex=function(t){return this.touches[t]},Vt.prototype.getTouches=function(){return this.touches},xt.prototype={constructor:xt},xt.prototype.getPositionPercent=function(){return Navigator.Utilities.getMousePositionAsPercentageFromValues(this.position.x,this.position.y,this.target.clientWidth,this.target.clientHeight)},xt.prototype.getId=function(){return this.touchId};var bt=function(){this.tapTimerMap.delete(this.touchId)};function Ut(t,e){this.tapTimerMap=e.tapTimerMap,this.touchId=t}function Bt(t){this.touchManipulatorEvent=t}function kt(t){this.manipulator=t,this.upVecLocked=!1,this.maintainLookFrom=!1,this.matrixDirty=!0}Ut.prototype=new S(null,null,bt),Ut.prototype.constructor=Ut,bt=function(){PLMVisRL.logger.info("MultiTap Timed out."),this.touchManipulatorEvent.isTapping=!1},Bt.prototype=new S(null,null,bt),Bt.prototype.constructor=Bt,kt.prototype={constructor:kt};var Ht=new THREE.Vector3,Ft=new THREE.Vector3,_t=new THREE.Vector3,Zt=new THREE.Vector3,Xt=new THREE.Vector3,Gt=new THREE.Vector3;function zt(){Zt.fromArray(this.getLookFrom()),Xt.fromArray(this.getLookAt()),Gt.fromArray(this.getUpVec()),Ht.subVectors(Zt,Xt),Navigator.Utilities.epsilonIsZero(Navigator.Utilities.epsilon(Ht.length()),Ht)&&(this.setLookFrom(new THREE.Vector3(Zt.x+1,Zt.y,Zt.z).toArray()),Ht.subVectors((new THREE.Vector3).fromArray(this.getLookFrom()),Xt)),Ht.normalize(),Ft.crossVectors(Gt,Ht),Navigator.Utilities.epsilonIsZero(Navigator.Utilities.epsilon(Ft.length()),Ft)&&(_t.crossVectors(Ht,new THREE.Vector3(1,0,0)),Navigator.Utilities.epsilonIsZero(Navigator.Utilities.epsilon(_t.length()),_t)?this.setUpVec([Gt.x,Gt.y+1,Gt.z]):this.setUpVec([Gt.x+1,Gt.y,Gt.z])),this.matrixDirty=!1,this.manipulator.computeNearFarClip(),this.manipulator.updateCameraMatrices()}kt.prototype.setUpVecLocked=function(t){this.upVecLocked=t},kt.prototype.getUpVecLocked=function(){return this.upVecLocked},kt.prototype.setMaintainLookFrom=function(t){this.maintainLookFrom=t},kt.prototype.getMaintainLookFrom=function(){return this.maintainLookFrom},kt.prototype.set=function(t,e,i,a){Zt.fromArray(t),Xt.fromArray(e),Gt.fromArray(i),Navigator.Utilities.epsilonIsZero(Navigator.Epsilon,Gt)&&PLMVisRL.logger.warning("The up vector cannot be a zero vector"),this.manipulator.camera.position.copy(Zt),this.manipulator.camera.up.copy(Gt),this.manipulator.setLookAt(Xt.toArray()),this.manipulator.camera.lookAt(Xt),null!=a&&this.setPreferences(a),this.matrixDirty=!0,this.manipulator.computeNearFarClip(),this.manipulator.updateCameraMatrices()},kt.prototype.setLookAt=function(t){Xt.fromArray(t),this.manipulator.setLookAt(Xt.toArray()),this.manipulator.camera.lookAt(Xt),this.matrixDirty=!0,this.manipulator.computeNearFarClip(),this.manipulator.updateCameraMatrices()},kt.prototype.getLookAt=function(){return(new THREE.Vector3).fromArray(this.manipulator.camLookAt).toArray()},kt.prototype.setLookFrom=function(t){Zt.fromArray(t),this.manipulator.camera.position.copy(Zt),this.matrixDirty=!0,this.manipulator.computeNearFarClip(),this.manipulator.updateCameraMatrices()};var Wt=new THREE.Vector3,Qt=new THREE.Vector3,Kt=new THREE.Vector3;kt.prototype.setLookFromUsingViewVec=function(t){Qt.fromArray(t);var e=Kt.fromArray(this.getViewVec()).length();Wt.fromArray(this.getLookAt()),Wt.sub(Qt),this.setLookFrom(Wt.toArray()),this.setFromDistance(e)},kt.prototype.setFromDistance=function(t){if(0!==t){Qt.fromArray(this.getViewVec()),Qt.normalize(),Qt.multiplyScalar(t);var e=(new THREE.Vector3).fromArray(this.manipulator.camLookAt);e.sub(Qt),Navigator.Utilities.epsilonAreEqual((new THREE.Vector3).fromArray(this.manipulator.camLookAt),e)||this.setLookFrom(e.toArray())}},kt.prototype.getLookFrom=function(){return(new THREE.Vector3).copy(this.manipulator.camera.position).toArray()},kt.prototype.setUpVec=function(t){Gt.fromArray(t),Navigator.Utilities.epsilonIsZero(Navigator.Epsilon,Gt)&&PLMVisRL.logger.warning("The up vector cannot be a zero vector"),this.manipulator.camera.up.copy(Gt),this.matrixDirty=!0,this.manipulator.computeNearFarClip(),this.manipulator.updateCameraMatrices()},kt.prototype.getUpVec=function(){return(new THREE.Vector3).copy(this.manipulator.camera.up).toArray()},kt.prototype.getViewVec=function(){var t=new THREE.Vector3,e=new THREE.Vector3,i=this.manipulator.camera.position.clone();return e.fromArray(this.manipulator.camLookAt),t.subVectors(e,i),t.toArray()};var Yt=new THREE.Matrix4,qt=new THREE.Matrix4;kt.prototype.getViewpointMatrix=function(){return this.matrixDirty&&zt.call(this),this.manipulator.camera.matrixWorldInverse.toArray()},kt.prototype.getViewpointMatrixInv=function(){return this.matrixDirty&&zt.call(this),Yt.copy(this.manipulator.camera.matrixWorldInverse),qt.getInverse(Yt).toArray()};var jt=new THREE.Vector3,Jt=new THREE.Vector3;kt.prototype.roll=function(t){return Jt.fromArray(this.getViewVec()),Jt.normalize(),this.rotateLookFrom(Jt.toArray(),t)},kt.prototype.translateLookAt=function(t){Jt.fromArray(t),null!=Jt&&(jt.fromArray(this.manipulator.camLookAt),jt.add(Jt),this.setLookAt(jt.toArray()))},kt.prototype.translateLookFrom=function(t){Jt.fromArray(t),null!=Jt&&((jt=this.manipulator.camera.position.clone()).add(Jt),this.setLookFrom(jt.toArray()))},kt.prototype.translate=function(t){if(Jt.fromArray(t),Navigator.Utilities.epsilonIsZero(Navigator.Epsilon,Jt))return!1;this.manipulator.camera.position.add(Jt);var e=(new THREE.Vector3).fromArray(this.manipulator.camLookAt);return e.add(Jt),this.manipulator.setLookAt(e.toArray()),this.manipulator.camera.lookAt(e),this.matrixDirty=!0,this.manipulator.computeNearFarClip(),this.manipulator.updateCameraMatrices(),!0};var $t=new THREE.Vector3,te=new THREE.Matrix4,ee=new THREE.Matrix4,ie=new THREE.Vector3,ae=new THREE.Vector3;Qt=new THREE.Vector3;var oe=new THREE.Vector3,re=new THREE.Vector3;kt.prototype.rotate=function(t,e,i){if(oe.fromArray(t),re.fromArray(e),Navigator.Utilities.epsilonIsZero(Navigator.Epsilon,re)||Navigator.Utilities.epsilonCompare(Math.abs(i),Navigator.Epsilon)<0)return!1;$t.fromArray(this.manipulator.camLookAt);var a=i*Navigator.DegreesToRadians;if(ie.copy(oe),ae.copy(ie),ae.negate(),te.makeTranslation(ae.x,ae.y,ae.z),Navigator.Utilities.rotateMatrix4(re,a,te),ee.makeTranslation(ie.x,ie.y,ie.z),ee.multiply(te),Navigator.Utilities.mulPoint(this.manipulator.camera.position,ee),Navigator.Utilities.mulPoint($t,ee),this.getUpVecLocked()&&(Qt.subVectors($t,this.manipulator.camera.position),Navigator.Utilities.isUpVecTooClose(Qt,this.manipulator.camera.up.clone())))return!1;var o=(new THREE.Vector3).copy(this.manipulator.camera.up);return this.getUpVecLocked()||Navigator.Utilities.mulVector(o,ee),this.manipulator.camera.up.copy(o),this.manipulator.setLookAt($t.toArray()),this.manipulator.camera.lookAt($t),this.matrixDirty=!0,this.manipulator.computeNearFarClip(),this.manipulator.updateCameraMatrices(),!0},kt.prototype.VPCSToWCSVector=function(t){this.matrixDirty&&zt.call(this);var e=new THREE.Matrix4,i=new THREE.Matrix4;return e.copy(this.manipulator.camera.matrixWorldInverse),i.getInverse(e),Navigator.Utilities.mulVector(t,i),t},kt.prototype.rotateLookAt=function(t,e){return this.rotate(this.manipulator.camera.position.clone().toArray(),t,e)},kt.prototype.rotateLookFrom=function(t,e){return this.rotate(this.manipulator.camLookAt,t,e)},kt.prototype.translateLookAtVPCS=function(t){Jt.fromArray(t),this.translateLookAt(this.VPCSToWCSVector(Jt).toArray())},kt.prototype.translateLookFromVPCS=function(t){Jt.fromArray(t),this.translateLookFrom(this.VPCSToWCSVector(Jt).toArray())},kt.prototype.translateVPCS=function(t){return Jt.fromArray(t),this.translate(this.VPCSToWCSVector(Jt).toArray())},kt.prototype.rotateVPCS=function(t,e,i){return oe.fromArray(t),re.fromArray(e),this.rotate(this.VPCSToWCSVector(oe).toArray(),this.VPCSToWCSVector(re).toArray(),i)},kt.prototype.rotateLookAtVPCS=function(t,e){return re.fromArray(t),this.rotateLookAt(this.VPCSToWCSVector(re).toArray(),e)},kt.prototype.rotateLookFromVPCS=function(t,e){return re.fromArray(t),this.rotateLookFrom(this.VPCSToWCSVector(re).toArray(),e)};var ne=new THREE.Vector3;kt.prototype.rotateUpVecFrom=function(t){ne.fromArray(t);var e=Navigator.RadiansToDegrees*new THREE.Vector3(this.getUpVec()).angleTo(ne),i=this.VPCSToWCSVector(new THREE.Vector3(0,0,-1));Navigator.Utilities.epsilonIsZero(Navigator.Epsilon,i)?Math.abs(e-180)<.001&&(this.setUpVec(ne.toArray()),Jt.fromArray(this.getViewVec()),Jt.multiplyScalar(-2),this.translateLookAt(Jt)):(this.rotateLookAt(i.toArray(),e),this.setUpVec(ne.toArray()))},kt.prototype.rotateUpVecTo=function(t){ne.fromArray(t);var e=Navigator.RadiansToDegrees*(new THREE.Vector3).fromArray(this.getUpVec()).angleTo(ne);re.cross((new THREE.Vector3).fromArray(this.getUpVec()),ne),Navigator.Utilities.epsilonIsZero(Navigator.Epsilon,re)?Math.abs(e-180)<.001&&(this.setUpVec(ne.toArray()),Jt.fromArray(this.getViewVec()),Jt.multiplyScalar(2),this.translateLookFrom(Jt.toArray())):(this.rotateLookFrom(re.toArray(),e),this.setUpVec(ne.toArray()))},kt.prototype.setPreferences=function(t){t.upVecLocked&&!this.getUpVec().equals(t.upVec)&&(this.setUpVecLocked(!1),t.maintainLookFrom?this.rotateUpVecFrom(ne.fromArray(t.upVec)):this.rotateUpVecTo(t.upVec)),this.setUpVecLocked(t.upVecLocked),this.setMaintainLookFrom(t.maintainLookFrom),this.setUpVec(t.upVec)},kt.prototype.getPreferences=function(){return{upVecLocked:this.getUpVecLocked(),upVec:this.getUpVec(),maintainLookFrom:this.getMaintainLookFrom()}};var se=kt;function ue(t){this.bWidth=t.width,this.bHeight=t.height,this.layeredCanvas=new Navigator.LayeredCanvas(t),this.rect=null,this.startPoint=null}ue.prototype.areaSelectionStart=function(t){this.startPoint=t,this.layeredCanvas.enable()},ue.prototype.areaSelectionUpdate=function(t){this.rect&&this.layeredCanvas.clearRect(this.rect),this.rect=function(t,e,i,a){var o=parseInt(e.x*i),r=parseInt(e.y*a),n=parseInt(t.x*i),s=parseInt(t.y*a),u=Math.abs(n-o),l=Math.abs(s-r),c=o,h=r;n-o<0&&(c=n);s-r<0&&(h=s);return new Navigator.ScreenRectangle(c,h,u,l)}(t,this.startPoint,this.bWidth,this.bHeight);var e=this.startPoint.x<t.x,i=e?"red":"blue",a=e?"rgba(255, 0, 0, 0.2)":"rgba(0, 0, 255, 0.2)";this.rect.drawRect(this.layeredCanvas.getLayeredCanvas(),2,i,a)},ue.prototype.areaSelectionEnd=function(t,e,i){this.rect&&(this.layeredCanvas.disable(this.rect),this.rect=null),e.volumeSelect(this.startPoint,t,i)},ue.prototype.disable=function(){this.layeredCanvas.disable(this.rect)},ue.prototype.areaQueryEnd=function(t,e){this.rect&&(this.layeredCanvas.disable(this.rect),this.rect=null),e.volumeQuery(this.startPoint,t)};var le=ue;function ce(t,e){this.canvas=t,this.cursorFolder=function(t){var e=null!=t?t:"";return e.replace(/\\/g,"/"),"/"!==e[0]&&(e="/"+e),"/"!==e.charAt(e.length-1)&&(e+="/"),"http://"+document.location.host+e}.call(this,e),this.urls=[],this.cursorResources=function(){if(window.navigator.userAgent.indexOf("Trident")>0)return!0;return!1}.call(this)||function(){if(window.navigator.userAgent.indexOf("Edge")>-1)return!0;return!1}.call(this)?Navigator.Browser.IE:Navigator.Browser.OTHER,function(t,e){switch(t){case Navigator.Browser.IE:this.urls[Navigator.Type.NONE]="",this.urls[Navigator.Type.ZOOMAREA]=e+"zoomarea.cur",this.urls[Navigator.Type.ROTATE]=e+"rotate.cur",this.urls[Navigator.Type.XROLL]=e+"xroll.cur",this.urls[Navigator.Type.YROLL]=e+"yroll.cur",this.urls[Navigator.Type.ZROLL]=e+"zroll.cur",this.urls[Navigator.Type.ZOOM]=e+"zoom.cur",this.urls[Navigator.Type.TRANSLATE]=e+"translate.cur",this.urls[Navigator.Type.EXPLORE]=e+"explore.cur",this.urls[Navigator.Type.LOOK]=e+"look.cur",this.urls[Navigator.Type.DRAG]=e+"drag.cur";break;case Navigator.Browser.OTHER:this.urls[Navigator.Type.NONE]="",this.urls[Navigator.Type.ZOOMAREA]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMBRIIDxzCi0AAAACHSURBVFjD7ZRLDsAgCERnTO/qmTgtXZn0kyaCaNOUt+vC8kQGIEmSv0PHGbl811UCAgCqev4BOSTSKyCtcCv4IGKW2Ey25K3wihkQVe0q7ulCeTsF3QLRrQ/twCEJ81PwNJjeFJTRm48+TeQici2kyFUsHgkGD7VZghOSZZKYsYgqkiRJvsQOWFUrf8JeH3gAAAAASUVORK5CYII=",this.urls[Navigator.Type.ROTATE]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMBRIDLrNfQtUAAADXSURBVFjD7ZdRC8QgDIPN4f//y7mXCbVE1qqHcOibjJlvaZttKM8iWU6sTzm8LsAF+B8AAATAIwAAOJsjNSNi9ySxKh52oImT7BJTiWdLgbcotuLPvgTu6VxadsCLkwRJWBh3XZYtDWAPUE8VgVh2wB6kLPUQfv/mwpYxVE5EXagzM6/ciDTclAOjJ5tJvTSAa7hOdAShGndHEMmaegifGZHSINIw6uBRmVRm7AiilvtFzX27nhVPTYF9+Shx4URoKups93rxn41hRHzpW+L+mFyAC3Aa4AsiSqk+SgATJgAAAABJRU5ErkJggg==",this.urls[Navigator.Type.XROLL]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMBRIFAtfdibAAAAC0SURBVFjD7ZbLDsQgCEU9E///l5lNSYiRGbC1bnApKRyuPIqItJPn0w6fAiiAAjgO0Fc+AqbTS0TYDgCINz0vG9ueYAwONMAq4Krj+ozuAhtcg2q2GtTao0r0leCjcwuSXW4Yx6+uRYXuw+Us+9R9UNH5E1iDJZ0Vn97fVSJdhL8K7F+t3GrDK+OQ08e7wBapld1rwy1P4A2iMXAm+zRAYBSn9wFLsj24jKjf8gIogAI4DfAFl3uVMciIC9cAAAAASUVORK5CYII=",this.urls[Navigator.Type.YROLL]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMBRIFLAsLhH8AAACzSURBVFjD7ZdBDsMgDAQziP9/eXspEUGOGkNalxZuHKIdrb3YQdIWedIWfPLIx8BunyRCHBgtYXgJFsDcAJIA4gAAlRTUkXwrQBGqxUsceyDSHeIjEKnHbqv25e6FSF7xswas7x6IuVIAHIaO0YhuoLkeole1PUvHVzvAVeLm1WtdOewGba/c4kAbMyOWbnH3SvaEkLUJVXCuGOSe7FvD5+M7Ya/g2ogWwO8BjI5j/v7v+AH2IogyuQta7gAAAABJRU5ErkJggg==",this.urls[Navigator.Type.ZROLL]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMBRIIOdN4HtkAAADpSURBVFjD7ZfBCsQwCEQzof//y7MnwRU1ui2kCwnkEJLo06m2Bcmxc8yxeRyAA1ACAEAAfPpsKwMkx8owAHbLuiVBBvGL8yWAl04PwnNelQIRtVxO9gdJZJEDEGi0MmCdiyHrXIx7++Y+2xJUnKuzS4gygKa1zvRaNFbZ+oKw6ygLM4s+ilx0lxlBZPZkXMXyQ6NU8f+d0NPOS7VMK433LJUBdAqtdhZCZtSM9DqSZiapXEJknTAq49d1QmQloiPV55z+QLtfrYq5KilroNoJvbu3X8ee8wzi0e+BzPkdCJwfkwNwAHYDfAAoGP5BDvjvAAAAAABJRU5ErkJggg==",this.urls[Navigator.Type.ZOOM]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMBRIGAvzw2nMAAAB/SURBVFjD7ZbBCoAwDEOb4f//8vPiQEUP7ZShJJdBx8ijo9kExEy1mCwDGODbAJKQxBQASQABxAhEGzHvGoFoFfNt3dcOexkt2QOArsx63WNoAAMY4PUguku7Xs8GUroD3eD8FlTTsHQFgM5vQTWKNfItr7b9MQCPoQEM8AuAFX5oPzuWW2piAAAAAElFTkSuQmCC",this.urls[Navigator.Type.TRANSLATE]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMBRIEKWJ6QbEAAAC6SURBVFjD7ZbhCsAgCIQ76f1f+fYnocVoaQ0Z6J9Bq/w27yyQLJEhJTgSIAH+DQCAABgCAIAkC8myAyE7yTV2IMSTvD37sds7S1TrApJ4Sqbjn/0By9dZ5srpDa1r8HYaquD6mvfiG/UwCPO1NFOAUe1Ox0whwjtheAnqiu1UUP1mMxu2Fr1kTbF439MvjvUBC4Rlbj3l76cyfXIWaILxMPKWymXDJsxlr2/ZcKUc3uTbAHknTIAEOBEXwZmIMqXJtZEAAAAASUVORK5CYII=",this.urls[Navigator.Type.EXPLORE]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAASdAAAEnQB3mYfeAAAAAd0SU1FB98CFxAQMOiPuZEAAADGSURBVFjD7VdRDsUgCLPk3f/K3ZcJjzhFMDFL4GebMloLygaS7aZJu2xFoAh8mwAAAuAVAgBIspFsGRKSAe+WISE7oOaq54Y+xwjogCRBEtbHjntJyI7cq6LT8960YNaMbK6t5IrY37P1HSmWKsIRULSrYvViV2G2yjd1Vqt3KUASKih09c/k9oC7U6ADvZGwgB5wVwqcu8MNWN3Q2i8i/Wx8NxUSOANgt2O/j9RB9CCCbUbRIkTmvyAq+zEC9U1YBIrACXsAGcycMaFRhzgAAAAASUVORK5CYII=",this.urls[Navigator.Type.LOOK]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAASdAAAEnQB3mYfeAAAAAd0SU1FB98CFw8tALPEJc4AAADJSURBVFjD7ZbBCsQwCEQd6f//sr2URboxcbIuhWIuTSF03kyiDcxMnhwqD48GaID3AAAwAHRNHxXCIiJmJgDkrwCRQ9/MHFCKBtlO6J1e71/ibq1kIfQX8Wju1lnZIRyJj/Z+lswWgHcxEp9BZFJQxn2URuQ6kwJdht71SIgtR92o+88zmpd3wvtH75FHBzQDo4nIsYo6OpyZXqBs9Kv9jtIo74QzOKYTgrmU+ppeOc3+Cw6yBOFBGKfl94EKcXoL+krWAA3wSoATQwuRTKd2QbkAAAAASUVORK5CYII=",this.urls[Navigator.Type.DRAG]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAAJdnBBZwAAACAAAAAgAIf6nJ0AAAB6SURBVEjH7VPLDsAgCGv3///cHcC5RBQzsxu9+IA2FBEoFFJIp3RlElzRLSiQHwQaPZO4Zs5JQQDk9JmVK6LTJbxI9rsNC1a6nrBeiZEVRvRFYweJ4wqGHpDytffAduvnHF4BkGyQ2inOPZ6D40nMrKR/YasbhcLvuAELdEX3ZJrbsAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNS0wNC0wOVQxNTo0Nzo1MC0wNDowMMYd64MAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTUtMDQtMDlUMTU6NDc6NTAtMDQ6MDC3QFM/AAAAAElFTkSuQmCC"}}.call(this,this.cursorResources,this.cursorFolder)}ce.prototype={constructor:ce},ce.prototype.clearCursors=function(){this.setCursor(Navigator.Target.CANVAS,Navigator.Type.NONE),this.setCursor(Navigator.Target.ROOT,Navigator.Type.NONE)},ce.prototype.setCursor=function(t,e){var i;switch(t){case Navigator.Target.CANVAS:i=this.canvas;break;case Navigator.Target.ROOT:i=document.body;break;default:i=null}if(i){var a=e===Navigator.Type.NONE||function(){return window.navigator.userAgent.indexOf("Trident/7.0")>0}.call(this)&&function(){return!!("ontouchstart"in window||window.DocumentTouch&&window.document instanceof DocumentTouch||window.navigator.maxTouchPoints||window.navigator.msMaxTouchPoints)}.call(this);i.style.cursor=a?"":"url("+function(t){return this.urls[t]}.call(this,e)+"),auto"}};var he=ce;function pe(t,e,i){this.renderer=t,this.clickTimer=null,this.camera=e.camera,this.manipulator=e,this.manipulator.activeManipulator=this,this.mouseManipulator=new Navigator.MouseManipulator(this.manipulator),this.mouseWheelIntervalSequence=new Navigator.IntervalSequence(100,Navigator.Algorithm.LASTPLUSNOISE),this.manipulator.setDefaultAction(Navigator.DefaultAction.ROTATE),this.mouseoutFuncCanvas=function(){this.canvas&&(this.panOn=!1,this.canvas.removeEventListener("mouseout",this.mouseoutFuncCanvas,!1),this.canvas=null)}.bind(this),this.canvas=null,this.panOn=!1,this.panStartX=0,this.panStartY=0,this.touchZoomStartDist=0,this.touch=i;var a=function(){this.mouseWheelIntervalSequence.clear()}.bind(this);this.mouseWheelSequenceClearTimer=new S(null,null,a);var o=function(){this.mouseWheelSequenceClearTimer.schedule(500),this.manipulator.setState(Navigator.NavigationState.FIXED),this.manipulator.redrawIfNeeded(!0)}.bind(this);this.mouseWheelFinalRedrawTimer=new S(null,null,o)}pe.prototype={constructor:pe},Object.defineProperties(pe.prototype,{manipulatorType:{get:function(){return this.touch?Navigator.ManipulatorType.TouchManipulator:Navigator.ManipulatorType.Manipulator2D}}}),pe.prototype.setDefaultAction=function(){this.manipulator.setDefaultAction(Navigator.DefaultAction.ROTATE)},pe.prototype.processEvent=function(t,e){var i=!1;if(!(t instanceof Navigator.HoverManipulatorEvent))if(t instanceof Navigator.TouchManipulatorEvent){var a=this.canvas,o=0,r=0,n=0,s=0;switch(t.currentTouches.touches&&t.currentTouches.touches.length>0&&(a=t.currentTouches.touches[0].target,o=t.currentTouches.touches[0].position.x,r=t.currentTouches.touches[0].position.y),t.currentTouches.touches&&t.currentTouches.touches.length>1&&(n=t.currentTouches.touches[1].position.x,s=t.currentTouches.touches[1].position.y),t.currentTouches.eventType){case Navigator.TouchEventType.DOWN:if(1===t.currentTouches.touches.length)this.canvas=a,this.panOn=!0,this.panStartX=o,this.panStartY=r,this.renderer.startPan();else if(t.currentTouches.touches.length>1){var u=o-n,l=r-s,c=Math.sqrt(u*u+l*l);this.touchZoomStartDist=c}break;case Navigator.TouchEventType.MOVE:switch(t.currentTouches.touches.length){case 1:if(this.panOn){var h=this.panStartX-o,p=r-this.panStartY;this.renderer.set2DNormalizedTranslation(h,p),i=!0}break;case 2:this.manipulator.setState(Navigator.NavigationState.ZOOM);u=o-n,l=r-s,c=Math.sqrt(u*u+l*l);(A=this.touchZoomStartDist-c)>0?this.renderer.set2DRelativeScale(1.1):this.renderer.set2DRelativeScale(.9),i=!0}break;case Navigator.TouchEventType.UP:this.panOn=!1}this.manipulator.redrawIfNeeded(i)}else{var g=t.getEvent();if(t instanceof Navigator.MouseManipulatorEvent){if("mousemove"===g.type){if(this.panOn){if(this.renderer.getMouseMoveIsPan()){h=this.panStartX-g.offsetX,p=g.offsetY-this.panStartY;this.renderer.set2DNormalizedTranslation(this.panStartX,this.panStartY,g.offsetX,g.offsetY)}else{var v=g.offsetY-this.panStartY;this.panStartY=g.offsetY;var A=1+.075*v;this.renderer.set2DRelativeScale(A)}i=!0}}else if("mousedown"===g.type)this.canvas=g.currentTarget,this.canvas.addEventListener("mouseout",this.mouseoutFuncCanvas,!1),this.panOn=!0,this.panStartX=g.offsetX,this.panStartY=g.offsetY,this.renderer.startPan();else if("mouseup"===g.type)this.panOn=!1,this.canvas&&this.canvas.removeEventListener("mouseout",this.mouseoutFuncCanvas,!1);else if("mousewheel"===g.type||"DOMMouseScroll"===g.type){if(this.renderer.getMouseMoveIsPan()){this.mouseWheelIntervalSequence.addSample(Date.now()),this.mouseWheelFinalRedrawTimer.schedule(this.mouseWheelIntervalSequence.getNextIntervalEstimate()),this.mouseWheelSequenceClearTimer.cancel(),this.manipulator.setState(Navigator.NavigationState.ZOOM),i=!0;A=1;g.wheelDelta?A=g.wheelDelta:g.detail&&(A=-1*g.detail),A<0?this.renderer.set2DRelativeScale(1.25):this.renderer.set2DRelativeScale(.8)}}else"mouseout"===g.type&&(this.panOn=!1);this.manipulator.redrawIfNeeded(i)}}};var ge=pe;function ve(t,e,i){this.renderer=t,this.clickTimer=null,this.camera=e.camera,this.manipulator=e,this.manipulator.activeManipulator=this,this.mouseManipulator=new Navigator.MouseManipulator(this.manipulator),this.mouseWheelIntervalSequence=new Navigator.IntervalSequence(100,Navigator.Algorithm.LASTPLUSNOISE),this.manipulator.setDefaultAction(Navigator.DefaultAction.ROTATE),this.mouseleaveFuncCanvas=function(t){this.panOn=!1,this.canvas.removeEventListener("mouseleave",this.mouseleaveFuncCanvas,!1),this.canvas=null}.bind(this),this.canvas=null,this.panOn=!1,this.panStartX=0,this.panStartY=0,this.touchZoomStartDist=0,this.touch=i;var a=function(){this.mouseWheelIntervalSequence.clear()}.bind(this);this.mouseWheelSequenceClearTimer=new S(null,null,a);var o=function(){this.mouseWheelSequenceClearTimer.schedule(500),this.manipulator.setState(Navigator.NavigationState.FIXED),this.manipulator.redrawIfNeeded(!0)}.bind(this);this.mouseWheelFinalRedrawTimer=new S(null,null,o)}ve.prototype={constructor:ve},Object.defineProperties(ve.prototype,{manipulatorType:{get:function(){return this.touch?Navigator.ManipulatorType.TouchManipulator:Navigator.ManipulatorType.Manipulator2D}}}),ve.prototype.setDefaultAction=function(){this.manipulator.setDefaultAction(Navigator.DefaultAction.ROTATE)},ve.prototype.processEvent=function(t,e){var i=!1;if(!(t instanceof Navigator.HoverManipulatorEvent))if(t instanceof Navigator.TouchManipulatorEvent){var a=this.canvas,o=0,r=0,n=0,s=0;switch(t.currentTouches.touches&&t.currentTouches.touches.length>0&&(a=t.currentTouches.touches[0].target,o=t.currentTouches.touches[0].position.x,r=t.currentTouches.touches[0].position.y),t.currentTouches.touches&&t.currentTouches.touches.length>1&&(n=t.currentTouches.touches[1].position.x,s=t.currentTouches.touches[1].position.y),t.currentTouches.eventType){case Navigator.TouchEventType.DOWN:if(1===t.currentTouches.touches.length)this.canvas=a,this.panOn=!0,this.panStartX=o,this.panStartY=r,this.renderer.startPan();else if(t.currentTouches.touches.length>1){var u=o-n,l=r-s,c=Math.sqrt(u*u+l*l);this.touchZoomStartDist=c}break;case Navigator.TouchEventType.MOVE:switch(t.currentTouches.touches.length){case 1:if(this.panOn){var h=o-this.panStartX,p=r-this.panStartY;this.renderer.set2DNormalizedTranslation(h,p),i=!0}break;case 2:this.manipulator.setState(Navigator.NavigationState.ZOOM);u=o-n,l=r-s,c=Math.sqrt(u*u+l*l);var g=this.touchZoomStartDist-c;this.touchZoomStartDist=c,this.canvas=a;var v=Math.sqrt(this.canvas.width*this.canvas.width+this.canvas.height*this.canvas.height),A=Math.abs(g)/v;g<0?this.renderer.set2DRelativeScale(1+2*A,o,r):this.renderer.set2DRelativeScale(1-2*A,o,r),i=!0}break;case Navigator.TouchEventType.UP:this.panOn=!1}this.manipulator.redrawIfNeeded(i)}else{var m=t.getEvent();if(t instanceof Navigator.MouseManipulatorEvent){if("mousemove"===m.type){if(this.panOn){if(this.renderer.getMouseMoveIsPan()){h=m.x-this.panStartX,p=m.y-this.panStartY;this.renderer.set2DNormalizedTranslation(h,p)}else{var E=m.y-this.panStartY;this.panStartY=m.y;g=1-.02*E;f=this.canvas.width/2,y=this.canvas.height/2,this.renderer.set2DRelativeScale(g,f,y)}i=!0}}else if("mousedown"===m.type)this.canvas=m.currentTarget,this.canvas.addEventListener("mouseleave",this.mouseleaveFuncCanvas,!1),this.panOn=!0,this.panStartX=m.x,this.panStartY=m.y,this.renderer.startPan();else if("mouseup"===m.type)this.panOn=!1,this.canvas&&this.canvas.removeEventListener("mouseleave",this.mouseleaveFuncCanvas,!1);else if("mousewheel"===m.type||"DOMMouseScroll"===m.type){if(this.renderer.getMouseMoveIsPan()){this.canvas=m.currentTarget;var f=m.offsetX||m.pageX-this.canvas.offsetLeft,y=m.offsetY||m.pageY-this.canvas.offsetTop;(f<0||f>this.canvas.width||y<0||y>this.canvas.height)&&(f=this.canvas.width/2,y=this.canvas.height/2),this.mouseWheelIntervalSequence.addSample(Date.now()),this.mouseWheelFinalRedrawTimer.schedule(this.mouseWheelIntervalSequence.getNextIntervalEstimate()),this.mouseWheelSequenceClearTimer.cancel(),this.manipulator.setState(Navigator.NavigationState.ZOOM),i=!0;g=1;m.wheelDelta?g=m.wheelDelta:m.detail&&(g=-1*m.detail),g<0?this.renderer.set2DRelativeScale(.8,f,y):this.renderer.set2DRelativeScale(1.25,f,y)}}else m.type;this.manipulator.redrawIfNeeded(i)}}};var Ae=ve;i.d(e,"PRODUCT",function(){return me}),i.d(e,"logger",function(){return Ee}),i.d(e,"BUILD",function(){return"20220616"}),i.d(e,"COPYRIGHT",function(){return a}),i.d(e,"VERSION",function(){return"6.1.1"}),i.d(e,"NavigationState",function(){return u}),i.d(e,"MouseButtons",function(){return l}),i.d(e,"DefaultAction",function(){return c}),i.d(e,"ManipulatorType",function(){return h}),i.d(e,"TouchEventType",function(){return p}),i.d(e,"ExploreMode",function(){return g}),i.d(e,"Algorithm",function(){return v}),i.d(e,"HoverState",function(){return A}),i.d(e,"ExploreAction",function(){return m}),i.d(e,"Target",function(){return E}),i.d(e,"Type",function(){return f}),i.d(e,"Browser",function(){return y}),i.d(e,"ExploreManipulator",function(){return P}),i.d(e,"HoverManipulatorEvent",function(){return I}),i.d(e,"HoverTimer",function(){return C}),i.d(e,"IntervalSequence",function(){return x}),i.d(e,"KeyboardManipulatorEvent",function(){return U}),i.d(e,"KeyboardModifier",function(){return k}),i.d(e,"LayeredCanvas",function(){return F}),i.d(e,"Manipulator",function(){return j}),i.d(e,"ManipulatorListenerViewImpl",function(){return et}),i.d(e,"ManipulatorListenerViewImplPicSling",function(){return nt}),i.d(e,"ManipulatorListenerViewImplTriangle",function(){return ut}),i.d(e,"MouseManipulator",function(){return ct}),i.d(e,"MouseManipulatorEvent",function(){return pt}),i.d(e,"ScreenCoverage",function(){return vt}),i.d(e,"ScreenRectangle",function(){return mt}),i.d(e,"SPLMManipulator",function(){return Tt}),i.d(e,"Timer",function(){return S}),i.d(e,"TouchManipulatorEvent",function(){return Ct}),i.d(e,"Utilities",function(){return ot}),i.d(e,"Viewpoint",function(){return se}),i.d(e,"VolumeSelectQueryRectangle",function(){return le}),i.d(e,"CursorManager",function(){return he}),i.d(e,"MIN_HOVER_TIME",function(){return 400}),i.d(e,"HOVER_PIXEL_DELTA",function(){return 3}),i.d(e,"edgeWidth",function(){return.15}),i.d(e,"Epsilon",function(){return 1e-5}),i.d(e,"OneThousandth",function(){return 1e-4}),i.d(e,"minNearClipRatio",function(){return 1e-4}),i.d(e,"DegreesToRadians",function(){return N}),i.d(e,"RadiansToDegrees",function(){return d}),i.d(e,"TouchManipulator",function(){return Rt}),i.d(e,"Manipulator2D",function(){return ge}),i.d(e,"Manipulator2DVector",function(){return Ae});var me="PLM Vis Render List",Ee=s.getLogger("Navigator",s.Level.OFF);window.Navigator={PRODUCT:me,BUILD:"20220616",COPYRIGHT:a,VERSION:"6.1.1",logger:Ee,NavigationState:u,MouseButtons:l,DefaultAction:c,ManipulatorType:h,TouchEventType:p,ExploreMode:g,Algorithm:v,HoverState:A,ExploreAction:m,Target:E,Type:f,Browser:y,ExploreManipulator:P,HoverManipulatorEvent:I,HoverTimer:C,IntervalSequence:x,KeyboardManipulatorEvent:U,KeyboardModifier:k,LayeredCanvas:F,Manipulator:j,ManipulatorListenerViewImpl:et,ManipulatorListenerViewImplPicSling:nt,ManipulatorListenerViewImplTriangle:ut,MouseManipulator:ct,MouseManipulatorEvent:pt,ScreenCoverage:vt,ScreenRectangle:mt,SPLMManipulator:Tt,Timer:S,TouchManipulatorEvent:Ct,Utilities:ot,Viewpoint:se,VolumeSelectQueryRectangle:le,CursorManager:he,MIN_HOVER_TIME:400,HOVER_PIXEL_DELTA:3,edgeWidth:.15,Epsilon:1e-5,OneThousandth:1e-4,minNearClipRatio:1e-4,DegreesToRadians:N,RadiansToDegrees:d,TouchManipulator:Rt,Manipulator2D:ge,Manipulator2DVector:Ae}}])});
//# sourceMappingURL=manipulator.min.js.map