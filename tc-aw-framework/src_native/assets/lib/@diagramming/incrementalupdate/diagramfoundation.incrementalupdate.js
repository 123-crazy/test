// @<COPYRIGHT>@
// ==================================================
// Copyright Siemens 2020.
// PL Diagram Foundation 1973.0.1-0
// ==================================================
// @<COPYRIGHT>@
var t,n;t=this,n=function(w,e){"use strict";function n(t,i){this.changeStateObj=t,this.hostInterfaceObj=t.hostInterfaceObj,this.reportError=this.hostInterfaceObj.reportError,i?(this.ve(),this.de(),this.we(),this.ge()):(this.de(),this.we())}function x(t,i,n){this.changeStateObj=t,this.hostInterfaceObj=i,this.isPartialUpdate=n,this.pe=x.ChangeReason_None,this.be=[],this.Ne=[],this.me=[],this.ye=[],this.ke=!0}w=w&&Object.prototype.hasOwnProperty.call(w,"default")?w.default:w,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,n.prototype.de=function(){for(var t,i=this.changeStateObj.nList,n=i.length,s=0;s<n;++s)for(var r,h=(r=i[s].ki).length,e=0;e<h;++e)(t=r[e]).Oe&&this.Ie(t)},n.prototype.we=function(){for(var t,i=this.changeStateObj.cList,n=i.length,s=0;s<n;++s)(t=i[s]).Oe&&this.Me(t)},n.prototype.Ie=function(t){var i=this.Ge(t),n=t.Ue,t=t.Ve;t.x=i.x+n.x,t.y=i.y+n.y},n.prototype.Ge=function(t){var i=t.Ve,n=t.x,s=t.y,r=t.w,h=t.h,e=t.Hu,t=e?e.nodeSide:this.xe(t);switch(t){
case"top":n+=r,s-=i.h;break;case"bottom":n+=r,s+=h;break;case"left":n-=i.w,s-=i.h;break;case"right":n+=r,s-=i.h}return{x:n,y:s}},n.prototype.xe=function(t){var i=t.x+t.w/2,n=t.y+t.h/2,s=t.ti,r=s.x,h=s.y,t=s.w,s=s.h,i=Math.abs(r-i),t=Math.abs(t-i),h=Math.abs(h-n),n=Math.abs(s-h),s="bottom";return i<Math.min(t,h,n)?s="left":t<Math.min(h,n)?s="right":h<n&&(s="top"),s},n.prototype.Me=function(t){var i,n,s,r=this.Te(t);r&&(i=t.Ve,n=t.Ue,t=r.p1,r=r.p2,t=t.x===r.x?(s=t.x,(t.y+r.y)/2-i.h/2):(s=(t.x+r.x)/2-i.w/2,t.y-i.h),i.x=s+n.x,i.y=t+n.y)},n.prototype.Te=function(t){var i=t.Bi;if(!i)return null;var n,s,r=i.length;if(r<2)return null;for(var h=i[0],e=i[1],u=this.Ce(h,e),o=e,f=2;f<r;++f)n=i[f],u<(s=this.Ce(o,n))&&(u=s,h=o,e=n),o=n;return{p1:h,p2:e}},n.prototype.Ce=function(t,i){return t.x===i.x?Math.abs(t.y-i.y):Math.abs(t.x-i.x)},n.prototype.ve=function(){for(var t,i,n=this.changeStateObj.nList,s=n.length,r=0;r<s;++r)for(var h,e=(h=n[r].ki).length,u=0;u<e;++u)(i=h[u]).Ve&&(t=i.Ve,i.labelX=t.x,
i.labelY=t.y);for(var o,f=this.changeStateObj.cList,a=f.length,c=0;c<a;++c)(o=f[c]).Ve&&(t=o.Ve,o.labelX=t.x,o.labelY=t.y)},n.prototype.ge=function(){for(var t,i,n,s,r=this.changeStateObj.nList,h=r.length,e=0;e<h;++e)for(var u,o=(u=r[e].ki).length,f=0;f<o;++f)(s=u[f]).Ve&&(t=s.Ve,i=s.labelX,n=s.labelY,s.Ue.x=i-t.x,s.Ue.y=n-t.y);for(var a,c=this.changeStateObj.cList,l=c.length,v=0;v<l;++v)(a=c[v]).Ve&&(t=a.Ve,i=a.labelX,n=a.labelY,a.Ue.x=i-t.x,a.Ue.y=n-t.y)};var t=0;x.ChangeReason_None=0,x.ChangeReason_UpdateAll=Math.pow(2,t++),x.ChangeReason_NewConnection=Math.pow(2,t++),x.ChangeReason_ModifyConnection=Math.pow(2,t++),x.ChangeReason_NewNode=Math.pow(2,t++),x.ChangeReason_ModifyNode=Math.pow(2,t++),x.ChangeReason_NewPort=Math.pow(2,t++),x.ChangeReason_ModifyPort=Math.pow(2,t++),x.ChangeReason_Remove=Math.pow(2,t++),x.ChangeReason_EndcompoundCommands=Math.pow(2,8),x.prototype.Le=function(t){this.Ne.indexOf(t)<0&&(this.Ne.push(t),this.ke=!0)},x.prototype.De=function(t){this.be.indexOf(t
)<0&&(this.be.push(t),this.ke=!0)},x.prototype.Re=function(t){this.me.indexOf(t)<0&&(this.me.push(t),this.ke=!0)},x.prototype.je=function(t){t=this.Ne.indexOf(t);-1<t&&(this.Ne.splice(t,1),this.ke=!0)},x.prototype.He=function(t){t=this.be.indexOf(t);-1<t&&(this.be.splice(t,1),this.ke=!0)},x.prototype.qe=function(t){t=this.me.indexOf(t);-1<t&&(this.me.splice(t,1),this.ke=!0)},x.prototype.Pe=function(){this.pe=x.ChangeReason_None,this.ye=[],this.ke=!0,this.be=[],this.Ne=[],this.me=[]},x.prototype.Se=function(){var t=this.changeStateObj;return this.isPartialUpdate?this.Fe():t.cList},x.prototype.Fe=function(){if(!this.ke)return this.ye;var t=this.changeStateObj,t=!(this.pe&x.ChangeReason_UpdateAll)&&this.pe?this.ze():t.cList;return this.ye=t,this.ke=!1,t},x.prototype.ze=function(){var t=this.changeStateObj,i=t.nList.length,n=t.cList.length;if(this.Ne.length===i||this.be.length===n)return t.cList;for(var s=this.be.concat(),r=this.me.concat(),h=[],e=this.Ne,u=e.length,o=0;o<u;++o){var f=e[o]
;L(f,h),D(f,h)}if(h.length===i||s.length===n)return t.cList;var a=this.pe;if(a===x.ChangeReason_NewConnection||a===x.ChangeReason_ModifyConnection)for(var c=s.length,l=this.hostInterfaceObj,v=0;v<c;v++){var d=(G=s[v]).bi,w=G.yi;if(d&&C(d,l)||w&&C(w,l)){h=this.Ae(t.zh,h);break}}else if(a===x.ChangeReason_NewPort||a===x.ChangeReason_ModifyPort){for(var g=0,p=r.length;g<p;++g){var b=t._i(r[g]);R(b,s)}h=this.Ae(t.zh,h)}else a===x.ChangeReason_Remove?0<h.length&&this.hostInterfaceObj.reportError("The node should keep unchanged when object is removed."):h=this.Ae(t.zh,h);if(h.length===i||s.length===n)return t.cList;for(var N=this.Be(s),g=0,p=N.length;g<p;++g){var m=N[g];s.indexOf(m)<0&&s.push(m)}var y=h.length;if(0<y){for(var k=0;k<y;++k)for(var O=t.Ii(h[k]),I=O.length,M=0;M<I;++M){var G=O[M];s.indexOf(G)<0&&s.push(G)}if(h.length===i||s.length===n)return t.cList;for(var U,V=t.cList,u=V.length,M=0;M<u;++M)if(!((U=V[M]).ignore||0<=s.indexOf(U)))for(k=0;k<y;++k)if(T(h[k],U)){s.push(U);break}}
return s},x.prototype.Ae=function(t,i){for(var n,s=this.hostInterfaceObj,r=t._n,h=r.length,e=0;e<h;++e)n=r[e],i.indexOf(n)<0&&C(n,s)?(L(n,i),D(n,i)):null!==n._n&&(i=this.Ae(n,i));return i},x.prototype.Be=function(t){for(var i=[],n=0,s=t.length;n<s;++n){var r=t[n];if(!r.ignore)for(var h=this.Ee(r),e=0,u=h.length;e<u;++e)i.push(h[e])}return i},x.prototype.Ee=function(t){for(var i=[],n=[t.bi,t.yi],s=[t.mi,t.pi],r=0,h=s.length;r<h;++r){var e=n[r];if(e&&(e.Jh&&e.Qh)){var u=s[r].Hu;if(u){var u=u.getPoint(),o=u.x,f=u.y,a=[];this.Je(e,e,a);for(var c=0,l=a.length;c<l;++c){var v=a[c];v.ignore||d(o,f,v)&&i.push(v)}}}}return i},x.prototype.Je=function(t,i,n){var s=t._n;if(s)for(var r=this.changeStateObj,h=0,e=s.length;h<e;++h){for(var u=s[h],o=r.Ii(u),f=0,a=o.length;f<a;++f){var c=o[f];c.ignore||c.bi&&c.yi&&r.Ke(c,i)&&n.indexOf(c)<0&&n.push(c)}u.Jh&&this.Je(u,i,n)}};var d=function(t,i,n){var s=n.Bi;if(!s)return!1;for(var r=0,h=s.length;r<h-1;++r)if(u(t,i,s[r],s[r+1]))return!0;return!1},u=function(
t,i,n,s){if(n.x===s.x){if(t!==n.x)return!1;var r=n.y;return(h=s.y)<r&&(e=h,h=r,r=e),i<r||h<i?!1:!0}if(i!==n.y)return!1;var h,e,r=n.x;return(h=s.x)<r&&(e=h,h=r,r=e),!(t<r||h<t)},T=function(t,i){var n=i.Bi;if(null===n)return!1;i=n.length;if(i<2)return!1;for(var s=i-1,r=0;r<s;++r)if(function(t,i,n){if(i.x===n.x){var s=i.x;if(s>=t.x&&s<=t.x+t.w){var r=i.y,h=n.y,e=t.y,s=e+t.h;if((r-e)*(r-s)<=0||(h-e)*(h-s)<=0)return!0;if((e-r)*(e-h)<=0||(s-r)*(s-h)<=0)return!0}return!1}if(i.y===n.y){h=i.y;if(h>=t.y&&h<=t.y+t.h){h=i.x,i=n.x,n=t.x,t=n+t.w;if((h-n)*(h-t)<=0||(i-n)*(i-t)<=0)return!0;if((n-h)*(n-i)<=0||(t-h)*(t-i)<=0)return!0}}return!1}(t,n[r],n[r+1]))return!0;return!1},C=function(t,i){var n=t.hostNode,n=i.getNodeRect(n);return t.x!==n.x||t.y!==n.y||(t.w!==n.w||t.h!==n.h)},L=function(t,i){i.indexOf(t)<0&&i.push(t)},D=function(t,i){var n=t._n;if(n)for(var s=n.length,r=0;r<s;++r){var h=n[r];L(h,i),D(h,i)}},R=function(t,i){for(var n=0,s=t.length;n<s;++n){var r=t[n];i.indexOf(r)<0&&i.push(r)}}
;function h(t,i,n,s){w.ChangeState.apply(this,arguments),this.Qe=new x(this,this.hostInterfaceObj,this.layoutSessionData.isPartialUpdate)}function s(t,i){this.We=null,this.hostInterfaceObj=t,this.layoutSessionData=i,this.changeStateObj=null,this.li=null,this.ho=null,this.removeSegmentOverlaps=w.LayoutCoreUtil.tryIsRSOPEnabled(t),this.compoundCommands=!1}function r(t){this.hostInterfaceObj=t,this.Xe=new w.LayoutHelper.Map}function f(t){this.hostNode=t,this.parentNode=null,this.Ye=[]}function i(t,i){this.Ze=new r(t),this.$e=new w.TreeHostInterfaceWrapper(t,this.Ze),this.go=t,s.call(this,this.$e,i),this.lt=w.LayoutDirection.TopToBottom,this.ct=w.LayoutDirection.LeftToRight,this.wt=w.LayoutDirection.BottomToTop,this.pt=w.LayoutDirection.RightToLeft}e.common.ObjectHelper.inherit(h,w.ChangeState),h.prototype.xi=function(){w.ChangeState.prototype.xi.apply(this,arguments),this.Qe=null},h.prototype.addNewNode=function(t){var i=w.ChangeState.prototype.addNewNode.apply(this,arguments)
;return this.Qe.Le(i),i},h.prototype.removeNode=function(t){t=this.Fi(t);w.ChangeState.prototype.removeNode.apply(this,arguments),this.Qe.je(t)},h.prototype._e=function(t){t=this.Fi(t);w.ChangeState.prototype._e.apply(this,arguments),this.Qe.Le(t)},h.prototype.addNewPort=function(t){var i=w.ChangeState.prototype.addNewPort.apply(this,arguments);return this.Qe.Re(i),i},h.prototype.movePort=function(t){w.ChangeState.prototype.movePort.apply(this,arguments);t=this.ru(t);this.Qe.Re(t)},h.prototype.removePort=function(t){t=this.ru(t);w.ChangeState.prototype.removePort.apply(this,arguments),this.Qe.qe(t)},h.prototype.addNewConnection=function(t){var i=w.ChangeState.prototype.addNewConnection.apply(this,arguments);this.Qe.De(i)},h.prototype.removeConnection=function(t){t=this.Gi(t);w.ChangeState.prototype.removeConnection.apply(this,arguments),this.Qe.He(t)},h.prototype.Eo=function(){for(var t,i=this.hostInterfaceObj,n=this.cList,s=n.length,r=0;r<s;++r)t=n[r],i.setPath(t.Si,t.su)},
s.prototype.setGroupPaddingFit=function(t){this.li.$o=t},s.prototype.isIncrementalActive=function(){return null!==this.changeStateObj},s.prototype.disableIncUpdate=function(){null!==this.changeStateObj&&this.changeStateObj.xi(),this.changeStateObj=null,this.li=null,this.ho=null},s.prototype.activateIncUpdate=function(t,i,n,s){var r=this.layoutSessionData;this.prepareSessionData(r,this.hostInterfaceObj),this.changeStateObj=new h(this.hostInterfaceObj,this.layoutSessionData,t,i),r.du=this.changeStateObj.du,r.du&&r.isRSOPEnabled&&r.Vo&&this.reportError("MakeRoom should turn off when using user defined port location."),this.li=new w.RemoveGroupOverlaps(r,this.changeStateObj),this.ho=new w.AllocateGluePoints(r,this.changeStateObj,this.li),this.ho.xo(),this.changeStateObj.Yo(),new w.ValidDistCalculator(r,this.reportError.bind(this)).validSessionData();switch(!r.du&&n?"restore":"normal"){case"normal":this.tf(),this.U();break;case"restore":this.if()}},s.prototype.addNewNode=function(t){if(
!1===this.isIncrementalActive())return!1;if(this.nf(t))return!1;t=this.changeStateObj.addNewNode(t);return this.li.sf(t,"any"),this.U(x.ChangeReason_NewNode),!0},s.prototype.addNewNodeUsingGridLayout=function(t){if(!1===this.isIncrementalActive())return!1;if(this.nf(t))return!1;var i=new w.BoxLayout(this.layoutSessionData,this.changeStateObj,this.li),t=this.changeStateObj.addNewNode(t);return i.rf(t,this.layoutSessionData.Ft),this.U(x.ChangeReason_NewNode),!0},s.prototype.addNewGroupNode=function(t,i){if(!1===this.isIncrementalActive())return!1;if(this.nf(t))return!1;t=this.changeStateObj.addNewNode(t);return this.changeStateObj.hf(i),this.li.sf(t,"any"),this.U(x.ChangeReason_NewNode|x.ChangeReason_ModifyNode),!0},s.prototype.convertNodeToGroupNode=function(t){if(!1===this.isIncrementalActive())return!1;t=this.changeStateObj.convertNodeToGroupNode(t);return null!==t&&(this.li.convertNodeToGroupNode(t,"any"),this.U(x.ChangeReason_ModifyNode),!0)},
s.prototype.convertGroupNodeToNode=function(t){if(!1===this.isIncrementalActive())return!1;t=this.changeStateObj.convertGroupNodeToNode(t);return null!==t&&(this.li.convertGroupNodeToNode(t,"any"),this.U(x.ChangeReason_ModifyNode),!0)},s.prototype.moveNode=function(t){return!1!==this.isIncrementalActive()&&(this.li.moveNode(t,"any"),this.U(x.ChangeReason_ModifyNode),!0)},s.prototype.changeParent=function(t){if(!1===this.isIncrementalActive())return!1;var i=this.Ni(t,!0);if(null===i)return!1;i=i.$n;return this.changeStateObj._e(t),this.li.moveNode(t,"any"),0!==this.li.groupPaddingFit&&this.li.ef(i,"any"),this.U(x.ChangeReason_ModifyNode),!0},s.prototype.changeParentAndRelocate=function(t){if(!1===this.isIncrementalActive())return!1;if(t.length<1)return!0;this.changeStateObj.hf(t);for(var i,n=t.length,s=[],r=0;r<n;++r)i=t[r],!1===this.ff(i,!0).uf&&s.push(i);return 0<s.length&&new w.BoxLayout(this.layoutSessionData,this.changeStateObj,this.li).af(s,this.layoutSessionData.Ft,"sideOffset"),
this.U(x.ChangeReason_ModifyNode),!0},s.prototype.removeNode=function(t,i){return!1!==this.isIncrementalActive()&&(i?this.removeOnlyGroupNode(t):this.changeStateObj.removeNode(t),this.U(x.ChangeReason_Remove),!0)},s.prototype.removeOnlyGroupNode=function(t){if(!1===this.isIncrementalActive())return!1;var i=this.Ni(t,!0);if(null===i)return!1;if(!i.Qh)return this.removeNode(t);for(var n,s=i.$n,r=i._n,h=r.length,e=this.changeStateObj,u=e.nList,o=0;o<h;++o)n=r[o],e.To(u,n);for(i._n=[],e.removeNode(t),o=0;o<h;++o)(n=r[o]).$n=s,u.push(n),s._n.push(n)},s.prototype.expandGroupNode=function(t){if(!1===this.isIncrementalActive())return!1;var i,n,s=this.Ni(t,!0);return null!==s&&(s.uf&&(i=s.w,n=s.h,s.Qh=!0,this.changeStateObj.ko(),this.changeStateObj.Oo(),this.ho.xo(),this.cf(s),this.li.vf(s).lf(),s.w=i,s.h=n),this.changeStateObj.Yo(),this.li.expandGroupNode(t,"downOrRight"),this.ho.expandGroupNode(s),this.U(x.ChangeReason_ModifyNode),!0)},s.prototype.collapseGroupNode=function(t){if(
!1===this.isIncrementalActive())return!1;var i=this.Ni(t,!0);return null!==i&&(this.li.collapseGroupNode(t),this.ho.collapseGroupNode(i),this.U(x.ChangeReason_ModifyNode),!0)},s.prototype.fitGroupNode=function(t,i){return!1!==this.isIncrementalActive()&&(null!==this.Ni(t,!0)&&(this.li.fitGroupNode(t,!0,i),this.U(x.ChangeReason_ModifyNode),!0))},s.prototype.resizeNode=function(t){return!1!==this.isIncrementalActive()&&(null!==this.Ni(t,!0)&&(this.li.resizeNode(t,"any"),this.U(x.ChangeReason_ModifyNode),!0))},s.prototype.compactGroupNode=function(t,i){return!1!==this.isIncrementalActive()&&(this.li.compactGroupNode(t,i,!1),this.li.df(!1),this.U(x.ChangeReason_ModifyNode),!0)},s.prototype.compactGraph=function(t){return!1!==this.isIncrementalActive()&&(this.li.compactGraph(this.changeStateObj.zh,t),this.li.df(!1),this.U(),!0)},s.prototype.addNewConnection=function(t){if(!1===this.isIncrementalActive())return!1;if(this.wf(t))return!1;var i=this.hostInterfaceObj.getSourcePort(t),
n=this.hostInterfaceObj.getTargetPort(t);return i&&n?(!1===this.changeStateObj.ji(i)&&this.changeStateObj.addNewPort(i),!1===this.changeStateObj.ji(n)&&this.changeStateObj.addNewPort(n),this.changeStateObj.addNewConnection(t),!!this.Ri(t,!0)&&(this.gf([t]),this.U(x.ChangeReason_NewConnection),!0)):(this.reportError("GcIncUpdateNestedView: Can not add dangling connection!"),!1)},s.prototype.moveConnection=function(t){if(!1===this.isIncrementalActive())return!1;var i=this.Ri(t,!0);if(null===i)return!1;this.ho.pf(i);var n=this.hostInterfaceObj.getSourcePort(t),s=this.hostInterfaceObj.getTargetPort(t);return n&&s?(!1===this.changeStateObj.ji(n)&&this.changeStateObj.addNewPort(n),!1===this.changeStateObj.ji(s)&&this.changeStateObj.addNewPort(s),this.gf([t]),this.changeStateObj.Qe.De(i),this.U(x.ChangeReason_ModifyConnection),!0):(this.reportError("GcIncUpdateNestedView: moving a connection results in a dangling connection!"),!1)},s.prototype.removeConnection=function(t){if(
!1===this.isIncrementalActive())return!1;var i=this.Ri(t,!0);return null!==i&&(this.ho.pf(i),this.changeStateObj.removeConnection(t),this.U(x.ChangeReason_Remove),!0)},s.prototype.addNewPort=function(t,i){if(!1===this.isIncrementalActive())return!1;this.changeStateObj.addNewPort(t);t=this.bf(t,!0);return null!==t&&((i=void 0===i?!0:i)?this.ho.Nf(t):this.ho.mf(t),this.U(x.ChangeReason_NewPort),!0)},s.prototype.movePort=function(t){if(!1===this.isIncrementalActive())return!1;var i=this.bf(t,!0);return null!==i&&(this.ho.yf(i,!1),this.changeStateObj.movePort(t),this.ho.kf(i),this.changeStateObj.ko(),this.U(x.ChangeReason_ModifyPort),!0)},s.prototype.removePort=function(t){if(!1===this.isIncrementalActive())return!1;var i=this.bf(t,!0);return null!==i&&(this.ho.yf(i,!1),this.changeStateObj.removePort(t),this.U(x.ChangeReason_Remove),!0)},s.prototype.changeConnectionLabel=function(t){return!1!==this.isIncrementalActive()&&(this.changeStateObj.changeConnectionLabel(t),this.U(),!0)},
s.prototype.changePortLabel=function(t){if(!1===this.isIncrementalActive())return!1;var i=this.bf(t,!0);return null!==i&&(this.changeStateObj.changePortLabel(t),this.ho.yf(i,!1),this.ho.Nf(i),this.U(),!0)},s.prototype.generalUpdate=function(t,i){if(!1===this.isIncrementalActive())return!1;var n=this.changeStateObj;if(n.Yo(),!1===this.Of(t))return!1;if(!1===this.If(i))return!1;var s=this.compoundCommands;this.compoundCommands=!0;for(var r=t.concat(),h=this.Mf(r);0<=r.length&&null!==h;)this.Gf(h),h=this.Mf(r);0<r.length&&this.reportError("GcIncUpdateNestedView: trying to add nodes that have no parent in the change state"),this.Uf();for(var e=i.length,u=0;u<e;++u)this.Vf(i[u]);this.cf(n.zh),n.Yo(),this.gf(i);n=this.xf();return this.compoundCommands=s,this.U(x.ChangeReason_NewNode|x.ChangeReason_NewConnection),n},s.prototype.Mf=function(t){for(var i,n,s=this.changeStateObj,r=t.length,h=0;h<r;++h){if(i=t[h],!(n=this.hostInterfaceObj.getParentNode(i)))return t.splice(h,1),i;if(s.Fi(n)
)return t.splice(h,1),i}return null},s.prototype.Vf=function(t){var i=this.hostInterfaceObj.getSourcePort(t),n=this.hostInterfaceObj.getTargetPort(t);i&&n||this.reportError("GcIncUpdateNestedView: Can not add dangling connection!"),!1===this.changeStateObj.ji(i)&&this.changeStateObj.addNewPort(i),!1===this.changeStateObj.ji(n)&&this.changeStateObj.addNewPort(n),this.changeStateObj.addNewConnection(t)},s.prototype.layoutSingleGroupNode=function(t){if(!1===this.isIncrementalActive())return!1;new e.common.ObjectHelper.rootNamespace.Layout.LayouterAlg(this.layoutSessionData,this.changeStateObj,this.li).doLayoutGroupOneLevel(t);var i=x.ChangeReason_UpdateAll;if(null!==t){t=this.Ni(t,!0);if(null===t)return!1;t.uf=!1,this.li.Tf(t,t.x,t.y,"downOrRight"),i=x.ChangeReason_ModifyNode}return this.U(i),!0},s.prototype.expandAndLayoutExistingGroupNode=function(t,i,n){if(!1===this.isIncrementalActive())return!1;var s=this.Ni(t,!0);if(null===s)return!1;var r=this.compoundCommands;return!(
this.compoundCommands=!0)===s.Qh&&this.expandGroupNode(t),s.uf=!0,this.generalUpdate(i,n),this.compoundCommands=r,this.U(x.ChangeReason_NewNode|x.ChangeReason_NewConnection),!0},s.prototype.expandAndLayoutNewGroupNode=function(t,i,n,s){if(!1===this.isIncrementalActive())return!1;var r=this.Ni(t,!0);if(null===r)return!1;t=this.changeStateObj.addNewNode(i);return t.x=r.x,t.y=r.y,this.expandAndLayoutExistingGroupNode(i,n,s)},s.prototype.distributeNewNodes=function(t,i,n,s){if(!1===this.isIncrementalActive())return!1;if(null===this.Ni(t,!0))return!1;if(!1===this.Of(i))return!1;if(!1===this.If(n))return!1;var r=this.compoundCommands;this.compoundCommands=!0;for(var h=this.hostInterfaceObj,e=[],u=h.getParentNode(t);null!==u;)e.push(u),u=h.getParentNode(u);e.push(null);for(var o,f=this.Cf(t,e,i),f=this.Lf(f,e),a=e.length,c=n,l=t,v=0;v<a;++v)u=e[v],f=(o=this.Df(t,u,l,f,c,e,s)).newHostNodeList,c=o.newHostConnectionList,l=u;var d=!0;0<f.length&&(this.reportError(
"GcIncUpdateNestedView:distributeNewNodes - nodes being added that do not have parent in the change state"),d=!1),0<c.length&&(this.reportError("GcIncUpdateNestedView:distributeNewNodes - connections being added that do not have source or target nodes in the change state"),d=!1);d=d&&this.xf(),i=this.changeStateObj;return this.cf(i.zh),i.Yo(),this.gf(n),this.compoundCommands=r,this.U(x.ChangeReason_NewNode|x.ChangeReason_NewConnection),d},s.prototype.nodeInTable=function(t){return this.changeStateObj.zi(t)},s.prototype.connectionInTable=function(t){return this.changeStateObj.Di(t)},s.prototype.portInTable=function(t){return this.changeStateObj.ji(t)},s.prototype.beginCompoundCommands=function(){this.compoundCommands=!0},s.prototype.endCompoundCommandsAndUpdate=function(){if(!1===this.isIncrementalActive())return!1;this.compoundCommands=!1,this.U(x.ChangeReason_EndcompoundCommands)},s.prototype.U=function(t){var i=this.changeStateObj.Qe;(t=t||x.ChangeReason_UpdateAll
)===x.ChangeReason_EndcompoundCommands||(this.compoundCommands?i.pe=i.pe|t:i.pe=t),this.changeStateObj.Yo();t=i.Se();!1===this.compoundCommands?(this.layoutSessionData.du&&this.ho.Rf(),this.ho.jf(t),this.ho.Vu(),this.layoutSessionData.du&&this.ho.Yu(),this.ho.So(),this.changeStateObj.Oo(),new w.HVPaths(this.layoutSessionData,this.changeStateObj,this.li,this.removeSegmentOverlaps),new n(this.changeStateObj,!1),this.changeStateObj.update(1),this.ho.Hf(),this.We&&this.We.call(this)):(this.ho.qf(void 0,t),this.ho.Vu(),this.ho.So(),this.changeStateObj.Oo()),this.compoundCommands||(i.pe=x.ChangeReason_None)},s.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},s.prototype.Df=function(t,i,n,s,r,h,e){var u=this.Pf(i,s);this.Sf(i,u.addedHostNodeList);var o=this.Lf(u.remainingHostNodeList,h);this.Uf();s=this.Ff(t,i),h=this.zf(r);return this.Af(u.addedHostNodeList),"useLayoutDirection"===e?(r=this.Bf(t,u.addedHostNodeList),this.Ef(t,n,i,r.sourceNodeList,r.sourceDir),this.Ef(t
,n,i,r.targetNodeList,r.targetDir),this.Jf(t,s,r.sourceSide)):(this.Ef(t,n,i,u.addedHostNodeList,e),this.Jf(t,s,e)),{newHostNodeList:o,newHostConnectionList:h}},s.prototype.Bf=function(t,i){var n,s;switch(this.layoutSessionData.Ft){case w.LayoutDirection.TopToBottom:n="up",s="down";break;case w.LayoutDirection.LeftToRight:n="left",s="right";break;case w.LayoutDirection.RightToLeft:n="right",s="left";break;case w.LayoutDirection.BottomToTop:n="down",s="up";break;default:this.reportError("GcIncUpdateNestedView:splitForDistributionToTwoSides - current layout direction is invalid - using top-to-bottom"),n="top",s="bottom"}for(var r=[],h=this.hostInterfaceObj,e=h.getAllPortsForNode(t),u=0,o=e.length;u<o;++u)var f=h.getAllConnectionsForPort(e[u]),r=r.concat(f);for(var a=[],c=[],l=0,v=i.length;l<v;++l){var d=i[l];("source"===this.Kf(t,d,r)?a:c).push(d)}return{sourceNodeList:a,sourceDir:n,targetNodeList:c,targetDir:s}},s.prototype.Kf=function(t,i,n){for(var s,r,h=this.hostInterfaceObj,e=0,u=0,
o=0,f=0,a=0,c=n.length;a<c;++a)r=n[a],s=h.getSourceNode(r),r=h.getTargetNode(r),s===i?++u:this.Qf(s,i)&&++f,r===i?++e:this.Qf(r,i)&&++o;var l=u+f,v=e+o;return v<l||!(l<v)&&e<u?"source":"target"},s.prototype.Qf=function(t,i){t=this.Ni(t,!1);if(null===t)return!1;i=this.Ni(i,!1);return null!==i&&this.changeStateObj.Nu(t,i)},s.prototype.Ef=function(t,i,n,s,r){t=this.Wf(t,i,s,r);this.Xf(n,i,s,r,t)},s.prototype.Cf=function(t,i,n){for(var s,r,h=n.slice(0),e=t,u=i.length-1,o=0;o<u;++o)r=i[o],this.nodeInTable(r)||(this.addNewGroupNode(r,[e]),-1<(s=h.indexOf(r))?h.splice(s,1):this.reportError("GcIncUpdateNestedView:distributeNewNodes - new ancestor node not in new node list")),e=r;return h},s.prototype.Lf=function(t,i){for(var n,s,r=this.hostInterfaceObj,h=[],e=!1,u=t.length,o=0;o<u;++o)n=t[o],s=r.getParentNode(n),i.indexOf(s)<0&&this.nodeInTable(s)?(e=!0,this.Gf(n)):h.push(n);return h=e?this.Lf(h,i):h},s.prototype.Gf=function(t){var i,n=this.ff(t,!0);return!!n&&(
n.uf?this.changeStateObj.addNewNode(t):this.addNewNodeUsingGridLayout(t),this.hostInterfaceObj.isGroupNode(t)&&(i=this.Ni(t,!0))&&(i.uf=!0),!0)},s.prototype.Pf=function(t,i,n){for(var s,r,h=this.hostInterfaceObj,e=this.layoutSessionData.nodeDist,u=i.length,o=this.changeStateObj,f=o.Yf(o.zh._n),a=f.w,c=0;c<u;++c)s=i[c],a+=(n?{x:r=this.Ni(s,!0),y:r.y,w:r.w,h:r.h}:h.getNodeRect(s)).w;var l=1.5*(a+e.x*u),v=f.x+l,d=f.y,w=[],g=[];for(c=0;c<u;++c)s=i[c],h.getParentNode(s)===t?(w.push(s),(r=n?this.Ni(s,!0):o.addNewNode(s)).x=v,r.y=d,v+=l,r.Jh&&(r.uf=!0)):g.push(s);return{addedHostNodeList:w,remainingHostNodeList:g}},s.prototype.Sf=function(t,i){if(null!==t){t=this.Ni(t,!0);if(null!==t)for(var n,s=this.changeStateObj,r=t._n,h=i.length,e=0;e<h;++e){if(null===(n=this.Ni(i[e],!0)))return;s.To(r,n)}}},s.prototype.Af=function(t){for(var i,n=t.length,s=0;s<n;++s){if(null===(i=this.Ni(t[s],!0)))return;i.uf&&this.cf(i)}},s.prototype.Wf=function(t,i,n,s){var r=this.layoutSessionData.nodeDist,h=r.x,e=r.y
,u=this.Ni(t,!0);if(null===u)return null;var o=this.Ni(i,!0);if(null===o)return null;for(var f,a,c,l=n.length,v=0,d=0,w=0;w<l;++w){if(null===(f=this.Ni(n[w],!0)))return null;v+=f.w,d+=f.h}switch(v+=h*(l-1),d+=e*(l-1),s){case"up":a=u.x+u.w/2-v/2,c=o.y-e;break;case"down":a=u.x+u.w/2-v/2,c=o.y+o.h+e;break;case"left":a=o.x-h,c=u.y+u.h/2-d/2;break;case"right":a=o.x+o.w+h,c=u.y+u.h/2-d/2;break;default:return this.reportError("GcIncupdate:distributeNewNodes - invalid direction"),null}var g=a,p=c,b=a,N=c,m=[];for(w=0;w<l;++w){if(null===(f=this.Ni(n[w],!0)))return null;switch(s){case"up":b=g+f.w+h,p=c-f.h;break;case"down":b=g+f.w+h,p=c;break;case"left":g=a-f.w,N=p+f.h+e;break;case"right":g=a,N=p+f.h+e}m.push({x:g,y:p}),g=b,p=N}return m},s.prototype.Xf=function(t,i,n,s,r){if(null===r&&0<n.length)this.Zf("GcIncupdate:distributeNewNodes - target positions not calculated");else{var h=this.Ni(i,!0);if(null!==h){var e=this.ff(i,!0);if(null!==e){var u=this.li,o=u.vf(e),
f=this.layoutSessionData.nodeDist,i=f.x,f=f.y,a=null;null!==t&&(a=e._n),o.$f={xmin:h.x-i,ymin:h.y-f,xmax:h.x+h.w+2*i,ymax:h.y+h.h+2*f};for(var c,l,v,d,w=n.length,g=0;g<w;++g){if(null===(l=this.Ni(n[g],!0)))return;null!==a&&a.push(l),v=r[g].x,d=r[g].y,c=this._f(g,w,s),u.Tf(l,v,d,c)}o.$f=null}}}},s.prototype._f=function(t,i,n){var s,r=0===t,i=t===i-1;return"up"===n||"down"===n?(s="upOrDown",r&&(s+="OrLeft"),i&&(s+="OrRight")):(s="leftOrRight",r&&(s+="OrUp"),i&&(s+="OrDown")),s},s.prototype.zf=function(t){for(var i,n,s,r=this.hostInterfaceObj,h=[],e=t.length,u=0;u<e;++u)i=t[u],n=r.getSourceNode(i),s=r.getTargetNode(i),n&&s&&this.nodeInTable(n)&&this.nodeInTable(s)?this.Vf(i):h.push(i);return h},s.prototype.Uf=function(){for(var t,i,n,s=[],r=[],h=this.changeStateObj.nList,e=h.length,u=0;u<e;++u)n=(i=h[u]).hostNode,null!==(t=this.ff(n,!1))&&t!==i.$n&&(s.push(n),r.push(i.$n));this.ta(s);var o=this.li;if(0!==o.$o)for(e=r.length,u=0;u<e;++u)(n=r[u].hostNode)&&o.fitGroupNode(n,!1,!0)},
s.prototype.ta=function(t){if(!(t.length<1)){this.changeStateObj.hf(t);for(var i,n=t.length,s=[],r=0;r<n;++r)i=t[r],!1===this.ff(i,!0).uf&&s.push(i);0<s.length&&new w.BoxLayout(this.layoutSessionData,this.changeStateObj,this.li).af(s,this.layoutSessionData.Ft,"sideOffset")}},s.prototype.Ff=function(t,i){t=this.Ni(t,!0);if(null===t)return null;var n=this.changeStateObj.zh;if(null!==(n=null!==i?this.Ni(i,!0):n)){for(var s,r,h=this.changeStateObj,e=[],u=h.ia(t),o=0,f=u.length;o<f;++o)(r=(s=u[o]).$n)===n&&(h.To(r._n,s),e.push(s));return e}},s.prototype.Jf=function(t,i,n){var s=this.Ni(t,!0);if(null===s)return null;for(var r=[],h=[],e=[],u=[],o=0,f=i.length;o<f;++o){var a=i[o];"up"===n||"down"===n?a.x<s.x?this.na(e,a,a.x):this.sa(u,a,a.x):a.y<s.y?this.na(r,a,a.y):this.sa(h,a,a.y)}this.ra(r,"up"),this.ra(h,"down"),this.ra(e,"left"),this.ra(u,"right")},s.prototype.ra=function(t,i){var n=t.length;if(!(n<1))for(var s=this.li,r=0;r<n;++r){var h=t[r].changeNode;h.$n._n.push(h),s.Tf(h,h.x,h.y,i)}}
,s.prototype.sa=function(t,i,n){for(var s={changeNode:i,sortValue:n},r=0,h=t.length;r<h;++r)if(n<=t[r].sortValue)return void t.splice(r,0,s);t.push(s)},s.prototype.na=function(t,i,n){for(var s={changeNode:i,sortValue:n},r=0,h=t.length;r<h;++r)if(t[r].sortValue<=n)return void t.splice(r,0,s);t.push(s)},s.prototype.cf=function(t){if(t.uf){var i=this.layoutSessionData.fu;this.layoutSessionData.fu=!0,new e.common.ObjectHelper.rootNamespace.Layout.LayouterAlg(this.layoutSessionData,this.changeStateObj,this.li).doLayoutGroupAllLevels(t.hostNode),this.layoutSessionData.fu=i,this.ha(t,!1),this.li.Tf(t,t.x,t.y,"downOrRight")}else for(var n,s=t._n,r=s.length,h=0;h<r;++h)(n=s[h]).Qh&&this.cf(n)},s.prototype.ha=function(t,i){if(t.Qh){t.uf=i;for(var n,s=t._n,r=s.length,h=0;h<r;++h)(n=s[h])._n&&t.Qh&&this.ha(n,i)}},s.prototype.gf=function(t){this.changeStateObj;for(var i,n=[],s=0,r=t.length;s<r;++s)i=t[s],(i=this.Ri(i,!1))&&(this.ea(i),i.ignore||n.push(i));this.ho.ua(n)},s.prototype.ea=function(t){
this.changeStateObj.Pi(t);for(var i=this.ho,n=[t.mi,t.pi],s=0,r=n.length;s<r;++s){var h,e=n[s];e&&(h=i.oa(e,t),e.ti!==h&&i.fa(e))}},s.prototype.aa=function(){for(var t,i,n,s,r=this.hostInterfaceObj,h=this.changeStateObj.cList,e=h.length,u=0;u<e;++u)if((t=h[u]).Bi=null,(i=t.Si)&&(n=r.getPath(i))){for(var o=n.length,f=[],a=0;a<o;++a)s=n[a],f.push({x:s.x,y:s.y});t.Bi=f}},s.prototype.Ni=function(t,i){return this.changeStateObj.Fi(t,i)},s.prototype.nf=function(t){return null!==this.Ni(t)&&(this.reportError("GcIncUpdateNestedView: request to a add new node for a node that is already defined"),!0)},s.prototype.Of=function(t){for(var i=t.length,n=0;n<i;++n)if(this.nf(t[n]))return!1;return!0},s.prototype.ff=function(t,i){t=this.hostInterfaceObj.getParentNode(t),t=null===t?this.changeStateObj.zh:this.Ni(t,!1);return null===t&&i&&this.reportError("GcIncUpdateNestedView: host node found without a parent node"),t},s.prototype.bf=function(t,i){return this.changeStateObj.ru(t,i)},
s.prototype.Ri=function(t,i){return this.changeStateObj.Gi(t,i)},s.prototype.wf=function(t){return null!==this.Ri(t,!1)&&(this.reportError("GcIncUpdateNestedView: request to a add new connnection for an connection that is already defined in GcIncUpdateNestedView"),!0)},s.prototype.If=function(t){for(var i=t.length,n=0;n<i;++n)if(this.wf(t[n]))return!1;return!0},s.prototype.xf=function(){for(var t=this.hostInterfaceObj,i=this.changeStateObj.nList,n=0,s=i.length;n<s;++n){var r=t.getParentNode(i[n].hostNode);if(null!==r&&null===this.Ni(r,!1))return this.reportError("GcIncUpdateNestedView:validateCurrentParentNodes - some node in the change state does not have a parent in the change state"),!1}return!0},s.prototype.tf=function(){this.li.df(!0),this.ho.Iu("float")},s.prototype.if=function(){this.aa(),new n(this.changeStateObj,!0),this.ho.Iu("fixed"),this.ho.Vu(),this.ho.So(),this.changeStateObj.ca()},s.prototype.prepareSessionData=function(t,i){w.LayoutCoreUtil.Bo(t,i),w.LayoutCoreUtil.Xo(t
)},r.prototype.la=function(t){for(var i=this.hostInterfaceObj,n=this.Xe,s=0,r=t.length;s<r;++s){var h=t[s];(o=n.va(h))?this.reportError("Host node has already been added in relation tree."):(o=new f(h),n.da(h,o))}for(s=0,r=t.length;s<r;++s){var e,h=t[s],u=i.getParentNode(h),o=n.va(h);u&&(e=n.va(u))?(o.parentNode=u,w.LayoutHelper.addUniqueItemInList(h,e.Ye)||this.reportError("Child list status is incorrect.")):o.parentNode=null}},r.prototype.removeNode=function(t,i){return i?this.wa(t):this.ga(t)},r.prototype.ga=function(t){var i=this.Xe,n=i.va(t);if(!n)return!1;for(var s=n.Ye.slice(0),r=0,h=s.length;r<h;++r){var e=i.va(s[r]);e.parentNode!==t&&this.reportError("Parent status is incorrect."),this.ga(e.hostNode)}n=n.parentNode;return n&&((n=i.va(n))?w.LayoutHelper.removeItemInList(t,n.Ye)||this.reportError("Child list status is incorrect."):this.reportError("Node's parent does not exist in relation data.")),i.pa(t),!0},r.prototype.wa=function(t){var i=this.Xe,n=i.va(t);if(!n)return!1
;var s=n.parentNode,r=null;s&&((r=i.va(s))?w.LayoutHelper.removeItemInList(t,r.Ye)||this.reportError("Child list status is incorrect."):this.reportError("Node's parent does not exist in relation data."));for(var h=n.Ye,e=0,u=h.length;e<u;++e){var o=h[e],f=i.va(o);f.parentNode!==t&&this.reportError("Parent status is incorrect."),f.parentNode=s,r&&(w.LayoutHelper.addUniqueItemInList(o,r.Ye)||this.reportError("Child list status is incorrect."))}return i.pa(t),!0},r.prototype._e=function(t){var i=this.Xe,n=i.va(t);if(!n)return this.reportError("The host node is not added yet."),!1;var s,r=n.parentNode,h=this.hostInterfaceObj.getParentNode(t);return h===r||(r&&(r=i.va(r),w.LayoutHelper.removeItemInList(t,r.Ye)||this.reportError("Child list status is incorrect.")),h&&(s=i.va(h))?(n.parentNode=h,w.LayoutHelper.addUniqueItemInList(t,s.Ye)||this.reportError("Child list status is incorrect.")):n.parentNode=null),!0},r.prototype.hf=function(t){for(var i=0,n=t.length;i<n;++i)this._e(t[i])},
r.prototype.ba=function(){for(var t=this.Xe.Na(),i=0,n=t.length;i<n;++i){var s=t[i];this._e(s.hostNode)}},r.prototype.ma=function(){return this.Xe.ya()},r.prototype.getParentNode=function(t){t=this.Xe.va(t);return t?t.parentNode:(this.reportError("The node is not added in relation data."),null)},r.prototype.getChildNodes=function(t){t=this.Xe.va(t);return t?t.Ye:(this.reportError("The node is not added in relation data."),[])},r.prototype.ka=function(t){var i=[],t=this.Xe.va(t);if(!t)return this.reportError("The node is not added in relation data."),i;for(var n=t.Ye,s=0,r=n.length;s<r;++s){var h=this.ka(n[s]);0<h.length&&(i=i.concat(h))}return i=i.concat(n)},r.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},r.prototype.clear=function(){this.Xe.Oa()},i.prototype.activateIncUpdate=function(t,i,n){this.Ze.la(t);t=o.activateIncUpdate.apply(this,arguments);return this.Ia(),t},i.prototype.addNewNode=function(t){this.Ze.la([t]);t=o.addNewNode.apply(this,arguments)
;return this.Ia(),t},i.prototype.addNewNodeUsingGridLayout=function(t){this.Ze.la([t]);t=o.addNewNodeUsingGridLayout.apply(this,arguments);return this.Ia(),t},i.prototype.addNewGroupNode=function(t,i){this.Ze.la([t]),this.Ze.hf(i);i=o.addNewGroupNode.apply(this,arguments);return this.Ia(),i},i.prototype.changeParent=function(t){this.Ze.hf([t]);t=o.changeParent.apply(this,arguments);return this.Ia(),t},i.prototype.changeParentAndRelocate=function(t){this.Ze.hf(t);t=o.changeParentAndRelocate.apply(this,arguments);return this.Ia(),t},i.prototype.removeNode=function(t,i){return i?this.wa(t):this.ga(t)},i.prototype.expandGroupNode=function(t){var i=this.Ni(t,!0);if(null===i)return!1;var n=i._n;if(!n)return!1;var s=this.Ma(n),n=this.compoundCommands;this.compoundCommands=!0,i.Qh=!0,i.uf?(this.Ga(s,!1),this.Ua(t),i.uf=!1):this.Ga(s,!0),this.li.vf(i).lf(),this.ho.Iu("float");t=o.expandGroupNode.call(this,t);return this.compoundCommands=n,this.U(),this.Ia(),t},
i.prototype.collapseGroupNode=function(t){if(null===this.Ni(t,!0))return!1;var i=this.compoundCommands;this.compoundCommands=!0;var n=o.collapseGroupNode.call(this,t),t=this.Va(t);return this.Ga(t,!0),this.ho.Iu("float"),this.compoundCommands=i,this.U(),this.Ia(),n},i.prototype.expandAndLayoutExistingGroupNode=function(t,i,n){if(!1===this.Of(i))return!1;if(!1===this.If(n))return!1;var s=this.Ni(t,!0);if(null===s)return!1;var r=s._n;if(!r)return!1;this.Ze.la(i),this.Ze.ba(),s.Qh=!0;r=this.Ma(r);this.Ga(r,!1),this.xa(i);r=this.Ta(t);this.Ga(r,!1);for(var h=0,e=n.length;h<e;++h)this.Vf(n[h]);return this.Ca(t,i),s.uf=!1,this.changeStateObj.Yo(),this.ho.Iu("float"),this.U(),this.Ia(),!0},i.prototype.expandAndLayoutNewGroupNode=function(t,i,n,s){this.Ze.la([i]);i=o.expandAndLayoutNewGroupNode.apply(this,arguments);return this.Ia(),i},i.prototype.distributeNewNodes=function(t,i,n,s){this.Ze.la(i),this.Ze.ba();i=o.distributeNewNodes.apply(this,arguments);return this.Ia(),i},
i.prototype.ga=function(t){for(var i,n=!0,s=this.Ta(t),r=0,h=s.length;r<h;++r){var e=s[r];this.nodeInTable(e)&&((i=o.removeNode.call(this,e,!1))||(n=i))}return(i=o.removeNode.call(this,t,!1))||(n=i),this.Ze.removeNode(t,!1),this.Ia(),n},i.prototype.wa=function(t){var i=o.removeNode.call(this,t,!0);return this.Ze.removeNode(t,!0),this.Ia(),i},i.prototype.Ua=function(t){var i=this.compoundCommands;this.compoundCommands=!0;var n=this.Ta(t);this.Ca(t,n),this.compoundCommands=i},i.prototype.Ca=function(t,i){var n=this.compoundCommands;this.compoundCommands=!0;i=this.La(t,i);this.createTreeSLLayoutObj(this.layoutSessionData,this.hostInterfaceObj,this.changeStateObj,this.li).Da(i),this.compoundCommands=n},i.prototype.La=function(t,i){var t={hostNode:t,childItems:[]},n=i.slice(0);this.Ra(t,n);for(var s=t.childItems,r=0,h=n.length;r<h;++r)s.push({hostNode:n[r],childItems:[]});return t},i.prototype.Ra=function(t,i){for(var n=t.hostNode,s=t.childItems,r=(r=this.Ze.getChildNodes(n)).slice(0
);0<r.length;){var h=r.pop();w.LayoutHelper.removeItemInList(h,i)&&s.push({hostNode:h,childItems:[]})}for(var e=0,u=s.length;e<u;++e)this.Ra(s[e],i);return t},i.prototype.xa=function(t){for(var i=t.concat(),n=this.Mf(i);0<=i.length&&null!==n;){this.changeStateObj.addNewNode(n);n=this.Mf(i)}0<i.length&&this.reportError("GcIncUpdateTreeView: trying to add nodes that have no parent in the change state")},i.prototype.ja=function(t){for(var i=[],n=0,s=t.length;n<s;++n){var r=this.Ni(t[n],!0);r?i.push(r):this.reportError("The node is not in change state.")}return i},i.prototype.Ma=function(t){for(var i=[],n=0,s=t.length;n<s;++n){var r=t[n].hostNode;r?i.push(r):this.reportError("The node is not in change state.")}return i},i.prototype.Ga=function(t,i){if(!(t.length<1)&&(this.changeStateObj.hf(t),this.changeStateObj.ko(),this.changeStateObj.Oo(),this.ho.xo(),i))for(var n=this.Ha(),s=0,r=t.length;s<r;++s){var h,e=t[s],u=this.Ni(e);u&&!1===this.ff(e,!0).uf&&(h=this.li.snapX(u.x),e=this.li.snapY(
u.y),this.li.Tf(u,h,e,n))}},i.prototype.Ta=function(t){return this.Ze.ka(t)},i.prototype.qa=function(t){return this.Ze.getParentNode(t)},i.prototype.Va=function(t){for(var i=[],n=this.Ta(t),s=0,r=n.length;s<r;++s){var h=n[s];this.Pa(h)===t&&i.push(h)}return i},i.prototype.Pa=function(t){for(var i=this.go,n=this.qa(t);n;){var s=i.isGroupNode(n),r=i.isExpanded(n);if(s&&!r)break;n=this.qa(n)}return n},i.prototype.Ha=function(){var t="any";switch(this.layoutSessionData.Ft){case this.lt:t="leftOrRightOrDown";break;case this.wt:t="leftOrRightOrUp";break;case this.ct:t="upOrDownOrRight";break;case this.pt:t="upOrDownOrLeft"}return t},i.prototype.createTreeSLLayoutObj=function(t,i,n,s){var r=null,h=e.common.ObjectHelper.rootNamespace.Layout.TreeSLLayouter;return h?r=new h(t,i,n,s):this.reportError("SortedLayout class is not loaded."),r},i.prototype.Ia=function(){this.Ze.ma()!==this.changeStateObj.nList.length&&this.reportError("The relation node num is different with that in change state.")},
e.common.ObjectHelper.inherit(i,s);var o=i.__base__.prototype;function a(){w.LayoutSessionData.call(this),this.isNestedView=!0,this.Sa=!1,this.isPartialUpdate=!0,this.nodePlacement=w.NodePlacementOption.Center,this.isAutoClearNodeArea=!0,this.nestedNodeLayoutStrategy=w.NestedNodeLayoutStrategy.Global,this.useOriPortPadding=!0}function c(t){this.hostInterfaceObj=t,this.Fa=null,this.layoutSessionData=new a,this.za=!0,Object.defineProperty(this,"removeSegmentOverlaps",{set:function(t){this.za=t,this.Fa.removeSegmentOverlaps=t},get:function(){return this.za}}),this.layoutSessionData.isNestedView=w.LayoutCoreUtil.tryIsNestedView(t),this.switchViewMode(),this.removeSegmentOverlaps=w.LayoutCoreUtil.tryIsRSOPEnabled(t)}c.prototype.setGroupPaddingFit=function(t){this.Aa().setGroupPaddingFit(t)},c.prototype.setPortArrangement=function(t){this.layoutSessionData.portArrangement=t},c.prototype.setPartialUpdate=function(t){this.layoutSessionData.isPartialUpdate=t},
c.prototype.isIncrementalActive=function(){return this.Aa().isIncrementalActive()},c.prototype.disableIncUpdate=function(){this.Aa().disableIncUpdate()},c.prototype.activateIncUpdate=function(t,i,n){this.layoutSessionData.isNestedView=w.LayoutCoreUtil.tryIsNestedView(this.hostInterfaceObj),this.switchViewMode(),this.Aa().activateIncUpdate.apply(this.Aa(),arguments)},c.prototype.addNewNode=function(t){return this.Aa().addNewNode(t)},c.prototype.addNewNodeUsingGridLayout=function(t){return this.Aa().addNewNodeUsingGridLayout(t)},c.prototype.addNewGroupNode=function(t,i){return this.Aa().addNewGroupNode(t,i)},c.prototype.convertNodeToGroupNode=function(t){return this.Aa().convertNodeToGroupNode(t)},c.prototype.convertGroupNodeToNode=function(t){return this.Aa().convertGroupNodeToNode(t)},c.prototype.moveNode=function(t){return this.Aa().moveNode(t)},c.prototype.changeParent=function(t){return this.Aa().changeParent(t)},c.prototype.changeParentAndRelocate=function(t){return this.Aa(
).changeParentAndRelocate(t)},c.prototype.removeNode=function(t,i){return this.Aa().removeNode(t,i)},c.prototype.removeOnlyGroupNode=function(t){return this.Aa().removeOnlyGroupNode(t)},c.prototype.expandGroupNode=function(t){return this.Aa().expandGroupNode(t)},c.prototype.collapseGroupNode=function(t){return this.Aa().collapseGroupNode(t)},c.prototype.fitGroupNode=function(t,i){return this.Aa().fitGroupNode(t,i)},c.prototype.resizeNode=function(t){return this.Aa().resizeNode(t)},c.prototype.compactGroupNode=function(t,i){return this.Aa().compactGroupNode(t,i)},c.prototype.compactGraph=function(t){return this.Aa().compactGraph(t)},c.prototype.addNewConnection=function(t){return this.Aa().addNewConnection(t)},c.prototype.moveConnection=function(t){return this.Aa().moveConnection(t)},c.prototype.removeConnection=function(t){return this.Aa().removeConnection(t)},c.prototype.addNewPort=function(t,i){return this.Aa().addNewPort(t,i)},c.prototype.movePort=function(t){return this.Aa(
).movePort(t)},c.prototype.removePort=function(t){return this.Aa().removePort(t)},c.prototype.changeConnectionLabel=function(t){return this.Aa().changeConnectionLabel(t)},c.prototype.changePortLabel=function(t){return this.Aa().changePortLabel(t)},c.prototype.generalUpdate=function(t,i){return this.Aa().generalUpdate(t,i)},c.prototype.layoutSingleGroupNode=function(t){return this.Aa().layoutSingleGroupNode(t)},c.prototype.expandAndLayoutExistingGroupNode=function(t,i,n){return this.Aa().expandAndLayoutExistingGroupNode(t,i,n)},c.prototype.expandAndLayoutNewGroupNode=function(t,i,n,s){return this.Aa().expandAndLayoutNewGroupNode(t,i,n,s)},c.prototype.distributeNewNodes=function(t,i,n,s){return this.Aa().distributeNewNodes(t,i,n,s)},c.prototype.nodeInTable=function(t){return this.Aa().nodeInTable(t)},c.prototype.connectionInTable=function(t){return this.Aa().connectionInTable(t)},c.prototype.portInTable=function(t){return this.Aa().portInTable(t)},
c.prototype.beginCompoundCommands=function(){return this.Aa().beginCompoundCommands()},c.prototype.endCompoundCommandsAndUpdate=function(){return this.Aa().endCompoundCommandsAndUpdate()},c.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},c.prototype.Ni=function(){return this.Aa().Ni.apply(this.Aa(),arguments)},c.prototype.Ri=function(){return this.Aa().Ri.apply(this.Aa(),arguments)},c.prototype.nf=function(){return this.Aa().nf.apply(this.Aa(),arguments)},c.prototype.wf=function(){return this.Aa().wf.apply(this.Aa(),arguments)},c.prototype.Of=function(){return this.Aa().Of.apply(this.Aa(),arguments)},c.prototype.If=function(){return this.Aa().If.apply(this.Aa(),arguments)},c.prototype.U=function(){return this.Aa().U.apply(this.Aa(),arguments)},c.prototype.switchViewMode=function(){var t=this.Fa;return this.Fa&&(this.Fa.disableIncUpdate(),this.Fa=null),this.layoutSessionData.isNestedView?this.Fa=new s(this.hostInterfaceObj,this.layoutSessionData):this.Fa=new i(
this.hostInterfaceObj,this.layoutSessionData),this.Fa.removeSegmentOverlaps=this.removeSegmentOverlaps,t&&(this.Fa.compoundCommands=t.compoundCommands),this.Fa},c.prototype.Aa=function(){return this.Fa},e.common.ObjectHelper.rootNamespace=e.common.ObjectHelper.rootNamespace||{};var l=e.common.ObjectHelper.rootNamespace;l.Layout=l.Layout||{},l.Layout.GcIncUpdate=c,l.Layout.changeState=h;t={};return t.Layout=l.Layout||{},t.Layout.GcIncUpdate=c,t.Layout.changeState=h,t},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("@diagramming/layoutcore"),require("@diagramming/core")):"function"==typeof define&&define.amd?define(["@diagramming/layoutcore","@diagramming/core"],n):((t=t||self).diagramfoundation=t.diagramfoundation||{},t.diagramfoundation.incrementalupdate=n(t.diagramfoundation.layoutcore,t.diagramfoundation.core));