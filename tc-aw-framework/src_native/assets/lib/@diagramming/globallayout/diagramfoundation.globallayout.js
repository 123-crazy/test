// @<COPYRIGHT>@
// ==================================================
// Copyright Siemens 2020.
// PL Diagram Foundation 1973.0.1-0
// ==================================================
// @<COPYRIGHT>@
var t,n;t=this,n=function(d,u,n,t){"use strict";d=d&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d,u=u&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var s={Any:0,Left:1,Right:2,Up:3,Down:4,Inferred:5};function r(t){this.tr=t}function w(){}r.prototype.getNodeRect=function(t){return t.ir()},r.prototype.getParentNode=function(t){return t?t.getParent():null},r.prototype.isGroupNode=function(t){return t.nr()},r.prototype.isExpanded=function(t){return t.rr()},r.prototype.getGroupNodePadding=function(t){return t.sr()},r.prototype.hr=function(t){return t.hr()},r.prototype.ur=function(t){return t.or()},r.prototype.er=function(t){return t.fr()},r.prototype.getNodeOfPort=function(t){return t.ar()},r.prototype.cr=function(t){return t.cr()},r.prototype.lr=function(t){return t.or()},r.prototype.vr=function(t){return t.getDirection()},
r.prototype.getSourcePort=function(t){return t.getSourcePort()},r.prototype.getTargetPort=function(t){return t.getTargetPort()},r.prototype.dr=function(t){return t.or()},r.prototype.wr=function(t){return t.getPath()},r.prototype.pr=function(t,i,n,r,s){t.gr({x:i,y:n,width:r,height:s})},r.prototype.yr=function(t,i,n){t.br({x:i,y:n})},r.prototype.kr=function(t,i){t.setPath(i)},r.prototype.getAllPortsForNode=function(t){for(var i=[],n=t.mr,r=n?n.length:0,s=0;s<r;++s){var h=n[s];h.xr&&i.push(h)}return i},r.prototype.reportError=function(t){this.tr.reportError(t)},w.LinkYfiles_clear=function(t){t&&t.Sr&&(t.Sr=null)},w.LinkYfiles_setYfNodeOnHost=function(t,i){t.Sr=i},w.LinkYfiles_setYfEdgeOnHost=function(t,i){t.Sr=i},w.LinkYfiles_appendYfPortOnHost=function(t,i){t.Sr?t.Sr.push(i):t.Sr=[i]},w.LinkYfiles_getYfObj=function(t){return t.Sr},w.LinkYfiles_getYfPortInfo=function(t){return t.Sr},w.LinkInter_clear=function(t){t&&t.Or&&(t.Or=null)},w.LinkInter_clearWithOwners=function(t){for(
var i=t;i&&i.Or;){var n=i.Or.interObj;i.Or=null,n&&n.iOwner&&(i=n.iOwner.hostObj)}},w.LinkInter_setInterObjOnHost=function(t,i){t.Or=t.Or||{},t.Or.interObj=i},w.LinkInter_getInterObj=function(t){if(t.Or)return t.Or.interObj},w.LinkInter_setProxyInterPort=function(t,i){t.Or=t.Or||{},t.Or.proxyIPort=i},w.LinkInter_getValidInterPort=function(t){var i,t=t.Or;return i=t?t.proxyIPort||t.interObj:i};function h(t){for(var i=Array.prototype.slice.apply(arguments).slice(1),n=0;n<i.length;n++){var r,s=i[n];for(r in s)Object.prototype.hasOwnProperty.call(t,r)||(t[r]=s[r])}return t}function o(t,i,n,r){this.Pr=t,this.Tr=null,this.Lr=!!t.Dr&&!!t.jr&&!!t.Ur,this.qr=!1,this.Cr=!1,this.Nr=!1,this.nList=i,this.Ar=n,this.Rr=r,this.Er=[],this.Mr=[],this._r=[],this.Ir=[],this.Gr=[],this.Vr()}function l(){}w.inherit=function(t,i){if(t&&i&&"function"==typeof t&&"function"==typeof i){var n={};return h(n,t.prototype),t.prototype=(r=i.prototype,Object.create||(Object.create=function(t){function i(){}
return i.prototype=t,new i}),Object.create(r)),h(t.prototype,n),h(t,i),(t.prototype.constructor=t)!=i&&(t.__base__=i),t}var r},o.prototype.reset=function(){this.Tr=null,this.qr=!1,this.Cr=!1,this.Nr=!1;for(var t=this.nList,i=0,n=t.length;i<n;++i)w.LinkInter_clearWithOwners(t[i]);for(i=0,n=(t=this.Ar).length;i<n;++i)w.LinkInter_clear(t[i]);for(i=0,n=(t=this.Rr).length;i<n;++i)w.LinkInter_clear(t[i]);this.nList=[],this.Ar=[],this.Rr=[],this.Er=[],this.Mr=[],this._r=[],this.Ir=[],this.Gr=[]},o.prototype.Vr=function(){this.Yr(this.nList,this.Ar,this.Rr),this.Fr(),this.Hr()},o.prototype.Yr=function(t,i,n){for(var r=0,s=t.length;r<s;++r)this.Br(t[r]);for(r=0,s=i.length;r<s;++r)this.Kr(i[r]);for(r=0,s=n.length;r<s;++r)this.Xr(n[r]);for(r=0,s=t.length;r<s;++r)this.zr(t[r]);for(r=0,s=i.length;r<s;++r)this.Jr(i[r]);for(r=0,s=n.length;r<s;++r)this.Qr(n[r])},o.prototype.zr=function(t){var i=w.LinkInter_getInterObj(t),t=this.Pr.getParentNode(t),t=t?w.LinkInter_getInterObj(t):null;this.Wr(i,t)},
o.prototype.Jr=function(t){var i=w.LinkInter_getInterObj(t),t=this.Pr.getNodeOfPort(t),t=w.LinkInter_getInterObj(t);t?this.Zr(i,t):alert("Port owner node is not added in the graph.")},o.prototype.Qr=function(t){var i=this.Pr,n=w.LinkInter_getInterObj(t),r=i.getSourcePort(t),s=i.getTargetPort(t),i=r?w.LinkInter_getInterObj(r):null,t=s?w.LinkInter_getInterObj(s):null;r&&!i&&alert("Edge's source port is not added in the graph."),s&&!t&&alert("Edge's target port is not added in the graph."),this.$r(n,i),this.ws(n,t)},o.prototype.Fr=function(){var t=this.Rr;if(this.Lr)for(i=0,n=t.length;i<n;++i){r=w.LinkInter_getInterObj(t[i]);this.gs(r)}else for(var i=0,n=t.length;i<n;++i){var r=w.LinkInter_getInterObj(t[i]);this.ys(r)}},o.prototype.ys=function(t){t.ks&&t.ks||(t.xr=!1)},o.prototype.gs=function(t){var i,n,r,s,h=this.Pr,u=t.xs;t.ks||(i=h.Dr(u),n=h.jr(u),r=this.Ss(n,i),s=this.Os(r),this.$r(t,s)),t.Ps||(i=h.Dr(u),n=h.Ur(u),r=this.Ss(n,i),s=this.Os(r),this.ws(t,s))},o.prototype.Hr=function(){
for(var t=this.Ts(),i=0,n=t.length;i<n;++i){var r=t[i],s=l.findTopCollapsedNode(r);null!=s&&(r.xr=!1);var h=r.mr;if(null!=h)if(!r.xr||r.Ls&&!r.Ds)for(var u=0,o=h.length;u<o;++u)h[u].xr=!1}this.js()},o.prototype.js=function(){for(var t=this.Rr,i=0,n=t.length;i<n;++i){var r,s,h,u,o,e,f=w.LinkInter_getInterObj(t[i]);f.xr&&(r=f.ks,s=f.Ps,r&&s?r.xr&&s.xr?f.xr=!0:(h=!1,r.xr||s.xr||null!=(u=l.findEdgeOwner(f))&&(u.xr&&(!u.Ls||u.Ds)||(h=!0)),h?f.xr=!1:(f.xr=!0,r.xr||(o=l.findCandidateNodeOfPort(r),e=this.Us(r,o),this.$r(f,e)),s.xr||(o=l.findCandidateNodeOfPort(s),e=this.Us(s,o),this.ws(f,e)))):f.xr=!1)}},o.prototype.Br=function(t){var i=this.Pr,n=new a(t,i.getNodeRect(t));return w.LinkInter_setInterObjOnHost(t,n),n.Ls=i.isGroupNode(n.xs),n.Ds=!!n.Ls&&i.isExpanded(n.xs),n.qs=n.Ls?i.getGroupNodePadding(n.xs):null,n.Cs=!!i.ur&&i.ur(n.xs),n.Cs&&(this.qr=!0),n},o.prototype.Kr=function(t){var i=this.Pr,n=new v(t,i.cr(t));return w.LinkInter_setInterObjOnHost(t,n),n.Cs=!!i.lr&&i.lr(n.xs),
n.Ns=i.vr?i.vr(n.xs):s.Any,n.Cs&&(this.Cr=!0),n},o.prototype.Xr=function(t){var i=this.Pr,n=new g(t,this.Pr.wr(t));return w.LinkInter_setInterObjOnHost(t,n),n.Cs=!!i.dr&&i.dr(n.xs),n.Cs&&(this.Nr=!0),n},o.prototype.Ss=function(t,i){t=new b(t.x,t.y),i=i?w.LinkInter_getInterObj(i):null;return this.Wr(t,i),this._r.push(t),t},o.prototype.Os=function(t){var i=t.As,n={};n.x=.5*i.width+i.x,n.y=.5*i.height+i.y;n=new k(n);return this.Zr(n,t),this.Ir.push(n),n},o.prototype.Us=function(t,i){var n=t.xs,t=new y(t,i);return w.LinkInter_setProxyInterPort(n,t),this.Zr(t,i),t.Cs&&(this.Cr=!0),this.Mr.push(t),t},o.prototype.Rs=function(t){var i=new m(t);return t.Es=i,this.Wr(i,t.Ms),this.Gr.push(i),i.Cs&&(this.qr=!0),i},o.prototype.Wr=function(t,i){i?(i._s||(i._s=[]),i._s.push(t),t.Ms=i):(this.Er.push(t),t.Ms=null)},o.prototype.Zr=function(t,i){i.mr||(i.mr=[]),i.mr.push(t),t.Ms=i},o.prototype.$r=function(t,i){null!=i&&(i.Is||(i.Is=[]),i.Is.push(t)),t.ks=i},o.prototype.ws=function(t,i){null!=i&&(i.Is||(
i.Is=[]),i.Is.push(t)),t.Ps=i},o.prototype.Ts=function(){for(var t=[],i=this.nList,n=0,r=i.length;n<r;++n){var s=w.LinkInter_getInterObj(i[n]);t.push(s)}for(n=0,r=(i=this._r).length;n<r;++n)t.push(i[n]);for(n=0,r=(i=this.Gr).length;n<r;++n)t.push(i[n]);return t},o.prototype.Gs=function(){for(var t=[],i=this.Ar,n=0,r=i.length;n<r;++n){var s=w.LinkInter_getInterObj(i[n]);t.push(s)}for(n=0,r=(i=this.iDangLingPorts).length;n<r;++n)t.push(i[n]);for(n=0,r=(i=this.Mr).length;n<r;++n)t.push(i[n]);return t},o.prototype.Vs=function(){for(var t=[],i=this.Rr,n=0,r=i.length;n<r;++n){var s=w.LinkInter_getInterObj(i[n]);t.push(s)}return t},o.prototype.Ys=function(t,i,n){t?(t=w.LinkInter_getInterObj(t))?l.offsetWholeGroup(t,i,n):alert("Cannot find the group in layout module."):alert("The offset input group is null.")},o.prototype.Fs=function(t){t=t?w.LinkInter_getInterObj(t):null;this.Hs(t);var i=!1;if(this.Pr.Bs)for(var n=this.nList,r=0,s=n.length;r<s;++r){var h=w.LinkInter_getInterObj(n[r])
;this.Pr.Bs(h.xs)&&h.xr&&(i=h.Ks=!0)}i&&this.Xs()},o.prototype.zs=function(t){t=t?w.LinkInter_getInterObj(t):null;this.Hs(t);for(var i=t?t._s:this.Er,n=i?i.length:0,r=0;r<n;++r){var s=i[r];s.Ls&&s.Ds&&(s.Ks=!0)}this.Xs()},o.prototype.Hs=function(t){if(t){for(var i=this.Ts(),n=0,r=i.length;n<r;++n){var s=i[n];s!==t&&s.xr&&(l.isNodeDescentOfNode(s,t)||(s.xr=!1,this.Js(s,!1)))}for(var h=this.Vs(),n=0,r=h.length;n<r;++n){var u=h[n];u.xr&&(u.ks.xr&&u.Ps.xr||(u.xr=!1))}}},o.prototype.Js=function(t,i){t.xr=i;for(var n=t.mr,r=n?n.length:0,s=0;s<r;++s)n[s].xr=i;for(var h=t._s,r=h?h.length:0,s=0;s<r;++s)this.Js(h[s],i)},o.prototype.Xs=function(){for(var t=this.Ts(),i=0,n=t.length;i<n;++i){var r=t[i];r.xr&&r.Ks&&(o=this.Rs(r),this.Js(r,!1))}for(var s=this.Vs(),i=0,n=s.length;i<n;++i){var h,u,o,e,f=s[i];f.xr&&(u=l.findEdgeOwner(f),f.xr=!u||u.xr,f.xr&&(h=f.ks,u=f.Ps,h.xr||((o=l.findSealedNodeOfPort(h))?(e=this.Us(h,o),this.$r(f,e)):alert("Cannot find sealed node.")),u.xr||((
o=l.findSealedNodeOfPort(u))?(e=this.Us(u,o),this.ws(f,e)):alert("Cannot find sealed node."))))}},o.prototype.getLayoutCandidates=function(){for(var t=[],i=[],n=[],r=this.Ts(),s=0,h=r.length;s<h;++s){var u=r[s];if(u.xr){t.push(u);for(var o=u.mr,e=o?o.length:0,f=0;f<e;++f){var a=o[f];a.xr&&i.push(a)}}}for(var c=this.Rr,s=0,h=c.length;s<h;++s){var l=w.LinkInter_getInterObj(c[s]);l.xr&&n.push(l)}var v={};return v.nodeList=t,v.portList=i,v.edgeList=n,v},o.prototype.Qs=function(t){var i;return this.Tr||(i=new r(this.Pr),this.qr||(i.ur=null),this.Cr||(i.lr=null),this.Nr||(i.dr=null),t&&(i.hr=null),i.er=null,this.Pr.vr||(i.vr=null),this.Tr=i),this.Tr},o.prototype.Ws=function(){return this.qr},o.prototype.Zs=function(){return this.Cr},o.prototype.$s=function(){return this.Nr},o.prototype.th=function(t){return w.LinkInter_getInterObj(t).ir()},o.prototype.ih=function(t){return w.LinkInter_getInterObj(t).cr()},o.prototype.nh=function(t){return w.LinkInter_getInterObj(t).getPath()},
l.findTopCollapsedNode=function(t){for(var i=null,n=t.Ms;n;)n.Ds||(i=n),n=n.Ms;return i},l.findCandidateNodeOfPort=function(t){for(var i=null,n=t.Ms;n;){if(n.xr){i=n;break}n=n.Ms}return i||alert("The top candidate node is null."),i},l.findSealedNodeOfPort=function(t){for(var i=null,n=t.Ms;n;)null!==n.Es&&void 0!==n.Es&&(i=n.Es),n=n.Ms;return i},l.findEdgeOwner=function(t){var i=t.ks,t=t.Ps;if(!i||!t)return null;var i=i.Ms,n=t.Ms;if(i===n)return i;for(var r=null,s=i;null!=s;){if(l.isNodeDescentOfNode(n,s)){r=s;break}s=s.Ms}return r},l.isNodeDescentOfNode=function(t,i){if(t===i)return!1;if(!i)return!0;if(!t)return!1;for(var n=!1,r=t.Ms;null!=r;){if(r===i){n=!0;break}r=r.Ms}return n},l.offsetWholeGroup=function(t,i,n){var r=[];l.rh(t,i,n,r);for(var s=0,h=r.length;s<h;++s){var u=r[s];if(!u.sh){var o=l.findEdgeOwner(u);if(o===t||l.isNodeDescentOfNode(o,t)){var e=u.hh;if(e)for(var f=0,a=e.length;f<a;++f)e[f].x+=i,e[f].y+=n}u.sh=!0}}for(s=0,h=r.length;s<h;++s)delete r[s].sh},l.rh=function(t,i
,n,r){t.As.x+=i,t.As.y+=n;for(var s=t.mr,h=s?s.length:0,u=0;u<h;++u){var o=s[u];o.uh.x+=i,o.uh.y+=n;for(var e=o.Is,f=e?e.length:0,a=0;a<f;++a)r.push(e[a])}for(var c=t._s,h=c?c.length:0,u=0;u<h;++u)l.rh(c[u],i,n,r)};var i=0;function e(){this.uid=++i}function f(t,i){e.call(this),this.xs=t,this.As=i,this.Ms=null,this._s=null,this.mr=null,this.Ls=!1,this.Ds=!1,this.qs=null,this.Cs=!1,this.xr=!0,this.Ks=!1,this.Es=null}function a(t,i){f.call(this,t,i)}function c(t,i){e.call(this),this.xs=t,this.uh=i,this.Ms=null,this.Is=null,this.Cs=!1,this.Ns=s.Any,this.xr=!0}function v(t,i){c.call(this,t,i)}function p(t,i){e.call(this),this.xs=t,this.hh=i,this.ks=null,this.Ps=null,this.Cs=!1,this.xr=!0}function g(t,i){p.call(this,t,i)}function y(t,i){var n=this.oh(t,i),r=t.xs;c.call(this,r,n),i.Ls&&!i.Ds?(this.Cs=!1,this.Ns=s.Any):(this.Cs=!0,this.Ns=t.Ns)}function b(t,i){f.call(this,null,{x:t,y:i,width:1,height:1})}function k(t){c.call(this,null,t)}function m(t){f.call(this,t.xs,t.As),
t.Ls&&t.Ds&&t.xr&&t.Ks||alert("Sealed group status is not correct."),this.Ls=!1,this.Ds=!1,this._s=null,this.qs=null,this.Cs=!1,this.Ks=!1,this.Es=null,this.eh=t}f.prototype.ir=function(){return this.As},f.prototype.gr=function(t){this.As=t},f.prototype.getParent=function(){var t=this.Ms;return t=t&&!t.xr?null:t},f.prototype.nr=function(){return!(this.Ls&&!this.Ds)&&this.Ls},f.prototype.rr=function(){return this.Ls||alert("This node is not a group."),this.Ds},f.prototype.hr=function(){return this.Ls||alert("This node is not a group."),this.As},f.prototype.sr=function(){return this.qs||alert("Group padding is null in this node."),this.qs},f.prototype.or=function(){return this.Cs},f.prototype.fr=function(){return 0},w.inherit(f,e),w.inherit(a,f),a.prototype.gr=function(t){var i,n;this.Ls&&!this.Ds?(i=t.x-this.As.x,n=t.y-this.As.y,l.offsetWholeGroup(this,i,n)):this.As=t},c.prototype.ar=function(){return this.Ms.xr||alert("Port's owning node is not candidate."),this.Ms},
c.prototype.cr=function(){return this.uh},c.prototype.br=function(t){this.uh=t},c.prototype.or=function(){return this.Cs},c.prototype.getDirection=function(){return this.Ns},w.inherit(c,e),w.inherit(v,c),p.prototype.getSourcePort=function(){return this.ks&&!this.ks.xr&&alert("Source port is not candidate."),this.ks},p.prototype.getTargetPort=function(){return this.Ps&&!this.Ps.xr&&alert("Target port is not candidate."),this.Ps},p.prototype.getPath=function(){return this.hh},p.prototype.setPath=function(t){this.hh=t},p.prototype.or=function(){return this.Cs},w.inherit(p,e),w.inherit(g,p),w.inherit(y,c),y.prototype.oh=function(t,i){var n={x:0,y:0};return i.Ls&&!i.Ds?(i=i.As,n.x=.5*i.width+i.x,n.y=.5*i.height+i.y):n=t.uh,n},w.inherit(b,f),w.inherit(k,c),w.inherit(m,f),m.prototype.gr=function(t){var i=t.x-this.As.x,n=t.y-this.As.y;this.As=t,l.offsetWholeGroup(this.eh,i,n)};var x={Tree:0,Hierarchical:1,Balloon:2,Orthogonal:3,Compact:4,Circular:5,Organic:6,Snake:7,Group:8,SimpleTree:9,
SimpleBalloon:10,NoLayout:11,OrthogonalGroup:13},S={Organic:0,Polyline1:1,Polyline2:2,Orthogonal:3,StraightLine:4,HVPaths:5,Default:6},O={Organic:0,Orthogonal:1,Line:2};function P(){this.fh=x.Hierarchical,this.Ft=d.LayoutDirection.TopToBottom,this.ah=S.Orthogonal,this.nestedNodeLayoutStrategy=d.NestedNodeLayoutStrategy.InsideToOut,this.ch=40,this.minLayerDistance=40,this.minNodeToEdgeDist=20,this.lh=20,this.minPortExtensionDist=20,this.vh=20,this.dh=O.Orthogonal,this.wh=!1,this.ph=!0,this.gh=800,this.yh=800,this.bh=!1,this.kh=!1,this.mh=!1,this.xh=!0,this.Sh=!0,this.Oh=500,this.Ph=1,this.rankingStrategy=null,this.nodePlacement=d.NodePlacementOption.Center}function T(t){this.tr=t,this.layoutOptions=new P,this.Th=null,this.Lh=null,this.Dh=null,this.dagreLayoutObj=null,this.jh=null,this.Uh=null,this.qh=null,this.dpMaps=null,this.Ch()}function L(t){this.changeStateObj=t,this.hostInterfaceObj=t.hostInterfaceObj,this.Nh=!1}P.prototype.Ah=function(){
var t=yfiles.layout.LayoutOrientation.TOP_TO_BOTTOM,i=this.Ft;switch(this.kh&&(i==d.LayoutDirection.TopToBottom?i=d.LayoutDirection.BottomToTop:i==d.LayoutDirection.BottomToTop&&(i=d.LayoutDirection.TopToBottom)),i){case d.LayoutDirection.TopToBottom:t=yfiles.layout.LayoutOrientation.TOP_TO_BOTTOM;break;case d.LayoutDirection.LeftToRight:t=yfiles.layout.LayoutOrientation.LEFT_TO_RIGHT;break;case d.LayoutDirection.BottomToTop:t=yfiles.layout.LayoutOrientation.BOTTOM_TO_TOP;break;case d.LayoutDirection.RightToLeft:t=yfiles.layout.LayoutOrientation.RIGHT_TO_LEFT;break;default:alert("Invalid Layout Direction: "+i)}return t},P.prototype.Rh=function(){var t=yfiles.partial.EdgeRoutingStrategy.ORTHOGONAL,i=this.dh;switch(i){case O.Organic:t=yfiles.partial.EdgeRoutingStrategy.ORGANIC;break;case O.Orthogonal:t=yfiles.partial.EdgeRoutingStrategy.ORTHOGONAL;break;case O.Line:t=yfiles.partial.EdgeRoutingStrategy.STRAIGHTLINE;break;default:alert("Unknown SubGraph Routing Type - "+i)}return t},
P.prototype.copyFrom=function(t){for(var i in t)Object.prototype.hasOwnProperty.call(this,i)&&(this[i]=t[i])},T.prototype.reset=function(){this.Th&&this.Th.reset(),this.Lh&&this.Lh.reset(),this.Dh&&this.Dh.reset(),this.dagreLayoutObj&&this.dagreLayoutObj.reset(),this.Th=null,this.Lh=null,this.Dh=null,this.dagreLayoutObj=null,this.jh=null,this.Uh=null,this.qh=null,this.dpMaps=null,this.Ch()},T.prototype.Ch=function(){this.Th=null,this.Lh=null,this.Dh=null,this.dagreLayoutObj=null,this.jh=[],this.Uh=[],this.qh=[],this.dpMaps=null},T.prototype.Eh=function(){return d.LayoutCoreUtil.Mh(this.layoutOptions)?this.layoutOptions.nestedNodeLayoutStrategy===d.NestedNodeLayoutStrategy.InsideToOut?(this.Lh||(t=this.Th.Qs(this.layoutOptions.ph),this.Lh=this.createBottomUpLayoutObj(t)),this.setInnerDpMaps(this.Lh,this.dpMaps),this.Lh):(this.Dh||(t=this.Th.Qs(this.layoutOptions.ph),this.Dh=this.createGlobalLayoutObj(t)),this.setInnerDpMaps(this.Dh,this.dpMaps),this.Dh):(this.dagreLayoutObj||(
t=this.Th.Qs(this.layoutOptions.ph),this.dagreLayoutObj=this.createDagreLayoutObj(t)),this.setInnerDpMaps(this.dagreLayoutObj,this.dpMaps),this.dagreLayoutObj);var t},T.prototype.getLayoutOptions=function(){return this.layoutOptions},T.prototype.addNode=function(t){this.jh.push(t)},T.prototype.addPort=function(t){this.Uh.push(t)},T.prototype.addEdge=function(t){this.qh.push(t)},T.prototype.layout=function(){this._h(this.layoutOptions.fh),this.Th&&this.Th.reset(),this.Th=new o(this.tr,this.jh,this.Uh,this.qh),this.Ih(this.layoutOptions);var t=this.Eh();t.getLayoutOptions().copyFrom(this.layoutOptions);var i=this.Th.getLayoutCandidates();this.Gh(i.nodeList,i.portList,i.edgeList),t.layout(),this.Vh(i.nodeList,i.portList,i.edgeList)},T.prototype.Yh=function(t){this._h(this.layoutOptions.fh),this.Th&&this.Th.reset(),this.Th=new o(this.tr,this.jh,this.Uh,this.qh),this.Th.Fs(t);var i=t?this.Th.th(t):null;this.Ih(this.layoutOptions);var n=this.Eh();n.getLayoutOptions().copyFrom(
this.layoutOptions);var r=this.Th.getLayoutCandidates();this.Gh(r.nodeList,r.portList,r.edgeList),n.layout(),this.Vh(r.nodeList,r.portList,r.edgeList);n=t?this.Th.th(t):null;null!=t&&(r=i.x-n.x,n=i.y-n.y,this.Th.Ys(t,r,n))},T.prototype.Fh=function(t){this._h(this.layoutOptions.fh),this.Th&&this.Th.reset(),this.Th=new o(this.tr,this.jh,this.Uh,this.qh),this.Th.zs(t);var i=t?this.Th.th(t):null;this.Ih(this.layoutOptions);var n=this.Eh();n.getLayoutOptions().copyFrom(this.layoutOptions);var r=this.Th.getLayoutCandidates();this.Gh(r.nodeList,r.portList,r.edgeList),n.layout(),this.Vh(r.nodeList,r.portList,r.edgeList);n=t?this.Th.th(t):null;null!=t&&(r=i.x-n.x,n=i.y-n.y,this.Th.Ys(t,r,n))},T.prototype.Hh=function(){var t=this.layoutOptions,i=t.fh,n=t.RoutingType,r=!0;t.fh===x.NoLayout?t.origRoutingType===S.Default?(r=!1,this.reportError("Route: the route type cannot be Default for NoLayout.")):r=!0:(r=(t.ah===S.Default&&(t.ah=this.Bh(t.fh)),!0),t.fh=x.NoLayout),r&&this.layout(),t.fh=i,
t.RoutingType=n},T.prototype.Bh=function(t){var i=S.Polyline1;switch(t){case x.Tree:case x.Hierarchical:case x.Orthogonal:case x.Compact:case x.Snake:case x.Group:case x.SimpleTree:i=S.Polyline1;break;case x.Balloon:case x.Circular:case x.Organic:case x.SimpleBalloon:i=S.StraightLine;break;default:this.reportError("LayoutLayer: Unsupported layout type: ."+t)}return i},T.prototype.Ih=function(t){var i=(i=this.Th.Ws()||this.Th.$s())||t.ah!==S.Default;t.mh=i},T.prototype.Gh=function(t,i,n){for(var r=this.Eh(),s=0,h=t.length;s<h;++s)r.addNode(t[s]);for(s=0,h=i.length;s<h;++s)r.addPort(i[s]);for(s=0,h=n.length;s<h;++s)r.addEdge(n[s])},T.prototype.Vh=function(t,i,n){for(var r=this.Eh(),s=0,h=t.length;s<h;++s){var u=t[s],o=r.th(u);u.gr(o)}for(s=0,h=i.length;s<h;++s){var e=i[s],f=r.ih(e);e.br(f)}for(s=0,h=n.length;s<h;++s){var a=n[s],c=r.nh(a);a.setPath(c)}},T.prototype.th=function(t){return this.Th.th(t)},T.prototype.ih=function(t){return this.Th.ih(t)},T.prototype.nh=function(t){
return this.Th.nh(t)},T.prototype.Kh=function(){return this.Eh().Kh()},T.prototype.setAllDpMaps=function(t){this.dpMaps=t},T.prototype.setInnerDpMaps=function(t,i){var n,r=null;if(i)for(var s in r={},i)!Object.prototype.hasOwnProperty.call(i,s)||(n=i[s])&&(r[s]={get:function(t){t=t.xs;return t?n.get(t):0}});t.setAllDpMaps(r)},T.prototype._h=function(t){var i=!0;return d.LayoutCoreUtil.Mh(this.layoutOptions)||t!==x.Hierarchical&&(this.reportError("DF homegrown layout does not support layout type: "+this.Xh(t)),i=!1),i},T.prototype.Xh=function(t){var i,n=x,r=t;for(i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&n[i]===t){r=i;break}return r},T.prototype.createGlobalLayoutObj=function(t){var i=null,n=u.common.ObjectHelper.rootNamespace.Layout.YfGlobalLayout;return n?i=new n(t):this.reportError("yfiles layout is not loaded."),i},T.prototype.createBottomUpLayoutObj=function(t){var i=null,n=u.common.ObjectHelper.rootNamespace.Layout.YfLayout;return n?i=new n(t):this.reportError(
"yfiles layout is not loaded."),i},T.prototype.createDagreLayoutObj=function(t){var i=null,n=u.common.ObjectHelper.rootNamespace.Layout.DagreLayer;return n?i=new n(t):this.reportError("Dagre is not loaded."),i},T.prototype.reportError=function(t){this.tr.reportError(t)},L.prototype.getNodeRect=function(t){return{x:t.x,y:t.y,width:t.w,height:t.h}},L.prototype.getParentNode=function(t){t=t.$n;return t===this.changeStateObj.zh?null:t},L.prototype.isGroupNode=function(t){return t.Jh},L.prototype.isExpanded=function(t){return t.Qh},L.prototype.getGroupNodePadding=function(t){return this.hostInterfaceObj.getGroupNodePadding(t.hostNode)},L.prototype.getNodeOfPort=function(t){return t.ti};function D(t){var i={};return i.x=t.x+t.w/2,i.y=t.y+t.h/2,i}function j(t){this.changeStateObj=t,this.hostInterfaceObj=t.hostInterfaceObj,this.layoutSessionData=t.layoutSessionData,this.reportError=t.reportError,this.Wh=null,this.Zh=null,this.dpMaps=null,
this.RoutingType=u.common.ObjectHelper.rootNamespace.Layout.RoutingType}function U(t,i,n){this.changeStateObj=t,this.hostInterfaceObj=t.hostInterfaceObj,this.$h=i,this.tu=n,this.iu=this.nu(i)}L.prototype.cr=D,L.prototype.lr=function(t){return!!this.Nh&&!t.cn},L.prototype.getSourcePort=function(t){t=t.Si,t=this.hostInterfaceObj.getSourcePort(t);return t?this.changeStateObj.ru(t):null},L.prototype.getTargetPort=function(t){t=t.Si,t=this.hostInterfaceObj.getTargetPort(t);return t?this.changeStateObj.ru(t):null},L.prototype.wr=function(t){var i=[];if(t.su)for(var n=t.su,r=0,s=n.length;r<s;++r)i.push({x:n[r].x,y:n[r].y});else{var h=this.getSourcePort(t),t=this.getTargetPort(t);h&&t&&(i=[D(h),D(t)])}return i},L.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},j.prototype.hu=function(t,i,n){var r=this.uu(),s=r.getLayoutOptions();this.ou(s),this.addCandidatesIntoLayouter(t,i,n),r.layout(),this.updateChangeStateFromLayouter(t,i,n),r.reset()},
j.prototype.doLayoutGroupOneLevel=function(t,i,n,r){var s=this.uu(),h=s.getLayoutOptions();this.ou(h),this.addCandidatesIntoLayouter(i,n,r),s.Fh(t),this.updateChangeStateFromLayouter(i,n,r),s.reset()},j.prototype.doLayoutGroupAllLevels=function(t,i,n,r){var s=this.uu(),h=s.getLayoutOptions();this.ou(h),this.addCandidatesIntoLayouter(i,n,r),s.Yh(t),this.updateChangeStateFromLayouter(i,n,r),s.reset()},j.prototype.Hh=function(t,i,n){var r=this.uu(),s=r.getLayoutOptions();this.ou(s),this.eu(s),this.addCandidatesIntoLayouter(t,i,n),r.Hh(),this.updateChangeStateFromLayouter(t,i,n),r.reset()},j.prototype.ou=function(t){var i=this.layoutSessionData;t.ch=i.ch,t.lh=i.lh,t.minLayerDistance=i.minLayerDistance,t.fh=i.fh,t.Ft=i.Ft,t.ah=i.ah,t.minNodeToEdgeDist=i.lh,t.minPortExtensionDist=i.minPortExtensionDist,t.vh=i.vh,t.ph=i.ph,t.xh=i.xh,t.Sh=i.Sh,t.Oh=i.Oh,t.Ph=i.Ph,t.nestedNodeLayoutStrategy=i.nestedNodeLayoutStrategy,t.rankingStrategy=i.rankingStrategy,t.nodePlacement=i.nodePlacement,
t.ah===this.RoutingType.HVPaths&&(t.ah=this.RoutingType.Default),i.fu&&this.au(t),t.coreType=i.coreType},j.prototype.au=function(t){t.lh=Math.min(t.lh,0),t.minNodeToEdgeDist=Math.min(t.minNodeToEdgeDist,0),t.minPortExtensionDist=Math.min(t.minPortExtensionDist,0),t.vh=Math.min(t.vh,0)},j.prototype.eu=function(t){t.lh*=.9,t.minNodeToEdgeDist*=.9,t.minPortExtensionDist*=.9,t.vh*=.9},j.prototype.addCandidatesIntoLayouter=function(t,i,n){for(var r=this.uu(),s=0,h=t.length;s<h;++s)r.addNode(t[s]);for(s=0,h=i.length;s<h;++s)r.addPort(i[s]);for(s=0,h=n.length;s<h;++s)r.addEdge(n[s])},j.prototype.updateChangeStateFromLayouter=function(t,i,n){for(var r=this.uu(),s=0,h=t.length;s<h;++s){var u=t[s],o=r.th(u);this.cu(u,o)}for(s=0,h=i.length;s<h;++s){var e=i[s],f=r.ih(e);this.lu(e,f)}for(s=0,h=n.length;s<h;++s){var a=n[s],c=r.nh(a);this.vu(a,c)}},j.prototype.cu=function(t,i){t.x,t.y,t.w,t.h;t.x=i.x,t.y=i.y,t.w=i.width,t.h=i.height},j.prototype.lu=function(t,i){t.x=i.x-t.w/2,t.y=i.y-t.h/2},
j.prototype.vu=function(t,i){var n=this.hostInterfaceObj,r=[];if(i)for(var s=0,h=i.length;s<h;++s){var u=i[s];r.push(n.makePoint(u.x,u.y))}t.su=r},j.prototype.setAllDpMaps=function(t){this.dpMaps=t},j.prototype.setInnerDpMaps=function(t,i){t.setAllDpMaps(i)},j.prototype.uu=function(){var t=this.Zh;return t||(this.Wh=new L(this.changeStateObj),this.Wh.Nh=this.layoutSessionData.du,t=new T(this.Wh),this.Zh=t),this.setInnerDpMaps(t,this.dpMaps),t},U.prototype.wu=function(t,i,n){for(var r=this.iu,s=[],h=0,u=r.length;h<u;++h){var o=r[h],e=this.pu(o);e&&(e.gu||(e.gu=[]),e.gu.push(o),s.push(e));e=this.yu(o);e&&(e.gu||(e.gu=[]),e.gu.push(o),s.push(e))}for(n=t.apply(i,n),h=0,u=s.length;h<u;++h)delete s[h].gu;return n},U.prototype.bu=function(t){for(var i=!1,n=t.ki,r=n?n.length:0,s=0;s<r;++s){var h=n[s].gu;if(h&&0<h.length){i=!0;break}}return i},U.prototype.ku=function(t){for(var i=!1,n=this.iu,r=0,s=n.length;r<s;++r)if(this.mu(n[r],t)){i=!0;break}return i},U.prototype.xu=function(t){for(var i=!1
,n=this.iu,r=0,s=n.length;r<s;++r)if(this.Su(n[r],t)){i=!0;break}return i},U.prototype.Ou=function(t){var i=!1;return!(i=t.Jh?t.Qh?!this.xu(t):!this.ku(t):!this.bu(t))||null!=(this.tu?this.tu.get(t.hostNode):null)&&(i=!1),i},U.prototype.getForWholeGraph=function(){return this.wu(this.Pu,this,arguments)},U.prototype.getGroupAllLevels=function(){return this.wu(this.Tu,this,arguments)},U.prototype.getGroupOneLevel=function(){return this.wu(this.Lu,this,arguments)},U.prototype.Pu=function(){return this.Tu()},U.prototype.Tu=function(){var t=this.$h;if(t&&(!t.Jh||!t.Qh))return null;for(var i=[],n=[],r=[],s=[],h=[],u=[],o=0,e=(u=t?(i.push(t),t._n):this.changeStateObj.zh._n).length;o<e;++o){var f=u[o];this.Du(f,i,n,h)}this.ju(i,r,s);t={};return t.cNodeList=i,t.uNodeList=n,t.portList=r,t.edgeList=s,t.isolatedGroups=h,t},U.prototype.Lu=function(){var t=this.$h;if(t&&(!t.Jh||!t.Qh))return null;for(var i=[],n=[],r=[],s=[],h=[],u=0,o=(h=t?(i.push(t),t._n):this.changeStateObj.zh._n).length;u<o;++u){
var e=h[u];this.Ou(e)?n.push(e):this.Uu(e,i)}this.ju(i,r,s);t={};return t.cNodeList=i,t.uNodeList=n,t.portList=r,t.edgeList=s,t.isolatedGroups=[],t},U.prototype.Du=function(t,i,n,r){if(this.Ou(t))return n.push(t),void(t.Jh&&t.Qh&&r.push(t));i.push(t);for(var s=t._n,h=s?s.length:0,u=0;u<h;++u)this.Du(s[u],i,n,r)},U.prototype.Uu=function(t,i){i.push(t);for(var n=t._n,r=n?n.length:0,s=0;s<r;++s)this.Uu(n[s],i)},U.prototype.ju=function(t,i,n){for(var r=0,s=t.length;r<s;++r){var h=t[r].ki;if(h)for(var u=0,o=h.length;u<o;++u){var e=h[u];i.push(e),e.qu=!0}}for(var f=this.iu,r=0,s=f.length;r<s;++r){var a=f[r],c=this.pu(a),l=this.yu(a);c&&!c.qu||l&&!l.qu||n.push(a)}for(r=0,s=i.length;r<s;++r)delete i[r].qu},U.prototype.nu=function(t){var i=[];if(t)for(var n=this.changeStateObj.cList,r=0,s=n.length;r<s;++r){var h=n[r];this.Cu(h,t)&&i.push(h)}else i=this.changeStateObj.cList;return i},U.prototype.Cu=function(t,i){if(!i)return!0;var n=this.pu(t),r=this.yu(t);if(!n||!r)return!1
;t=this.changeStateObj,n=n.ti,r=r.ti;return n===i&&r===i||(n===i&&r!==i?t.Nu(r,i):r===i&&n!==i?t.Nu(n,i):n!==i&&r!==i?!!t.Nu(n,i)&&t.Nu(r,i):(this.changeStateObj.reportError("Unknown status."),!1))},U.prototype.mu=function(t,i){if(!i)return this.changeStateObj.reportError("The input ChangeState node is null."),!1;var n=this.pu(t),r=this.yu(t);if(!n||!r)return!1;t=n.ti,n=r.ti,r=this.changeStateObj;if(t===i&&n===i)return!1;if(t===i&&n!==i)return!r.Nu(n,i);if(n===i&&t!==i)return!r.Nu(t,i);if(t===i||n===i)return this.changeStateObj.reportError("Unknown status."),!1;t=r.Nu(t,i),i=r.Nu(n,i);return(!t||!i)&&!(!t&&!i)},U.prototype.Su=function(t,i){if(!i)return this.changeStateObj.reportError("The input ChangeState node is null."),!1;var n=this.pu(t),r=this.yu(t);if(!n||!r)return!1;t=n.ti,n=r.ti,r=this.changeStateObj;if(t===i&&n===i)return!0;if(t===i&&n!==i)return!r.Nu(n,i);if(n===i&&t!==i)return!r.Nu(t,i);if(t===i||n===i)return this.changeStateObj.reportError("Unknown status."),!1;t=r.Nu(t,i),
i=r.Nu(n,i);return(!t||!i)&&!(!t&&!i)},U.prototype.pu=function(t){t=this.hostInterfaceObj.getSourcePort(t.Si);return t?this.changeStateObj.ru(t):null},U.prototype.yu=function(t){t=this.hostInterfaceObj.getTargetPort(t.Si);return t?this.changeStateObj.ru(t):null};var q={LAYER_ID_DP_KEY:0,EDGE_PORT_CONSTRAINT_DP_KEY:1};function C(t,i){n.AllocateForFixedPort.call(this,i,i.reportError),this.layoutSessionData=t,this.changeStateObj=i,this.Au=new d.GluePointUtils(t,i)}function N(t,i,n){d.AllocateGluePoints.call(this,t,i,n),this.fixedPortUtils=new C(t,i),this.reportError=this.hostInterfaceObj.reportError.bind(this.hostInterfaceObj)}C.prototype.allocateGpForOneFixedPort=function(t,i){var n=this.Au.Ru(t,i).nodeSide,r=t.userLoc;this.Eu(t,i,n,r)},C.prototype.Eu=function(t,i,n,r){var s=this.changeStateObj._i(t);return new(this.layoutSessionData.Mu&&d.LayoutCoreUtil._u(i)?d.ModifiedRelativeGluePoint:d.RelativeGluePoint)("attachment",n,r.perX,r.perY,r.absX,r.absY,i,t,s,this.reportError)},
u.common.ObjectHelper.inherit(C,n.AllocateForFixedPort),N.prototype.Iu=function(){var t=this.changeStateObj;this.layoutSessionData.Mu&&d.LayoutCoreUtil.Gu(t.nList,!0),this.markAllSourceTargetPorts(t.cList),this.assignAllGpsFollowDir(),this.clearAllTempProperties(),this.layoutSessionData.Mu&&d.LayoutCoreUtil.Gu(t.nList,!1)},N.prototype.Vu=function(){},N.prototype.Yu=function(){},N.prototype.Fu=function(t){for(var i,n,r=this.changeStateObj,s=t.ki,h=s.length,u=0;u<h;++u)(i=s[u]).ignore||(n=i.Hu)&&(n=n.getPoint(),i.Hi(n.x-i.w/2,n.y-i.h/2),r.Vi(i))},N.prototype.assignAllGpsFollowDir=function(){for(var t=this.changeStateObj,i=this.layoutSessionData.Bu,n=i===d.PortLocationSharing.OutOnly||i===d.PortLocationSharing.InAndOut,r=i===d.PortLocationSharing.InOnly||i===d.PortLocationSharing.InAndOut,s=t.nList,h=0,u=s.length;h<u;++h){var o=s[h];o.ignore||this.assignNodeGpsFollowDir(o,n,r)}},N.prototype.assignNodeGpsFollowDir=function(t,i,n){var r=this.fixedPortUtils,s=r.getFloatAndFixedPorts(t.ki),
h=s.fixedPorts,u=s.floatPorts;r.allocateGpForFixedPorts(h,t);var o=this.dividePortsOnNode(u),e=o.sourcePorts,f=o.targetPorts,a=o.unconnectedPorts,c=o.selfSrcPorts,l=o.selfTarPorts,v=o.cpOnParentSrcPorts,s=o.cpOnParentTarPorts,r=o.cpOnChildSrcPorts,h=o.cpOnChildTarPorts,u=this.layoutSessionData.Ft,e=this.sortSourcePorts(t,e,s,r,u),f=this.sortTargetPorts(t,f,v,h,u);e=(e=a.concat(e)).concat(c),f=f.concat(l),o=this.getPairNodeSides(u),i?this.Ku(t,e,o.nodeSide1):this.assignPortsByEqualOnSide(t,e,o.nodeSide1),n?this.Ku(t,f,o.nodeSide2):this.assignPortsByEqualOnSide(t,f,o.nodeSide2)},N.prototype.Ku=function(t,i,n){if(!(i.length<1))for(var r=0,s=i.length;r<s;++r){var h=i[r];this.createSideGluePointForPort(h,t,n,.5,0)}},N.prototype.assignPortsByEqualOnSide=function(t,i,n){var r,s,h;i.length<1||(0<(h=(s=t[r="bottom"===n||"top"===n?"w":"h"])-this.getAllPortProjectLen(i,r))?this.assignGpByPortSize(t,i,n,s,h,r):this.assignGpNoPortSize(t,i,n,s))},N.prototype.assignGpByPortSize=function(t,i,n,r,s,h){
for(var u=s/(i.length+1),o=0,e=0,f=0,a=i.length;f<a;++f){var c=i[f],l=c.Xu?0:c[h];e+=o/2+u+l/2,this.createSideGluePointForPort(c,t,n,e/r,f),o=l}},N.prototype.assignGpNoPortSize=function(t,i,n,r){for(var s=r/(i.length+1),h=s,u=0,o=i.length;u<o;++u){var e=i[u];this.createSideGluePointForPort(e,t,n,h/r,u),h+=s}},N.prototype.createSideGluePointForPort=function(t,i,n,r,s){var h=this.changeStateObj._i(t);return new(this.layoutSessionData.Mu&&d.LayoutCoreUtil._u(i)?d.ModifiedSideGluePoint:d.SideGluePoint)("attachment",n,r,0,s,i,t,h,this.reportError)},N.prototype.getPairNodeSides=function(t){var i="bottom",n="top";switch(t){case d.LayoutDirection.TopToBottom:i="bottom",n="top";break;case d.LayoutDirection.BottomToTop:i="top",n="bottom";break;case d.LayoutDirection.LeftToRight:i="right",n="left";break;case d.LayoutDirection.RightToLeft:i="left",n="right";break;default:this.reportError("unknown direction: "+t)}return{nodeSide1:i,nodeSide2:n}},N.prototype.markAllSourceTargetPorts=function(t){for(
var i=this.Au.zu(t,d.PortArrangementOption.ShortestPath),n=0,r=i.length;n<r;++n){var s=i[n],h=s.mi,u=s.pi;h&&u&&(h.Ju||(h.Ju={port:h,isSrc:!0,conn:s,connInx:n,pairNode:s.yi}),u.Ju||(u.Ju={port:u,isSrc:!1,conn:s,connInx:n,pairNode:s.bi}))}},N.prototype.clearAllTempProperties=function(){for(var t=this.changeStateObj.cList,i=0,n=t.length;i<n;++i){var r=t[i],s=r.mi,r=r.pi;s&&r&&(delete s.Ju,delete r.Ju)}},N.prototype.dividePortsOnNode=function(t){var i=[],n=[],r=[],s=[],h=[],u=[],o=[],e=[],f=[];t.sort(function(t,i){t=t.Ju,i=i.Ju;return t&&i?t.connInx-i.connInx:-1});for(var a=t.length,c=0;c<a;++c){var l,v=t[c],d=v.Ju;(d?(l=d.conn).Qu?d.isSrc?s:h:l.Wu?d.isSrc?l.Zu?u:e:l.$u?o:f:d.isSrc?i:n:r).push(v)}return{sourcePorts:i,targetPorts:n,unconnectedPorts:r,selfSrcPorts:s,selfTarPorts:h,cpOnParentSrcPorts:u,cpOnParentTarPorts:o,cpOnChildSrcPorts:e,cpOnChildTarPorts:f}},N.prototype.sortSourcePorts=function(t,i,n,r,s){var h=i.length+n.length+r.length;if(h<2)return i.concat(n).concat(r)
;var u=this.divideQuadLayers(t,i,s),o=null;switch(s){case d.LayoutDirection.TopToBottom:o=this.sortQuadSourcePorts_TB(u,n,r,s);break;case d.LayoutDirection.BottomToTop:o=this.sortQuadSourcePorts_BT(u,n,r,s);break;case d.LayoutDirection.LeftToRight:o=this.sortQuadSourcePorts_LR(u,n,r,s);break;case d.LayoutDirection.RightToLeft:o=this.sortQuadSourcePorts_RL(u,n,r,s)}for(var e=[],f=0,a=o.length;f<a;++f)for(var c=o[f],l=0,v=c.length;l<v;++l)e.push(c[l].port);return e.length!==h&&this.reportError("Sorted port number is incorrect."),e},N.prototype.sortTargetPorts=function(t,i,n,r,s){var h=i.length+n.length+r.length;if(h<2)return i.concat(n).concat(r);var u=this.divideQuadLayers(t,i,s),o=null;switch(s){case d.LayoutDirection.TopToBottom:o=this.sortQuadTargetPorts_TB(u,n,r,s);break;case d.LayoutDirection.BottomToTop:o=this.sortQuadTargetPorts_BT(u,n,r,s);break;case d.LayoutDirection.LeftToRight:o=this.sortQuadTargetPorts_LR(u,n,r,s);break;case d.LayoutDirection.RightToLeft:
o=this.sortQuadTargetPorts_RL(u,n,r,s)}for(var e=[],f=0,a=o.length;f<a;++f)for(var c=o[f],l=0,v=c.length;l<v;++l)e.push(c[l].port);return e.length!==h&&this.reportError("Sorted port number is incorrect."),e},N.prototype.sortQuadSourcePorts_TB=function(t,i,n,r){var s=[],h=this.sortByLinesAndNodes(t.quad2,r,!0,!1);return s.push(h),h=this.sortByLinesAndNodes(t.left,r,!0,!1),s.push(h),h=this.sortByLayersAndNodes(t.quad3,r,!1,!1),s.push(h),h=this.sortByLayersAndNodes(t.down,r,!1,!1),s.push(h),h=this.getPortDataList(i),s.push(h),h=this.getPortDataList(n),s.push(h),h=this.sortByLayersAndNodes(t.quad4,r,!0,!1),s.push(h),h=this.sortByLayersAndNodes(t.right,r,!0,!1),s.push(h),h=this.sortByLinesAndNodes(t.quad1,r,!0,!0),s.push(h),h=this.sortByLinesAndNodes(t.top,r,!0,!0),s.push(h),s},N.prototype.sortQuadTargetPorts_TB=function(t,i,n,r){var s=[],h=this.sortByLinesAndNodes(t.quad3,r,!0,!0);return s.push(h),h=this.sortByLinesAndNodes(t.left,r,!0,!0),s.push(h),h=this.sortByLayersAndNodes(t.quad2,r,!0
,!1),s.push(h),h=this.sortByLayersAndNodes(t.top,r,!0,!1),s.push(h),h=this.getPortDataList(i),s.push(h),h=this.getPortDataList(n),s.push(h),h=this.sortByLayersAndNodes(t.quad1,r,!1,!1),s.push(h),h=this.sortByLayersAndNodes(t.right,r,!1,!1),s.push(h),h=this.sortByLinesAndNodes(t.quad4,r,!0,!1),s.push(h),h=this.sortByLinesAndNodes(t.down,r,!0,!1),s.push(h),s},N.prototype.sortQuadSourcePorts_BT=function(t,i,n,r){return this.sortQuadTargetPorts_TB(t,i,n,r)},N.prototype.sortQuadTargetPorts_BT=function(t,i,n,r){return this.sortQuadSourcePorts_TB(t,i,n,r)},N.prototype.sortQuadSourcePorts_LR=function(t,i,n,r){var s=[],h=this.sortByLinesAndNodes(t.quad2,r,!0,!1);s.push(h),h=this.sortByLinesAndNodes(t.top,r,!0,!1),s.push(h),h=this.sortByLayersAndNodes(t.quad1,r,!1,!1),s.push(h),h=this.sortByLayersAndNodes(t.right,r,!1,!1),s.push(h),h=this.getPortDataList(i),s.push(h),h=this.getPortDataList(n),s.push(h),h=this.sortByLayersAndNodes(t.quad4,r,!0,!1),s.push(h),h=this.sortByLayersAndNodes(t.down,r,!0
,!1),s.push(h);var h=this.sortByLinesAndNodes(t.quad3,r,!0,!0);return s.push(h),h=this.sortByLinesAndNodes(t.left,r,!0,!0),s.push(h),s},N.prototype.sortQuadTargetPorts_LR=function(t,i,n,r){var s=[],h=this.sortByLinesAndNodes(t.quad1,r,!0,!0);s.push(h),h=this.sortByLinesAndNodes(t.top,r,!0,!0),s.push(h),h=this.sortByLayersAndNodes(t.quad2,r,!0,!1),s.push(h),h=this.sortByLayersAndNodes(t.left,r,!0,!1),s.push(h),h=this.getPortDataList(i),s.push(h),h=this.getPortDataList(n),s.push(h),h=this.sortByLayersAndNodes(t.quad3,r,!1,!1),s.push(h),h=this.sortByLayersAndNodes(t.down,r,!1,!1),s.push(h);var h=this.sortByLinesAndNodes(t.quad4,r,!0,!1);return s.push(h),h=this.sortByLinesAndNodes(t.right,r,!0,!1),s.push(h),s},N.prototype.sortQuadSourcePorts_RL=function(t,i,n,r){return this.sortQuadTargetPorts_LR(t,i,n,r)},N.prototype.sortQuadTargetPorts_RL=function(t,i,n,r){return this.sortQuadSourcePorts_LR(t,i,n,r)};function A(t,i,n,r){return t?r.pairNode[i]-n.pairNode[i]:n.pairNode[i]-r.pairNode[i]}
function R(t,i,n,r){return A(t,i,n[0],r[0])}function E(t,i,n){N.call(this,t,i,n)}function M(t,i,n){d.AllocateGluePoints.call(this,t,i,n),this.fixedPortUtils=new C(t,i)}function _(t,i,n){d.AllocateGluePoints.call(this,t,i,n),this.reportError=i.reportError.bind(i),this.to=null}N.prototype.sortByLayersAndNodes=function(t,i,n,r){var s=[];if(t.length<1)return s;var h="y",u="x";i!==d.LayoutDirection.LeftToRight&&i!==d.LayoutDirection.RightToLeft||(h="x",u="y");h=R.bind(void 0,n,h);t.sort(h);for(var o=A.bind(void 0,r,u),e=0,f=t.length;e<f;++e){var a=t[e];a.sort(o),s=s.concat(a)}return s},N.prototype.sortByLinesAndNodes=function(t,i,n,r){var s=[];if(t.length<1)return s;var h="x",u="y";i!==d.LayoutDirection.LeftToRight&&i!==d.LayoutDirection.RightToLeft||(h="y",u="x");var o=this.divideQuadLayersToLines(t,i),h=R.bind(void 0,n,h);o.sort(h);for(var e=A.bind(void 0,r,u),f=0,a=o.length;f<a;++f){var c=o[f];c.sort(e),s=s.concat(c)}return s},N.prototype.divideQuadLayersToLines=function(t,i){if(
t.length<1)return[];for(var n=t[0],r=0,s=1,h=t.length;s<h;++s){var u=t[s];n.length<u.length&&(n=u,r=s)}for(var o=[],s=0,h=n.length;s<h;++s)o.push([n[s]]);for(s=0,h=t.length;s<h;++s)if(s!==r)for(var e=0,f=(u=t[s]).length;e<f;++e){var a=u[e];this.addNodeIntoLine(a,o,i)}return o},N.prototype.addNodeIntoLine=function(t,i,n){var r="x";n!==d.LayoutDirection.LeftToRight&&n!==d.LayoutDirection.RightToLeft||(r="y");for(var s=t.pairNode,h=-1,u=Number.POSITIVE_INFINITY,o=0,e=i.length;o<e;++o){var f=i[o][0].pairNode,f=this.distBoxCenterProject(s,f,r);f<u&&(h=o,u=f)}var a=-1,n=i[h][0].pairNode,n=this.compareBoxProject(s,n,r);0===n?i[a=h].push(t):n<0?i.splice(a=(a=h-1)<0?0:a,0,[t]):i.splice(a=h+1,0,[t])},N.prototype.divideQuadLayers=function(t,i,n){t=this.divideOtherNodesInQuard(t,i),i={};return i.quad1=this.divideNodesInLayers(t.quad1,n),i.quad2=this.divideNodesInLayers(t.quad2,n),i.quad3=this.divideNodesInLayers(t.quad3,n),i.quad4=this.divideNodesInLayers(t.quad4,n),
i.left=this.divideNodesInLayers(t.left,n),i.right=this.divideNodesInLayers(t.right,n),i.top=this.divideNodesInLayers(t.top,n),i.down=this.divideNodesInLayers(t.down,n),i},N.prototype.divideOtherNodesInQuard=function(t,i){for(var t=this.getBoxCenter(t),n=t.x,r=t.y,s=[],h=[],u=[],o=[],e=[],f=[],a=[],c=[],l=0,v=i.length;l<v;++l){var d=i[l].Ju,w=d.pairNode,p=this.getBoxCenter(w),w=p.x-n,p=p.y-r;0==w?(0<p?c:a).push(d):0==p?(0<w?f:e).push(d):0<w?(0<p?o:s).push(d):w<0&&(0<p?u:h).push(d)}return{quad1:s,quad2:h,quad3:u,quad4:o,left:e,right:f,top:a,down:c}},N.prototype.divideNodesInLayers=function(t,i){for(var n=[],r=0,s=t.length;r<s;++r){for(var h=t[r],u=h.pairNode,o=!1,e=0,f=n.length;e<f;++e){var a=n[e],c=a[0].pairNode;if(this.isBoxProjectOverlap(u,c,i)){a.push(h),o=!0;break}}o||n.push([h])}for(var l=i===d.LayoutDirection.TopToBottom||i===d.LayoutDirection.BottomToTop?"x":"y",r=0,s=n.length;r<s;++r)n[r].sort(function(t,i){return t.pairNode[l]-i.pairNode[l]})
;return l=i===d.LayoutDirection.TopToBottom||i===d.LayoutDirection.BottomToTop?"y":"x",n.sort(function(t,i){return t[0].pairNode[l]-i[0].pairNode[l]}),n},N.prototype.getPortDataList=function(t){for(var i=[],n=0,r=t.length;n<r;++n)i.push(t[n].Ju);return i},N.prototype.isBoxProjectOverlap=function(t,i,n){return n===d.LayoutDirection.TopToBottom||n===d.LayoutDirection.BottomToTop?!(i.y+i.h<t.y||i.y>t.y+t.h):!(i.x+i.w<t.x||i.x>t.x+t.w)},N.prototype.compareBoxProject=function(t,i,n){var r="x"===n?"w":"h",s=0;return t[n]+t[r]<i[n]?s=-1:t[n]>i[n]+i[r]&&(s=1),s},N.prototype.distBoxCenterProject=function(t,i,n){var r="x"===n?"w":"h",t=t[n]+t[r]/2,r=i[n]+i[r]/2;return Math.abs(r-t)},N.prototype.getAllPortProjectLen=function(t,i){for(var n=0,r=0,s=t.length;r<s;++r){var h=t[r];h.Xu||(n+=h[i])}return n},N.prototype.getBoxCenter=function(t){return{x:t.x+t.w/2,y:t.y+t.h/2}},u.common.ObjectHelper.inherit(N,d.AllocateGluePoints),E.prototype.Iu=function(){this.markAllSourceTargetPorts(
this.changeStateObj.cList),this.extendAllNodesForSidePorts(),this.assignAllGpsFollowDir(),this.clearAllTempProperties()},E.prototype.extendAllNodesForSidePorts=function(){for(var t=this.changeStateObj.nList,i=this.layoutSessionData.Ft,n=0,r=t.length;n<r;++n){var s=t[n];s.ignore||this.extendNodeForSidePorts(s,i)}},E.prototype.extendNodeForSidePorts=function(t,i){var n=this.Au,r=this.getPairNodeSides(i),s=r.nodeSide1,h=r.nodeSide2,u=this.dividePortsOnNode(t),o=u.sourcePorts,e=u.targetPorts,f=u.unconnectedPorts,a=u.selfSrcPorts,c=u.selfTarPorts,l=u.cpOnParentSrcPorts,i=u.cpOnParentTarPorts,r=u.cpOnChildSrcPorts,u=u.cpOnChildTarPorts,r=o.concat(f,a,i,r),u=e.concat(c,l,u),r=n.io(r,s),h=n.io(u,h),h=Math.max(r,h);n.no(t,s,h)},u.common.ObjectHelper.inherit(E,N),M.prototype.Iu=function(){var t=this.changeStateObj.nList;this.layoutSessionData.Mu&&d.LayoutCoreUtil.Gu(t,!0),this.assignGpForAllFixedPorts(),this.layoutSessionData.Mu&&d.LayoutCoreUtil.Gu(t,!1)},M.prototype.Vu=function(){},
M.prototype.Yu=function(){},M.prototype.assignGpForAllFixedPorts=function(){var t=this.changeStateObj.nList;this.fixedPortUtils.assignGpForFixedPortsOnNodes(t)},u.common.ObjectHelper.inherit(M,d.AllocateGluePoints),_.prototype.Iu=function(t){this.to=this.ro(t),this.to.Iu(t)},_.prototype.Vu=function(){this.to.Vu()},_.prototype.Yu=function(){this.to.Yu()},_.prototype.ro=function(t){var i=this.layoutSessionData.at;if("straightLine"===i||"line"===i)return new M(this.layoutSessionData,this.changeStateObj,this.li);var n=null;switch(t){case"equalSpaceOnSide":n=new N(this.layoutSessionData,this.changeStateObj,this.li);break;case"equalSpaceOnExpandSide":n=new E(this.layoutSessionData,this.changeStateObj,this.li);break;case"float":case"fixed":n=new d.AllocateGluePoints(this.layoutSessionData,this.changeStateObj,this.li);break;default:this.reportError("Unknown port move option: "+t),n=new d.AllocateGluePoints(this.layoutSessionData,this.changeStateObj,this.li)}return n},
u.common.ObjectHelper.inherit(_,d.AllocateGluePoints);var I={Default:0,UserDefined:1,UserDefinedSimple:2,NetworkSimplex:3,TightTree:4,LongestPath:5,TightTreeRev:6,LongestPathRev:7,SimpleCompact:8};function G(t,i,n){this.layoutSessionData=t,this.changeStateObj=i,this.so=n,this.ho=null,this.uo="relative",this.oo=null,this.hostInterfaceObj=i.hostInterfaceObj,this.reportError=i.reportError,this.eo=new j(i),this.dpMaps=null,this.fo=!0,this.RoutingType=u.common.ObjectHelper.rootNamespace.Layout.RoutingType}function V(t){this.hostInterfaceObj=t}function Y(t){this.hostInterfaceObj=t}function F(t,i,n,r){d.ChangeState.apply(this,arguments),this.initPathsFromHost(this,t)}function H(){d.LayoutSessionData.call(this),this.fh=x.Hierarchical,this.ah=S.Orthogonal,this.ch=40,this.minLayerDistance=40,this.lh=20,this.vh=20,this.minPortExtensionDist=20,this.xh=!0,this.Sh=!0,this.Oh=500,this.Ph=1,this.ph=!0,this.fu=!1,this.nestedNodeLayoutStrategy=d.NestedNodeLayoutStrategy.Global,
this.rankingStrategy=I.Default,this.isNestedView=!0,this.nodePlacement=d.NodePlacementOption.Center,this.useOriPortPadding=!1,this.Mu=!1}function B(){}function K(t,i){this.tr=t,this.layoutOptions=i}function X(t){this.ao=null,T.apply(this,arguments)}function z(t){this.tr=t,this.hostInterfaceObj=null,this.layoutOptions=new P,this.dgLayoutObj=null,this.hostNodes=[],this.hostPosts=[],this.co=[],this.dpMaps=null}G.prototype.hu=function(t){this.doLayoutGroupAllLevels(null,t)},G.prototype.doLayoutGroupOneLevel=function(t,i){var n=t?this.changeStateObj.Fi(t):null;!t||n?!n||n.Jh?(t=this.lo(n).getGroupOneLevel())&&(this.vo().doLayoutGroupOneLevel(n,t.cNodeList,t.portList,t.edgeList),this.do(n,t.uNodeList,!0),this.wo(n,t.uNodeList),i&&this.Hh()):this.reportError("LayouterAlg: the input node is not a group."):this.reportError("LayouterAlg: the input node is not in the change state")},G.prototype.doLayoutGroupAllLevels=function(t,i){this.po(t),i&&this.Hh()},G.prototype.doSortedLayout=function(t,i,n
,r){var s=this.hostInterfaceObj.go;s||(this.reportError("This is not Network View! \r\nSorted Layout should be used in Network View."),s=this.hostInterfaceObj),this.createTreeSLLayoutObj(this.layoutSessionData,s,this.changeStateObj,this.so).yo(t,i,n),r&&this.Hh()},G.prototype.doLayoutUsePureCore=function(){var t=this.changeStateObj,i=t.nList,n=t.cList,t=this.bo(i);this.vo().hu(i,t,n)},G.prototype.bo=function(t){for(var i=[],n=0,r=t.length;n<r;++n)var s=t[n].ki,i=i.concat(s);return i},G.prototype.po=function(t){var i=t?this.changeStateObj.Fi(t):null;if(!t||i)if(!i||i.Jh){t=this.lo(i).getGroupAllLevels();if(t){for(var n=t.isolatedGroups,r=0,s=n.length;r<s;++r){var h=n[r];this.po(h.hostNode)}this.vo().doLayoutGroupAllLevels(i,t.cNodeList,t.portList,t.edgeList),this.do(i,t.uNodeList,!1),this.wo(i,t.uNodeList)}}else this.reportError("LayouterAlg: the input node is not a group.");else this.reportError("LayouterAlg: the input node is not in the change state.")},G.prototype.Hh=function(){
var t=this.changeStateObj,i=this.layoutSessionData;if(i.ah!==this.RoutingType.HVPaths&&"incUpdate"!==this.oo&&d.LayoutCoreUtil.Mh(i)){for(var n=t.nList,r=t.cList,s=[],h=0,u=n.length;h<u;++h)for(var o=n[h].ki,e=o?o.length:0,f=0;f<e;++f)s.push(o[f]);this.vo().Hh(n,s,r)}else{t.ko();r=this.mo(i.portArrangement);this.ho=new _(i,t,this.so),this.ho.xo(),this.ho.Iu(r),this.ho.Vu(),i.du&&this.ho.Yu(),this.ho.So(),t.Oo(),new d.LayoutHVPaths(i,t,this.so,this.fo),this.Po()}},G.prototype.mo=function(t){var i="float";switch(t){case d.PortArrangementOption.FollowLayoutDirection:i="equalSpaceOnSide";break;case d.PortArrangementOption.FollowOptimalConnectionDistance:case d.PortArrangementOption.ShortestPath:i="float";break;case d.PortArrangementOption.FloatSide:case d.PortArrangementOption.FixedSide:i="float";break;default:this.reportError("Unknown port arrangement option: "+t)}return i},G.prototype.do=function(t,i,n){for(var r=this.changeStateObj,s=0,h=i.length;s<h;++s){var u=(f=i[s]).$n;r.To(u._n,f)}
r.Lo();var o=this.so,e=t||r.zh;o.Do(e);t=this.layoutSessionData.ph;o.jo(e,!n&&t,!0),r.Uo(this.uo);for(var f,s=0,h=i.length;s<h;++s)(u=(f=i[s]).$n)._n.push(f)},G.prototype.wo=function(t,i){var n,r;i.length<1||(n=this.changeStateObj,(n=(t=t||n.zh).$n)&&(r=n.Qh,n.Qh=!1),t=this.layoutSessionData.Ft,new d.BoxLayout(this.layoutSessionData,this.changeStateObj,this.so).qo(i,t,this.uo),n&&(n.Qh=r))},G.prototype.setAllDpMaps=function(t){this.dpMaps=t},G.prototype.setInnerDpMaps=function(t,i){var n,r=null;if(i)for(var s in r={},i)!Object.prototype.hasOwnProperty.call(i,s)||(n=i[s])&&(r[s]={get:function(t){return n.get(t.hostNode)}});t.setAllDpMaps(r)},G.prototype.vo=function(){return this.setInnerDpMaps(this.eo,this.dpMaps),this.eo},G.prototype.createTreeSLLayoutObj=function(t,i,n,r){var s=null,h=u.common.ObjectHelper.rootNamespace.Layout.TreeSLLayouter;return h?s=new h(t,i,n,r):this.reportError("SortedLayout class is not loaded."),s},G.prototype.Po=function(){var t=this.layoutSessionData;t.Mu&&(
d.LayoutCoreUtil.Gu(this.changeStateObj.nList,!0),t.ah===S.StraightLine&&t.fh===x.Hierarchical||(this.ho.So(),this.Co()))},G.prototype.Co=function(){for(var t=this.changeStateObj.cList,i=0,n=t.length;i<n;++i){var r=t[i];if(!r.ignore&&r.Bi){var s=r.Bi;if(s&&!(s.length<2)){var h=r.mi,u=r.pi,h=h.Hu,u=u.Hu;if(h&&u){h=h.No(),u=u.No();s.splice(0,0,h),s.push(u),this.fi(s,0)&&s.splice(1,1),this.fi(s,s.length-3)&&s.splice(s.length-2,1);for(var o=this.hostInterfaceObj,e=[],f=0;f<s.length;++f){var a=s[f];e.push(o.makePoint(a.x,a.y))}r.su=e}}}}},G.prototype.fi=function(t,i){if(i<0)return!1;if(i>t.length-3)return!1;var n=t[i],r=t[i+1],i=t[i+2];return n.x===r.x&&n.x===i.x||n.y===r.y&&n.y===i.y},G.prototype.lo=function(t){var i=null;return this.layoutSessionData.rankingStrategy===I.UserDefined&&(i=this.dpMaps?this.dpMaps[q.LAYER_ID_DP_KEY]:null),new U(this.changeStateObj,t,i)},G.Ao=function(i){var t=null;return i.getUserDefinedRank&&((t=t||{})[q.LAYER_ID_DP_KEY]={get:function(t){
return i.getUserDefinedRank(t)}}),t},V.prototype.doLayout=function(t,i){var n=this.hostInterfaceObj;n.getWrapFixedLength()||n.reportError("The Snake Layout cannot support wrap graph by ratio.");var r=n.getWrapLength(),n=new SDF.Layout.SnakeLayout(n);n.setWrapLength(r),n.doLayout(t,i),n.clear()},V.ApplyLayout=function(t,i,n){new V(t).doLayout(i,n)},Y.prototype.doLayout=function(t,i){var n=this.hostInterfaceObj,r=n.getNodeToNodeDist(),r=Math.max(r.x,r.y),n=this.Ro(n);n.setNodeOffset(r),n.setGraphs(t,i),n.doLayout()},Y.prototype.Ro=function(t){var i=null,n=u.common.ObjectHelper.rootNamespace.Layout.BalloonLayout;return n?i=new n(t):t.reportError("BolloonLayout is not loaded."),i},Y.ApplyLayout=function(t,i,n){new Y(t).doLayout(i,n)},u.common.ObjectHelper.inherit(F,d.ChangeState),F.prototype.Eo=function(){for(var t,i=this.hostInterfaceObj,n=this.cList,r=n.length,s=0;s<r;++s)t=n[s],i.setPath(t.Si,t.su)},F.prototype.initPathsFromHost=function(t,i){for(var n=t.cList,r=0,s=n.length;r<s;++r){
var h=n[r],u=h.Si;if(u){var o=i.getPath(u);if(o){for(var e=[],f=[],a=0,c=o.length;a<c;++a){var l=o[a];e.push({x:l.x,y:l.y}),f.push(i.makePoint(l.x,l.y))}h.Bi=e,h.su=f}}}},B.ApplyOptimizedLayout=function(t,i,n,r){var s=new B;return B.prototype.applyLayout.apply(s,arguments)},B.prototype.applyLayout=function(t,i,n,r){var s=d.LayoutCoreUtil.Mo.apply(null,arguments),h=!(!(s=s||{})||"yfiles"!==s.coreType),u=t.getLayoutType();u!==x.Snake||h?u!==x.Balloon||d.LayoutCoreUtil.Mh(s)?(s.pathRouter||(s.pathRouter="incUpdate"),u=t,s.useSortedLayout=!1,d.LayoutCoreUtil.tryIsNestedView(u)||(t=new d.TreeHostInterfaceWrapper(u),this._o(u,i)&&(s.useSortedLayout=!0)),this.Io(t,i,n,r,s)):Y.ApplyLayout(t,i,n):V.ApplyLayout(t,i,n)},B.prototype.Io=function(t,i,n,r,s){var h=!0===r,u=new H;this.Go(u,t,i),u.coreType=s.coreType;var o=new F(t,u,i,n);u.du=o.du,u.du&&u.isRSOPEnabled&&u.Vo&&t.reportError("MakeRoom should turn off when using user defined port location.");r=new d.RemoveGroupOverlaps(u,o);o.Yo()
;r=new G(u,o,r),t=G.Ao(t);r.setAllDpMaps(t),void 0!==s.pathRouter&&(r.oo=s.pathRouter),s&&s.useSortedLayout?r.doSortedLayout(null,i,n,h):s&&!0===s.usePureCore?r.doLayoutUsePureCore():(d.LayoutCoreUtil.Mh(u)||d.LayoutCoreUtil.Fo(o.nList,u.edgeDist,u),r.hu(h)),o.update(1),o.xi()},B.prototype.Go=function(t,i,n){this.Ho(t),d.LayoutCoreUtil.Bo(t,i),t.ah=this.Bh(t.fh,t.ah),t.at=t.ah===u.common.ObjectHelper.rootNamespace.Layout.RoutingType.StraightLine?"straightLine":"HV",t.Mu=!1,this.Ko(t),d.LayoutCoreUtil.Xo(t)},B.prototype.Ho=function(t){d.LayoutCoreUtil.Mh(t)||(t.fh=x.Hierarchical,t.Ft=d.LayoutDirection.TopToBottom,t.ah=S.HVPaths,t.ph=!0,t.isRSOPEnabled=!0,t.Vo=!1,t.isNestedView=!0,t.fu=!1,t.nodePlacement=d.NodePlacementOption.Center,t.portArrangement=d.PortArrangementOption.FollowLayoutDirection,t.nestedNodeLayoutStrategy=d.NestedNodeLayoutStrategy.Global,t.minPortExtensionDist=0)},B.prototype.Ko=function(t){var i=new d.ValidDistCalculator(t).getValidConfigure();t.nodeDist=i.nodeDist,
t.edgeDist=i.edgeDist,t.minSegmentLength=i.minSegmentLength,t.edgeToNodeDist=i.edgeToNodeDist,t.zo=i.zo},B.prototype.Bh=function(t,i){var n=i;if(i===u.common.ObjectHelper.rootNamespace.Layout.RoutingType.Default)switch(t){case x.Hierarchical:case x.Snake:n=u.common.ObjectHelper.rootNamespace.Layout.RoutingType.HVPaths;break;case x.Balloon:n=u.common.ObjectHelper.rootNamespace.Layout.RoutingType.StraightLine}return n},B.prototype._o=function(t,i){var n=!1;if(!d.LayoutCoreUtil.tryIsNestedView(t)&&t.getLayoutType()===x.Hierarchical)for(var r=0,s=i.length;r<s;r++){var h=i[r];if(t.isGroupNode(h)&&t.isExpanded(h)){n=!0;break}}return n},K.prototype.getNodeToNodeDist=function(){var t=this.layoutOptions.ch;return{x:t,y:t}},K.prototype.getEdgeToEdgeDist=function(){var t=this.layoutOptions.lh;return{x:t,y:t}},K.prototype.getMinSegmentLength=function(){return{x:0,y:0}},K.prototype.enableCompactLayout=function(){return!1},K.prototype.getMinNodeSize=function(t){return{w:0,h:0}},
K.prototype.getLayoutType=function(){return this.layoutOptions.fh},K.prototype.getLayoutDirection=function(){return this.layoutOptions.Ft},K.prototype.getRoutingType=function(){return this.layoutOptions.ah},K.prototype.getIncUpdatePathType=function(){return"HV"},K.prototype.getEnableGlobalLayout=function(){return!0},K.prototype.getMinPortExtensionDist=function(){return this.layoutOptions.minPortExtensionDist},K.prototype.getMinSegmentDist=function(){return this.layoutOptions.vh},K.prototype.isNestedView=function(){return!0},K.prototype.getGroupAutoShrink=function(){return this.layoutOptions.ph},K.prototype.getHostManagesGroupNodeSizes=function(){return!1},K.prototype.isMakeRoomInRSOPDisabled=function(){return!1},K.prototype.isRSOPEnabled=function(){return!0},K.prototype.getWrapMirror=function(){return this.layoutOptions.xh},K.prototype.getWrapFixedLength=function(){return this.layoutOptions.Sh},K.prototype.getWrapLength=function(){return this.layoutOptions.Oh},
K.prototype.getWrapRatio=function(){return this.layoutOptions.Ph},K.prototype.getNodeRect=function(t){t=this.tr.getNodeRect(t);return{x:t.x,y:t.y,w:t.width,h:t.height}},K.prototype.setNodeRect=function(t,i,n,r,s){this.tr.pr(t,i,n,r,s)},K.prototype.getStandardPortSize=function(){return{w:0,h:0}},K.prototype.getPortRect=function(t){t=t.cr();return{x:t.x,y:t.y,w:0,h:0}},K.prototype.setPortRect=function(t,i,n,r,s){this.tr.yr(t,i,n)},K.prototype.getPortLocation=function(t){var i=this.getNodeOfPort(t),i=this.getNodeRect(i),t=this.getPortRect(t);return{absoluteX:0,absoluteY:0,percentX:(t.x+t.w/2-i.x)/i.w,percentY:(t.y+t.h/2-i.y)/i.h}},K.prototype.getParentNode=function(t){return this.tr.getParentNode(t)},K.prototype.getNodePriority=function(t){return 1},K.prototype.isExpanded=function(t){return!!this.isGroupNode(t)&&this.tr.isExpanded(t)},K.prototype.isGroupNode=function(t){return this.tr.isGroupNode(t)},K.prototype.getGroupNodePadding=function(t){return t&&this.isGroupNode(t
)?this.tr.getGroupNodePadding(t):{top:0,bottom:0,left:0,right:0}},K.prototype.getGroupNodeKeepOutArea=function(t,i){return{x:0,y:0,w:0,h:0}},K.prototype.getSourcePort=function(t){return this.tr.getSourcePort(t)},K.prototype.getTargetPort=function(t){return this.tr.getTargetPort(t)},K.prototype.getNodeOfPort=function(t){return this.tr.getNodeOfPort(t)},K.prototype.getAllPortsForNode=function(t){return this.tr.getAllPortsForNode(t)},K.prototype.getAllConnectionsForPort=function(t){for(var i=[],n=t.Is,r=n?n.length:0,s=0;s<r;++s)n[s].xr&&i.push(n[s]);return i},K.prototype.getSourceNode=function(t){var i=null,t=this.getSourcePort(t);return i=t?this.getNodeOfPort(t):i},K.prototype.getTargetNode=function(t){var i=null,t=this.getTargetPort(t);return i=t?this.getNodeOfPort(t):i},K.prototype.getPath=function(t){return this.tr.wr(t)},K.prototype.setPath=function(t,i){this.tr.kr(t,i)},K.prototype.setGluePoints=function(t,i){},K.prototype.getPortLabel=function(t){return null},
K.prototype.getConnectionLabel=function(t){return null},K.prototype.getLabelRect=function(t){return null},K.prototype.setLabelRect=function(t,i,n,r,s){},K.prototype.stopDisplayUpdate=function(){},K.prototype.updateDisplay=function(){},K.prototype.makePoint=function(t,i){return{x:t,y:i}},K.prototype.getPortBehavior=function(t){var i=!1;return(i=this.tr.lr?this.tr.lr(t):i)?"generalPort":"layoutAllocatedPortFloat"},K.prototype.getObjectKey=function(t){return t.uid},K.prototype.reportError=function(t){this.tr.reportError(t)},K.prototype.isAutoClearNodeArea=function(){return!0},u.common.ObjectHelper.inherit(X,T),X.prototype.reset=function(){this.ao&&this.ao.reset(),this.ao=null,T.prototype.reset.apply(this,arguments)},X.prototype.Ch=function(){T.prototype.Ch.apply(this,arguments),this.ao=null},X.prototype.Eh=function(){return d.LayoutCoreUtil.Mh(this.layoutOptions)?T.prototype.Eh.apply(this,arguments):(this.ao||(t=this.Th.Qs(this.layoutOptions.ph),this.ao=this.createInnerLayout(t)),this.ao)
;var t},X.prototype._h=function(t){var i=!0;return d.LayoutCoreUtil.Mh(this.layoutOptions)||t!==x.Hierarchical&&t!==x.Balloon&&t!==x.Snake&&(this.reportError("DF homegrown layout does not support layout type: "+this.Xh(t)),i=!1),i},X.prototype.createInnerLayout=function(t){return new z(t)},z.prototype.reset=function(){this.dgLayoutObj&&this.dgLayoutObj.clear(),this.dgLayoutObj=null,this.hostInterfaceObj=null,this.hostNodes=[],this.hostPosts=[],this.co=[],this.dpMaps=null},z.prototype.layout=function(){this.hostInterfaceObj=new K(this.tr,this.layoutOptions),u.common.ObjectHelper.rootNamespace.Layout.Layouter.ApplyOptimizedLayout(this.hostInterfaceObj,this.hostNodes,this.co,!0)},z.prototype.getLayoutOptions=function(){return this.layoutOptions},z.prototype.addNode=function(t){this.hostNodes.push(t)},z.prototype.addPort=function(t){this.hostPosts.push(t)},z.prototype.addEdge=function(t){this.co.push(t)},z.prototype.th=function(t){t=this.hostInterfaceObj.getNodeRect(t);return{x:t.x,y:t.y,
width:t.w,height:t.h}},z.prototype.ih=function(t){t=this.hostInterfaceObj.getPortRect(t);return{x:t.x,y:t.y}},z.prototype.nh=function(t){return this.hostInterfaceObj.getPath(t)},z.prototype.Kh=function(){for(var t=0,i=0,n=0,r=0,s=this.hostInterfaceObj,h=this.hostNodes,u=0,o=h.length;u<o;++u){var e=s.getNodeRect(h[u]),f=e.x,a=e.y,c=f+e.w,e=a+e.h;0===u?(t=f,i=a,n=c,r=e):(f<t&&(t=f),a<i&&(i=a),n<c&&(n=c),r<e&&(r=e))}return{x:t,y:i,width:n-t,height:r-i}},z.prototype.setAllDpMaps=function(t){},z.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},u.common.ObjectHelper.rootNamespace=u.common.ObjectHelper.rootNamespace||{};var J=u.common.ObjectHelper.rootNamespace;J.Layout=J.Layout||{},J.Layout.Layouter=B,J.Layout.LayoutType=x,J.Layout.LayoutDirection=d.LayoutDirection,J.Layout.RoutingType=S,J.Layout.SubGraphRoutingType=O,J.Layout.HostInterface=t,J.Layout.HierarchicRankingStrategy=I,J.Layout.YfPortDirection=s,J.Layout.EngineLayerWrapper=X,J.Layout.LayouterAlg=G;var Q={}
;return Q.Layouter=B,Q.LayoutType=x,Q.LayoutDirection=d.LayoutDirection,Q.RoutingType=S,Q.SubGraphRoutingType=O,Q.HostInterface=t,Q.HierarchicRankingStrategy=I,Q.YfPortDirection=s,Q.EngineLayerWrapper=X,Q.LayouterAlg=G,Q.GlobalLayoutSessionData=H,Q.GlobalLayoutChangeState=F,Q.DataProviderKeys=q,Q.YfLayoutOption=P,Q.Layout=J.Layout||{},Q.Layout.Layouter=B,Q.Layout.LayoutType=x,Q.Layout.LayoutDirection=d.LayoutDirection,Q.Layout.RoutingType=S,Q.Layout.SubGraphRoutingType=O,Q.Layout.HostInterface=t,Q.Layout.HierarchicRankingStrategy=I,Q.Layout.YfPortDirection=s,Q.Layout.EngineLayerWrapper=X,Q.Layout.LayouterAlg=G,Q},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("@diagramming/layoutcore"),require("@diagramming/core"),require("@diagramming/astar"),require("@diagramming/hostinterface")):"function"==typeof define&&define.amd?define(["@diagramming/layoutcore","@diagramming/core","@diagramming/astar","@diagramming/hostinterface"],n):((t=t||self
).diagramfoundation=t.diagramfoundation||{},t.diagramfoundation.globallayout=n(t.diagramfoundation.layoutcore,t.diagramfoundation.core,t.diagramfoundation.astar,t.diagramfoundation.layouthostinterface));