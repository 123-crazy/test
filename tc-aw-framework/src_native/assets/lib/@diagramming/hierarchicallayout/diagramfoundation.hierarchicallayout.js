// @<COPYRIGHT>@
// ==================================================
// Copyright Siemens 2020.
// PL Diagram Foundation 1973.0.1-0
// ==================================================
// @<COPYRIGHT>@
var t,n;t=this,n=function(f,a,t,i){"use strict";function n(t){this.hostInterfaceObj=t,this.layoutSessionData=new f.GlobalLayoutSessionData,this.dpMaps=null,this.init()}function s(t){this.hostInterfaceObj=t,this.opts={rankdir:"TB",ranksep:40,nodesep:40,edgesep:20,ranker:null,grouplayoutstrategy:"global",layeralignment:.5,edgefactor:1,onelevel:!1,dpMaps:{}},this.dagre=null,this.graphObj=null,this.hostNodes=[],this.hostPorts=[],this.co=[],this.portRelPosData={},this.nodeRectMap=null,this.edgePathMap=null,this.portPosMap=null}function h(t){this.hostInterfaceObj=t,this.layoutOptions=new f.YfLayoutOption,this.dgLayoutObj=null,this.hostNodes=[],this.hostPosts=[],this.co=[],this.dpMaps=null}f=f&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,n.prototype.init=function(){
var t=this.layoutSessionData;t.fh=f.LayoutType.Hierarchical,t.Ft=a.LayoutDirection.TopToBottom,t.ah=f.RoutingType.HVPaths,t.ph=!0,t.isRSOPEnabled=!0,t.Vo=!1,t.isNestedView=!0,t.fu=!1,t.nodePlacement=a.NodePlacementOption.Center,t.portArrangement=a.PortArrangementOption.FollowLayoutDirection,t.nestedNodeLayoutStrategy=a.NestedNodeLayoutStrategy.Global,t.minPortExtensionDist=0},n.prototype.setLayoutDirection=function(t){this.layoutSessionData.Ft=t},n.prototype.setMinLevelGapDistance=function(t){this.layoutSessionData.minLayerDistance=t},n.prototype.setOptimalNodeToNodeDistance=function(t){this.layoutSessionData.ch=t},n.prototype.setOptimalConnectionDistance=function(t){this.layoutSessionData.lh=t},n.prototype.setRoutingType=function(t){this.layoutSessionData.ah=t},n.prototype.setNestedNodeLayoutStrategy=function(t){this.layoutSessionData.nestedNodeLayoutStrategy=t},n.prototype.setRankingStrategy=function(t){this.layoutSessionData.rankingStrategy=t},
n.prototype.setUserDefinedRanking=function(t,i){this.dpMaps||(this.dpMaps={});var n=t.slice(0),s=i.slice(0),i={get:function(t){t=n.indexOf(t);return 0<=t?s[t]:void 0}};this.dpMaps[f.DataProviderKeys.LAYER_ID_DP_KEY]=i},n.prototype.setPortAllocationRule=function(t){this.layoutSessionData.portArrangement=t},n.prototype.setPortLocationSharing=function(t){this.layoutSessionData.Bu=t},n.prototype.setNodePlacement=function(t){this.layoutSessionData.nodePlacement=t},n.prototype.setRSOPEnabled=function(t){this.layoutSessionData.isRSOPEnabled=t},n.prototype.setMakeRoomForRSOP=function(t){this.layoutSessionData.Vo=t},n.prototype.doLayout=function(t,i){var n=(n=a.LayoutCoreUtil.Mo.apply(null,arguments))||{},s=this.hostInterfaceObj,h=this.layoutSessionData;this.prepareSessionData(h,s,t),h.coreType="homegrown",n&&n.coreType&&(h.coreType=n.coreType);s=this.wrapHostInterfaceForPadding(s,h),t=new f.GlobalLayoutChangeState(s,h,t,i);h.du=t.du;i=new a.RemoveGroupOverlaps(h,t);t.Yo();i=new f.LayouterAlg(h
,t,i);i.fo=this.layoutSessionData.isRSOPEnabled,i.setAllDpMaps(this.dpMaps),i.oo="incUpdate",void 0!==n.pathRouter&&(i.oo=n.pathRouter),n&&!0===n.usePureCore?i.doLayoutUsePureCore():(a.LayoutCoreUtil.Fo(t.nList,h.edgeDist,h),i.hu(!0)),t.update(1),t.xi()},n.prototype.setMinPortSegmentLength=function(t){this.layoutSessionData.minPortExtensionDist=t},n.prototype.prepareSessionData=function(t,i,n){this.prepareConfig(t),this.setStdPortSize(t,n,i),this.makeValidConfig(t)},n.prototype.prepareConfig=function(t){var i=Math.min(t.ch,t.minLayerDistance);t.nodeDist={x:i,y:i},i=t.lh,t.edgeDist={x:i,y:i},i=t.minPortExtensionDist,t.minSegmentLength={x:i,y:i},t.at=t.ah===f.RoutingType.StraightLine?"straightLine":"HV",t.vh=t.lh,t.Mu=a.LayoutCoreUtil.w(t)},n.prototype.makeValidConfig=function(t){var i=new a.ValidDistCalculator(t).getValidConfigure();t.nodeDist=i.nodeDist,t.edgeDist=i.edgeDist,t.minSegmentLength=i.minSegmentLength,t.edgeToNodeDist=i.edgeToNodeDist,t.zo=i.zo;var n=i.nodeDist.x,
s=i.edgeDist.x,i=t.ch;t.ch=Math.max(n,Math.ceil(i/s)*s),i=t.minLayerDistance,t.minLayerDistance=Math.max(n,Math.ceil(i/s)*s)},n.prototype.setStdPortSize=function(t,i,n){t.zo=a.LayoutCoreUtil.checkStdPortSize(n,i)},n.prototype.wrapHostInterfaceForPadding=function(i,t){var n={};a.LayoutHelper.copyMethodsFrom(n,i);function s(t){return t=(t=Math.ceil(t/e)*e)<h?h:t}var h=t.nodeDist.x,e=t.edgeDist.x;return n.getGroupNodePadding=function(t){t=i.getGroupNodePadding(t);return{top:s(t.top),bottom:s(t.bottom),left:s(t.left),right:s(t.right)}},n},n.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},s.prototype.clear=function(){this.graphObj=null,this.hostNodes=[],this.hostPorts=[],this.co=[],this.portRelPosData={},this.nodeRectMap=null,this.edgePathMap=null,this.portPosMap=null},s.prototype.setLayoutDirection=function(t){switch(t){case"topToBottom":this.opts.rankdir="TB";break;case"leftToRight":this.opts.rankdir="LR";break;case"bottomToTop":this.opts.rankdir="BT";break
;case"rightToLeft":this.opts.rankdir="Rl";break;default:this.reportError("Unknown direction: "+t)}},s.prototype.setMinLayerDistance=function(t){this.opts.ranksep=t},s.prototype.setMinNodeToNodeDistance=function(t){this.opts.nodesep=t},s.prototype.setMinEdgeToEdgeDistance=function(t){this.opts.edgesep=t},s.prototype.setLayerAlignment=function(t){this.opts.layeralignment=t},s.prototype.setEdgeFactor=function(t){this.opts.edgefactor=t},s.prototype.setNestedNodeLayoutStrategy=function(t){this.opts.grouplayoutstrategy=t},s.prototype.setRankingStrategy=function(t){this.opts.ranker=t},s.prototype.setDataProvider=function(t,n){var s;n?(s=this).opts.dpMaps[t]={get:function(t){var i=s.graphObj.node(t);return(i=i||s.graphObj.edge(t))?n.get(i.te):null}}:this.opts.dpMaps[t]=null},s.prototype.doLayout=function(t,i){this.clear(),this.ie(t,i,this.hostInterfaceObj),this.ne(),this.graphObj.setGraph(this.opts),this.dagre.layout(this.graphObj)},s.prototype.doLayoutOneLevel=function(t,i,n){this.clear(),
this.ie(t,i,this.hostInterfaceObj),this.ne(),this.graphObj.setGraph(this.opts),this.graphObj.graph().onelevel=!0,this.dagre.layout(this.graphObj)},s.prototype.th=function(t){this.nodeRectMap||this.se();t=this.he(t,"node"),t=this.nodeRectMap[t];return t||(this.reportError("node is not found in layout."),t={x:0,y:0,width:0,height:0}),t},s.prototype.ih=function(t){this.portPosMap||this.se();var i,n,s=this.he(t,"port"),h=this.portPosMap[s];return h||(n=i=0,(s=this.portRelPosData[s])?(t=this.hostInterfaceObj.getNodeOfPort(t),i=(t=this.th(t)).x+s.x*t.width,n=t.y+s.y*t.height):this.reportError("The port has no position."),h={x:i,y:n}),h},s.prototype.nh=function(t){this.edgePathMap||this.se();t=this.he(t,"edge"),t=this.edgePathMap[t];return t||(this.reportError("edge path is not found in layout."),t=[]),t},s.prototype.Kh=function(){var t=0,i=0,n=0,s=0,h=this.graphObj,e=h.nodes();if(0<e.length)for(var o=0,r=e.length;o<r;++o){var u=h.node(e[o]),a=u.x-u.width/2,c=u.y-u.height/2,f=a+u.width,
u=c+u.height;0===o?(t=a,i=c,n=f,s=u):(a<t&&(t=a),c<i&&(i=c),n<f&&(n=f),s<u&&(s=u))}return{x:t,y:i,width:n-t,height:s-i}},s.prototype.ne=function(){this.dagre=this.ee(),this.graphObj=new this.dagre.graphlib.Graph({directed:!0,compound:!0,multigraph:!0}),this.oe()},s.prototype.ie=function(t,i,n){this.hostNodes=t.slice(0),this.co=i.slice(0),n.getAllPortsForNode?this.hostPorts=this.re(this.hostNodes,n):this.hostPorts=this.ue(this.co,n),this.ae(this.hostPorts)},s.prototype.re=function(t,i){for(var n=[],s=0,h=t.length;s<h;++s)var e=i.getAllPortsForNode(t[s]),n=n.concat(e);return n},s.prototype.ue=function(t,i){for(var n=[],s=0,h=t.length;s<h;++s){var e=t[s],o=i.getSourcePort(e),e=i.getTargetPort(e);n.indexOf(o)<0&&n.push(o),n.indexOf(e)<0&&n.push(e)}return n},s.prototype.oe=function(){var t=this.hostInterfaceObj,i=this.graphObj;i.setDefaultEdgeLabel(function(){return{}});for(var n=this.hostNodes,s=0,h=n.length;s<h;++s){var e=n[s],o=t.getNodeRect(e),r=null;t.isGroupNode(e)&&(
r=t.getGroupNodePadding(e));var u=this.he(e,"node");i.setNode(u,{x:o.x+o.width/2,y:o.y+o.height/2,width:o.width,height:o.height,padding:r,te:e})}for(s=0,h=n.length;s<h;++s){var e=n[s],a=t.getParentNode(e);a&&(v=this.he(e,"node"),p=this.he(a,"node"),i.setParent(v,p))}for(var c=this.co,s=0,h=c.length;s<h;++s){var f=c[s],l=t.getSourcePort(f),d=t.getTargetPort(f),g=t.getNodeOfPort(l),l=t.getNodeOfPort(d),d=t.wr(f),d=d?d.slice(0):[],v=this.he(g,"node"),p=this.he(l,"node"),l=this.he(f,"edge");i.setEdge(v,p,{labelpos:"c",points:d,te:f},l)}},s.prototype.ae=function(t){for(var i=this.hostInterfaceObj,n=this.portRelPosData,s=0,h=t.length;s<h;++s){var e=t[s],o=i.getNodeOfPort(e),r=i.cr(e),u=i.getNodeRect(o),a=.5,o=.5;0<u.width&&0<u.height&&(a=(r.x-u.x)/u.width,o=(r.y-u.y)/u.height),n[this.he(e,"port")]={x:a,y:o}}},s.prototype.se=function(){for(var t=this.hostInterfaceObj,i={},n={},s={},h=this.graphObj,e=h.nodes(),o=0,r=e.length;o<r;++o){var u=h.node(e[o]),a=u.te,c=u.x-u.width/2,f=u.y-u.height/2,
l=u.width,u=u.height;i[this.he(a,"node")]={x:c,y:f,width:l,height:u}}for(var d=h.edges(),o=0,r=d.length;o<r;++o){var g=h.edge(d[o]),v=[],p=g.points;if(p)for(var b=0,m=p.length;b<m;++b){var y=p[b];v.push({x:y.x,y:y.y})}var k=g.te;1<(n[this.he(g.te,"edge")]=v).length&&(g=t.getSourcePort(k),k=t.getTargetPort(k),g=this.he(g,"port"),k=this.he(k,"port"),s[g]||(y=v[0],s[g]={x:y.x,y:y.y}),s[k]||(y=v[v.length-1],s[k]={x:y.x,y:y.y}))}this.nodeRectMap=i,this.edgePathMap=n,this.portPosMap=s},s.prototype.he=function(t,i){var n=null;"node"===i?n=this.hostNodes:"edge"===i?n=this.co:"port"===i?n=this.hostPorts:this.reportError("Unknown object type: "+i);t=n?n.indexOf(t):-1;return t<0&&this.reportError("Object id is not found."),t},s.prototype.ee=function(){return t},s.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},h.prototype.reset=function(){this.dgLayoutObj&&this.dgLayoutObj.clear(),this.dgLayoutObj=null,this.hostNodes=[],this.hostPosts=[],this.co=[],this.dpMaps=null},
h.prototype.getLayoutOptions=function(){return this.layoutOptions},h.prototype.layout=function(){this.dgLayoutObj=new s(this.hostInterfaceObj),this.ce(this.dgLayoutObj),this.dgLayoutObj.doLayout(this.hostNodes,this.co)},h.prototype.addNode=function(t){this.hostNodes.push(t)},h.prototype.addPort=function(t){this.hostPosts.push(t)},h.prototype.addEdge=function(t){this.co.push(t)},h.prototype.th=function(t){return this.dgLayoutObj.th(t)},h.prototype.ih=function(t){return this.dgLayoutObj.ih(t)},h.prototype.nh=function(t){return this.dgLayoutObj.nh(t)},h.prototype.Kh=function(){return this.dgLayoutObj.Kh()},h.prototype.ce=function(t){var i=this.layoutOptions,n="topToBottom",s=i.Ft;switch(s){case a.LayoutDirection.TopToBottom:n="topToBottom";break;case a.LayoutDirection.LeftToRight:n="leftToRight";break;case a.LayoutDirection.BottomToTop:n="bottomToTop";break;case a.LayoutDirection.RightToLeft:n="rightToLeft";break;default:this.reportError("unknown direction: "+s)}var h=i.minLayerDistance,
e=i.ch,o=i.lh;t.setLayoutDirection(n),t.setMinLayerDistance(h),t.setMinNodeToNodeDistance(e),t.setMinEdgeToEdgeDistance(o);o=i.nestedNodeLayoutStrategy===a.NestedNodeLayoutStrategy.InsideToOut?"inside-out":"global";t.setNestedNodeLayoutStrategy(o);var r=null,o=i.rankingStrategy,u="simple-compact";switch(o=null==o?f.HierarchicRankingStrategy.Default:o){case f.HierarchicRankingStrategy.Default:r=u;break;case f.HierarchicRankingStrategy.UserDefined:r="user-defined-mixed";break;case f.HierarchicRankingStrategy.UserDefinedSimple:r="user-defined";break;case f.HierarchicRankingStrategy.NetworkSimplex:r="network-simplex";break;case f.HierarchicRankingStrategy.TightTree:r="tight-tree";break;case f.HierarchicRankingStrategy.LongestPath:r="longest-path";break;case f.HierarchicRankingStrategy.TightTreeRev:r="tight-tree-rev";break;case f.HierarchicRankingStrategy.LongestPathRev:r="longest-path-rev";break;case f.HierarchicRankingStrategy.SimpleCompact:r="simple-compact";break;default:r=u}
t.setRankingStrategy(r),this.fe(),this.setInnerDpMaps(t,this.dpMaps);o=a.LayoutCoreUtil.toLayerAlignmentValue(i.nodePlacement,s);t.setLayerAlignment(o);i=i.edgeFactor;0<i&&t.setEdgeFactor(i)},h.prototype.setAllDpMaps=function(t){this.dpMaps=t},h.prototype.setInnerDpMaps=function(t,i){var n;i&&((n=i[f.DataProviderKeys.LAYER_ID_DP_KEY])&&t.setDataProvider("LAYER_ID_DP_KEY",n),(n=i[f.DataProviderKeys.EDGE_PORT_CONSTRAINT_DP_KEY])&&t.setDataProvider("EDGE_PORT_CONSTRAINT_DP_KEY",n))},h.prototype.fe=function(){for(var i=null,t=this.hostInterfaceObj,n=this.co,s=0,h=n.length;s<h;s++){var e,o,r,u=n[s],a=t.getSourcePort(u),c=t.getTargetPort(u);t.lr&&(e=t.lr(a),o=t.lr(c),(e||o)&&(r={},e&&(r.source=this.le(a)),o&&(r.target=this.le(c)),(i=i||{})[u.uid]=r))}return i&&(i.get=function(t){return i[t.uid]},this.dpMaps||(this.dpMaps={}),this.dpMaps[f.DataProviderKeys.EDGE_PORT_CONSTRAINT_DP_KEY]=i),i},h.prototype.le=function(t){var i=this.hostInterfaceObj,n=i.getNodeOfPort(t),t=i.cr(t),n=i.getNodeRect(n
);return{type:"fixedLocation",side:"auto",location:{absoluteX:0,absoluteY:0,percentX:(t.x-n.x)/n.width,percentY:(t.y-n.y)/n.height}}},h.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},i.common.ObjectHelper.rootNamespace=i.common.ObjectHelper.rootNamespace||{};var e=i.common.ObjectHelper.rootNamespace;e.Layout=e.Layout||{},e.Layout.HierarchicalLayout=n,e.Layout.LayoutType=f.LayoutType,e.Layout.RoutingType=f.RoutingType,e.Layout.HierarchicRankingStrategy=f.HierarchicRankingStrategy,e.Layout.LayouterAlg=f.LayouterAlg,e.Layout.DagreLayer=h;i={};return i.Layout=e.Layout||{},i.Layout.HierarchicalLayout=n,i.Layout.LayoutType=f.LayoutType,i.Layout.RoutingType=f.RoutingType,i.Layout.HierarchicRankingStrategy=f.HierarchicRankingStrategy,i.Layout.LayouterAlg=f.LayouterAlg,i.Layout.DagreLayer=h,i},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("@diagramming/globallayout"),require("@diagramming/layoutcore"),require("@diagramming/dagre"),
require("@diagramming/core")):"function"==typeof define&&define.amd?define(["@diagramming/globallayout","@diagramming/layoutcore","@diagramming/dagre","@diagramming/core"],n):((t=t||self).diagramfoundation=t.diagramfoundation||{},t.diagramfoundation.hierarchicallayout=n(t.diagramfoundation.globallayout,t.diagramfoundation.layoutcore,t.diagramfoundation.dagre.core,t.diagramfoundation.core));