// @<COPYRIGHT>@
// ==================================================
// Copyright Siemens 2020.
// PL Diagram Foundation 1973.0.1-0
// ==================================================
// @<COPYRIGHT>@
var t,n;t=this,n=function(y,t){"use strict";function i(t,i){y.TableNode.call(this,t,i),this.owningBranchNode=null,this.childNodes=[],this.branchOutToBranches=[],this.branchInFromNode=null,this.v=[],this.Y=null,this.Z=null,this.$=null,this.tt={newRow:null,newcol:null},this.isProcessing=!1}function s(t){y.GridSpace.call(this,t)}y=y&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,i.prototype.isBranchNode=function(){return!this.owningBranchNode},i.prototype.it=function(t){(this.Z=t).$=this},i.prototype.st=function(t){this.branchOutToBranches.push(t),t.branchInFromNode=this},i.prototype.ht=function(t){this.v.push(t),t.Y=this},i.prototype.isLeafNode=function(){if(this.isBranchNode())return!1;if(this.Z)return!1;if(this.branchOutToBranches&&0<this.branchOutToBranches.length)return!1;if(this.v&&0<this.v.length)return!1;var t=this.owningBranchNode;return!(t.childNodes.indexOf(this)<t.childNodes.length-1)},
t.common.ObjectHelper.inherit(i,y.TableNode),s.prototype.removeNode=function(t){y.GridSpace.prototype.removeNode.call(this,t);var i=t.owningBranchNode;i&&(n=i.childNodes.indexOf(t),i.childNodes.splice(n,1));i=t.branchInFromNode;i&&(n=i.branchOutToBranches.indexOf(t),i.branchOutToBranches.splice(n,1));for(var s=t.branchOutToBranches,h=0,r=s.length;h<r;h++)s[h].branchInFromNode=null;i=t.Y;i&&(n=i.v.indexOf(t),i.v.splice(n,1));var i=[],n=t.Z;n&&(n.$=null,i.push(n));t=t.$;return t&&(t.Z=null,i.push(t)),i},s.prototype.rt=function(t){t=new i(t,this.reportError);return this.nt.push(t),t};function e(t,i){for(var s=t.branchOutToBranches,h=0,r=s.length;h<r;h++){i.indexOf(s[h])<0&&i.push(s[h]);for(var n=0,o=(f=s[h].childNodes).length;n<o;n++)e(f[n],i)}for(var f,h=0,r=(f=t.childNodes).length;h<r;h++)e(f[h],i)}function h(t,i,s){y.ModelSpace.call(this,t,i,s)}function r(t,i){y.TableOperator.call(this,t,i),this.ot=null,this.ft()}function n(t,i,s){y.SimpleHVPaths.call(this,t,i),this.tableOperatorObj=s}
function o(t,i,s){y.HVPaths.call(this,t,i,s,t.isRSOPEnabled)}function f(t,i,s,h){y.ChangeState.call(this,t,i,s,h)}function a(){y.LayoutSessionData.call(this),this.et=y.LayoutDirection.TopToBottom,this.compactGraph=!1}function u(t,i,s,h){this.reportError=t.reportError,this.hostInterfaceObj=t,this.compoundCommands=!1,this.isPartialUpdate=!0,this.layoutSessionData=new a,this.layoutSessionData.nodeDist=this.hostInterfaceObj.getNodeToNodeDist(),this.layoutSessionData.edgeDist=this.hostInterfaceObj.getEdgeToEdgeDist(),this.layoutSessionData.minSegmentLength=this.hostInterfaceObj.getMinSegmentLength(),this.layoutSessionData.isRSOPEnabled=!1,this.setLayoutDirections(i,s),this.layoutSessionData.at=h||"HV",this.changeStateObj=new f(this.hostInterfaceObj,this.layoutSessionData,[],[]),this.tableOperatorObj=new r(this.layoutSessionData,this.reportError)}s.prototype.ut=function(t){var i=[];return e(t,i),i},s.prototype.vt=function(t,i,s,h,r,n,o){for(var f=o===this.ct||o===this.lt,e=t?t.length:0,
a=0;a<e;a++){var u=t[a];u.isProcessing=!0,u.tt.newRow=i,s?h.unshift(u):h.push(u);u=u.childNodes.concat();this.dt(u,f?i+1:i-1,s,h,r,n,o)}},s.prototype.dt=function(t,i,s,h,r,n,o){for(var f=o===this.ct||o===this.lt,e=t.shift();e;){var a=e.branchOutToBranches,u=this.getLayerSeqOfNode(e,n);if(s)e.isProcessing=!0,e.tt.newRow=i,h.unshift(e),e.Z?r.push(e.Z):e.$&&r.push(e.$),e=t.shift();else{if(!(f?u.seq<i:u.seq>i))break;e.isProcessing=!0,e.tt.newRow=i,h.push(e),e.Z?r.push(e.Z):e.$&&r.push(e.$),e=t.shift()}this.vt(a,i,s,h,r,n,o),f?i++:i--}},s.prototype.gt=function(t,i,s,h){for(var r=this.getLayerSeqOfNode(t,s),n=t.owningBranchNode,o=h===this.ct||h===this.lt,f=[],e=n.childNodes,a=0,u=e.length;a<u;a++){var v=this.getLayerSeqOfNode(e[a],s);(o?v.seq>=r.seq:v.seq<=r.seq)&&f.push(e[a])}var c=o?r.seq>i:r.seq<i,t=[],n=[];return this.dt(f,i,c,t,n,s,h),{nodesToRelocate:t,relatedPromoteNodes:n}},s.prototype.bt=function(t,i,s,h,r){if(this.getLayerSeqOfNode(t,h).seq!==i){var i=this.gt(t,i,h,r),
n=i.nodesToRelocate,o=i.relatedPromoteNodes;this.yt(n,h);for(var f=0,e=n.length;f<e;f++)s.indexOf(n[f])<0&&s.push(n[f]);for(f=0,e=o.length;f<e;f++){var a,u,v=o[f],c=null;v.Z&&v.Z.isProcessing?c=v.Z:v.$&&v.$.isProcessing&&(c=v.$),c&&(a=c.tt.newRow,c=(u=this.mt(v,h,r))<a?a:u,r!==this.pt&&r!==this.wt||(c=a<u?a:u),this.bt(v,c,s,h,r))}}},s.prototype.Lt=function(t,i,s,h){y.LayoutHelper.setAttrOnItems(this.nt,"isProcessing",!1);var r=[];return this.bt(t,i,r,s,h),r},s.prototype.yt=function(t,i){for(var s=t.length-1;0<=s;s--){var h=t[s],r=h.tt.newRow,n=this.getLayerSeqOfNode(h,i);i===this.ct||i===this.pt?this.Tt.Bt(h,r,n.layer):this.Tt.Bt(h,n.layer,r)}},s.prototype.removeBranches=function(t,i){for(var s=[],h=[],r=i===this.ct||i===this.lt,n=null,o=0,f=t.length;o<f;o++){var e=this.getLayerSeqOfNode(t[o],i).layer;(null===n||(r?e<n:n<e))&&(n=e),s.push(t[o].refNode),this.removeNode(t[o]);for(var a=t[o].childNodes,u=a.length-1;0<=u;u--)s.push(a[u].refNode),h=h.concat(this.removeNode(a[u]))}for(
var v=[],o=0,c=h.length;o<c;o++)this.nt.indexOf(h[o])<0||0<=v.indexOf(h[o])||v.push(h[o]);return{removedNodes:s,promoteNodes:v,startNodeBarIndex:n}},s.prototype.Mt=function(t,i,s){var h=null,r=null,n=t.length;if(0<n)for(var o,h=(o=this.getLayerSeqOfNode(t[0],i)).seq,r=t[0],f=s===this.ct||s===this.lt,e=1;e<n;e++)o=this.getLayerSeqOfNode(t[e],i),(f?h<o.seq:h>o.seq)&&(h=o.seq,r=t[e]);return{node:r,seq:h}},s.prototype.mt=function(t,i,s){var h=t.owningBranchNode;if(h){for(var r=h,n=h.childNodes,o=n.length,f=0;f<o&&n[f]!==t;f++)r=n[f];i=this.getLayerSeqOfNode(r,i);return s===this.ct||s===this.lt?i.seq+1:i.seq-1}},s.prototype.kt=function(t,i){var s=this.getLayerSeqOfNode(t,i),h=s.layer,r=i===this.ct||i===this.lt,n=t.owningBranchNode;if(n){for(var o=0,f=(u=n.childNodes).length;o<f;o++)if((c=this.getLayerSeqOfNode(u[o],i)).seq<=s.seq)for(var e=0,a=(v=this.ut(u[o])).length;e<a;e++)c=this.getLayerSeqOfNode(v[e],i),(r?c.layer>h:c.layer<h)&&(h=c.layer)}else for(var u,o=0,f=(u=t.childNodes
).length;o<f;o++)for(var v,e=0,a=(v=this.ut(u[o])).length;e<a;e++){var c=this.getLayerSeqOfNode(v[e],i);(r?c.layer>h:c.layer<h)&&(h=c.layer)}return h=r?h+1:h-1},s.prototype.Ht=function(t,i,s){var h=this.getLayerSeqOfNode(t,i).seq,r=s===this.ct||s===this.lt;if(t.isBranchNode())for(var n=t.childNodes,o=0,f=n.length;o<f;o++){var e=this.getLayerSeqOfNode(n[o],i);(r?e.seq>h:e.seq<h)&&(h=e.seq)}return h},s.prototype.Vt=function(t,i,s){for(var h=t.length,r=0;r<h;r++){var n=t[r],o=i[r];this.At(n,o.layer,o.seq,s)}},s.prototype.getRemoveBranches=function(t){for(var i=[],s=0,h=t.length;s<h;s++){var r=t[s];if(void 0!==r){for(var n=this.ut(r),o=s+1;o<h;o++)0<=n.indexOf(t[o])&&(t[o]=void 0);for(var f=(f=[r]).concat(n),e=i.length-1;0<=e;e--){var a=i[e];0<=f.indexOf(a[0])&&i.splice(e,1)}i.push(f)}}return i},s.prototype.xt=function(t,i){for(var s=this.getLayerSeqOfNode(t[0],i).layer,h=s,r=1,n=t.length;r<n;r++){var o=this.getLayerSeqOfNode(t[r],i).layer;o<s&&(s=o),h<o&&(h=o)}return{startingLayer:s,
endingLayer:h}},t.common.ObjectHelper.inherit(s,y.GridSpace),h.prototype.qt=function(t){y.ModelSpace.prototype.Nt.call(this,this.Tt,t)},h.prototype.Rt=function(t){this.jt(t)},h.prototype.yt=function(t,i){for(var s=i===this.ct||i===this.pt,h=0,r=t.length;h<r;h++){var n=t[h],o=this.Ot(n,s?"H":"V");o?o.removeNode(n):this.reportError("BLTableModelSpace.__assignNewTableLocations: not found table bar for node in table model space!"),this.Pt([n],s?"H":"V")}},h.prototype.removeBranches=function(t){for(var i=0,s=t.length;i<s;i++){this.removeNode(t[i]);for(var h=t[i].childNodes,r=0,n=h.length;r<n;r++)this.removeNode(h[r])}},t.common.ObjectHelper.inherit(h,y.ModelSpace),r.prototype.ft=function(){this.gridSpaceObj=new s(this.reportError),this._t={ir:0,ic:0},this.Ct=null;var t=this.gridSpaceObj.It();this.modelSpaceObj=new h(this.layoutSessionData,t,this.reportError)},r.prototype.isLeafNode=function(t){t=this.St(t,!0);return!!t&&t.isLeafNode()},r.prototype.zt=function(t,i){(t=t||i.shift())&&(
this.Ct=this.gridSpaceObj.Dt(t,this._t.ir,this._t.ic,!0),this.gridSpaceObj.Et(this.Ct.ir,this.Ct.ic),this.ot=this.Ct,this.modelSpaceObj.qt([this.Ct],this.layoutSessionData.Ft),this.addNodesToBranch(t,i))},r.prototype.addNodesToBranch=function(t,i,s){var h=this.St(t,!0);if(h){for(var r=this.layoutSessionData.Ft,t=this.layoutSessionData.et,n=this.gridSpaceObj.getLayerSeqOfNode(h,r).layer,o=this.gridSpaceObj.Ht(h,r,t),f=t===y.LayoutDirection.LeftToRight||t===y.LayoutDirection.TopToBottom,e=[],a=[],u=0,v=i.length;u<v;u++){var c=(c=this.St(i[u],!1))||this.gridSpaceObj.rt(i[u]);h.childNodes.push(c),c.owningBranchNode=h,e.push(c),a.push({layer:n,seq:f?o+u+1:o-u-1})}this.gridSpaceObj.Vt(e,a,r),this.modelSpaceObj.Gt(e,r);for(u=0,v=s?s.length:0;u<v;u++){var l=s[u];this.Jt(l[0],l[1])}}},r.prototype.addChildBranch=function(t,i,s,h){var r=this.St(t,!0);if(r){var n=i;if(n=n||s.shift()){for(var o=r,f=0,e=h.length;f<e;f++){var a=h[f];if(a[1]===n){a=a[0],o=this.St(a,!1);h.splice(f,1);break}}
var u=this.layoutSessionData.Ft,v=u===y.LayoutDirection.LeftToRight||u===y.LayoutDirection.TopToBottom,c=u===y.LayoutDirection.LeftToRight||u===y.LayoutDirection.RightToLeft,l=!1,d=this.gridSpaceObj.getLayerSeqOfNode(o,u).seq,t=this.gridSpaceObj.kt(r,u),i=this.modelSpaceObj.Kt(t,c?"V":"H");i&&i.isEmpty()&&(l=!0);c=(c=this.St(n,!1))||this.gridSpaceObj.rt(n);r.st(c),o&&o.ht(c);r=null;l||(r=i)&&(this.modelSpaceObj.Qt(r,u),this.modelSpaceObj.Ut(r,v?t+1:t-1,u)),this.gridSpaceObj.Vt([c],[{layer:t,seq:d}],u),this.modelSpaceObj.Gt([c],u),r&&this.modelSpaceObj.Wt(r,u),this.addNodesToBranch(n,s,h)}}},r.prototype.addParentBranch=function(t,i,s,h){var r=this.St(t,!0);if(r){var n,o,f=i;if(f=f||s.shift()){if(h&&0<h.length)for(var e=0,a=h.length;e<a;e++){var u=h[e];if(u[1]===t){n=u[0],o=(o=this.St(n,!1))||this.gridSpaceObj.rt(n),h.splice(e,1);break}}var v=this.layoutSessionData.Ft,c=this.layoutSessionData.et,l=this.gridSpaceObj.getLayerSeqOfNode(r,v),i=s.indexOf(n),
c=c===y.LayoutDirection.LeftToRight||c===y.LayoutDirection.TopToBottom?l.seq-i-1:l.seq+i+1,i=v===y.LayoutDirection.LeftToRight||v===y.LayoutDirection.TopToBottom?l.layer-1:l.layer+1,l=(l=this.St(f,!1))||this.gridSpaceObj.rt(f);this.ot=l,o.st(r),o.ht(r),this.gridSpaceObj.Vt([l],[{layer:i,seq:c}],v),this.modelSpaceObj.Gt([l],v),this.addNodesToBranch(f,s,h)}}},r.prototype.insertBranch=function(t,i,s,h,r,n){var o=this.St(t,!0);if(!o)return!1;var f=this.St(r,!0);if(!f)return!1;var e=i;if(e=e||s.shift()){var a=o;if(n&&0<n.length)for(var u=0,v=n.length;u<v;u++){var c=n[u];if(c[1]===e){c=c[0],a=this.St(c,!1),n.splice(u,1);break}}var l,d=this.layoutSessionData.Ft,g=d===y.LayoutDirection.LeftToRight||d===y.LayoutDirection.TopToBottom,t=d===y.LayoutDirection.LeftToRight||d===y.LayoutDirection.RightToLeft,r=!1,i=this.gridSpaceObj.getLayerSeqOfNode(a,d).seq;"before"===h?(l=this.gridSpaceObj.getLayerSeqOfNode(f,d).layer,(h=this.modelSpaceObj.Kt(g?l-1:l+1,t?"V":"H"))&&h.isEmpty()&&(l=h.Xt,r=!0)):(
l=this.gridSpaceObj.kt(f,d),(b=this.modelSpaceObj.Kt(l,t?"V":"H"))&&b.isEmpty()&&(r=!0));var b=(b=this.St(e,!1))||this.gridSpaceObj.rt(e);o.st(b),a&&a.ht(b);o=null;r||(o=this.modelSpaceObj.Kt(l,t?"V":"H"))&&(this.modelSpaceObj.Qt(o,d),this.modelSpaceObj.Ut(o,g?l+1:l-1,d)),this.gridSpaceObj.Vt([b],[{layer:l,seq:i}],d),this.modelSpaceObj.Gt([b],d),o&&this.modelSpaceObj.Wt(o,d),this.addNodesToBranch(e,s,n)}},r.prototype.removeBranches=function(t,i){for(var s=[],h=0,r=t.length;h<r;h++){var n=this.St(t[h],!0);n&&s.push(n)}for(var o=[],f=this.gridSpaceObj.getRemoveBranches(s),h=0,r=f.length;h<r;h++)var e=this.Yt(f[h],i),o=o.concat(e);return o},r.prototype.collapseUpAll=function(t,i){var s=this.ot;if(!s)return!1;var h=this.layoutSessionData.Ft,r=this.gridSpaceObj.ut(s);r.unshift(s);var t=this.St(t,!0),n=this.gridSpaceObj.ut(t);n.unshift(t);for(var o=[],f=0,e=r.length;f<e;f++)n.indexOf(r[f])<0&&o.push(r[f]);this.modelSpaceObj.removeBranches(o);h=this.gridSpaceObj.removeBranches(o,h)
;return i&&this.Zt(h.promoteNodes),this.ot=t,h.removedNodes},r.prototype.Yt=function(t,i){var s=this.layoutSessionData.Ft,h=this.gridSpaceObj.xt(t,s),r=s===y.LayoutDirection.LeftToRight||s===y.LayoutDirection.TopToBottom,n=r?h.endingLayer+1:h.startingLayer-1,o=s===y.LayoutDirection.LeftToRight||s===y.LayoutDirection.RightToLeft,f=null;i&&(f=this.modelSpaceObj.Kt(n,o?"V":"H"))&&this.modelSpaceObj.Qt(f,s),this.modelSpaceObj.removeBranches(t);t=this.gridSpaceObj.removeBranches(t,s);return i&&null!==t.startNodeBarIndex&&(o=this.modelSpaceObj.Kt(t.startNodeBarIndex,o?"V":"H"),this.modelSpaceObj.Qt(o,s)),i&&this.Zt(t.promoteNodes),f&&(h=r?h.startingLayer:h.endingLayer,this.modelSpaceObj.Ut(f,h,s),this.modelSpaceObj.Wt(f,s)),t.removedNodes},r.prototype.deleteLeafNode=function(t,i){t=this.St(t,!0);if(!t)return!1;this.modelSpaceObj.removeNode(t);t=this.gridSpaceObj.removeNode(t);return i&&this.Zt(t),!0},r.prototype.Jt=function(t,i){var s,h,r,n=this.St(t,!0);!n||(s=this.St(i,!0))&&(
h=this.layoutSessionData.Ft,r=this.layoutSessionData.et,i=(t=this.gridSpaceObj.Mt([n,s],h,r)).seq,t=n===t.node?s:n,r=this.gridSpaceObj.Lt(t,i,h,r),this.modelSpaceObj.yt(r,h),n.it(s))},r.prototype.Zt=function(t){for(var i=this.layoutSessionData.Ft,s=this.layoutSessionData.et,h=0,r=t.length;h<r;h++){var n=this.gridSpaceObj.mt(t[h],i,s);n&&(n=this.gridSpaceObj.Lt(t[h],n,i,s),this.modelSpaceObj.yt(n,i))}},t.common.ObjectHelper.inherit(r,y.TableOperator),n.prototype.$t=function(t,i,s,h,r,n){var o=t.ti,f=h.ti,e=this.ii(t,i,s),t=this.ii(h,r,n),h=null;if(this.si(e,t)){if(this.hi(e,t))return this.ri(o,i,e,f,r,t,s);(h=[]).push(i),h.push(e),h.push(t),h.push(r)}else{n=this.ni(e,t,s);if(this.oi(e,n,t)&&(n=this.ni(t,e,s),this.oi(e,n,t)))return this.ri(o,i,e,f,r,t,s);(h=[]).push(i),h.push(e),h.push(n),h.push(t),h.push(r)}return h&&(this.fi(h,0)&&h.splice(1,1),this.fi(h,h.length-3)&&h.splice(h.length-2,1)),h},n.prototype.ri=function(t,i,s,h,r,n,o){var f="left"===o||"right"===o?"H":"V",e="up"
;this.tableOperatorObj.et!==y.LayoutDirection.BottomToTop&&this.tableOperatorObj.et!==y.LayoutDirection.RightToLeft||(e="down");var a=this.tableOperatorObj.ei(t,f,e),t=(a.min+a.max)/2;a.upBar&&a.nextBar||(u=this.tableOperatorObj.modelSpaceObj.ai(f)/2,"up"===e?t=a.max-u:"down"===e&&(t=a.min+u));var a={x:s.x,y:s.y},u={x:n.x,y:n.y},o="left"===o||"right"===o?"y":"x";a[o]=t,u[o]=t;t=[];return t.push(i),t.push(s),t.push(a),t.push(u),t.push(n),t.push(r),t},n.prototype.ii=function(t,i,s){var h=t.ti,r="left"===s||"right"===s?"V":"H",n="right"===s||"down"===s?"down":"up",t=this.tableOperatorObj.ei(h,r,n),h=(t.min+t.max)/2;t.upBar&&t.nextBar||(r=this.tableOperatorObj.modelSpaceObj.ai(r)/2,"up"==n?h=t.max-r:"down"==n&&(h=t.min+r));i={x:i.x,y:i.y};return"down"===s?i.y=h:"left"===s||"right"===s?i.x=h:"up"===s&&(i.y=h),i},n.prototype.hi=function(t,i){for(var s,h=Math.min(t.x,i.x),r=Math.max(t.x,i.x),n=Math.min(t.y,i.y),o=Math.max(t.y,i.y),f=this.changeStateObj.nList,e=f.length,a=0;a<e;++a)if(!(s=f[a]
).ignore&&this.ui(s,h,n,r,o))return!0;return!1},t.common.ObjectHelper.inherit(n,y.SimpleHVPaths),o.prototype.vi=function(){this.ci=new n(this.layoutSessionData,this.changeStateObj,this.li);for(var t,i=this.changeStateObj,s=i.isPartialUpdate?this.di():i.cList,h=s.length,r=0;r<h;++r)(t=s[r]).ignore||this.gi(t)},o.prototype.gi=function(t){t.bi,t.yi;var i=t.mi,s=t.pi,h={x:i.x,y:i.y},r={x:s.x,y:s.y},n=this.changeStateObj.wi(i,t),o=this.changeStateObj.wi(s,t),n=this.Li[n],o=this.Li[o],o=this.ci.$t(i,h,n,s,r,o);t.Bi=o,t.Ti=!0},t.common.ObjectHelper.inherit(o,y.HVPaths),f.prototype.wi=function(t,i){var s="",h=t.ti,t=i.bi,i=i.yi,r=t.tabNode.ir,n=t.tabNode.ic,o=i.tabNode.ir,f=i.tabNode.ic,e=h===t;if(r===o)s=e?f<n?"left":"right":f<n?"right":"left";else if(n===f)s=e?o<r?"top":"bottom":o<r?"bottom":"top";else switch(this.layoutSessionData.Ft){case y.LayoutDirection.LeftToRight:s=e?f<n?o<r?"top":"bottom":"right":f<n?"right":o<r?"bottom":"top";break;case y.LayoutDirection.RightToLeft:
s=e?f<n?"left":o<r?"top":"bottom":f<n?o<r?"bottom":"top":"left";break;case y.LayoutDirection.TopToBottom:s=e?o<r?f<n?"left":"right":"bottom":o<r?"bottom":f<n?"right":"left";break;case y.LayoutDirection.BottomToTop:s=e?o<r?"top":f<n?"left":"right":o<r?f<n?"right":"left":"top";break;default:s=e?f<n?o<r?"top":"bottom":"right":f<n?"right":o<r?"bottom":"top"}return s},f.prototype.Mi=function(){for(var t=this.nList,i=t.length,s=0;s<i;++s)for(var h,r,n=(h=t[s]).ki,o=n.length,f=0;f<o;f++)(r=n[f]).Hi(h.x+h.w/2,h.y+h.h/2),this.Vi(r)},t.common.ObjectHelper.inherit(f,y.ChangeState),t.common.ObjectHelper.inherit(a,y.LayoutSessionData),u.prototype.setLayoutDirections=function(t,i){var s=(s=t)||"leftToRight";this.layoutSessionData.Ft=this.Ai(s);t=i;i||("leftToRight"===s||"rightToLeft"===s?t="topToBottom":"topToBottom"!==s&&"bottomToTop"!==s||(t="leftToRight")),this.layoutSessionData.et=this.Ai(t)},u.prototype.Ai=function(t){var i;switch(t){case"leftToRight":i=y.LayoutDirection.LeftToRight;break
;case"rightToLeft":i=y.LayoutDirection.RightToLeft;break;case"topToBottom":i=y.LayoutDirection.TopToBottom;break;case"bottomToTop":i=y.LayoutDirection.BottomToTop;break;default:i=y.LayoutDirection.LeftToRight}return i},u.prototype.setGlobalCompact=function(t){this.layoutSessionData.compactGraph=t},u.prototype.isActive=function(){return null!==this.changeStateObj},u.prototype.clear=function(){null!==this.changeStateObj&&this.changeStateObj.xi(),null!==this.tableOperatorObj&&this.tableOperatorObj.qi(),this.changeStateObj=null,this.tableOperatorObj=null},u.prototype.initBranch=function(t,i){if(!1===this.isActive())return this.reportError("BranchLayout Mode is not Active!"),!1;var s=this.changeStateObj,h=null;t&&(h=(h=this.Ni(t,!1))||s.addNewNode(t));for(var r=[],n=0,o=i.length;n<o;n++){var f=(f=this.Ni(i[n],!1))||s.addNewNode(i[n]);r.push(f)}return this.tableOperatorObj.zt(h,r),this.U(),!0},u.prototype.addNodesToBranch=function(t,i,s){if(!1===this.isActive())return this.reportError(
"BranchLayout Mode is not Active!"),!1;t=this.Ni(t,!0);if(!t)return!1;for(var h=this.changeStateObj,r=[],n=0,o=i.length;n<o;n++){var f=(f=this.Ni(i[n],!1))||h.addNewNode(i[n]);r.push(f)}for(var e=[],n=0,o=s?s.length:0;n<o;n++){var a=s[n],u=this.Ni(a[0],!0),a=this.Ni(a[1],!0);e.push([u,a])}return this.tableOperatorObj.addNodesToBranch(t,r,e),this.U(),!0},u.prototype.addChildBranch=function(t,i,s,h){if(!1===this.isActive())return this.reportError("BranchLayout Mode is not Active!"),!1;var r=this.Ni(t,!0);if(!r)return!1;var n=this.changeStateObj,t=null;i&&(t=(t=this.Ni(i,!1))||n.addNewNode(i));for(var o=[],f=0,e=s.length;f<e;f++){var a=(a=this.Ni(s[f],!1))||n.addNewNode(s[f]);o.push(a)}for(var u=[],f=0,e=h?h.length:0;f<e;f++){var v=h[f],c=this.Ni(v[0],!0),v=this.Ni(v[1],!0);u.push([c,v])}return this.tableOperatorObj.addChildBranch(r,t,o,u),this.U(),!0},u.prototype.addParentBranch=function(t,i,s,h){if(!1===this.isActive())return this.reportError("BranchLayout Mode is not Active!"),!1
;var r=this.Ni(t,!1);if(!r)return!1;var n=this.changeStateObj,t=null;i&&(t=(t=this.Ni(i,!1))||n.addNewNode(i));for(var o=[],f=0,e=s.length;f<e;f++){var a=(a=this.Ni(s[f],!1))||n.addNewNode(s[f]);o.push(a)}for(var u=[],f=0,e=h?h.length:0;f<e;f++){var v=h[f],c=this.Ni(v[0],!0),v=this.Ni(v[1],!0);u.push([c,v])}return this.tableOperatorObj.addParentBranch(r,t,o,u),this.U(),!0},u.prototype.insertBranch=function(t,i,s,h,r,n){if(!1===this.isActive())return this.reportError("BranchLayout Mode is not Active!"),!1;var o=this.Ni(t,!0);if(!o)return!1;t=this.Ni(r,!0);if(!t)return!1;var f=this.changeStateObj,r=null;i&&(r=(r=this.Ni(i,!1))||f.addNewNode(i));for(var e=[],a=0,u=s.length;a<u;a++){var v=(v=this.Ni(s[a],!1))||f.addNewNode(s[a]);e.push(v)}for(var c=[],a=0,u=n?n.length:0;a<u;a++){var l=n[a],d=this.Ni(l[0],!0),l=this.Ni(l[1],!0);c.push([d,l])}return this.tableOperatorObj.insertBranch(o,r,e,h,t,c),this.U(),!0},u.prototype.addConnections=function(t){if(!1===this.isActive()
)return this.reportError("BranchLayout Mode is not Active!"),!1;for(var i=this.hostInterfaceObj,s=this.changeStateObj,h=0,r=t.length;h<r;++h){var n=t[h];if(!(a=this.Ri(n,!1))){var o,f=i.getSourcePort(n),e=i.getTargetPort(n);if(!f||!e)return this.reportError("BranchLayout: Can not add dangling connection!"),!1;!1===s.ji(f)&&(o=s.addNewPort(f))&&(o.Oi=2),!1===s.ji(e)&&(o=s.addNewPort(e))&&(o.Oi=1),s.addNewConnection(n);var a=this.Ri(n,!0);s.Pi(a)}}return this.U(),!0},u.prototype.removeConnections=function(t){if(!1===this.isActive())return this.reportError("BranchLayout Mode is not Active!"),!1;for(var i=0,s=t.length;i<s;i++){var h,r=t[i],n=this.Ri(r,!1);n&&(h=n.mi,1===this.changeStateObj._i(h).length&&this.changeStateObj.removePort(h.Ci),n=n.pi,1===this.changeStateObj._i(n).length&&this.changeStateObj.removePort(n.Ci),this.changeStateObj.removeConnection(r))}return this.U(),!0},u.prototype.removeBranches=function(t,i){if(!1===this.isActive())return this.reportError(
"BranchLayout Mode is not Active!"),!1;for(var s=[],h=0,r=t.length;h<r;h++){var n=this.Ni(t[h],!0);n&&s.push(n)}var i=null==i?this.layoutSessionData.compactGraph:i,o=this.tableOperatorObj.removeBranches(s,i);if(o){for(var f=[],h=0,e=o.length;h<e;h++)for(var a=this.changeStateObj.Ii(o[h]),u=0,v=a.length;u<v;u++)f.push(a[u].Si);this.removeConnections(f);for(h=0,e=o.length;h<e;h++)this.changeStateObj.removeNode(o[h].hostNode)}return this.U(),!0},u.prototype.collapseUpAll=function(t,i){if(!1===this.isActive())return this.reportError("BranchLayout Mode is not Active!"),!1;var t=this.Ni(t,!0),i=null==i?this.layoutSessionData.compactGraph:i,s=this.tableOperatorObj.collapseUpAll(t,i);if(s){for(var h=[],r=0,n=s.length;r<n;r++)for(var o=this.changeStateObj.Ii(s[r]),f=0,e=o.length;f<e;f++)h.push(o[f].Si);this.removeConnections(h);for(r=0,n=s.length;r<n;r++)this.changeStateObj.removeNode(s[r].hostNode)}return this.U(),!0},u.prototype.deleteLeafNode=function(t,i){if(!1===this.isActive()
)return this.reportError("BranchLayout Mode is not Active!"),!1;var s=this.Ni(t,!0);if(!this.tableOperatorObj.isLeafNode(s))return this.reportError("BranchLayout.deleteLeafNode only deletes leaf node."),!1;if(!this.tableOperatorObj.deleteLeafNode(s,this.layoutSessionData.compactGraph))return!1;if(!1!==i){for(var h=[],r=this.changeStateObj.Ii(s),n=0,o=r.length;n<o;n++)h.push(r[n].Si);this.removeConnections(h)}return this.changeStateObj.removeNode(t),this.U(),!0},u.prototype.nodeInTable=function(t){return this.changeStateObj.zi(t)},u.prototype.connectionInTable=function(t){return this.changeStateObj.Di(t)},u.prototype.portInTable=function(t){return this.changeStateObj.ji(t)},u.prototype.beginCompoundCommands=function(){this.compoundCommands=!0},u.prototype.endCompoundCommandsAndUpdate=function(){this.compoundCommands=!1,this.U()},u.prototype.U=function(){var t;this.changeStateObj.Mi(),!1===this.compoundCommands&&(t=this.changeStateObj,new o(this.layoutSessionData,t,this.tableOperatorObj)
,t.update(1),t.Ei())},u.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},u.prototype.Ni=function(t,i){return this.changeStateObj.Fi(t,i)},u.prototype.Ri=function(t,i){return this.changeStateObj.Gi(t,i)},t.common.ObjectHelper.rootNamespace=t.common.ObjectHelper.rootNamespace||{};var v=t.common.ObjectHelper.rootNamespace;v.Layout=v.Layout||{},v.Layout.BranchLayout=u;t={};return t.Layout=v.Layout||{},t.Layout.BranchLayout=u,t},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("@diagramming/layoutcore"),require("@diagramming/core")):"function"==typeof define&&define.amd?define(["@diagramming/layoutcore","@diagramming/core"],n):((t=t||self).diagramfoundation=t.diagramfoundation||{},t.diagramfoundation.branchlayout=n(t.diagramfoundation.layoutcore,t.diagramfoundation.core));