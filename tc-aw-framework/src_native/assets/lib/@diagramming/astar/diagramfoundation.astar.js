// @<COPYRIGHT>@
// ==================================================
// Copyright Siemens 2020.
// PL Diagram Foundation 1973.0.1-0
// ==================================================
// @<COPYRIGHT>@
var t,n;t=this,n=function(n){"use strict";function t(t,i){this.reportError=i,this.nodeDist=void 0===t.nodeDist?{x:0,y:0}:t.nodeDist,this.edgeDist=void 0===t.edgeDist?{x:0,y:0}:t.edgeDist,this.zo=void 0===t.zo?{w:0,h:0}:t.zo,this.P1=void 0===t.minSegmentLength?{x:0,y:0}:t.minSegmentLength,this.edgeToNodeDist=void 0===t.edgeToNodeDist?{x:0,y:0}:t.edgeToNodeDist,this.useOriPortPadding=t.useOriPortPadding}function e(t,i){this.reportError=i,this.changeStateObj=t,this.yw={x:10,y:10},this.G1={x:0,y:0},this.P1={x:0,y:0},this.zo={w:0,h:0},this.fx="origin",this.xw=null,this.cx=!1,this.tP=!1}function P(t){this.reportError=t,this.grid=[],this.iP=0,this.nP=0,this.rP=10,this.sP=10}function s(t,i){this.hP=t,this.eP=i,this.open=!1,this.closed=!1,this.index=-1,this.parentNode=null,this.uP=-1,this.oP=0,this.aP=0,this.fP=0}function i(){}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,t.prototype._c=function(){var t=this.edgeDist,i=this.zo,n=this.edgeToNodeDist,r=this.P1
;return this.calcNodePortPaddingForParams(t,i,n,r)},t.prototype.calcNodePortPaddingForParams=function(t,i,n,r){var s=0,h=0;return this.useOriPortPadding&&0===n.x&&0===r.x?s=Math.round(i.w/2/t.x)*t.x+t.x:(s=t.x*Math.max(1,Math.ceil(i.w/2/t.x)))===i.w/2&&(s+=t.x),this.useOriPortPadding&&0===n.y&&0===r.y?h=Math.round(i.h/2/t.y)*t.y+t.y:(h=t.y*Math.max(1,Math.ceil(i.h/2/t.y)))===i.h/2&&(h+=t.y),{x:s,y:h}},t.prototype.nl=function(){var t=this.edgeDist,i=this.edgeToNodeDist,n=this.P1,r=Math.max(n.x,i.x),n=Math.max(n.y,i.y),i=this._c(),r=Math.max(r,i.x),n=Math.max(n,i.y);return{x:Math.max(1,Math.ceil(r/t.x))*t.x,y:Math.max(1,Math.ceil(n/t.y))*t.y}},t.prototype.el=function(){var t=this.edgeDist,i=this.edgeToNodeDist,n=i.x,r=i.y,i=this._c(),n=Math.max(n,i.x),r=Math.max(r,i.y);return{x:Math.max(1,Math.ceil(n/t.x))*t.x,y:Math.max(1,Math.ceil(r/t.y))*t.y}},t.prototype.validSessionDataXY=function(t){var i=this.zo,n={w:i.w,h:i.h},r={x:(i=this.edgeDist).x,y:i.y},s={x:(i=this.nodeDist).x,y:i.y},h={x:(
i=this.P1).x,y:i.y},e={x:(i=this.edgeToNodeDist).x,y:i.y},u={x:(i=this._c()).x,y:i.y},o="x"===t?"w":"h",i="";return r[t]<=0?(this.reportError(i=(i="EdgeToEdge distance must be greater than 0 (zero).")+"\r\nEdgeToEdgeDist = {x:"+r.x+" , y:"+r.y+"}"),!1):n[o]<0?(this.reportError(i=(i="StandardPortSize must be greater than or equal to 0 (zero).")+"\r\nStandardPortSize = {w:"+n.w+" , h:"+n.h+"}"),!1):e[t]<0?(this.reportError(i=(i="Internal error: EdgeToNode must be greater than or equal to 0 (zero).")+"\r\nEdgeToNode = {x:"+e.x+" , y:"+e.y+"}"),!1):h[t]<0?(this.reportError(i=(i="MinSegmentLength must be greater than or equal to 0 (zero).")+"\r\nMinSegmentLength = {x:"+h.x+" , y:"+h.y+"}"),!1):h[t]<e[t]?(this.reportError(i=(i=(i="MinSegmentLength at port must be greater than or equal to EdgeToNode distance.")+"\r\nMinSegmentLength = {x:"+h.x+" , y:"+h.y+"}")+"\r\nEdgeToNodeDist = {x:"+e.x+" , y:"+e.x+"}"),!1):s[t]<2*r[t]?(this.reportError(i=(i=(
i="NodeToNode distance must be greater than or equal to 2 times the EdgeToEdge distance.")+"\r\nNodeToNodeDist = {x:"+s.x+" , y:"+s.y+"}")+"\r\nEdgeToEdgeDist = {x:"+r.x+" , y:"+r.y+"}"),!1):s[t]<2*h[t]?(this.reportError(i=(i=(i="NodeToNode distance must be greater than or equal to 2 times the MinSegmentLength.")+"\r\nNodeToNodeDist = {x:"+s.x+" , y:"+s.y+"}")+"\r\nMinSegmentLength = {x:"+h.x+" , y:"+h.y+"}"),!1):Math.ceil(s[t]/r[t])*r[t]!==s[t]?(this.reportError(i=(i=(i="NodeToNode distance should be a multiple of the EdgeToEdge distance.")+"\r\nNodeToNodeDist = {x:"+s.x+" , y:"+s.y+"}")+"\r\nEdgeToEdgeDist = {x:"+r.x+" , y:"+r.y+"}"),!1):!(s[t]<2*u[t])||(i=(i=(i="NodeToNode distance must be greater than port size.")+"\r\nNodeToNodeDist = {x:"+s.x+" , y:"+s.y+"}")+"\r\nStandardPortSize = {w:"+n.w+" , h:"+n.h+"}",this.reportError(i+="\r\nNodeToNodeDist >= 2 * ( (Math.round((portSize /2) / edgeToEdge) * edgeToEdge) + edgeToEdge )"),!1)},t.prototype.validSessionData=function(){
return this.validSessionDataXY("x")&&this.validSessionDataXY("y")},t.prototype.getValidConfigureXY=function(t){var i="x"===t?"w":"h",n=this.edgeDist[t];n<=0&&(this.reportError("EdgeToEdge distance must be greater than 0 (zero): "+n),n=10);var r=this.zo[i];r<0&&(this.reportError("StandardPortSize must be greater than or equal to 0 (zero)"+r),r=0);var s=this.calcNodePortPaddingForParams({x:n,y:n},{w:r,h:r},this.edgeToNodeDist,this.P1)[t],h=this.edgeToNodeDist[t];h<0&&(this.reportError("Internal error: EdgeToNode must be greater than or equal to 0 (zero)."+h),h=0);var e=this.P1[t];(e=e<0?0:e)<h&&(e=h);i=this.nl()[t],t=this.nodeDist[t];return(t=(t=t<2*n?2*n:t)<2*i?2*i:t)<2*s&&(t=2*s),{e2e:n,Rp:r,G1:h,runOut:e,n2n:t=Math.ceil(t/n)*n}},t.prototype.getValidConfigure=function(){var t=this.getValidConfigureXY("x"),i=this.getValidConfigureXY("y");return{nodeDist:{x:t.n2n,y:i.n2n},edgeDist:{x:t.e2e,y:i.e2e},minSegmentLength:{x:t.runOut,y:i.runOut},edgeToNodeDist:{x:t.G1,y:i.G1},zo:{w:t.Rp,h:i.Rp}
}},t.prototype.lP=function(t){var i=null;switch(t){case"normal":i=this.getValidConfigure();break;case"astar":(i=this.getValidConfigure()).minSegmentLength=this.nl(),i.edgeToNodeDist=this.el();break;case"origin":i={edgeDist:this.edgeDist,edgeToNodeDist:this.edgeToNodeDist,minSegmentLength:this.P1};break;default:this.reportError("Invalid case for config: "+t),i=this.getValidConfigure()}return{yw:i.edgeDist,G1:i.edgeToNodeDist,P1:i.minSegmentLength}},e.prototype.setOptimalConnectionDistance=function(t){this.setEdgeDist(t,t)},e.prototype.setOptimalConnectionToNodeDistance=function(t){this.setEdgeToNodeDist(t,t)},e.prototype.setOptimalPortSegmentLength=function(t){this.setMinRunOut(t,t)},e.prototype.setEdgeDist=function(t,i){var n=this.yw;n.x===t&&n.y===i||(n.x=t,n.y=i,this.cx=!1)},e.prototype.setEdgeToNodeDist=function(t,i){var n=this.G1;n.x===t&&n.y===i||(n.x=t,n.y=i,this.cx=!1)},e.prototype.setMinRunOut=function(t,i){var n=this.P1;n.x===t&&n.y===i||(n.x=t,n.y=i,this.cx=!1)},
e.prototype.setStandardPortSize=function(t,i){var n=this.zo;n.w===t&&n.h===i||(n.w=t,n.h=i,this.cx=!1)},e.prototype.setValidConfigMode=function(t){this.fx!==t&&(this.fx=t,this.cx=!1)},e.prototype.t2=function(t){(this.changeStateObj||this.cx)&&this.reportError("Don't change ChangeState object if it has been set or module has internally initialized."),this.changeStateObj=t,this.cx=!1},e.prototype.cP=function(t){this.tP=t},e.prototype.ll=function(){this.cx||(this.xw=this.vP(this.fx),this.cx=!0)},e.prototype.dP=function(){return this.ll(),this.xw},e.prototype.vP=function(t){return this.gP().lP(t)},e.prototype.gP=function(){return new t({edgeDist:this.yw,edgeToNodeDist:this.G1,minSegmentLength:this.P1,zo:this.zo},this.reportError)},e.prototype.mP=function(){return this.changeStateObj.getAllCsNodes()},e.prototype.bP=function(){return this.changeStateObj.getAllCsConnections()},e.prototype.Zf=function(t){this.tP&&this.reportError(t)},P.prototype.pP=function(t,i,n,r){this.iP=t,this.nP=i,
this.rP=n,this.sP=r},P.prototype.xP=function(t,i){t=this.grid[t];return(t=t&&t[i])||null},P.prototype.yP=function(t,i){var n=void 0,r=this.grid[t];return r?(n=r[i])||(n=new s(t,i),r[i]=n):(n=new s(t,i),(r=[])[i]=n,this.grid[t]=r),n},P.prototype.wP=function(t,i,n){var r=this.grid[t];void 0===r&&(this.grid[t]=r=[]),r[i]=n},P.prototype.MP=function(t,i,n){void 0===this.grid[t]&&(this.grid[t]=[],this.grid[t][i]=null),null===this.grid[t][i]?this.grid[t][i]=n:this.reportError("AStarSearchGrid: request to set a grid cell that is not empty ("+t+", "+i+" )")},P.prototype.kP=function(t,i,n){void 0!==this.grid[t]&&void 0!==this.grid[t][i]?this.grid[t][i]===n?this.grid[t][i]=null:this.reportError("AStarSearchGrid: request to clear an object from a grid cell that does not contain that object ("+t+", "+i+" )"):this.reportError("AStarSearchGrid: request to clear a grid cell that is not defined ("+t+", "+i+" )")},P.prototype.Ug=function(t,i){return{x:this.iP+this.rP*t,y:this.nP+this.sP*i}},
P.prototype.SP=function(t,i){return{x:this.iP+this.rP*t+this.rP,y:this.nP+this.sP*i+this.sP}},P.prototype.PP=function(t,i){return{x:this.iP+this.rP*t,y:this.nP+this.sP*i,w:this.rP,h:this.sP}},P.prototype.TP=function(t,i){t=this.iP+this.rP*t,i=this.nP+this.sP*i;return{x:t+=this.rP/2,y:i+=this.sP/2}},P.prototype.AP=function(t,i){return{x:Math.round((t-this.iP)/this.rP),y:Math.round((i-this.nP)/this.sP)}},i.prototype.getBoxCenter=function(t){return{x:t.x+t.w/2,y:t.y+t.h/2}},i.prototype.getBoundsOfBoxes=function(t){var i=t.length;if(i<1)return null;for(var n,r,s=t[0],h=s.x,e=s.y,u=h+s.w,o=e+s.h,a=1;a<i;++a)(n=(s=t[a]).x)<h&&(h=n),(r=s.y)<e&&(e=r),u<(n+=s.w)&&(u=n),o<(r+=s.h)&&(o=r);return{x:h,y:e,w:u-h,h:o-e}},i.prototype.isPointInBox=function(t,i,n){var r=n.x;if(t<r)return!1;if(r+n.w<t)return!1;t=n.y;return!(i<t)&&!(t+n.h<i)},i.prototype.addBoxPadding=function(t,i){return{x:t.x-i.left,y:t.y-i.top,w:t.w+i.left+i.right,h:t.h+i.top+i.bottom}},i.prototype.getClosestBoxSide=function(t,i,n){
var r=n.x,s=n.y,h=n.w,n=n.h,t=Math.abs(r-t),h=Math.abs(h-t),i=Math.abs(s-i),n=Math.abs(n-i);return t<Math.min(h,i,n)?"left":h<Math.min(i,n)?"right":i<n?"top":"bottom"};var u=new i;function r(t,i){e.call(this,t,i),this.fx="astar",this.zh=null,this.Xw=!1,this.DP=!0,this.NP=new P(i),this.LP=null,this.BP={x:0,y:0},this.EP={x:0,y:0},this.HP={x:1,y:1},this.CP=[],this.VP=null,this.qP=null,this.OP=0,this.zP=0,this.up={x:0,y:-1},this.down={x:0,y:1},this.left={x:-1,y:0},this.right={x:1,y:0},this.RP=[this.up,this.down,this.left,this.right],this._P=10}function h(t,i){this.changeStateObj=t,this.reportError=i,this.G1={x:0,y:0},this.yw={x:0,y:0},this.IP=null}function o(t,i){e.call(this,t,i),this.fx="normal",this.UP=!0}function a(t,i,n,r){this.reportError=r,this.changeNode=t,this.nodeSide=i,this.changePort=n,this.hc()}function f(t,i,n,r,s){a.call(this,t,i,r,s),this.percent=n,this.XP()}function l(t){this.reportError=t,this.YP={up:"top",down:"bottom",left:"left",right:"right"}}function c(t,i,n,r,s,h,e,u
){a.call(this,t,i,e,u),this.perX=n,this.perY=r,this.offX=s,this.offY=h,this.XP()}function v(t,i){this.changeStateObj=t,this.reportError=i}r.prototype.setCellSize=function(t,i){this.setEdgeDist(t,i)},r.prototype.setEdgeToNodeDist=function(t,i){this.reportError("Edge-To-Node distance is not supported in current Astar.")},r.prototype.enableAlignPathEndPoints=function(t){this.Xw!==t&&(this.Xw=t,this.cx=!1)},r.prototype.jP=function(t){this.DP!==t&&(this.DP=t,this.cx=!1)},r.prototype.setRootNode=function(t){this.zh!==t&&(this.zh=t,this.cx=!1)},r.prototype.findPathForNodePoints=function(t,i,n,r,s,h){this.ll(),this.vT(t,r,!1);h=this.findPath(i,n,s,h);return this.vT(t,r,!0),h},r.prototype.findPath=function(t,i,n,r){return this.ll(),this.Mk(t,i,n,r)},r.prototype.Mk=function(t,i,n,r){var s=this.NP,h=s.iP,e=s.nP,u=s.rP,o=s.sP,s=new P(this.reportError);s.pP(h,e,u,o);o=(this.LP=s).AP(t.x,t.y),s=s.AP(n.x,n.y);if(this.FP(i,o),this.FP(r,s),this.GP(o.x,o.y))return this.Zf(
"aStar Path Planning: findPath - from position is out of bounds: "+o.x+","+o.y),null;if(this.GP(s.x,s.y))return this.Zf("aStar Path Planning: findPath - to position is out of bounds: "+s.x+","+s.y),null;if(this.JP(o.x,o.y))return this.Zf("aStar Path Planning: findPath - from position is filled: "+o.x+","+o.y),null;if(this.JP(s.x,s.y))return this.Zf("aStar Path Planning: findPath - to position is filled: "+s.x+","+s.y),null;s.dir=r;s=this.findPathUsingAStar(o,s);return null!==s&&this.KP(s,t,i,n,r),s},r.prototype.findPathUsingAStar=function(t,i){if(this.VP=this.QP(i.x,i.y),this.qP=this.QP(t.x,t.y),this.VP===this.qP)return[];this.OP=t.x,this.zP=t.y;var n=this.VP;n.fP=this.WP(n),n.aP=0,n.oP=n.fP,n.uP=this.ZP(i.dir),this.CP=[n];for(var r=null,s=this.CP;0!==s.length;){if(n=s[0],this.$P(),n.closed=!0,n===this.qP){r=this.buildPath();break}this.qL(n)}return r},r.prototype.buildPath=function(){for(var t,i=[],n=this.qP,r=this.VP,s=-1;n!==r;)s!==(t=n.uP)&&(i.push({x:n.hP,y:n.eP}),s=t),
n=n.parentNode;return i.push({x:r.hP,y:r.eP}),i},r.prototype.ZP=function(t){switch(t){case"up":return 0;case"down":return 1;case"left":return 2;case"right":return 3}return-1},r.prototype.KP=function(t,i,n,r,s){for(var h,e=this.LP,u=t.length,o=0;o<u;++o)h=t[o],h=e.Ug(h.x,h.y),t[o]={x:h.x,y:h.y};this.Xw&&this.UL(t,i,n,r,s),t.unshift({x:i.x,y:i.y}),t.push({x:r.x,y:r.y}),this.fi(t,0)&&t.splice(1,1),this.fi(t,t.length-3)&&t.splice(t.length-2,1)},r.prototype.UL=function(t,i,n,r,s){var h,e,u=t.length;2===u?(h=t[0],e=t[1],h.x===e.x?("up"===n||"down"===n?(h.x=i.x,e.x=i.x):h.y=i.y,e.y=r.y):("up"===n||"down"===n?h.x=i.x:(h.y=i.y,e.y=i.y),e.x=r.x)):2<u&&(h=t[0],e=t[1],h.x===e.x?"up"===n||"down"===n?(h.x=i.x,e.x=i.x):h.y=i.y:"up"===n||"down"===n?h.x=i.x:(h.y=i.y,e.y=i.y),i=t[u-1],u=t[u-2],i.x===u.x?"up"===s||"down"===s?(i.x=r.x,u.x=r.x):i.y=r.y:"up"===s||"down"===s?i.x=r.x:(i.y=r.y,u.y=r.y))},r.prototype.qL=function(t){for(var i,n,r,s=t.aP+this._P,h=t.uP,e=this.RP,u=e.length,o=t.hP,a=t.eP,
f=0;f<u;++f)n=o+(r=e[f]).x,r=a+r.y,this.GP(n,r)||this.JP(n,r)||(i=this.QP(n,r)).closed||(r=s,f!==h&&++r,!1===i.open?(i.parentNode=t,i.uP=f,i.fP=this.WP(i),i.aP=r,i.oP=r+i.fP,this.XL(i)):r===i.aP?(i.parentNode=t,i.uP=f):r<i.aP&&(i.parentNode=t,i.uP=f,i.aP=r,i.oP=r+i.fP,this.YL(i)))},r.prototype.XL=function(t){var i=this.CP,n=i.length;i.push(t);var r,s=t.index=n,h=s-1>>1;for(0===s&&(h=0);i[h].oP>i[s].oP;)r=i[s],i[s]=i[h],i[s].index=s,i[h]=r,h=(s=i[h].index=h)-1>>1,0===s&&(h=0);t.open=!0},r.prototype.YL=function(t){var i,n,r,s=this.CP,h=t.index;if(0!==h)for(n=s[h],r=s[i=h-1>>1];r.oP>n.oP&&(s[h]=r,s[h].index=h,s[i]=n,-1!=(i=(h=s[i].index=i)-1>>1));)n=s[h],r=s[i]},r.prototype.$P=function(){var t=this.CP,i=t.length;if(0!==i)if(1!==i){var n=i-1;if(t[0]=t[n],t[0].index=0,t.pop(),0!=(n-=1)){var r,s,h=1,e=2,u=t[h],o=t[e];if(u)r=!o||u.oP<o.oP?h:e;else{if(!o)return;r=e}for(var a=0;t[a].oP>t[r].oP;){if(s=t[a],t[a]=t[r],t[a].index=a,t[r]=s,(a=t[r].index=r)===n)return;if(u=t[h=(e=a+1<<1)-1],o=t[e],u
)r=!o||u.oP<o.oP?h:e;else{if(!o)return;r=e}}}}else t.pop()},r.prototype.WP=function(t){return(Math.abs(this.OP-t.hP)+Math.abs(this.zP-t.eP))*this._P},r.prototype.FL=function(t,i,n,r){var s=null;return this.GL(t,n,i)&&this.JL(i,r,n)&&((s=[]).push({x:t,y:i}),t!==n&&i!==r&&s.push({x:n,y:i}),s.push({x:n,y:r})),s},r.prototype.KL=function(t,i,n,r){var s=null;return this.GL(t,n,r)&&this.JL(i,r,t)&&((s=[]).push({x:t,y:i}),t!==n&&i!==r&&s.push({x:t,y:r}),s.push({x:n,y:r})),s},r.prototype.GL=function(t,i,n){if(t===i)return!0;var r=t,s=i;i<t&&(r=i,s=t);for(var h=r;h<=s;++h)if(this.JP(h,n))return!1;return!0},r.prototype.JL=function(t,i,n){if(t===i)return!0;var r=t,s=i;i<t&&(r=i,s=t);for(var h=r;h<=s;++h)if(this.JP(n,h))return!1;return!0},r.prototype.FP=function(t,i){switch(t){case"up":i.y-=this.HP.y+1;break;case"down":i.y+=this.HP.y+1;break;case"left":i.x-=this.HP.x+1;break;case"right":i.x+=this.HP.x+1}},r.prototype.QP=function(t,i){return this.LP.yP(t,i)},r.prototype.QL=function(t,i){
return t.x===i.x&&t.y===i.y},r.prototype.GP=function(t,i){var n=this.BP;if(t<n.x)return!0;if(i<n.y)return!0;n=this.EP;return t>n.x||i>n.y},r.prototype.JP=function(t,i){i=this.NP.xP(t,i);return null!==i&&i},r.prototype.fi=function(t,i){if(i<0)return!1;if(i>t.length-3)return!1;var n=t[i],r=t[i+1],i=t[i+2];return n.x===r.x&&n.x===i.x||n.y===r.y&&n.y===i.y},r.prototype.ll=function(){if(!this.cx){e.prototype.ll.call(this);for(var t=this.mP(),i=[],n=0,r=t.length;n<r;++n){var s=t[n];s.ignore||i.push(s)}var h=u.getBoundsOfBoxes(i);this.WL(this.xw,i,h)}},r.prototype.WL=function(t,i,n,r){var s=t.P1,h=t.yw.x,e=t.yw.y;n=n||{x:0,y:0,w:0,h:0},this.DP&&(n=this.ZL(n,h,e));var u=this.HP;u.x=Math.max(Math.ceil(s.x/h)-1,0),u.y=Math.max(Math.ceil(s.y/e)-1,0);var o=n.x-(h*(r=void 0===r?1:r)+u.x*h),t=n.y-(e*r+u.y*e),s=n.x+n.w+(h*r+u.x*h),r=n.y+n.h+(e*r+u.y*e),u=this.NP;u.pP(o,t,h,e),this.BP=u.AP(o,t),this.EP=u.AP(s,r);for(var a=0,f=i.length;a<f;++a)this.sT(i[a],!0)},r.prototype.sT=function(t,i){var n,r,s,h,
e,u;t&&(t.ignore||(n=t.x,r=t.y,s=t.w,h=t.h,u=this.xw.yw,u={x:n-(e=this.HP).x*u.x,y:r-e.y*u.y,w:s+e.x*u.x*2,h:h+e.y*u.y*2},this.$L(u,i),this.setGluePoints(t,!0),this.setPoint(n,r,!0),this.setPoint(n,r+h,!0),this.setPoint(n+s,r,!0),this.setPoint(n+s,r+h,!0),!1!==t.Qh&&(u=t.titleKeepOutArea)&&this.$L({x:t.x+u.x,y:t.y+u.y,w:u.w,h:u.h},!0)))},r.prototype.setGluePoints=function(t,i){for(var n,r,s=this.xw.yw,h=s.x,e=s.y,u=["top","bottom","left","right"],o=u.length,a={x:0,y:0,w:0,h:0},f=0;f<o;++f)for(var l,c=(l=t.gluePointLists[u[f]]).length,v=1;v<c;++v)if(g=l[v]){if(r=g.getPoint(),"attachment"===g.type&&(n=g.changePort)){var d=n.ti;if(d.Jh&&d.Qh&&0<n.w){var g=Math.floor(n.w/2/h)*h,d=Math.floor(n.h/2/e)*e;a.x=r.x-g,a.y=r.y-d,a.w=2*g,a.h=2*d,this.$L(a,i);continue}}this.setPoint(r.x,r.y,i)}},r.prototype.setPoint=function(t,i,n){var r=this.NP,i=r.AP(t,i);r.wP(i.x,i.y,n)},r.prototype.$L=function(t,i){for(var n=this.NP,r=t.x,s=t.y,h=r+t.w,t=s+t.h,s=n.AP(r,s),t=n.AP(h,t),e=s.x,u=s.y,o=t.x,a=t.y,
f=e;f<=o;++f)n.wP(f,u,i),n.wP(f,a,i);for(var l=u+1;l<=a-1;++l)n.wP(e,l,i),n.wP(o,l,i)},r.prototype.tB=function(t,i,n){if(t)for(var r=t.$n;r!==i&&null!==r;)this.sT(r,n),r=r.$n},r.prototype.vT=function(t,i,n){if((t?t.$n:this.zh)===(i?i.$n:this.zh))return null;var r=this.ed(t,i);this.tB(t,r,n),this.tB(i,r,n)},r.prototype.ed=function(t,i){var n=t?t.$n:this.zh,r=i?i.$n:this.zh;if(r===this.zh)return r;for(;null!==n.$n;){for(r=i.$n;null!==r.$n;){if(n===r)return n;r=r.$n}n=n.$n}return n},r.prototype.ZL=function(t,i,n){var r=Math.floor(t.x/i)*i,s=Math.floor(t.y/n)*n;return{x:r,y:s,w:Math.ceil((t.x+t.w)/i)*i-r,h:Math.ceil((t.y+t.h)/n)*n-s}},n.common.ObjectHelper.inherit(r,e),h.prototype.iB=function(t,i){var n=this.G1;n.x=t,n.y=i},h.prototype.rc=function(t,i){var n=this.yw;n.x=t,n.y=i},h.prototype.nB=function(t){this.IP=t},h.prototype.oi=function(t,i,n){return!!this.hi(t,i)||!!this.hi(i,n)},h.prototype.hi=function(t,i){for(var n,r=Math.min(t.x,i.x),s=Math.max(t.x,i.x),h=Math.min(t.y,i.y),
e=Math.max(t.y,i.y),u=this.mP(),o=u.length,a=0;a<o;++a)if(!(n=u[a]).ignore)if(n.T2){if(this.ul(n,r,h,s,e))return!0;if(this.fl(n,r,h,s,e))return!0;if(this.dl(n,r,h,s,e))return!0}else if(this.ui(n,r,h,s,e))return!0;return!1},h.prototype.ui=function(t,i,n,r,s){var h=this.G1,e=this.rB(t),u=h.x,t=e.x-u;if(r<=t)return!1;r=h.y,h=e.y-r;return!(s<=h)&&(!(t+e.w+2*u<=i)&&!(h+e.h+2*r<=n))},h.prototype.dl=function(t,i,n,r,s){for(var h,e,u,o=t.ki,a=o.length,f=0;f<a;++f)if(!(r<(h=(u=o[f]).x)||s<(e=u.y)||h+u.w<i||e+u.h<n))return!0;return!1},h.prototype.fl=function(t,i,n,r,s){var h=t.x,e=t.y;if(this.cl(h,e,i,n,r,s))return!0;var u=e+t.h;if(this.cl(h,u,i,n,r,s))return!0;t=h+t.w;return!!this.cl(t,u,i,n,r,s)||!!this.cl(t,e,i,n,r,s)},h.prototype.ul=function(t,i,n,r,s){var h=t.titleKeepOutArea;if(!h)return!1;var e=this.G1,u=e.x,o=t.x-u;if(r<=o)return!1;e=e.y,e=t.y-e;return!(s<=e)&&(!(o+h.w+2*u<=i)&&!(e+h.h+this.yw.y<=n))},h.prototype.cl=function(t,i,n,r,s,h){return!(t<n)&&(!(i<r)&&(!(s<t)&&!(h<i)))},
h.prototype.wl=function(t,i,n){var r=Math.min(i.x,n.x),s=Math.max(i.x,n.x),h=Math.min(i.y,n.y),n=Math.max(i.y,n.y);return this.cl(t.x,t.y,r,h,s,n)},h.prototype.sB=function(t,i){for(var n=t.x,r=n+t.w,s=t.y,h=s+t.h,e=this.mP(),u=0,o=e.length;u<o;u++){var a=e[u];if(!(i&&0<=i.indexOf(a))&&this.ui(a,n,s,r,h))return!0}return!1},h.prototype.mP=function(){return this.changeStateObj.getAllCsNodes()},h.prototype.bP=function(){return this.changeStateObj.getAllCsConnections()},h.prototype.rB=function(t){var i;switch(this.IP){case"round":i=this.hB(t);break;case"extend":i=this.eB(t);break;default:i={x:t.x,y:t.y,w:t.w,h:t.h},this.IP&&this.reportError("unknown snap grid mode: "+this.IP)}return i},h.prototype.hB=function(t){var i=this.yw.x,n=this.yw.y,r=Math.round(t.x/i)*i,s=Math.round(t.y/n)*n;return{x:r,y:s,w:Math.round((t.x+t.w)/i)*i-r,h:Math.round((t.y+t.h)/n)*n-s}},h.prototype.eB=function(t){var i=this.yw.x,n=this.yw.y,r=Math.floor(t.x/i)*i,s=Math.floor(t.y/n)*n;return{x:r,y:s,w:Math.ceil((t.x+t.w
)/i)*i-r,h:Math.ceil((t.y+t.h)/n)*n-s}},h.prototype.uB=function(t,i,n){var r;switch(this.IP){case"round":r=this.oB(t,i,n);break;case"extend":r=this.aB(t,i,n);break;default:r={x:t.x,y:t.y},this.IP&&this.reportError("unknown snap grid mode: "+this.IP)}return r},h.prototype.oB=function(t,i,n){var r=this.yw.x,s=this.yw.y,h=t.x,e=t.y;if(n)switch(i){case"up":case"down":n||(h=Math.round(h/r)*r),e=Math.round(e/s)*s;break;case"left":case"right":h=Math.round(h/r)*r,n||(e=Math.round(e/s)*s);break;default:this.reportError("unknown extend direction: "+i)}else h=Math.round(h/r)*r,e=Math.round(e/s)*s;return{x:h,y:e}},h.prototype.aB=function(t,i,n){var r=this.yw.x,s=this.yw.y,h=t.x,e=t.y;switch(i){case"up":n||(h=Math.round(h/r)*r),e=Math.floor(e/s)*s;break;case"down":n||(h=Math.round(h/r)*r),e=Math.ceil(e/s)*s;break;case"left":h=Math.floor(h/r)*r,n||(e=Math.round(e/s)*s);break;case"right":h=Math.ceil(h/r)*r,n||(e=Math.round(e/s)*s);break;default:this.reportError("unknown extend direction: "+i)}return{
x:h,y:e}},o.prototype.fB=function(t){this.UP=t},o.prototype.findPathForNodePoints=function(t,i,n,r,s,h,e,u,o){return this.changeStateObj.jl(t,s),this.ll(),this.findPath(i,n,r,h,e,u,o)},o.prototype.findPath=function(t,i,n,r,s,h,e){this.ll();var u=this.al(),o=this.ii(t,i,n),a=this.ii(r,s,h),h=null;if(this.si(o,a)){if(u.hi(o,a))return null;(h=[]).push(t),h.push(o),h.push(a),h.push(r)}else{var f=[];e?"a"===e?f.push(this.ni(o,a,i)):"b"===e?f.push(this.ni(a,o,i)):this.reportError("Unsupported mid point mode: "+e):(f.push(this.ni(o,a,i)),f.push(this.ni(a,o,i)));for(var l=null,c=0,v=f.length;c<v;++c){var d=f[c];if(!u.wl(d,t,o)&&!u.wl(d,r,a)&&!u.oi(o,d,a)){l=d;break}}if(!l)return null;(h=[]).push(t),h.push(o),h.push(l),h.push(a),h.push(r)}return h&&(this.fi(h,0)&&h.splice(1,1),this.fi(h,h.length-3)&&h.splice(h.length-2,1)),h},o.prototype.findPathDeafly=function(t,i,n,r,s,h){this.ll();n=this.ii(t,i,n),s=this.ii(r,s,h),h=null;return this.si(n,s)?((h=[]).push(t),h.push(n)):(i=this.ni(n,s,i),(h=[]
).push(t),h.push(n),h.push(i)),h.push(s),h.push(r),h&&(this.fi(h,0)&&h.splice(1,1),this.fi(h,h.length-3)&&h.splice(h.length-2,1)),h},o.prototype.ll=function(){this.cx||e.prototype.ll.call(this)},o.prototype.ii=function(t,i,n){var r={x:t.x,y:t.y};n=n||0;t=this.dP(),this.yw;return"down"===i?r.y+=t.P1.y+n:"left"===i?r.x-=t.P1.x+n:"right"===i?r.x+=t.P1.x+n:"up"===i&&(r.y-=t.P1.y+n),this.UP&&((n=this.al()).nB("extend"),r=n.uB(r,i,!0)),r},o.prototype.ni=function(t,i,n){t={x:t.x,y:t.y};return"down"===n||"up"===n?t.y=i.y:t.x=i.x,t},o.prototype.si=function(t,i){return t.x===i.x||t.y===i.y},o.prototype.fi=function(t,i){if(i<0)return!1;if(i>t.length-3)return!1;var n=t[i],r=t[i+1],i=t[i+2];return n.x===r.x&&n.x===i.x||n.y===r.y&&n.y===i.y},o.prototype.hi=function(t,i){return this.al().hi(t,i)},o.prototype.al=function(){var t=this.dP(),i=t.G1,n=t.yw,t=new h(this.changeStateObj,this.reportError);return t.iB(i.x,i.y),t.rc(n.x,n.y),t.nB(null),t},n.common.ObjectHelper.inherit(o,e),
a.prototype.hc=function(){this.lB(),this.tl()},a.prototype.lB=function(){var t=this.changePort;t.Hu=this,t.sl===t.ti&&(t.hl=this,t.rl&&t.rl.push(this))},a.prototype.tl=function(){var t=this.ar(),i=this.nodeSide;t.gluePointLists[i].push(this)},a.prototype.pl=function(){this.vl(),this.bl()},a.prototype.bl=function(){var t,i=this.changePort;i&&(i.Hu===this&&(i.Hu=null),i.hl===this&&(i.hl=null),!(t=i.rl)||0<=(i=t.indexOf(this))&&t.splice(i,1))},a.prototype.vl=function(){for(var t=this.ar(),i=this.nodeSide,n=t.gluePointLists[i],r=0,s=n.length;r<s;r++)if(n[r]===this){n.splice(r,1);break}},a.prototype.getPoint=function(){this.reportError("Child class does not implement method.")},a.prototype.setPoint=function(t,i){this.reportError("Child class does not implement method.")},a.prototype.No=function(){return this.getPoint()},a.prototype.XP=function(){var t=this.getPoint(),i=this.changePort;i.x=t.x-i.w/2,i.y=t.y-i.h/2},a.prototype.ar=function(){return this.changeNode},
f.prototype.getPoint=function(){var t=this.ar(),i=t.x,n=t.y;switch(this.nodeSide){case"bottom":i+=this.percent*t.w,n+=t.h;break;case"left":n+=this.percent*t.h;break;case"right":i+=t.w,n+=this.percent*t.h;break;case"top":i+=this.percent*t.w}return{x:i,y:n}},f.prototype.setPoint=function(t,i){var n=this.ar();switch(this.nodeSide){case"bottom":case"top":this.percent=(t-n.x)/n.w;break;case"left":case"right":this.percent=(i-n.y)/n.h}this.XP()},n.common.ObjectHelper.inherit(f,a),l.prototype.cB=function(t){for(var i=0,n=t.length;i<n;i++){var r=t[i];r.ignore||r.Bi&&this.vB(r)}},l.prototype.vB=function(t){var i,n,r,s=t.Bi,h=t.mi,e=t.pi,u=h.Hu,o=e.Hu;u&&o||(i=(n=this.dB(t)).srcSide,n=n.tarSide,u||(u=t.bi,r=this.gB(u,i,s[0]),r=this.mB(u,i,r),this.Eu(u,i,r,h)),o||(t=t.yi,s=this.gB(t,n,s[s.length-1]),r=this.mB(t,n,s),this.Eu(t,n,r,e)))},l.prototype.dB=function(t){var i=t.Bi,n=i.length;if(!i||n<2)return null;t=this.bB(i[0],i[1]),n=this.bB(i[n-1],i[n-2]);return{srcSide:this.YP[t],tarSide:this.YP[n]}}
,l.prototype.bB=function(t,i){var n=i.x-t.x,t=i.y-t.y,t=Math.abs(n)>Math.abs(t)?0<n?"right":"left":0<t?"down":"up";return t},l.prototype.mB=function(t,i,n){var r=.5;switch(i){case"bottom":case"top":r=(n.x-t.x)/t.w;break;case"right":case"left":r=(n.y-t.y)/t.h;break;default:this.reportError("Unsupported node side: "+i)}return r},l.prototype.gB=function(t,i,n){var r;switch(i){case"bottom":r={x:n.x,y:t.y+t.h};break;case"top":r={x:n.x,y:t.y};break;case"right":r={x:t.x+t.w,y:n.y};break;case"left":r={x:t.x,y:n.y};break;default:r={x:n.x,y:t.y+t.h},this.reportError("Unsupported node side: "+i)}return r},l.prototype.Eu=function(t,i,n,r){return new f(t,i,n,r,this.reportError)},c.prototype.getPoint=function(){var t=this.ar();return{x:t.x+t.w*this.perX+this.offX,y:t.y+t.h*this.perY+this.offY}},c.prototype.setPoint=function(t,i){this.reportError("This glue point cannot be moved.")},c.prototype.No=function(){var t=this.getPoint(),i=this.ar(),n=this.nodeSide;return t=this.pB(t,i,n)},
c.prototype.pB=function(t,i,n){var r=t.x,s=t.y;switch(n){case"left":r=i.x;break;case"right":r=i.x+i.w;break;case"bottom":s=i.y+i.h;break;case"top":s=i.y;break;default:this.reportError("Invalid node side: "+n),s=i.y+i.h}return{x:r,y:s}},n.common.ObjectHelper.inherit(c,a),v.prototype.findNodeSideByDevideAnlge=function(t,i){var n=i.x+i.w/2,r=i.y+i.h/2,s=t.x+t.w/2,t=t.y+t.h/2,t=this.xB(n,r,s,t),i=this.yB(i);return this.wB(t,i)},v.prototype.wB=function(t,i){return t>=i[2]&&t<=i[3]?"bottom":t>=i[3]||t<=i[0]?"right":t>=i[0]&&t<=i[1]?"top":"left"},v.prototype.yB=function(t){var i=[0,0,0,0],n=t.x+t.w/2,r=t.y+t.h/2;return i[0]=this.xB(n,r,t.x+t.w,t.y),i[1]=this.xB(n,r,t.x,t.y),i[2]=this.xB(n,r,t.x,t.y+t.h),i[3]=this.xB(n,r,t.x+t.w,t.y+t.h),i},v.prototype.xB=function(t,i,n,r){t=180*Math.atan2(i-r,n-t)/Math.PI;return t<0&&(t+=360),t},v.prototype.Ba=function(t){for(var i=[],n=0,r=t.length;n<r;++n)this.Za(t[n],i);return i},v.prototype.Za=function(t,i){for(var n=t.nodeDist,r=i.length,s=0;s<r;++s)if(
n<i[s].nodeDist)return void i.splice(s,0,t);i.push(t)},v.prototype.MB=function(t,i){var n=t.x+t.w/2,r=t.y+t.h/2,t=i.x+i.w/2,i=i.y+i.h/2;return this.xB(n,r,t,i)},v.prototype.kB=function(t){for(var i=0,n=t.length;i<n;i++)delete t[i].SB},v.prototype.PB=function(t,i){for(var n=[],r=0,s=t.length;r<s;++r){var h=t[r];h.Hu||(h=this.TB(h,i),n.push(h))}return n},v.prototype.TB=function(t,i){var n={changePort:t,conList:this.changeStateObj._i(t)},r=this.AB(n);return n.angle=r.anlge,n.isSource=r.isSource,i||(t.SB=n),n},v.prototype.AB=function(t){var i=0,n=!0,r=t.changePort,s=r.ti;t.conList=this.Ba(t.conList);var h,e=t.conList;return 0<e.length?(t=(h=e[0]).bi,e=h.yi,i=this.MB(s,s===t?e:t),n=h.mi===r):i=-1,{anlge:i,isSource:n}},v.prototype.DB=function(t){var i=t.top,n=t.bottom,r=t.left,t=t.right;n.sort(d),t.sort(m),i.sort(g),r.sort(d)};var d=function(t,i){return t.angle-i.angle},g=function(t,i){return i.angle-t.angle},m=function(t,i){t=t.angle,i=i.angle;return t<180?i<180?i-t:-1:180<i?i-t:1}
;function b(t,i){this.reportError=i,this.changeStateObj=t,this.Au=this.NB(),this.YP={up:"top",down:"bottom",left:"left",right:"right"}}function p(t,i){this.reportError=i,this.changeStateObj=t,this.Au=this.NB(),this.LB=null,this.BB=null,this.Li={top:"up",bottom:"down",left:"left",right:"right"},this.EB=["top","bottom","left","right"]}function x(t,i){this.reportError=i,this.changeStateObj=t,this.Au=this.NB(),this.LB=null,this.BB=null,this.Li={top:"up",bottom:"down",left:"left",right:"right"},this.EB=["top","bottom","left","right"]}function y(t,i){x.call(this,t,i)}function w(t,i){x.call(this,t,i)}function M(t,i){this.reportError=i,this.changeStateObj=t,this.Au=this.NB(),this.EB=["top","bottom","left","right"],this.LB=null,this.HB=!1,this.CB=!1,this.VB="TB"}function k(t,i){this.reportError=i,this.changeStateObj=t,this.UP=!0,this.qB={x:10,y:10},this.OB=null}function S(t,i){this.reportError=i,this.changeStateObj=t,this.zB="pairSides",this.VB="TB",this.UP=!0,this.qB={x:10,y:10},this.BB=null}
function T(t,i){this.p1=t,this.p2=i,this.type="?",t.y===i.y||t.x!==i.x&&Math.abs(t.y-i.y)<Math.abs(t.x-i.x)?this.type="H":this.type="V",this.seg1=null,this.seg2=null,this.gp1=null,this.gp2=null,this.port1=null,this.port2=null,this.node1=null,this.node2=null,this.nodeSide1="",this.nodeSide2=null,this.connection=null,this.moving=!1,this.RB=0,this._B=0}function A(t,i,n){this.r=n,this.IB=t,this.UB=i,this.Op=[],this.Hp=[],this.XB=!0,this.YB=!1,this.yw={x:0,y:0}}v.prototype.jB=function(t){for(var i=[],n=0,r=t.length;n<r;++n){var s=t[n].changePort;i.push(s)}return i},v.prototype.gd=function(t,i){var n=t.y,r=i.y,s=n+t.h,h=r+i.h,e=t.x,u=i.x,t=e+t.w,i=u+i.w;return s<=r?t<=u?"topLeft":i<=e?"topRight":"topOverlap":h<=n?t<=u?"bottomLeft":i<=e?"bottomRight":"bottomOverlap":t<=u?"leftOverlap":"rightOverlap"},v.prototype.FB=function(t,i){var n=t.x+t.w/2,r=t.y+t.h/2,t=i.x+i.w/2,i=i.y+i.h/2;return(t-n)*(t-n)+(i-r)*(i-r)},v.prototype.Ru=function(t,i){var n=this.GB(t,i,.5);return{nodeSide:this.JB(t,i,!n),
isInsideNode:n}},v.prototype.JB=function(t,i,n){var r=t.x+t.w/2,s=t.y+t.h/2,h=this.KB({x:r,y:s},i),s=h[0].side;if(h[0].dist===h[1].dist){for(var e=[],u=h[0].dist,o=0,a=h.length;o<a;o++){var f=h[o];u===f.dist&&e.push(f.side)}(i=n?this.findNodeSideByDevideAnlge(t,i):this.QB(t,i,e))&&(s=i)}return s},v.prototype.QB=function(t,i,n){var r=this.changeStateObj._i(t);if(r.length<1)return null;for(var s=(r=this.Ba(r))[0],r=s.bi,s=s.yi,r=i===r?s:r,h=r.x+r.w/2,e=r.y+r.h/2,u={x:t.x+t.w/2,y:t.y+t.h/2},o=n||["bottom","right","top","left"],a=null,f=0,l=0,c=o.length;l<c;++l){var v=o[l],d=this.adjustPtToBoxSide(u,i,v),d=Math.abs(e-d.y)+Math.abs(h-d.x);(null===a||d<f)&&(a=v,f=d)}return a},v.prototype.KB=function(t,i){var n=t.y-i.y,r=t.y-(i.y+i.h),s=t.x-i.x,i=t.x-(i.x+i.w),i=[{side:"top",dist:Math.abs(n)},{side:"bottom",dist:Math.abs(r)},{side:"left",dist:Math.abs(s)},{side:"right",dist:Math.abs(i)}];return i.sort(function(t,i){return t.dist-i.dist}),i},v.prototype.adjustPtToBoxSide=function(t,i,n){
var r=t.x,s=t.y;switch(n){case"left":r=i.x;break;case"right":r=i.x+i.w;break;case"bottom":s=i.y+i.h;break;case"top":s=i.y;break;default:this.reportError("Invalid node side: "+n),s=i.y+i.h}return{x:r,y:s}},v.prototype.GB=function(t,i,n){var r=this.changeStateObj;if(0===t.w||0===t.h)return r.El({x:t.x,y:t.y},i);var s=void 0===n?0:n,h=t.x-s,n=t.y-s;return!!r.El({x:h,y:n},i)&&(h=t.x+t.w+s,!!r.El({x:h,y:n},i)&&(n=t.y+t.h+s,!!r.El({x:h,y:n},i)&&(h=t.x-s,!!r.El({x:h,y:n},i))))},v.prototype.WB=function(t){for(var i=[],n=t.slice(0);0<n.length;){var r=n.shift();if(!r.ignore){for(var s=r.bi,h=r.yi,e=[r],u=0;u<n.length;){var o=n[u],a=o.bi,f=o.yi;a===s&&f===h||a===h&&f===s?(e.push(o),n.splice(u,1)):u++}1<e.length&&i.push(e)}}return i},b.prototype.assignGpForFixedPortsOnNodes=function(t){for(var i=0,n=t.length;i<n;++i){var r,s=t[i];s.ignore||((r=this.getFloatAndFixedPorts(s.ki).fixedPorts).length<1||this.allocateGpForFixedPorts(r,s))}},b.prototype.allocateGpForFixedPorts=function(t,i){for(var n=0,
r=t.length;n<r;++n)this.allocateGpForOneFixedPort(t[n],i)},b.prototype.allocateGpForOneFixedPort=function(t,i){var n=this.getNodeSideForPort(t,i),r=t.userLoc;this.Eu(i,n,r,t)},b.prototype.getNodeSideForPort=function(t,i){var n=t.qq;return"any"===n?this.Au.Ru(t,i).nodeSide:n},b.prototype.getFloatAndFixedPorts=function(t){for(var i=[],n=[],r=0,s=t.length;r<s;++r){var h=t[r];(!h.isUserLoc||h.Xu?n:i).push(h)}return{floatPorts:n,fixedPorts:i}},b.prototype.Eu=function(t,i,n,r){return new c(t,i,n.perX,n.perY,n.absX,n.absY,r,this.reportError)},b.prototype.NB=function(){return new v(this.changeStateObj,this.reportError)},p.prototype.ZB=function(t){this.LB=t},p.prototype.$B=function(t){this.BB=t},p.prototype.t3=function(t){var i=this.mP();this.i3().assignGpForFixedPortsOnNodes(i);var n=this.bP();this.n3().cB(n),this.r3(n),this.s3(n),this.h3(n),this.Iu(i),this.e3(),this.u3()},p.prototype.s3=function(t){for(var i=0,n=t.length;i<n;i++)(r=t[i]).ignore||this.o3(r);for(var r,i=0,n=t.length;i<n;i++)(
r=t[i]).ignore||this.a3(r)},p.prototype.a3=function(t){var i=t.SB;i&&(i.srcSide&&i.tarSide||(this.f3(t),i.srcSide&&i.tarSide||(this.l3(t),i.srcSide&&i.tarSide||this.reportError("Connection end is not assigned with node side"))))},p.prototype.o3=function(t){var i,n=t.SB;n.srcSide&&n.tarSide||(i=t.mi,t=t.pi,i=i.Hu,t=t.Hu,i=i?i.nodeSide:null,t=t?t.nodeSide:null,n.srcSide||(n.srcSide=i),n.tarSide||(n.tarSide=t))},p.prototype.f3=function(t){var i=t.SB,n=i.srcSide,r=i.tarSide;n&&r||(r=this.c3(i.relativePos),i.candidateSides=r,r=this.v3(t,r),i.srcSide||(i.srcSide=r.side1),i.tarSide||(i.tarSide=r.side2))},p.prototype.l3=function(t){var i=t.SB;i.srcSide&&i.tarSide||((t=i.defaultSides)&&(i.srcSide||(i.srcSide=t.srcSide),i.tarSide||(i.tarSide=t.tarSide)),(t=i.candidateSides[0])&&(i.srcSide||(i.srcSide=t.side1),i.tarSide||(i.tarSide=t.side2)),i.srcSide||(i.srcSide="bottom"),i.tarSide||(i.tarSide="bottom"))},p.prototype.v3=function(t,i){for(var n=t.bi,r=t.yi,s=null,h=null,e=null,u=0,
o=i.length;u<o;u++){var a=i[u],f=a.side1,l=a.side2,c=this.d3(n,f,r,l);if(this.g3(s,c)&&(s=c,h=f,e=l),a.stop&&s)break}return{side1:h,side2:e}},p.prototype.g3=function(t,i){return!!i&&(!t||i.length<t.length)},p.prototype.c3=function(t){var i=[];switch(t){case"topLeft":i=[{side1:"right",side2:"top"},{side1:"bottom",side2:"left"},{side1:"right",side2:"left"},{side1:"bottom",side2:"top"},{side1:"left",side2:"bottom"},{side1:"top",side2:"right"}];break;case"topRight":i=[{side1:"left",side2:"top"},{side1:"bottom",side2:"right"},{side1:"left",side2:"right"},{side1:"bottom",side2:"top"},{side1:"right",side2:"bottom"},{side1:"top",side2:"left"}];break;case"topOverlap":i=[{side1:"bottom",side2:"top"},{side1:"left",side2:"left"},{side1:"right",side2:"right",stop:!0},{side1:"bottom",side2:"left"},{side1:"bottom",side2:"right"},{side1:"top",side2:"bottom"}];break;case"bottomLeft":i=[{side1:"right",side2:"bottom"},{side1:"top",side2:"left"},{side1:"right",side2:"left"},{side1:"top",side2:"bottom"},{
side1:"left",side2:"top"},{side1:"bottom",side2:"right"}];break;case"bottomRight":i=[{side1:"left",side2:"bottom"},{side1:"top",side2:"right"},{side1:"left",side2:"right"},{side1:"top",side2:"bottom"},{side1:"right",side2:"top"},{side1:"bottom",side2:"left"}];break;case"bottomOverlap":i=[{side1:"top",side2:"bottom"},{side1:"left",side2:"left"},{side1:"right",side2:"right",stop:!0},{side1:"top",side2:"left"},{side1:"top",side2:"right"},{side1:"bottom",side2:"top"}];break;case"leftOverlap":i=[{side1:"right",side2:"left"},{side1:"top",side2:"top"},{side1:"bottom",side2:"bottom",stop:!0},{side1:"right",side2:"top"},{side1:"right",side2:"bottom"},{side1:"left",side2:"right"}];break;case"rightOverlap":i=[{side1:"left",side2:"right"},{side1:"top",side2:"top"},{side1:"bottom",side2:"bottom",stop:!0},{side1:"left",side2:"top"},{side1:"left",side2:"bottom"},{side1:"right",side2:"left"}];break;default:this.reportError("Unknown relative postion: "+t)}return i},p.prototype.Iu=function(t){this.m3(t)
;for(var i=0,n=t.length;i<n;i++){var r=t[i];r.ignore||this.b3(r)}},p.prototype.m3=function(t){for(var i,n,r=this.Au,s=0,h=t.length;s<h;s++)(e=t[s]).ignore||e.ki.length<1||(i=this.p3(e),r.DB(i),(n=e.SB)||(e.SB=n={}),n.sideData=i);for(var e,s=0,h=t.length;s<h;s++)(e=t[s]).ignore||this.x3(e)},p.prototype.b3=function(t){if(!(t.ki.length<1)){var i=this.Au,n=t.SB,r=n?n.sideData:null;if(r)for(var s=this.EB,h=0,e=s.length;h<e;++h){var u=s[h],o=r[u],o=i.jB(o);this.y3(t,u,o)}}},p.prototype.p3=function(t){for(var i={top:[],bottom:[],left:[],right:[]},n=t.ki,r=0,s=n.length;r<s;r++){var h=n[r].SB,e=h.nodeSide;e&&i[e].push(h)}return i},p.prototype.d3=function(t,i,n,r){var s=t.w3(i),t=n.w3(r),n=this.Li,i=n[i],r=n[r];return this.BB.findPath(s,i,0,t,r,0)},p.prototype.y3=function(t,i,n){return n.length<1||!this.LB?null:this.LB.y3(t,i,n)},p.prototype.NB=function(){return new v(this.changeStateObj,this.reportError)},p.prototype.n3=function(){return new l(this.reportError)},p.prototype.i3=function(){
return new b(this.changeStateObj,this.reportError)},p.prototype.mP=function(){return this.changeStateObj.getAllCsNodes()},p.prototype.bP=function(){return this.changeStateObj.getAllCsConnections()},p.prototype.x3=function(t){var i=t.SB,n=i?i.sideData:null;if(n)for(var r=this.EB,s=0,h=r.length;s<h;s++)for(var e=n[r[s]].slice(0);0<e.length;){var u,o,a,f,l=e.shift(),c=this.M3(l,e);c&&(u=c.multiDataList1,o=c.multiDataList2,a=c.nodeSide1,f=c.nodeSide2,l=c.csNode1,c=c.csNode2,t===l?this.k3(e,u):this.k3(e,o),l=l.SB,c=c.SB,l=l?l.sideData:null,c=c?c.sideData:null,l&&c&&(a=l[a],f=c[f],this.S3(a,u,f,o)))}},p.prototype.M3=function(t,i){var n=t.conList[0];if(!n)return null;var r=n.bi,s=n.yi,h=n.mi.SB,t=n.pi.SB,e=h?h.nodeSide:null,u=t?t.nodeSide:null;if(!e||!u)return null;for(var o=[h],a=[t],f=0,l=i.length;f<l;f++){var c,v,d,g,m,b=i[f].conList[0];b&&b!==n&&(c=b.bi,v=b.yi,d=b.mi.SB,g=b.pi.SB,m=d?d.nodeSide:null,b=g?g.nodeSide:null,c!==r||v!==s||m!==e||b!==u?c!==s||v!==r||m!==u||b!==e||o.indexOf(g
)<0&&(o.push(g),a.push(d)):o.indexOf(d)<0&&(o.push(d),a.push(g)))}return o.length<2?null:{multiDataList1:o,multiDataList2:a,nodeSide1:e,nodeSide2:u,csNode1:r,csNode2:s}},p.prototype.S3=function(t,i,n,r){if(!(i.length<2||i.length!==r.length)){var s=this.P3(t,i),h=this.P3(n,r);if(!(s<0||h<0)){var e=i[0].conList[0];if(e.SB){var u=this.k3(t,i),o=this.k3(n,r);if(u.length!==i.length||o.length!==r.length)return this.T3(t,u,s),void this.T3(n,o,h);this.A3(e)&&r.reverse(),this.T3(t,i,s),this.T3(n,r,h)}}}},p.prototype.A3=function(t){var i=t.SB;if(!i)return!1;var t=i.srcSide,n=i.tarSide;if(!t||!n)return!1;switch(n<t&&(i=t,t=n,n=i),t){case"bottom":if("bottom"===n)return!0;if("left"===n)return!0;if("right"===n)return!1;if("top"===n)return!1;break;case"left":if("left"===n)return!0;if("right"===n)return!1;if("top"===n)return!1;break;case"right":if("right"===n)return!0;if("top"===n)return!0;break;case"top":if("top"===n)return!0}return!1},p.prototype.D3=function(t){t.sort(function(t,i){t=t.SB,i=i.SB
;return i?t?t.dist-i.dist:1:-1})},p.prototype.r3=function(t){for(var i=0,n=t.length;i<n;i++){var r,s,h,e=t[i];e.ignore||(r=e.bi,s=e.yi,h=this.N3(e),e.SB=h.edgeAttrs,r.SB=h.srcNodeAttrs,s.SB=h.tarNodeAttrs)}this.L3(t)},p.prototype.L3=function(t){var i=this.Au.WB(t);if(!(i.length<1))for(var n=0,r=i.length;n<r;n++){var s=i[n];if(!(s.length<2))for(var h=0,e=s.length;h<e;h++){var u=s[h].SB;u&&(u.multiEdges=s)}}},p.prototype.N3=function(t){var i=t.bi,n=t.yi,r=this.Au,s=r.FB(i,n),h=r.gd(i,n),e=r.MB(i,n),t=e+180;return 360<=t&&(t-=360),{edgeAttrs:{dist:s,relativePos:h,srcAngle:e,tarAngle:t,candidateSides:[],defaultSides:null,srcSide:null,tarSide:null},srcNodeAttrs:{divAngles:r.yB(i)},tarNodeAttrs:{divAngles:r.yB(n)}}},p.prototype.e3=function(){for(var t=this.bP(),i=0,n=t.length;i<n;i++){var r=t[i],s=r.bi,h=r.yi;delete r.SB,s&&delete s.SB,h&&delete h.SB}},p.prototype.h3=function(t){var i=t.slice(0);this.D3(i);for(var n=0,r=i.length;n<r;n++){var s,h,e=i[n];e.ignore||(s=this.B3(e),h=e.mi,e=e.pi,
h.SB||(h.SB=s.srcAttrs),e.SB||(e.SB=s.tarAttrs))}this.E3()},p.prototype.E3=function(){for(var t=this.mP(),i=0,n=t.length;i<n;i++){var r=t[i];if(!r.ignore)for(var s=r.ki,h=0,e=s.length;h<e;h++){var u=s[h];u.SB||(u.SB=this.H3(u),u.nodeSide="bottom")}}},p.prototype.B3=function(t){var i=t.SB,n=t.mi,r=t.pi;return{srcAttrs:{changePort:n,conList:[t],angle:i.srcAngle,nodeSide:i.srcSide,isSource:!0},tarAttrs:{changePort:r,conList:[t],angle:i.tarAngle,nodeSide:i.tarSide,isSource:!1}}},p.prototype.H3=function(t){return{changePort:t,conList:[],angle:-1,nodeSide:null,isSource:!0}},p.prototype.u3=function(){for(var t=this.mP(),i=0,n=t.length;i<n;i++)for(var r=t[i].ki,s=0,h=r.length;s<h;s++)delete r[s].SB},p.prototype.k3=function(t,i){for(var n=[],r=0,s=i.length;r<s;r++){var h=i[r],e=t.indexOf(h);0<=e&&(t.splice(e,1),n.push(h))}return n},p.prototype.T3=function(t,i,n){for(var r=n>t.length-1,s=0,h=i.length;s<h;s++){var e=i[s];r?t.push(e):t.splice(n,0,e),n++}},p.prototype.P3=function(t,i){for(
var n=t.length,r=0,s=i.length;r<s;r++){var h=i[r],h=t.indexOf(h);-1<h&&h<n&&(n=h)}return n=n===t.length?-1:n},x.prototype.ZB=function(t){this.LB=t},x.prototype.$B=function(t){this.BB=t},x.prototype.t3=function(t){var i=this.mP();this.i3().assignGpForFixedPortsOnNodes(i);var n=this.bP();this.n3().cB(n),this.Iu(i)},x.prototype.Iu=function(t){for(var i=this.Au,n=0,r=t.length;n<r;n++)(s=t[n]).ignore||i.PB(s.ki);this.C3(t);for(n=0,r=t.length;n<r;n++)(s=t[n]).ignore||this.b3(s);for(var s,n=0,r=t.length;n<r;n++)(s=t[n]).ignore||i.kB(s.ki)},x.prototype.b3=function(t){if(!(t.ki.length<1)){var i=this.Au,n=this.p3(t),n=this.V3(n);this.q3(t,n),i.DB(n);for(var r=this.EB,s=0,h=r.length;s<h;++s){var e=r[s],u=n[e],u=i.jB(u);this.y3(t,e,u)}}},x.prototype.p3=function(t){for(var i={top:[],bottom:[],left:[],right:[]},n=t.ki,r=0,s=n.length;r<s;r++){var h,e=n[r];e.Hu||(e=(h=e.SB).nodeSide)&&i[e].push(h)}return i},x.prototype.V3=function(t){for(var i={top:[],bottom:[],left:[],right:[]},n=this.EB,r=0,
s=n.length;r<s;r++)for(var h=n[r],e=i[h],u=t[h],o=0,a=u.length;o<a;o++){var f=u[o],l=this.O3(f,h);(l?i[l]:e).push(f)}return this.z3(),i},x.prototype.q3=function(t,i){for(var n=t.ki,r=0,s=n.length;r<s;r++){var h=n[r],e=h.Hu;e&&(e=i[e.nodeSide],h=this.Au.TB(h),e.push(h))}},x.prototype.O3=function(t,i){var n=t.changePort.ti,r=null;if(this.R3(n,i))for(var s=t.angle,h=this._3(i,s,t.isSource),e=0,u=h.length;e<u;e++){var o=h[e];if(!this.R3(n,o)){r=o;break}}return r},x.prototype.R3=function(t,i){var n=t.I3;return void 0===n&&(t.I3=n={}),void 0===n[i]&&(n[i]=this.U3(t,i)),n[i]},x.prototype.z3=function(){for(var t=this.mP(),i=0,n=t.length;i<n;i++)delete t[i].I3},x.prototype.U3=function(t,i){var n=this.BB,t=t.w3(i),i=this.Li[i],t=n.ii(t,i);return n.hi(t,t)},x.prototype._3=function(t,i,n){var r=[];switch(t){case"top":r=90<i&&i<270?["right","left"]:["left","right"],n||r.reverse(),r.push("bottom");break;case"bottom":r=90<i&&i<270?["right","left"]:["left","right"],n||r.reverse(),r.push("top");break
;case"left":r=180<i?["top","bottom"]:["bottom","top"],n||r.reverse(),r.push("right");break;case"right":r=180<i?["bottom","top"]:["top","bottom"],n||r.reverse(),r.push("left");break;default:this.reportError("Unknwon node side: "+t)}return r},x.prototype.y3=function(t,i,n){return n.length<1||!this.LB?null:this.LB.y3(t,i,n)},x.prototype.NB=function(){return new v(this.changeStateObj,this.reportError)},x.prototype.n3=function(){return new l(this.reportError)},x.prototype.i3=function(){return new b(this.changeStateObj,this.reportError)},x.prototype.mP=function(){return this.changeStateObj.getAllCsNodes()},x.prototype.bP=function(){return this.changeStateObj.getAllCsConnections()},y.prototype.C3=function(t){for(var i=0,n=t.length;i<n;i++){var r=t[i];r.ignore||this.X3(r)}},y.prototype.X3=function(t){for(var i=this.Au,n=t.ki,r=i.yB(t),s=0,h=n.length;s<h;++s){var e=n[s],u=e.SB;e.Hu||(u.nodeSide=i.wB(u.angle,r))}},n.common.ObjectHelper.inherit(y,x),w.prototype.C3=function(t){for(
var i=this.changeStateObj,n=[],r=0,s=t.length;r<s;r++){var h=t[r];if(!h.ignore)for(var e=i.Ii(h),u=0,o=e.length;u<o;u++){var a=e[u];a.ignore||n.indexOf(a)<0&&(n.push(a),this.Y3(a))}}},w.prototype.Y3=function(t){var i,n=t.mi,r=t.pi;n.Hu||((n=n.SB).nodeSide||(i=i||this.j3(t),n.nodeSide=i.side1)),r.Hu||((r=r.SB).nodeSide||(i=i||this.j3(t),r.nodeSide=i.side2))},w.prototype.j3=function(t){for(var i=t.bi,n=t.yi,r=this.Li,s=this.BB,h=this.c3(i,n),e=h[0].side1,u=h[0].side2,o=0,a=h.length;o<a;o++){var f=h[o],l=f.side1,c=f.side2,v=i.w3(l),d=n.w3(c),g=r[l],f=r[c];if(s.findPath(v,g,0,d,f,0,"a")){e=l,u=c;break}}return{side1:e,side2:u}},w.prototype.c3=function(t,i){var n=[{side1:"bottom",side2:"top"}],r=this.Au.gd(t,i);switch(r){case"topLeft":n=[{side1:"right",side2:"top"},{side1:"bottom",side2:"left"}];break;case"topRight":n=[{side1:"left",side2:"top"},{side1:"bottom",side2:"right"}];break;case"bottomLeft":n=[{side1:"top",side2:"left"},{side1:"right",side2:"bottom"}];break;case"bottomRight":n=[{
side1:"top",side2:"right"},{side1:"left",side2:"bottom"}];break;case"topOverlap":n=[{side1:"bottom",side2:"top"}];break;case"bottomOverlap":n=[{side1:"top",side2:"bottom"}];break;case"leftOverlap":n=[{side1:"right",side2:"left"}];break;case"rightOverlap":n=[{side1:"left",side2:"right"}];break;default:this.reportError("Unknown relative postion: "+r)}return n},n.common.ObjectHelper.inherit(w,x),M.prototype.ZB=function(t){this.LB=t},M.prototype.F3=function(t){this.VB=t},M.prototype.t3=function(t){var i=this.mP();this.Iu(i)},M.prototype.Iu=function(t){this.markAllSourceTargetPorts(this.bP());for(var i=0,n=t.length;i<n;++i){var r=t[i];r.ignore||this.b3(r)}this.clearAllTempProperties()},M.prototype.b3=function(t){var i,n,r,s,h,e,u,o=this.Au,a=o.PB(t.ki,!0),f=o.jB(a);f.length<1||(e=(h=this.dividePortsOnNode(f)).sourcePorts,u=h.targetPorts,i=h.unconnectedPorts,n=h.selfSrcPorts,r=h.selfTarPorts,s=h.cpOnParentSrcPorts,o=h.cpOnParentTarPorts,a=h.cpOnChildSrcPorts,f=h.cpOnChildTarPorts,
h=this.getPairNodeSides(this.VB),e=e.concat(o).concat(a),u=u.concat(s).concat(f),e=(f=this.sortSourcePorts(t,e,u,h.nodeSide1,h.nodeSide2)).sourcePorts,u=f.targetPorts,e=(e=i.concat(e)).concat(n),u=u.concat(r),this.HB?this.Ku(t,e,h.nodeSide1):this.y3(t,h.nodeSide1,e),this.CB?this.Ku(t,u,h.nodeSide2):this.y3(t,h.nodeSide2,u))},M.prototype.markAllSourceTargetPorts=function(t){for(var i=this.Au.Ba(t),n=0,r=i.length;n<r;++n){var s=i[n],h=s.mi,e=s.pi;h&&e&&(h.Ju||(h.Ju={port:h,isSrc:!0,conn:s,connInx:n,pairNode:s.yi}),e.Ju||(e.Ju={port:e,isSrc:!1,conn:s,connInx:n,pairNode:s.bi}))}},M.prototype.clearAllTempProperties=function(){for(var t=this.bP(),i=0,n=t.length;i<n;++i){var r=t[i],s=r.mi,r=r.pi;s&&r&&(delete s.Ju,delete r.Ju)}},M.prototype.dividePortsOnNode=function(t){var i=[],n=[],r=[],s=[],h=[],e=[],u=[],o=[],a=[];t.sort(function(t,i){t=t.Ju,i=i.Ju;return t&&i?t.connInx-i.connInx:-1});for(var f=t.length,l=0;l<f;++l){var c,v=t[l],d=v.Ju;(d?(c=d.conn
).Qu?d.isSrc?s:h:c.Wu?d.isSrc?c.Zu?e:o:c.$u?u:a:d.isSrc?i:n:r).push(v)}return{sourcePorts:i,targetPorts:n,unconnectedPorts:r,selfSrcPorts:s,selfTarPorts:h,cpOnParentSrcPorts:e,cpOnParentTarPorts:u,cpOnChildSrcPorts:o,cpOnChildTarPorts:a}},M.prototype.sortSourcePorts=function(t,i,n,r,s){var h,e,u,o=this.Au;return(2<i.length||2<n.length)&&(h=o.PB(i),e=o.PB(n),(u={top:[],bottom:[],left:[],right:[]})[r]=h,u[s]=e,o.DB(u),i=o.jB(h),n=o.jB(e)),{sourcePorts:i,targetPorts:n}},M.prototype.getPairNodeSides=function(t){var i="bottom",n="top";switch(t){case"TB":i="bottom",n="top";break;case"BT":i="top",n="bottom";break;case"LR":i="right",n="left";break;case"RL":i="left",n="right";break;default:this.reportError("unknown direction: "+t)}return{nodeSide1:i,nodeSide2:n}},M.prototype.Ku=function(t,i,n){i.length<1||this.reportError("It is not implemented for share ports")},M.prototype.y3=function(t,i,n){return this.LB?this.LB.y3(t,i,n):null},M.prototype.NB=function(){return new v(this.changeStateObj,
this.reportError)},M.prototype.mP=function(){return this.changeStateObj.getAllCsNodes()},M.prototype.bP=function(){return this.changeStateObj.getAllCsConnections()},k.prototype.fB=function(t){this.UP=t},k.prototype.G3=function(t,i){this.qB.x=t,this.qB.y=i},k.prototype.J3=function(t){this.OB=t},k.prototype.y3=function(t,i,n){var r,s,h;n.length<1||(0<(h=(s=t[r="bottom"===i||"top"===i?"w":"h"])-this.getAllPortProjectLen(n,r))?this.K3(n,t,i,h,r):this.Q3(n,t,i,s,r))},k.prototype.getAllPortProjectLen=function(t,i){for(var n=0,r=0,s=t.length;r<s;++r){var h=t[r];h.Xu||(n+=h[i])}return n},k.prototype.K3=function(t,i,n,r,s){var h="w"===s?"x":"y",e=this.qB[h],u=this.UP,o=i[s];r/(t.length+1)<e&&(u=!1),this.Zs(t)?this.W3(t,i,n,o,h,e,u):this.Z3(t,i,n,o,s,r,e,u)},k.prototype.Z3=function(t,i,n,r,s,h,e,u){for(var o=i["w"===s?"x":"y"],a=0,f=0,l=0,c=t.length,v=h,d=0,g=t.length;d<g;++d){var m=t[d],b=m.Xu?0:m[s];f=l+a/2+v/(c+1)+b/2,u&&(f=Math.round((o+f)/e)*e-o),this.Eu(i,n,f/r,m),v-=f-l-(a/2+b/2),--c,a=b,
l=f}},k.prototype.W3=function(t,i,n,r,s,h,e){this.tH(t,i,n,r,s,h,e,!1)},k.prototype.tH=function(t,i,n,r,s,h,e,u){for(var o=this.iH(i,t,s,u),a=0,f=t.length;a<f;a++){var l=t[a];if(!l.Hu)for(var c=this.nH(l,t,o,h),v=this.rH(l,t),d=0,g=v.length;d<g;d++){var m,b=v[d],p=v.length;c?(m=c.pos1+(c.pos2-c.pos1)/(p+1)*(d+1),e&&1===p&&(m=Math.round(m/h)*h)):m=i[s]+r/(f+1)*(d+1);p=m-i[s];this.Eu(i,n,p/r,b),o=this.sH(o,b,s,u)}}},k.prototype.Q3=function(t,i,n,r,s){var h,e;this.Zs(t)?(h=this.qB[e],this.hH(t,i,n,r,e="w"===s?"x":"y",h)):this.eH(t,i,n,r)},k.prototype.eH=function(t,i,n,r){for(var s=r/(t.length+1),h=s,e=0,u=t.length;e<u;++e){var o=t[e];o.Hu||this.Eu(i,n,h/r,o),h+=s}},k.prototype.hH=function(t,i,n,r,s,h){this.tH(t,i,n,r,s,h,!1,!0)},k.prototype.nH=function(t,i,n,r){if(n.length<1)return null;for(var s=i.indexOf(t),h=n.length-1,e=0,u=n.length;e<u;e++){var o=n[e].port2,o=i.indexOf(o);if(0<=o&&s<=o){h=e;break}}var t=n[h],a=t.pos2-t.pos1;if(Math.floor(a/r)<2){for(var f=-1,l=0,c=-1,e=0,
u=n.length;e<u;e++){var v=h-e-1;if(0<=v){a=(d=n[v]).pos2-d.pos1;if(2<=Math.floor(a/r)){f=v;break}l<a&&(l=a,c=v)}if((v=h+e+1)<u){var d,a=(d=n[v]).pos2-d.pos1;if(2<=Math.floor(a/r)){f=v;break}l<a&&(l=a,c=v)}}h=f=f<-1?c:f}return n[h]},k.prototype.iH=function(t,i,n,r){for(var s=t[n],h=[{pos1:s,pos2:s+t["x"===n?"w":"h"],port1:null,port2:null}],e=0,u=i.length;e<u;e++){var o=i[e];o.Hu&&(h=this.sH(h,o,n,r))}return h},k.prototype.uH=function(t,i,n,r){t=t.Xu?0:t["x"===n?"w":"h"];return{min:i[n]-(t=r?0:t)/2,max:i[n]+t/2}},k.prototype.sH=function(t,i,n,r){var s=i.Hu.getPoint(),r=this.uH(i,s,n,r);return this.oH(t,r.min,r.max,i)},k.prototype.oH=function(t,i,n,r){for(var s=[],h=0,e=t.length;h<e;h++){var u=t[h],o=u.pos1,a=u.pos2;a<=i||n<=o?s.push(u):i<o&&a<n||(o<i&&s.push({pos1:o,pos2:i,port1:u.port1,port2:r}),n<a&&s.push({pos1:n,pos2:a,port1:r,port2:u.port2}))}return s},k.prototype.rH=function(t,i){var n=[],r=t.SB,r=r?r.conList[0]:null;if(r){var r=r.SB,s=r?r.multiEdges:null;if(s&&1<s.length){for(
var h=[],e=0,u=s.length;e<u;e++){var o=s[e];o.ignore||(h.push(o.mi),h.push(o.pi))}for(var a=0,f=i.length;a<f;a++){var l=i[a];l.Hu||0<=h.indexOf(l)&&n.push(l)}}}return n=n.length<1||n.indexOf(t)<0?[t]:n},k.prototype.Zs=function(t){for(var i=0,n=t.length;i<n;i++)if(t[i].Hu)return!0;return!1},k.prototype.Eu=function(t,i,n,r){var s=null;return s=this.OB?this.OB.Eu({changeNode:t,nodeSide:i,percent:n,changePort:r}):s},S.prototype.aH=function(t){this.zB=t},S.prototype.F3=function(t){this.VB=t},S.prototype.fB=function(t){this.UP=t},S.prototype.G3=function(t,i){this.qB.x=t,this.qB.y=i},S.prototype.$B=function(t){this.BB=t},S.prototype.t3=function(t){this.fH(this.zB).t3(t)},S.prototype.fH=function(t){var i=null;switch(t){case"pairSides":i=this.lH();break;case"relativeAngle":i=this.cH();break;case"relativePos":i=this.vH();break;case"layoutDirection":i=this.dH();break;default:this.reportError("Unsupported allocator type: "+t)}return i},S.prototype.vH=function(){var t=this.gH(),i=new w(
this.changeStateObj,this.reportError);return i.ZB(t),i.$B(this.BB),i},S.prototype.cH=function(){var t=this.gH(),i=new y(this.changeStateObj,this.reportError);return i.ZB(t),i.$B(this.BB),i},S.prototype.lH=function(){var t=this.gH(),i=new p(this.changeStateObj,this.reportError);return i.ZB(t),i.$B(this.BB),i},S.prototype.dH=function(){var t=this.gH(),i=new M(this.changeStateObj,this.reportError);return i.ZB(t),i.F3(this.VB),i},S.prototype.gH=function(){var t=new k(this.changeStateObj,this.reportError);return t.fB(this.UP),t.G3(this.qB.x,this.qB.y),t.J3(this),t},S.prototype.Eu=function(t){return new f(t.changeNode,t.nodeSide,t.percent,t.changePort,this.reportError)},T.prototype.ew=function(){return"H"===this.type?this.p1.y:this.p1.x},T.prototype.lw=function(t){var i="y";"V"===this.type&&(i="x");var n=this.p1[i];this.p1[i]=t,this.p2[i]=t;i=this.connection;i&&void 0!==i.CT&&(i.CT=t!==n)},T.prototype.Wp=function(t,i,n,r){var s,h,e,u,o=this;return o.ew()===i&&(o.type===t&&(r="H"===t?(
s=o.p1.x,h=o.p2.x,e=n.x,r.x):(s=o.p1.y,h=o.p2.y,e=n.y,r.y),h<s&&(u=s,s=h,h=u),r<e&&(u=e,e=r,r=u),!(h<e)&&!(r<s)))},T.prototype.mH=function(t){return this!==t&&this.Wp(t.type,t.ew(),t.p1,t.p2)},T.prototype.bH=function(t){for(var i,n=t.length,r=0;r<n;++r)if(i=t[r],this.mH(i))return!0;return!1},T.prototype.pH=function(t){if(this.type!==t.type)return 0;if(!1===this.mH(t))return 0;var i=this.xH(t),t=t.xH(this);return t<i?1:i<t?-1:0},T.prototype.yH=function(t){var i,n,r,s="H"===this.type?(i=this.p1.x,n=this.p2.x,r=t.p1.x,t.p2.x):(i=this.p1.y,n=this.p2.y,r=t.p1.y,t.p2.y);s<r&&(h=r,r=s,s=h);var t=0,h=0;return this.wH(i,r,s)&&(0<this.RB?++t:this.RB<0&&++h),this.wH(n,r,s)&&(0<this._B?++t:this._B<0&&++h),{belowCrossovers:h,aboveCrossovers:t}},T.prototype.xH=function(t){var i=this.yH(t),t=i.aboveCrossovers;return i.belowCrossovers-t},T.prototype.wH=function(t,i,n){return!(t<i)&&!(n<t)},T.prototype.MH=function(){return T.MH(this.type,this.p1,this.p2)},T.prototype.kH=function(t){if(
this.type===t.type)return!1;var i=this,n=t,r=i.MH(),s=n.ew();return!(s<=r.min||s>=r.max)&&(n=this,r=(i=t).MH(),!((s=n.ew())<=r.min||s>=r.max))},T.MH=function(t,i,n){var r="x",s=i[r="V"===t?"y":r],t=n[r];return t<s&&(s=n[r],t=i[r]),{min:s,max:t}},A.prototype.Oa=function(){for(var t=this.IB,i=this.UB,n=0,r=t?t.length:0;n<r;n++){var s=t[n],h=s.pi,e=s.mi,h=h?h.Hu:null,e=e?e.Hu:null;delete s.SH,h&&delete h.segList,e&&delete e.segList}for(n=0,r=i?i.length:0;n<r;n++){var u=i[n];delete u.segList,delete u.inGroupNodeSegList}},A.prototype.PH=function(t,i){for(var n=0,r=t.length;n<r;n++)this.TH(t[n]);for(var s=i?i.length:0,h=0;h<s;++h)this.AH(i[h])},A.prototype.AH=function(t){t.segList=[],t.Qh&&(t.inGroupNodeSegList={H:[],V:[]}),t.moving=!1},A.prototype.TH=function(t){t.SH=[];var i=t.pi,i=i?i.Hu:null;i&&this.DH(i);t=t.mi,t=t?t.Hu:null;t&&this.DH(t)},A.prototype.DH=function(t){t.segList=[],t.moving=!1},A.prototype.oc=function(t){return"H"===t?this.Op:this.Hp},A.prototype.sc=function(t){this.YB=t},
A.prototype.rc=function(t,i){this.yw.x=t,this.yw.y=i},A.prototype.hc=function(){var t=this.IB,i=this.UB;if(t){this.PH(t,i),this.YB&&this.NH();for(var n=0,r=t.length;n<r;n++){var s=t[n];s.ignore||this.LH(s)}}},A.prototype.LH=function(t){t=this.BH(t.Bi,t,this.UB);return t&&(this.Op=this.Op.concat(t.hPathSegList),this.Hp=this.Hp.concat(t.vPathSegList)),t},A.prototype.BH=function(t,i,n){if(!t)return null;var r=t.length;if(r<2)return null;for(var s=r-1,h=null,e=i?i.mi:null,u=i?i.pi:null,o=e?e.Hu:null,a=u?u.Hu:null,f=o?o.nodeSide:null,l=a?a.nodeSide:null,c=i?i.bi:null,v=i?i.yi:null,d=[],g=[],m=[],b=0;b<s;++b){var p=t[b],x=t[b+1];p.moving=!1,x.moving=!1;var y=new T(p,x);p.x===x.x&&p.y===x.y&&h&&(y.type="V"===h.type?"H":"V"),("V"===y.type?g:m).push(y),d.push(y),y.connection=i,0===b&&(y.gp1=o,y.port1=e,y.node1=c,y.nodeSide1=f,c&&c.segList&&c.segList.push(y),o&&o.segList.push(y)),b+1===s&&(y.gp2=a,y.port2=u,y.node2=v,y.nodeSide2=l,v&&v.segList&&v.segList.push(y),a&&a.segList.push(y)),(y.seg1=h
)&&(h.seg2=y),h=y}for(var w=0,M=g.length;w<M;w++){y=g[w];this.EH(y.seg1,y,y.seg2)}for(w=0,M=m.length;w<M;w++){y=m[w];this.EH(y.seg1,y,y.seg2)}return i&&(i.SH=d,n&&this.HH(d,n)),{edgeSegList:d,vPathSegList:g,hPathSegList:m}},A.prototype.EH=function(t,i,n){null!==i&&(i.RB=null===t?0:this.getDirection(i.p1,t.p1),i._B=null===n?0:this.getDirection(i.p2,n.p2))},A.prototype.getDirection=function(t,i){var n=t.x,r=t.y,t=i.x,i=i.y,n=n===t?i-r:t-n;return 0<n?1:-1},A.prototype.HH=function(t,i){if(i&&!(i.length<1))for(var n=0,r=t.length;n<r;n++){var s=t[n];this.CH(s,i)}},A.prototype.CH=function(t,i){for(var n,r,s=t.type,h=i.length,e=0;e<h;++e)(r=i[e]).ignore||r.Jh&&r.Qh&&(n={x:r.x,y:r.y,w:r.w,h:r.h},this.VH(t,r,n)&&(r.inGroupNodeSegList[s].push(t),t.inGroup=r))},A.prototype.VH=function(t,i,n){if(t.node1===i)return!1;if(t.node2===i)return!1;i=t.p1,t=t.p2;return!!u.isPointInBox(i.x,i.y,n)||!!u.isPointInBox(t.x,t.y,n)},A.prototype.qH=function(t){var i=this.Op,n=this.Hp,r=t.mi,s=t.pi,h=r?r.Hu:null,
e=s?s.Hu:null,r=t.bi,s=t.yi,u=h?h.segList:null,o=e?e.segList:null,a=r?r.segList:null,f=s?s.segList:null,l=t.SH;t.SH=[];for(var c=0,v=l.length;c<v;c++){var d=l[c],g=d.type;L("H"===g?i:n,d),L(u,d),L(o,d),L(a,d),L(f,d);var m=d.inGroup,m=m?m.inGroupNodeSegList:null;m&&L(m[g],d)}},A.prototype.OH=function(t,i,n,r){return this.zH(t,i,n,r)+this.RH(t,i,n,r)},A.prototype._H=function(t,i){return this.IH(t,i)+this.UH(t,i)},A.prototype.zH=function(t,i,n,r){i=i?this.XH(i):t.SH,r=r?this.XH(r):n.SH;return this.IH(i,[t,n])+this.IH(r,[t,n])+this.YH(i,r)},A.prototype.IH=function(t,i){if(!t)return 0;for(var n=[],r=[],s=0,h=t.length;s<h;s++){var e=t[s];("H"===e.type?n:r).push(e)}return this.YH(n,this.Hp,i)+this.YH(r,this.Op,i)},A.prototype.YH=function(t,i,n){for(var r=0,s=0,h=t.length;s<h;s++){var e=t[s];r+=this.jH(e,i,n)}return r},A.prototype.jH=function(t,i,n){for(var r=0,s=0,h=i.length;s<h;s++){var e=i[s];n&&e.connection&&0<=n.indexOf(e.connection)||t.kH(e)&&r++}return r},A.prototype.RH=function(t,i,n,r
){i=i?this.XH(i):t.SH,r=r?this.XH(r):n.SH;return this.UH(i,[t,n])+this.UH(r,[t,n])+this.FH(i,r)},A.prototype.UH=function(t,i){if(!t)return 0;for(var n=[],r=[],s=0,h=t.length;s<h;s++){var e=t[s];("H"===e.type?n:r).push(e)}return this.FH(n,this.Op,i)+this.FH(r,this.Hp,i)},A.prototype.FH=function(t,i,n){for(var r=0,s=0,h=t.length;s<h;s++){var e=t[s];r+=this.GH(e,i,n)}return r},A.prototype.GH=function(t,i,n){for(var r=0,s=0,h=i.length;s<h;s++){var e=i[s];n&&e.connection&&0<=n.indexOf(e.connection)||t.mH(e)&&(r++,this.XB&&(e=t.yH(e),r+=Math.min(e.aboveCrossovers,e.belowCrossovers)))}return r},A.prototype.XH=function(t){t=this.BH(t,null,null);return t?t.edgeSegList:[]},A.prototype.NH=function(){var t=this.JH();this.KH(t)},A.prototype.JH=function(){for(var t=[],i=this.IB,n=i.slice(0),r=0,s=i?i.length:0;r<s;r++){var h=i[r],h=this.QH(h,n);h&&t.push(h)}return t},A.prototype.KH=function(t){for(var i=0,n=t.length;i<n;i++)for(var r,s=t[i],h=Math.ceil(s.length/2),e=0,u=s.length;e<u;e++)0!==e&&(
r=s[e],this.WH(r,e+1<h?-1:1))},A.prototype.QH=function(t,i){for(var n=null,r=0;r<i.length;){var s=i[r];s!==t?this.ZH(s,t)?((n=n||[t]).push(s),i.splice(r,1)):r++:i.splice(r,1)}return n},A.prototype.ZH=function(t,i){var n=!1,r=t.Bi,s=i.Bi;if(!r||r.length<1||!s||s.length<1)return n;if(3<r.length||3<s.length)return n;if(r.length!==s.length)return n;r=t.mi,s=t.pi,t=i.mi,i=i.pi;return n=r===t&&s===i||r===i&&s===t?!0:n},A.prototype.WH=function(t,i){var n=t.Bi;2===n.length?this.$H(t,i):3===n.length&&this.tV(t,i)},A.prototype.$H=function(t,i){var n,r,s,h=t.Bi;2===h.length&&(s=this.yw,n=h[0],r=h[1],n=(t=this.iV(n,r,s,s))?t.newPtA:null,r=t?t.newPtB:null,n&&r&&(s={x:n.x,y:n.y},t={x:r.x,y:r.y},h.splice(1,0,n,s,t,r)))},A.prototype.tV=function(t,i){var n,r,s,h=t.Bi;3===h.length&&(n=this.yw,s=h[0],r=h[2],t=h[1],s=this.iV(s,t,n,null),r=this.iV(t,r,null,n),n=s?s.newPtA:null,(s=r?r.newPtB:null)&&(r={x:s.x,y:s.y},h.splice(2,0,r,s)),n&&(s={x:n.x,y:n.y},h.splice(1,0,n,s)))},A.prototype.iV=function(t,i,n,r){
n=n||{x:0,y:0},r=r||{x:0,y:0};var s,h=null,e=null;return t.x===i.x?t.y<i.y?(s=D(t.y,i.y,n.y,-r.y))&&(h={x:t.x,y:s.newPosA},e={x:i.x,y:s.newPosB}):t.y>i.y&&(s=D(t.y,i.y,-n.y,r.y))&&(h={x:t.x,y:s.newPosA},e={x:i.x,y:s.newPosB}):t.y===i.y&&(t.x<i.x?(s=D(t.x,i.x,n.x,-r.x))&&(h={x:s.newPosA,y:t.y},e={x:s.newPosB,y:i.y}):t.x>i.x&&(s=D(t.x,i.x,-n.x,r.x))&&(h={x:s.newPosA,y:t.y},e={x:s.newPosB,y:i.y})),h&&e?{newPtA:h,newPtB:e}:null};var D=function(t,i,n,r){var s=N(t+n,Math.abs(n),0<n),h=N(i+r,Math.abs(r),0<r);return(i<t&&s<h||t<i&&h<s)&&(s=t+n,h=i+r),i<t&&s<h||t<i&&h<s?null:{newPosA:s,newPosB:h}},N=function(t,i,n){return 0===i?t:n?Math.ceil(t/i)*i:Math.floor(t/i)*i},L=function(t,i){if(!t)return-1;i=t.indexOf(i);return 0<=i&&t.splice(i,1),i};function B(){}function E(t,i,n){this.nV=t,this.rV=i,this.sV=n}function H(t,i){this.changeStateObj=t,this.reportError=i,this.BB=null,this.hV=null}function C(t,i){H.call(this,t,i),this.EB=["top","bottom","left","right"]}function V(t,i){C.call(this,t,i),
this.eV=null}function q(t,i){this.changeStateObj=t,this.reportError=i,this.yw={x:10,y:10},this.eV=null}function O(t,i,n){this.reportError=n,this.rows=[],this.uV=[],this.R2=i,this.oV(t)}function z(t,i){e.call(this,t,i),this.fx="normal",this.aV=t?t.getAllCsNodes():void 0,this.fV=t?t.getAllCsConnections():void 0,this.Op=null,this.Hp=null,this._1=null,this.W1=null,this.lV=!1,this.Rw=!1,this.YB=!1,this.cV={right:"left",left:"right",top:"bottom",bottom:"top"}}function R(t,i){e.call(this,t,i),this.fx="normal",this.vV=null}function _(t,i){e.call(this,t,i),this.fx="astar",this.lc=!0,this.rV=null,this.nV=null,this.Xw=!0,this.UP=!0,this.dV=!0,this.gV=!0,this.mV=!1,this.bV=!0,this.zB="pairSides",this.VB="TB",this.Li={top:"up",bottom:"down",left:"left",right:"right"}}B.M2=function(t,i){return t.getPortBehavior?t.getPortBehavior(i):!t.isPortFloating||t.isPortFloating(i)?"layoutAllocatedPortFloat":"layoutAllocatedPortStatic"},E.prototype.pV=function(t,i,n,r,s,h,e){var u=this.nV,o=this.rV,a=this.sV,
f=null,l=null;return!f&&u&&(e&&"simpleA"!==e||(f=u.findPathForNodePoints(t,i,n,0,r,s,h,0,"a"))&&(l="simpleA")),!f&&u&&(e&&"simpleB"!==e||(f=u.findPathForNodePoints(t,i,n,0,r,s,h,0,"b"))&&(l="simpleB")),!f&&o&&(e&&"aStar"!==e||(f=o.findPathForNodePoints(t,i,n,r,s,h))&&(l="aStar")),!f&&a&&(e&&"simpleDeafly"!==e||(f=a.findPathDeafly(i,n,0,s,h,0),l="simpleDeafly")),{pathXY:f,routeInfo:{sourceNode:t,targetNode:r,p1:i,p2:s,p1Dir:n,p2Dir:h,routeMode:l}}},B.xV=E,H.prototype.$B=function(t){this.BB=t},H.prototype.ll=function(){this.yV(),this.hV=this.wV()},H.prototype.Oa=function(){this.hV.Oa(),this.MV()},H.prototype.kV=function(t){this.ll();for(var i=0,n=t.length;i<n;i++){var r=t[i];r.ignore||this.SV(r)}this.Oa()},H.prototype.SV=function(t){var i,n,r,s,h=t.PV;"simpleA"===h.routeMode&&(i=(s=this.TV(h)).pathXY,n=s.routeInfo,i&&((h=(r=this.hV).XH(i)).length<1||(s=r._H(t.SH,[t]),r._H(h,[t])<s&&this.AV(t,i,n))))},H.prototype.TV=function(t){var i=t.sourceNode,n=t.targetNode,r=t.p1,s=t.p2,h=t.p1Dir,
t=t.p2Dir;return new B.xV(this.BB,null,null).pV(i,r,h,n,s,t,"simpleB")},H.prototype.AV=function(t,i,n){var r=this.hV;r.qH(t),this.DV(t,t.Bi,i),t.Bi=i,t.PV=n,r.LH(t)},H.prototype.DV=function(t,i,n){if(!(i.length<2||n.length<2))for(var r=t.mi,t=t.pi,s=[r?r.Hu:null,t?t.Hu:null],h=[i[0],i[i.length-1]],e=[n[0],n[n.length-1]],u=0,o=s.length;u<o;u++){var a,f,l=s[u];l&&((f=e[u]).x===(a=h[u]).x&&f.y===a.y||l.setPoint(f.x,f.y))}},H.prototype.yV=function(){for(var t=this.bP(),i=0,n=t.length;i<n;i++)for(var r=t[i],s=r.mi,h=r.pi,e=s===h?[s]:[s,h],u=0,o=e.length;u<o;u++){var a,f=e[u];f&&((a=f.SB)||(f.SB={conList:[]},a=f.SB),a.conList||(a.conList=[]),a.conList.push(r))}},H.prototype.MV=function(){for(var t=this.mP(),i=0,n=t.length;i<n;i++)for(var r=t[i].ki,s=0,h=r.length;s<h;s++)delete r[s].SB},H.prototype.wV=function(){var t=this.mP(),t=new A(this.bP(),t,this.reportError);return t.sc(!1),t.hc(),t},H.prototype.mP=function(){return this.changeStateObj.getAllCsNodes()},H.prototype.bP=function(){
return this.changeStateObj.getAllCsConnections()},C.prototype.kV=function(t){this.ll();var i=this.mP();this.NV(i);for(var n=0,r=i.length;n<r;n++){var s=i[n];s.ignore||this.SV(s)}this.Oa()},C.prototype.SV=function(t){for(var i=t.gluePointLists,n=this.EB,r=0,s=n.length;r<s;r++){var h=i[n[r]];h.length<2||this.LV(h)}},C.prototype.LV=function(t){if(!(t.length<2))for(var i=this.BV(t),n=0,r=i.length;n<r;n++){var s=i[n];this.EV(s,t,i,1)<1&&this.EV(s,t,i,-1)}},C.prototype.EV=function(t,i,n,r){var s=0,h=null;do{}while((h=this.HV(t,i,n,r))&&(this.CV(t,h)&&(this.VV(i,t,h)&&(s++,h))));return s},C.prototype.CV=function(t,i){var n=t.changePort,r=this.qV(n);if(r.length<1)return!1;var s=i.changePort,h=this.qV(s);if(h.length<1)return!1;var e=r[0],u=h[0],o=e.PV,a=u.PV;if(!o||!a)return!1;for(var f=["simpleA","simpleB"],l=[o.routeMode,a.routeMode],c=0,v=l.length;c<v;c++)if(f.indexOf(l[c])<0)return!1;if(!e.SH||!u.SH)return!1;var d,g,m=this.hV,b=m.OH(e,null,u,null),n=this.OV(e,t,u,i),s=n?n.newE1P1:null,
r=n?n.newE1P2:null,h=n?n.newE2P1:null,t=n?n.newE2P2:null,i=null;return s&&r&&h&&t&&(!(d=(n=new B.xV(this.BB,null,null)).pV(o.sourceNode,s,o.p1Dir,o.targetNode,r,o.p2Dir,o.routeMode)).pathXY||(g=n.pV(a.sourceNode,h,a.p1Dir,a.targetNode,t,a.p2Dir,a.routeMode)).pathXY&&(i=m.OH(e,d.pathXY,u,g.pathXY))),null!==i&&i<b&&(this.AV(e,d.pathXY,d.routeInfo),this.AV(u,g.pathXY,g.routeInfo),!0)},C.prototype.OV=function(t,i,n,r){var s=i.ar();if(s!==r.ar())return null;var h=t.PV,e=n.PV;if(!h)return null;var u=h.sourceNode,o=h.targetNode,a=h.p1,f=h.p2,l=e.sourceNode,c=e.targetNode,i=e.p1,r=e.p2,t=null,n=null,h=null,e=null;return s===u?s===l?(t={x:i.x,y:i.y},n={x:f.x,y:f.y},h={x:a.x,y:a.y},e={x:r.x,y:r.y}):s===c&&(t={x:r.x,y:r.y},n={x:f.x,y:f.y},h={x:i.x,y:i.y},e={x:a.x,y:a.y}):s===o&&(s===l?(t={x:a.x,y:a.y},n={x:i.x,y:i.y},h={x:f.x,y:f.y},e={x:r.x,y:r.y}):s===c&&(t={x:a.x,y:a.y},n={x:r.x,y:r.y},h={x:i.x,y:i.y},e={x:f.x,y:f.y})),{newE1P1:t,newE1P2:n,newE2P1:h,newE2P2:e}},C.prototype.BV=function(t){for(
var i=[],n=0,r=t.length;n<r;n++){var s=t[n],h=s.changePort;this.zV(h)&&(h.isUserLoc&&!h.Xu||i.push(s))}return i},C.prototype.zV=function(t){var i=this.qV(t);if(i.length<1)return!1;for(var n=0,r=i.length;n<r;n++)if(!1===i[n].RV)return!1;return!0},C.prototype.qV=function(t){t=t.SB,t=t?t.conList:null;return t||[]},C.prototype.HV=function(t,i,n,r,s){var h=i.indexOf(t);if(h<0)return null;for(var e=null,u=0<r?i.length-1:0,o=h+r;0<=(u-o)*r;o+=r){var a=i[o],f=!!s||!this._V(t,a);if(0<=n.indexOf(a)&&f){e=a;break}}return e},C.prototype._V=function(t,i){var n=t.changePort,r=i.changePort;if(!n||!r)return!1;t=this.qV(n);if(t.length<1)return!1;i=this.qV(r);if(i.length<1)return!1;n=t[0],r=i[0],t=n.bi,i=n.yi,n=r.bi,r=r.yi;return t===n&&i===r||t===r&&i===n},C.prototype.NV=function(t){for(var i=0,n=t.length;i<n;i++){var r=t[i];r.ignore||this.IV(r)}},C.prototype.IV=function(t){for(var i=t.gluePointLists,n=this.EB,r=0,s=n.length;r<s;r++){var h,e=n[r],u=i[e];u.length<2||(h="top"===e||"bottom"===e?"x":"y",
u.sort(function(t,i){t=t.No(),i=i.No();return t[h]-i[h]}))}},C.prototype.VV=function(t,i,n){var r=t.indexOf(i),s=t.indexOf(n);return 0<=r&&0<=s&&(t[r]=n,t[s]=i,!0)},n.common.ObjectHelper.inherit(C,H),V.prototype.UV=function(t){this.eV=t},V.prototype.HV=function(t,i,n,r,s){return C.prototype.HV.call(this,t,i,n,r,!0)},V.prototype.CV=function(t,i){var n=t.ar();if(n!==i.ar())return!1;var r=t.changePort,s=this.qV(r);if(s.length<1)return!1;var h=i.changePort,e=this.qV(h);if(e.length<1)return!1;var u=s[0],o=e[0],r=u.Bi,h=o.Bi;if(!r||!h)return!1;if(r.length<3||h.length<3)return!1;s=this.XV(r,t,h,i),e=s?s.newPathXY1:null,t=s?s.newPathXY2:null,i=s?s.swapInx1:null,s=s?s.swapInx2:null;if(!e||!t)return!1;if(this.YV(r,e,i,[n]))return!1;if(this.YV(h,t,s,[n]))return!1;s=this.hV;if(0<s.RH(u,e,o,t))return!1;if(!u.SH||!o.SH)return!1;n=s.zH(u,null,o,null);return s.zH(u,e,o,t)<n&&(this.AV(u,e,u.PV),this.AV(o,t,o.PV),!0)},V.prototype.XV=function(t,i,n,r){var s=i.No(),h=r.No(),e=t[0],u=n[0],o=t[t.length-1],
a=n[n.length-1],i=null,r=null;if(this.jV(s,e)?i="start":this.jV(s,o)&&(i="end"),this.jV(h,u)?r="start":this.jV(h,a)&&(r="end"),!i||!r)return null;var o=this.FV(t),u=this.FV(n),h=-1,a=-1,t=[],n=[],t="start"===i?[o[h=0],o[h+1]]:[o[(h=o.length-1)-1],o[h]],n="start"===r?[u[a=0],u[a+1]]:[u[(a=u.length-1)-1],u[a]],f=u[a].x-o[h].x,l=u[a].y-o[h].y;return 0!=f&&0!=l?null:(t.forEach(function(t){t.x+=f,t.y+=l}),n.forEach(function(t){t.x-=f,t.y-=l}),{newPathXY1:o,newPathXY2:u,swapInx1:h,swapInx2:a})},V.prototype.YV=function(t,i,n,r){var s=0,h=1;0!==n&&(s=n-1,h=n);var e=t[s],u=t[h],n=i[s],t=i[h],s=Math.min(e.x,u.x,n.x,t.x),i=Math.max(e.x,u.x,n.x,t.x),h=Math.min(e.y,u.y,n.y,t.y),t=Math.max(e.y,u.y,n.y,t.y);return this.eV.sB({x:s,y:h,w:i-s,h:t-h},r)},V.prototype.FV=function(t){for(var i=[],n=0,r=t.length;n<r;n++){var s=t[n];i.push({x:s.x,y:s.y})}return i},V.prototype.jV=function(t,i){return t.x===i.x&&t.y===i.y},n.common.ObjectHelper.inherit(V,C),q.prototype.rc=function(t,i){var n=this.yw;n.x=t,n.y=i
},q.prototype.UV=function(t){this.eV=t},q.prototype.GV=function(t){for(var i=0,n=t.length;i<n;i++){var r=t[i];r.ignore||this.JV(r)}},q.prototype.JV=function(t){var i,n,r,s,h,e,u,o,a=t.Bi;!a||a.length<3||(r=t.bi,s=t.yi,e=t.mi,u=t.pi,i=e.Hu,n=u.Hu,i&&n&&(h=this.KV(r,i.nodeSide),t=!1,this.KV(s,n.nodeSide)<=h||(a.reverse(),t=!t,h=r,r=s,s=h,h=e,e=u,u=h,h=i,i=n,n=h),u.isUserLoc&&!u.Xu||(o=a.length,this.QV(a,r,s,n.nodeSide,n),a.length!==o&&this.DV(n,a[a.length-1])),3<a.length&&(e.isUserLoc&&!e.Xu||(a.reverse(),t=!t,o=a.length,this.QV(a,s,r,i.nodeSide,i),a.length!==o&&this.DV(i,a[a.length-1]))),t&&a.reverse()))},q.prototype.QV=function(t,i,n,r,s){var h=t.length;if(!(h<4)){var e="x",u="w";"left"!==r&&"right"!==r||(e="y",u="h");var o=this.yw[e],a=this.KV(n,r);if(!(n[u]/(a+1)<=o)){var f=t[h-4],a=t[h-1],l=a[e],c=f[e],f=n[e],u=n[e]+n[u];if(!(c<f+o||u-o<c)){for(var v=!0,d=n.gluePointLists[r],g=0,m=d.length;g<m;g++){var b=d[g];if(b!==s){var p=b.No()[e],b=l-p,p=c-p;if(Math.abs(p)<o){v=!1;break}if(!(
0<p&&0<b||p<0&&b<0)){v=!1;break}}}v&&((f={x:a.x,y:a.y})[e]=c,u=t[h-3],r=i.ignore,a=n.ignore,i.ignore=!0,n.ignore=!0,u=this.eV.hi(u,f),i.ignore=r,n.ignore=a,u||(t.splice(h-3,3),t.push(f)))}}}},q.prototype.KV=function(t,i){for(var n=0,r=t.gluePointLists[i],s=0,h=r.length;s<h;s++)r[s]&&n++;return n},q.prototype.DV=function(t,i){t.setPoint(i.x,i.y)},O.prototype.tg=function(t,i){i=this.WV(i);var n=this.rows[i];n||(this.rows[i]=n=[],this.ZV(this.uV,i)),n.push(t)},O.prototype.$V=function(t){return t=this.WV(t),this.rows[t]},O.prototype.tz=function(t){var i=this.$V(t);if(!i)return[];for(var n=[],r=0,s=i.length;r<s;++r){var h=i[r];h&&n.push(h)}return n},O.prototype.iz=function(t,i){for(var n=this.$V(i),r=n?n.length:0,s=0;s<r;++s){var h=n[s];if(h&&h===t)return!(n[s]=null)}return!1},O.prototype.nw=function(t,i,n){i!==n&&(this.iz(t,i)||console.log("RankIndexSegManager: the seg is not found at rank seg list."),this.tg(t,n))},O.prototype.oV=function(t){for(var i=0,n=t.length;i<n;++i){var r=t[i]
;this.tg(r,r.ew())}},O.prototype.nz=function(t,i,n){for(var r=this.WV(t),s=-1,h=-1,e=this.uV,u=e.length,o=0;o<u;++o)if((l=e[o])<=r&&(s=o),r<=l){h=o;break}for(var a=null,f=null,o=h<0?e.length-1:h;0<=o;--o){var l=e[o],c=this.$V(l);if(c&&(a=this.rz(c,t,i,n)))break}for(var o=s<0?0:s,v=e.length;o<v;++o){l=e[o],c=this.$V(l);if(c&&(f=this.sz(c,t,i,n)))break}return{lowRankSeg:a,highRankSeg:f}},O.prototype.rz=function(t,i,n,r){if(!t)return null;for(var s=null,h=t.length,e=0;e<h;++e){var u,o,a=t[e];a&&(i<=(u=a.ew())||((o=a.MH()).min>r||o.max<n||(!s||s.ew()<u)&&(s=a)))}return s},O.prototype.sz=function(t,i,n,r){if(!t)return null;for(var s=null,h=t.length,e=0;e<h;++e){var u,o,a=t[e];a&&((u=a.ew())<=i||((o=a.MH()).min>r||o.max<n||(!s||s.ew()>u)&&(s=a)))}return s},O.prototype.Cc=function(t,i){var n=this.uV,r=n.length;if(r<1)return[];var s=t.x,h=s+t.w;"H"===i&&(h=(s=t.y)+t.h);t=n[0];if(h<t)return this.tz(t);t=n[r-1];if(t<s)return this.tz(t);for(var e=-1,u=-1,o=-1,a=-1,f=0;f<r;++f)if((c=n[f]
)<s?e=f:c===s&&(u=f),c===h)a=f;else if(h<c){o=f;break}var l=[];(o=o<0&&0<=a?a:o)<0&&(o=r-1);for(f=e=(e=e<0&&0<=u?u:e)<0?0:e;f<=o;++f){var c=n[f],v=this.$V(c);if(v)for(var d=0,g=v.length;d<g;++d){var m=v[d];m&&l.push(m)}}return l},O.prototype.ZV=function(t,i){for(var n=-1,r=0,s=t.length;r<s;++r)if(t[r]>i){n=r;break}-1===n?t.push(i):t.splice(n,0,i)},O.prototype.WV=function(t){var i=this.R2;return Math.floor(t/i)*i},z.prototype.setStandardPortSize=function(t,i){this.reportError("Stand Port Size need not be set, as Distribute module will check port size individually.")},z.prototype.hz=function(t){this.lV=t},z.prototype.sc=function(t){this.YB=t},z.prototype.ll=function(){var t,i;this.cx||(void 0===this.aV&&(this.aV=this.changeStateObj.getAllCsNodes()),void 0===this.fV&&(this.fV=this.changeStateObj.getAllCsConnections()),this.ez(),t=this.xw.yw,(i=new A(this.fV,this.aV,this.reportError)).sc(this.YB),i.rc(t.x,t.y),i.hc(),this.Op=i.oc("H"),this.Hp=i.oc("V"),this._1=new O(this.Op,t.y,
this.reportError),this.W1=new O(this.Hp,t.x,this.reportError))},z.prototype.ez=function(){this.cx||e.prototype.ll.call(this)},z.prototype.Q1=function(t,i,n,r){this.cx||(this.ez(),this.Op=t,this.Hp=i,this._1=n,this.W1=r)},z.prototype.Nw=function(t,i){var n=t.length;if(n<2)return null;var r=this.dP().yw,s="x",h=r.y;"V"===i&&(s="y",h=r.x);for(var e=[],u=0,o=t.length;u<o;++u){var a=t[u];this.uz(a)||e.push(a)}if(e.length<1)return null;var f=this.kw(e,i),l=f.min,r=f.max;if(null===l||null===r)return null;if(r<l)return this.Zf("DistributeAlgorithm: max rank is smaller than min rank"),null;f=e.length;if(f<n&&(f+=1),h<=(r-l)/(f+1))return null;r=l+h*(f+1),h=this.og(e),f=h.maxPnt[s]-h.minPnt[s],s=r-l,r={x:0,y:0,w:0,h:0};return"H"===i?(r.x=h.minPnt.x,r.y=l,r.w=f,r.h=s):(r.x=l,r.y=h.minPnt.y,r.w=s,r.h=f),r.w<0||r.h<0?(this.Zf("DistributeAlgorithm: rect w or h is negative."),null):r},z.prototype.distributeAllSegs=function(){this.ll(),this.oz(this.Op,"H"),this.oz(this.Hp,"V"),this.Cw(this.Op,"H"),
this.Cw(this.Hp,"V")},z.prototype.oz=function(t,i){for(var n=this.Vw(t),r=n.shift();r;)r=(r.length<2||(r=this.Dw(r),this.qw(r,i)),n.shift())},z.prototype.qw=function(t,i){var n,r,s,h;t.length<2||(t[0].ew(),n=[],r=[],s=null,n=(h=this.mw(t)).lowSegList,r=h.highSegList,s=h.fixSegList,n.concat(r).length<1||(h=this.pw(t,i),s.length<1?this.Ow(t,h,i):this.Sw(n,r,h,i)))},z.prototype.pw=function(t,i){if(!(t.length<2)){var n=t[0].ew(),r=this.mw(t),s=r.lowSegList,h=r.highSegList,e=r.fixSegList,u=s.concat(h),o=this.kw(u,i);if(u.length<1)return o;var a=o.min,t=o.max,r=o.minPad,s=o.maxPad;if(null===a)return o;if(null===t)return o;var h=this.xw.yw,f=h.y;"V"===i&&(f=h.x);h=(t-a-r-s)/(u.length+1);if(f<=(h=0<e.length?(t-a-r-s)/(u.length+1+1):h))return o;var l=this.Mw([o]),c=(a=Math.max(Math.floor((n-a-r)/f)-1,0),n);0<e.length&&(c=n+f);for(var v=!0,d=a,g=u.length;d<g;++d){var m=u.slice(d),b=(x=this.kw(m,i)).max;if(l.max=c+f,l.maxPad=0,null!==b&&b-x.maxPad<=c){l.max=b,l.maxPad=x.maxPad,v=!1;break}c+=f}
var p=this.Mw([l]);if(!v){a=Math.max(Math.floor((t-s-n)/f)-1,0),r=u.length-a-1,c=n;0<e.length&&(c=n-f);for(d=r;0<=d;--d){var x,m=u.slice(0,d+1),y=(x=this.kw(m,i)).min;if(p.min=c-f,p.minPad=0,null!==y&&y+x.minPad>=c){p.min=y,p.minPad=x.minPad;break}c-=f}}return p}this.Zf("DistributeAlgorithm: the num of overlaps is small than 2.")},z.prototype.Ow=function(t,i,n){if(i){if(!(t.length<1)){var r=t[0].ew(),s=i.min,h=i.max,e=i.minPad,u=i.maxPad;if(this.Rw&&(null!==s&&(s+=e),null!==h&&(h-=u),u=e=0),!(null!==s&&null!==h&&h<=s))if(null!==s&&r<s)this.Zf("DistributeAlgorithm: min rank is bigger than rank");else if(null!==h&&h<r)this.Zf("DistributeAlgorithm: max rank is smaller than rank");else{var o=this.xw.yw,a=o.y;"V"===n&&(a=o.x);var f,l,c=t.length,v=0,d=null;if(null!==s&&null!==h){if(d=a<=(v=(h-s-u-e)/(c+1))?(f=r-(c-1)*(v=a),l=r+(c-1)*a,i=Math.max(e,a),o=Math.max(u,a),s+i<=f?f:l<=h-o?r:s+v):s+(v=(v=a<(v=(h-s)/(c+1))?a:v)<(u=e=0)?0:v),0===v)return}else if(null!==s&&null===h)v=a,d=r;else if(
null===s&&null!==h)d=r-(c-1)*(v=a);else{if(null!==s||null!==h)return void this.Zf("DistributeAlgorithm: unknown status");d=r-(c-1)*(v=a)}d=this.az(d,v,a,c,s,h,e,u),this.Lw(t,d-v,null,v,n)}}}else this.Zf("The input limit is null.")},z.prototype.Sw=function(t,i,n,r){if(n){if(!(t.length+i.length<1)){var s=n.min,h=n.max,e=n.minPad,u=n.maxPad;if(this.Rw&&(null!==s&&(s+=e),null!==h&&(h-=u),u=e=0),!(null!==s&&null!==h&&h<=s)){var o=null;if(0<t.length&&(o=t[0].ew()),0<i.length&&(o=i[0].ew()),null!==s&&o<s)this.Zf("DistributeAlgorithm: min rank is bigger than rank");else if(null!==h&&h<o)this.Zf("DistributeAlgorithm: max rank is smaller than rank");else{var a=this.xw.yw,n=a.y;if("V"===r&&(n=a.x),null!==s&&null!==h){var f=t.length+i.length+1;if(0===(b=(b=n<(b=(h-s-u-e)/(f+1))?n:b)<n&&(b=(h-s)/(f+1))<(u=e=0)?0:b))return;var l=Math.round((o-s-e)/b)-1,c=Math.round((h-o-u)/b)-1;c<0&&(c=0);var v=[],d=[];if((l=l<0?0:l)>=t.length)if(c>=i.length)v=t.slice(0),d=i.slice(0);else{for(var v=t.slice(0),
g=i.length-c,m=0;m<g;++m)v.push(i[m]);for(m=g;m<i.length;++m)d.push(i[m])}else{for(m=0;m<l;++m)v.push(t[m]);for(m=l;m<t.length;++m)d.push(t[m]);d=d.concat(i)}v.length+d.length!==t.length+i.length&&this.Zf("DistributeAlgorithm: the total number of segments is not correct."),n<(b=(o-s-e)/(v.length+1))&&(b=n);f=o-(v.length+1)*b;0<(c=this.Lw(v,f,o,b,r)).length&&this.Zf("DistributeAlgorithm: some segments are not moved in (minRank, rank)."),n<(b=(h-o-u)/(d.length+1))&&(b=n),0<(c=this.Lw(d,o,h,b,r)).length&&this.Zf("DistributeAlgorithm: some segments are not moved in (rank, maxRank).")}else if(null!==s&&null===h){var b=n;(f=o-(t.length+1)*n)<s+e&&(f=o-Math.floor((o-s-e)/b)*b);var p=(c=this.Lw(t,f,o,b,r)).concat(i);0<(c=this.Lw(p,o,null,b,r)).length&&this.Zf("DistributeAlgorithm: some segments are not moved.")}else if(null===s&&null!==h){b=n,e=o+(i.length+1)*n;h-u<e&&(e=o+Math.floor((h-u-o)/b)*b),i.reverse();c=this.Lw(i,e,o,0-b,r);t.reverse();p=c.concat(t);0<(c=this.Lw(p,o,null,0-b,r)
).length&&this.Zf("DistributeAlgorithm: some segments are not moved.")}else{if(null!==s||null!==h)return void this.Zf("DistributeAlgorithm: unknown status");b=n,f=o-(t.length+1)*n;0<(c=this.Lw(t,f,o,b,r)).length&&this.Zf("DistributeAlgorithm: some segments are not moved."),0<(c=this.Lw(i,o,null,b,r)).length&&this.Zf("DistributeAlgorithm: some segments are not moved.")}}}}}else this.Zf("The input limit is null.")},z.prototype.Lw=function(t,i,n,r,s){if(null==i)return this.Zf("DistributeAlgorithm: input start rank is null"),[];if(t.length<1)return[];for(var h="V"===s?this.W1:this._1,e=[],u={},o=0,a=0;a<t.length;){var f=t[a],l=this.fz(e,u,f,s);null===l&&(o++,e.push(l=i+o*r),u[l]=[]);if(null!==n&&(0<r?n<=l:l<=n))break;h.nw(f,f.ew(),l),f.lw(l),u[l].push(f),++a}for(var c=[],v=a,d=t.length;v<d;++v)c.push(t[v]);return c},z.prototype.Iw=function(t,i){for(var n="H"===i?"x":"y",r=[],s=0,h=t.length;s<h;++s){var e=(f=t[s]).port1,u=f.port2;e&&this.lz(r,e,n),u&&this.lz(r,u,n)}if(!(r.length<1)){var o=[
],a={posA:Number.NEGATIVE_INFINITY,posB:r[0],segs:[]};o.push(a);for(s=0,h=r.length-1;s<h;++s){a={posA:r[s],posB:r[s+1],segs:[]};o.push(a)}a={posA:r[r.length-1],posB:Number.POSITIVE_INFINITY,segs:[]};o.push(a);for(var f,s=0,h=t.length;s<h;++s)((f=t[s]).port1||f.port2)&&this.cz(o,f,i);return o}},z.prototype.lz=function(t,i,n){for(var r=this.vz(i),i="x"===n?r.w:r.h,s=r[n]+i/2,h=0,e=t.length;h<e;++h){var u=t[h];if(u===s)return;if(s<u)return void t.splice(h,0,s)}t.push(s)},z.prototype.cz=function(t,i,n){if(!(t.length<1))for(var r=this.dz(i,n),s=0,h=t.length;s<h;++s){var e=t[s];if(r>=e.posA&&r<=e.posB){e.segs.push(i);break}}},z.prototype.dz=function(t,i){i="H"===i?"x":"y";return(t.p1[i]+t.p2[i])/2},z.prototype.Uw=function(t,i,n,r){if(isFinite(i)&&isFinite(n)){for(var s="H"===r?"x":"y",h="H"===r?"w":"h",e=[],u=[],o=0,a=t.length;o<a;++o){var f=t[o],l=f.port1,c=f.port2;if(l||c){if(l&&c)return;c=this.vz(l||c);(c[s]+c[h]/2===n?u:e).push(f)}}if(!(e.length<1||u.length<1))return{movableSegs:u,
remainSegs:e}}},z.prototype.gz=function(t,i){t.length;if(!(t.length<2)){for(var n=null,r=null,s=[],h=[],e=0,u=t.length;e<u;++e){var o=(M=t[e]).port1,a=M.port2;(o||a)&&((r=r||(a||o))===(n=n||(o||a))&&(r=null),s.push(M),o&&a||h.push(M))}if(n&&r&&!(s.length<2||h.length<1)){var f=this.xw.yw,l="y",c="h",v=f.y;"V"===i&&(l="x",c="w",v=f.x);var d="V"===i?this.W1:this._1,g=this.vz(n),m=this.vz(r),b=g[c],f=m[c],i=b,b=g[l];f<i&&(i=f,b=m[l]);var p=h[0].ew(),x=s.length!==h.length;if(0<i)for(var y=i/(h.length+1),w=b+(y=x?i/(h.length+1+1):y),e=0,u=h.length;e<u;++e){x&&w===p&&(w+=y);var M=h[e];this.mz(M,c)&&(d.nw(M,p,w),M.lw(w),w+=y)}else 2!==h.length||x||(y=v/3,0!==g[c]&&g[c]<v&&(y=g[c]/3),0!==m[c]&&m[c]<v&&(y=m[c]/3),v=h[0],m=h[1],this.mz(v,c)&&(d.nw(v,v.ew(),p-y),v.lw(p-y)),this.mz(m,c)&&(d.nw(m,m.ew(),p+y),m.lw(p+y)))}}},z.prototype.mz=function(t,i){for(var n=[t.port1,t.port2],r=0,s=n.length;r<s;r++){var h=n[r];if(h)if(h.isUserLoc&&!h.Xu&&0===h[i])return!1}return!0},z.prototype.mw=function(t){for(
var i=[],n=[],r=[],s=null,h=0,e=t.length;h<e;++h){var u=t[h];this.uz(u)?(s=s||u,r.push(u)):(s?n:i).push(u)}return{lowSegList:i,highSegList:n,fixSegList:r}},z.prototype.uz=function(t){return!(!t.port1&&!t.port2)},z.prototype.kw=function(t,i){if(t.length<1)return{min:null,max:null};var n=[],r=t[0].ew(),s=this.og(t),h=s.minPnt,s=s.maxPnt,h=this.bz(i,r,h,s);n.push(h);s=this.xw.P1;return("H"===i?0===s.y:0===s.x)||(h=this.pz(t,i),n.push(h)),this.Mw(n)},z.prototype.bz=function(t,i,n,r){var s=this.xz(t,i,n,r),r=this.yz(t,i,n,r);return this.Mw([s,r])},z.prototype.xz=function(t,i,n,r){var s="V"===t?this.W1:this._1,n=T.MH(t,n,r),r=n.min,n=n.max,r=s.nz(i,r,n),n=r.lowRankSeg,r=r.highRankSeg,n=n?n.ew():null,r=r?r.ew():null;return null!==n&&i<n&&this.Zf("DistributeAlgorithm: low rank is bigger than rank"),null!==r&&r<i&&this.Zf("DistributeAlgorithm: high rank is smaller than rank"),this.Ib(n,r)},z.prototype.yz=function(t,i,n,r){for(var s=this.xw.G1,h=this.aV,e=h.length,u=!1,u="H"===t?0===s.y:0===s.x,
o=[],a=0;a<e;++a){var f,l,c,v,d=h[a];d.ignore||(v=[],f={x:d.x,y:d.y,w:d.w,h:d.h},l=this.wz(f,t,i,n,r),this.lV&&this.Mz(l,t),v.push(l),c=null!==l.min&&null!==l.max,l.isCrossRect&&(l=this.kz(d,t,i,n,r),v.push(l)),u||(l=this.Sz(f,t,i,n,r,c))&&v.push(l),(l=this.Pz(d,t,i,n,r))&&v.push(l),l=this.Tz(d,t,i,n,r),v.push(l),v=this.Mw(v),o.push(v))}return this.Mw(o)},z.prototype.kz=function(t,i,n,r,s){var h="y",e=["left","right"];"V"===i&&(h="x",e=["top","bottom"]);for(var u=[],o=t.gluePointLists,a=e.length,f=0;f<a;++f)for(var l=o[e[f]],c=l.length,v=0;v<c;++v){var d,g=l[v];g&&("crossover"===g.type||(g=g.getPoint())[h]!==n&&(g={x:g.x,y:g.y,w:0,h:0},d=this.wz(g,i,n,r,s),u.push(d)))}return d=this.Mw(u)},z.prototype.Pz=function(t,i,n,r,s){if(!t.Jh||!t.Qh)return null;var h=t.titleKeepOutArea;if(!h)return null;var e=Math.min(h.w,t.w),h=Math.min(h.h,t.w);if(0===e||0===h)return null;h={x:t.x,y:t.y,w:e,h:h};return this.wz(h,i,n,r,s)},z.prototype.Sz=function(t,i,n,r,s,h){var e=this.xw.yw,u=this.xw.G1,o=e.y,
a=u.y;if("V"===i&&(o=e.x,a=u.x),0===a)return null;(a-=o)<0&&(a=0);var f,t={x:t.x,y:t.y,w:t.w,h:t.h};if(h){if("H"===i){if(t.y+=a,t.h-=2*a,t.h<0)return this.Zf("The rect size < 0"),null}else if(t.x+=a,t.w-=2*a,t.w<0)return this.Zf("The rect size < 0"),null;return(f=this.wz(t,i,n,r,s)).minPad=o,f.maxPad=o,f}return"H"===i?(t.y-=a,t.h+=2*a):(t.x-=a,t.w+=2*a),(f=this.wz(t,i,n,r,s)).minPad=o,f.maxPad=o,f},z.prototype.Tz=function(t,i,n,r,s){for(var h=[],e=t.ki,u=e?e.length:0,o=0;o<u;++o){var a,f=e[o];f.ignore||0!==(f={x:f.x,y:f.y,w:f.w,h:f.h}).w&&0!==f.h&&(a=this.wz(f,i,n,r,s),h.push(a))}return a=this.Mw(h)},z.prototype.pz=function(t,i){for(var n=[],r=0,s=t.length;r<s;++r){var h=this.Az(t[r],i);n.push(h)}return this.Mw(n)},z.prototype.Az=function(t,i){for(var n=this.xw.yw,r=this.xw.P1,s=[],h=t.ew(),e=[t.seg1,t.seg2],u=0,o=e.length;u<o;++u){var a=e[u];if(a){var f=a.node1,l=a.nodeSide1;if(f||(f=a.node2,l=a.nodeSide2),f){var c,v,d,g=null,a=null;if("H"===i){if(c=f.y,v=r.y,d=n.y,"bottom"===l
)c+=f.h;else if("top"!==l){this.Zf("The attaching node side may be incorrect.");continue}}else if(c=f.x,v=r.x,d=n.x,"right"===l)c+=f.w;else if("left"!==l){this.Zf("The attaching node side may be incorrect.");continue}c<h?g=c+(v-d):a=c-(v-d);a=this.Ib(g,a);a.minPad=d,a.maxPad=d,s.push(a)}}}return this.Mw(s)},z.prototype.wz=function(t,i,n,r,s){var h=this.Ib(null,null);h.isCrossRect=!1;var e=T.MH(i,r,s),u=e.min,o=e.max,a=t.w,r=t.h,s=t.x,e=t.y,t=s+a,a=e+r,r={H:{min:e,max:a},V:{min:s,max:t}},s={H:{min:s,max:t},V:{min:e,max:a}};if(s[i].min>o||s[i].max<u)return h;t=null,e=null,a=r[i].min,r=r[i].max,e=n<a?(t=null,a):r<n?(t=r,null):(t=a,r);return h.min=t,h.max=e,h.isCrossRect=s[i].min>u||s[i].max<o,h},z.prototype.Mw=function(t){for(var i=null,n=null,r=0,s=0,h=0,e=t.length;h<e;++h){var u=t[h],o=u.min,a=u.max;null===i?(i=o,r=u.minPad):null!==o&&(i<o?(i=o,r=u.minPad):i===o&&r<u.minPad&&(r=u.minPad)),null===n?(n=a,s=u.maxPad):null!==a&&(a<n?(n=a,s=u.maxPad):n===a&&s<u.maxPad&&(s=u.maxPad))}
var f=this.Ib(i,n);return f.minPad=r,f.maxPad=s,f},z.prototype.Ib=function(t,i){return{min:t,max:i,minPad:0,maxPad:0}},z.prototype.MH=function(t,i,n){return T.MH(t,i,n)},z.prototype.Dz=function(t,i){for(var n=t.ew(),r=("V"===i?this.W1:this._1).$V(n),s=r?r.length:0,h=0;h<s;++h){var e=r[h];if(e&&(e!==t&&e.mH(t)))return!0}return!1},z.prototype.og=function(t){for(var i=t[0],n=i.p1,r=i.p2,s=n.x,h=n.y,e=r.x,u=r.y,o=Math.min(s,e),a=Math.min(h,u),f=Math.max(s,e),l=Math.max(h,u),c=t.length,v=1;v<c;++v)n=(i=t[v]).p1,r=i.p2,s=n.x,h=n.y,(e=r.x)<(o=s<o?s:o)&&(o=e),(u=r.y)<(a=h<a?h:a)&&(a=u),(f=f<s?s:f)<e&&(f=e),(l=l<h?h:l)<u&&(l=u);return{minPnt:{x:o,y:a},maxPnt:{x:f,y:l}}},z.prototype.Dw=function(t){for(var i=[],n=t.length,r=0;r<n;++r)this.Nz(i,t[r]);return i},z.prototype.Nz=function(t,i){for(var n,r=t.length,s=0;s<r;++s)if(n=t[s],0<i.pH(n))return void t.splice(s,0,i);t.push(i)},z.prototype.Vw=function(t){for(var i,n=t.length,r=[],s=0;s<n;++s)i=t[s],this.Lz(i,r);return r},z.prototype.Aw=function(t
,i){t.sort(z.prototype.Bz);for(var n=[],r=0,s=t.length;r<s;++r){var h,e=t[r];e.length<2||(h=e[0].ew(),h=this.Bw(e,h),t[r]=h.leftSegs,0<h.movedSegs.length&&(n=n.concat(h.movedSegs)))}for(r=0,s=n.length;r<s;++r)this.Lz(n[r],t);for(s=i?i.length:0,r=0;r<s;++r)this.Lz(i[r],t)},z.prototype.Bz=function(t,i){return t[0].ew()-i[0].ew()},z.prototype.Bw=function(t,i){for(var n=[],r=[],s=0,h=t.length;s<h;++s){var e=t[s];(e.ew()===i?n:r).push(e)}return{leftSegs:n,movedSegs:r}},z.prototype.Lz=function(t,i){for(var n,r,s=t.ew(),h=[],e=i.length,u=0;u<e;++u)s===(n=i[u])[0].ew()&&t.bH(n)&&h.push(n);if((e=h.length)<1)return(r=[]).push(t),void this.Ez(i,r);var o=[];for(u=0;u<e;++u)r=h[u],o=o.concat(r),this.To(i,r);o.push(t),this.Ez(i,o)},z.prototype.To=function(t,i){i=t.indexOf(i);i<0?this.Zf("DistributeAlgorithm: array item not found to remove"):t.splice(i,1)},z.prototype.Ez=function(t,i){for(var n=i[0].ew(),r=t.length,s=0;s<r;++s)if(n<=t[s][0].ew())return void t.splice(s,0,i);t.push(i)},
z.prototype.vz=function(t){if(!t.ignore)return{x:t.x,y:t.y,w:t.w,h:t.h};var i=t.Hu;if(!i)return{x:t.x,y:t.y,w:0,h:0};i=i.getPoint();return{x:i.x,y:i.y,w:0,h:0}},z.prototype.Cw=function(t,i){for(var n=this.Vw(t),r=0,s=n.length;r<s;++r)if(2===(h=n[r]).length)for(var h=this.Dw(h),e=this.Iw(h,i),u=e?e.length:0,o=1;o<u-1;++o){var a,f,l=e[o].segs;2===l.length&&(a=l[0],f=l[1],this.Hz(a,f)&&this.gz(l,i))}},z.prototype.Hz=function(t,i){return t.port1&&!t.port2?i.port1&&!i.port2?t.port1!==i.port1:!(i.port1||!i.port2)&&t.port1!==i.port2:!(t.port1||!t.port2)&&(i.port1&&!i.port2?t.port2!==i.port1:!(i.port1||!i.port2)&&t.port2!==i.port2)},z.prototype.Mz=function(t,i){var n,r,s,h;t&&(n=(h=this.xw.yw).y,"V"===i&&(n=h.x),null!==(s=r=t.min)&&(s=Math.ceil(r/n)*n),null!==(h=i=t.max)&&(h=Math.floor(i/n)*n),null!==r&&null!==i&&i<=r||(t.min=s,t.max=h))},z.prototype.fz=function(t,i,n,r){for(var s=null,h=n.p1,e=n.p2,u=t.length-1;0<=u;--u){for(var o=t[u],a=i[o],f=!0,l=0,c=a.length;l<c;l++)if(a[l].Wp(r,o,h,e)){
f=!1;break}if(!f)break;s=o}return s},z.prototype.az=function(t,i,n,r,s,h,e,u){var o=t;if(i===n){if(null!==s&&null!==h)for(var o=Math.floor(t/n)*n,a=Math.max(e,n);o<s+a;)o+=n;else null!==s&&null===h?o=Math.ceil(t/n)*n:null===s&&null!==h?o=Math.floor(t/n)*n:null===s&&null===h&&(o=Math.round(t/n)*n);null!==h&&h-(a=Math.max(u,n))<o+(r-1)*n&&(o=t)}return o},n.common.ObjectHelper.inherit(z,e),R.prototype.ll=function(){this.cx||(e.prototype.ll.call(this),this.vV=this.Cz())},R.prototype.Hw=function(){this.ll(),this.vV.distributeAllSegs()},R.prototype.Cz=function(){var t=new z(this.changeStateObj,this.reportError);return t.setValidConfigMode(this.fx),t.setEdgeDist(this.yw.x,this.yw.y),t.setEdgeToNodeDist(this.G1.x,this.G1.y),t.setMinRunOut(this.P1.x,this.P1.y),t.sc(!0),t},n.common.ObjectHelper.inherit(R,e),_.prototype.setRSOPEnabled=function(t){this.lc!==t&&(this.lc=t,this.cx=!1)},_.prototype.enableAlignPathEndPoints=function(t){this.Xw!==t&&(this.Xw=t,this.cx=!1)},
_.prototype.setSnapGridFlag=function(t){this.UP!==t&&(this.UP=t,this.cx=!1)},_.prototype.setAllocatorType=function(t){this.zB=t},_.prototype.setLayoutDirection=function(t){this.VB=t},_.prototype.setMinCrossByReroute=function(t){this.gV!==t&&(this.gV=t,this.cx=!1)},_.prototype.setMinCrossBySwapPorts=function(t){this.mV!==t&&(this.mV=t,this.cx=!1)},_.prototype.setMinCrossBySwapEndSegs=function(t){this.bV!==t&&(this.bV=t,this.cx=!1)},_.prototype.setRemoveEndBendingFlag=function(t){this.dV!==t&&(this.dV=t,this.cx=!1)},_.prototype.generatePaths=function(t){this.ll(),t=t.slice(0),this.Vz(t),this.qz(t),this.Oz(t),this.vi(t),this.gV&&this.zz(t),this.mV&&this.Rz(t),this.dV&&this._z(t),this.lc&&this.Iz(),this.bV&&this.Uz(t)},_.prototype.ll=function(){this.cx||(e.prototype.ll.call(this),this.rV=this.Xz(),this.nV=this.Yz())},_.prototype.qz=function(t){for(var i=this.bP(),n=0,r=i.length;n<r;n++)(s=i[n]).mi&&s.pi||(s.ignore=!0),s.CT=!1,s.RV=!1;for(var s,h=0,e=t.length;h<e;h++){(s=t[h]).Bi=null;for(
var u=[s.mi,s.pi],n=0,r=u.length;n<r;n++){var o=u[n];!o||(o=o.Hu)&&o.pl()}s.ignore||(s.RV=!0)}},_.prototype.Vz=function(t){var i=this.changeStateObj;i.Vz(),i.jz(null,t)},_.prototype.vi=function(t){for(var i=t.length,n=0;n<i;++n){var r=t[n];r.ignore||r.Bi||this.gi(r)}},_.prototype.gi=function(t){var i=t.bi,n=t.yi,r=t.mi,s=t.pi,h=r.Hu,e=s.Hu;if(!h||!e)return t.Bi=null,void(t.E2=null);var u=h.No(),o=e.No(),r=this.Li[h.nodeSide],s=this.Li[e.nodeSide];t.Wu&&(t.Zu?r=this.Yw(i,h,r):s=this.Yw(n,e,s));s=new B.xV(this.nV,this.rV,this.nV).pV(i,u,r,n,o,s);t.Bi=s.pathXY,t.PV=s.routeInfo,t.Bi||this.reportError("path is not found")},_.prototype.Yw=function(t,i,n){var r=t.titleKeepOutArea;if(r){r={x:t.x,y:t.y,w:r.w,h:r.h},i=i.getPoint();if(this.changeStateObj.El(i,r))return n}return{left:"right",right:"left",down:"up",up:"down"}[n]},_.prototype.Iz=function(){this.Fz().Hw()},_.prototype.zz=function(t){this.Gz().kV(t)},_.prototype.Rz=function(t){this.Jz().kV(t)},_.prototype.Uz=function(t){this.Kz().kV(t
)},_.prototype._z=function(t){this.Qz().GV(t)},_.prototype.Xz=function(){var t=this.xw,i=new r(this.changeStateObj,this.reportError);return i.setCellSize(t.yw.x,t.yw.y),i.setMinRunOut(t.P1.x,t.P1.y),i.enableAlignPathEndPoints(this.Xw),i.jP(this.UP),i},_.prototype.Yz=function(){var t=this.changeStateObj,i=this.xw,t=new o(t,this.reportError);return t.setEdgeDist(i.yw.x,i.yw.y),t.setEdgeToNodeDist(i.G1.x,i.G1.y),t.setMinRunOut(i.P1.x,i.P1.y),t.fB(this.UP),t},_.prototype.Gz=function(){var t=new H(this.changeStateObj,this.reportError);return t.$B(this.nV),t},_.prototype.Jz=function(){var t=new C(this.changeStateObj,this.reportError);return t.$B(this.nV),t},_.prototype.Kz=function(){var t=new V(this.changeStateObj,this.reportError),i=this.al();return t.UV(i),t},_.prototype.Qz=function(){var t=this.xw,i=this.al(),n=new q(this.changeStateObj,this.reportError);return n.rc(t.yw.x,t.yw.y),n.UV(i),n},_.prototype.Fz=function(){var t=new R(this.changeStateObj,this.reportError)
;return t.setValidConfigMode("normal"),t.setEdgeDist(this.yw.x,this.yw.y),t.setEdgeToNodeDist(this.G1.x,this.G1.y),t.setMinRunOut(this.P1.x,this.P1.y),t},_.prototype.al=function(){var t=this.dP(),i=t.G1,n=t.yw,t=new h(this.changeStateObj,this.reportError);return t.iB(i.x,i.y),t.rc(n.x,n.y),t},_.prototype.Oz=function(t){this.Wz().t3(t)},_.prototype.Wz=function(){var t=this.xw.yw,i=new S(this.changeStateObj,this.reportError);return i.aH(this.zB),i.F3(this.VB),i.fB(this.UP),i.G3(t.x,t.y),i.$B(this.nV),i},n.common.ObjectHelper.inherit(_,e);var I={};function U(t){this.x=0,this.y=0,this.w=0,this.h=0,this.hostNode=t,this.$n=null,this._n=null,this.ki=[],this.Rl=[],this.Jh=!1,this.Qh=!0,this.ignore=!1,this.gluePointLists={top:[],left:[],bottom:[],right:[]},this.padding=null,this.titleKeepOutArea=null,this.uf=!1,this.vs=I.NEW}function X(t,i){this.Ci=t,this.ti=i,this.Hu=null,this.hl=null,this.rl=[],this.Oe=null,this.Ve=null,this.Ue=null,this.cn=!1,this.Xu=!1,this.x=0,this.y=0,this.w=0,this.h=0,
this.sl=i,this.ignore=!1,this.vs=I.NEW,this.ti.vs|=I.NEW,this.Oi=0,this.qq="any"}function Y(t){this.Bi=null,this.mi=null,this.pi=null,this.bi=null,this.yi=null,this.Si=t,this.su=null,this.Oe=null,this.Ve=null,this.Ue=null,this.ignore=!1,this.P2=null,this.I2=null,this.Wu=!1,this.U2=!1,this.Qu=!1,this.Zu=!1,this.$u=!1,this.j2=!1,this.nodeDist=0,this.E2=null,this.Ti=!1,this.vs=I.NEW}function j(t){this.Zz=[],this.$z=[],this.BR=0,this.VR=t,this.VR||(this.VR=function(t,i){return t===i})}function F(t){this.qR={},this.BR=0,this.zR=t}function G(t,i){this.reportError=i,this.UR=t,this.nList=[],this.cList=[],this.XR=this.YR(),this.jR=this.YR(),this.FR=this.YR(),this.zh=this.GR(null,!0),this.zh.T2=!0,this.du=!1,this.isPartialUpdate=!1,this.A2=void 0,this.q2=void 0}I.NONE=0,I.NEW=1,I.MOVE=2,I.RESIZE=4,U.prototype.Hi=function(t,i){this.x===t&&this.y===i||(this.vs|=I.MOVE),this.x=t,this.y=i},U.prototype.jn=function(t,i){this.w===t&&this.h===i||(this.vs|=I.RESIZE),this.w=t,this.h=i},
U.prototype.G2=function(){this.gluePointLists.top=[],this.gluePointLists.left=[],this.gluePointLists.bottom=[],this.gluePointLists.right=[]},U.prototype.w3=function(t){var i=null;switch(t){case"top":i={x:this.x+this.w/2,y:this.y};break;case"bottom":i={x:this.x+this.w/2,y:this.y+this.h};break;case"left":i={x:this.x,y:this.y+this.h/2};break;case"right":i={x:this.x+this.w,y:this.y+this.h/2};break;default:i={x:this.x,y:this.y},this.reportError("Unknwon node side: "+t)}return i},X.prototype.Hi=function(t,i){this.x===t&&this.y===i||(this.vs|=I.MOVE),this.x=t,this.y=i},j.prototype.ya=function(){return this.BR},j.prototype.JR=function(){return this.BR<1},j.prototype.Oa=function(){this.Zz=[],this.$z=[],this.BR=0},j.prototype.da=function(t,i){this.Zz.push(t),this.$z.push(i),this.BR++},j.prototype.pa=function(t){t=this.KR(t);return!(t<0)&&(this.Zz.splice(t,1),this.$z.splice(t,1),this.BR--,!0)},j.prototype.va=function(t){t=this.KR(t);if(!(t<0))return this.$z[t]},j.prototype.hm=function(t){return!(
this.KR(t)<0)},j.prototype.QR=function(t){return!(this.$z.indexOf(t)<0)},j.prototype.WR=function(){return this.Zz},j.prototype.Na=function(){return this.$z},j.prototype.KR=function(t){for(var i=this.Zz,n=0,r=i.length;n<r;++n)if(this.VR(t,i[n]))return n;return-1},F.prototype.ya=function(){return this.BR},F.prototype.JR=function(){return this.BR<1},F.prototype.Oa=function(){this.qR={},this.BR=0},F.prototype.da=function(t,i){this.qR[this.zR(t)]={k:t,v:i},this.BR++},F.prototype.pa=function(t){t=this.zR(t);return!!this.qR[t]&&(delete this.qR[t],this.BR--,!0)},F.prototype.ZR=function(t){var i,n=this.qR;for(i in n)if(n[i].v===t)return delete n[i],this.BR--,!0;return!1},F.prototype.va=function(t){t=this.qR[this.zR(t)];if(t)return t.v},F.prototype.hm=function(t){return Object.prototype.hasOwnProperty.call(this.qR,this.zR(t))},F.prototype.QR=function(t){var i,n=this.qR;for(i in n)if(n[i].v===t)return!0;return!1},F.prototype.WR=function(){var t,i=[],n=this.qR,r=0;for(t in n)i[r++]=n[t].k;return i
},F.prototype.Na=function(){var t,i=[],n=this.qR,r=0;for(t in n)i[r++]=n[t].v;return i},G.prototype.Yo=function(){var t,i=this.nList,n=i.length,r=0,s=this.zh;this.F2=s,this.z2=s;for(var h=0;h<n;++h)if((t=i[h])!==s){t.T2=!1;for(var e=[],u=t.$n,r=0;u!==s;)e.push(u),r++,u=u.$n;t.parentNodes=r?e:void 0}},G.prototype.X2=function(t,i){if(t){var n=t.parentNodes;if(n)for(var r=n.length,s=0;s<r;s++)n[s].T2=i}},G.prototype.jl=function(t,i){var n=t.$n,r=i.$n,s=this.F2,h=this.z2;n===s&&r===h||(s===h?n==s&&r==s||(n!=s&&r!=s?(this.X2(this.A2,!1),this.X2(t,!0),n!=r&&this.X2(i,!0)):n!=s?this.X2(t,!0):this.X2(i,!0)):(this.X2(this.A2,!1),this.X2(this.q2,!1),this.X2(t,!0),n!=r&&this.X2(i,!0)),this.A2=t,this.q2=i,this.F2=n,this.z2=r)},G.prototype.addNewNodeObj=function(t,i,n){i=this.GR(t,i);return(n=n||this.zh)._n.push(i),i.$n=n,i},G.prototype.addNewPortObj=function(t,i){t=this.$R(t,i);return i.ki.push(t),i.Rl.push(t),t},G.prototype.addNewConnectionObj=function(t,i,n){t=this.tI(t);return t.mi=i,t.pi=n,
i&&(t.bi=i.ti,t.P2=i.sl),n&&(t.yi=n.ti,t.I2=n.sl),t},G.prototype.removeNodeObj=function(t){for(var i=t.ki;0<i.length;)this.removePortObj(i[0]);var n=t._n;if(null!==n)for(;0<n.length;)this.removeNodeObj(n[0]);var r=t.$n;this.To(r._n,t),this.iI(t)},G.prototype.removePortObj=function(t){var i=t.ti,n=t.sl;this.To(i.ki,t),this.To(n.Rl,t),this.nI(t)},G.prototype.removeConnectionObj=function(t){this.rI(t)},G.prototype.setNodeInfo=function(t,i){void 0!==i.owner&&this.sI(t,i.owner),void 0!==i.isGroup&&null!==i.isGroup&&(i.isGroup?this.hI(t):this.eI(t)),void 0!==i.isExpanded&&null!==i.isExpanded&&(t.Qh=i.isExpanded);var n=i.box;n&&(t.x=n.x,t.y=n.y,t.w=n.w,t.h=n.h);var r=i.padding;r&&((n=t.padding).top=r.top,n.bottom=r.bottom,n.left=r.left,n.right=r.right);i=i.keepOutArea;i&&((t=t.titleKeepOutArea).x=i.x,t.y=i.y,t.w=i.w,t.h=i.h)},G.prototype.setPortInfo=function(t,i){i.owner&&this.uI(t,i.owner);var n=i.portBehavior;n&&(
"layoutAllocatedPortFloat"===n?t.cn=!0:"generalPort"===n?t.isUserLoc=!0:"layoutAllocatedPortStatic"===n?t.cn=!1:this.reportError("unknown port behavior: "+i.portBehavior)),i.portDirection&&(t.qq=i.portDirection);n=i.box;n&&(t.x=n.x,t.y=n.y,t.w=n.w,t.h=n.h);i=i.portLocation;i&&(t.userLoc={absX:i.absoluteX,absY:i.absoluteY,perX:i.percentX,perY:i.percentY}),(n||i)&&this.Vi(t)},G.prototype.setConnectionInfo=function(t,i){i.pathXY&&(t.Bi=i.pathXY)},G.prototype.askCsNodeRect=function(t){return{x:t.x,y:t.y,w:t.w,h:t.h}},G.prototype.askCsPortRect=function(t){return{x:t.x,y:t.y,w:t.w,h:t.h}},G.prototype.askCsConnectionPath=function(t){return t.Bi},G.prototype.getHostNode=function(t){return t.hostNode},G.prototype.getHostPort=function(t){return t.Ci},G.prototype.getHostConnection=function(t){return t.Si},G.prototype.zi=function(t){return!!this.Fi(t)},G.prototype.ji=function(t){return!!this.ru(t)},G.prototype.Di=function(t){return!!this.Gi(t)},G.prototype.Fi=function(t,i){t=this.XR.va(t)
;return t||(i&&this.reportError("BaseChangeState: node not found in change state"),null)},G.prototype.ru=function(t,i){t=this.jR.va(t);return t||(i&&this.reportError("BaseChangeState: port not found in change state"),null)},G.prototype.Gi=function(t,i){t=this.FR.va(t);return t||(i&&this.reportError("BaseChangeState: connection not found in change state"),null)},G.prototype.Ma=function(t){for(var i=[],n=0,r=t.length;n<r;++n)i.push(this.getHostNode(t[n]));return i},G.prototype.ms=function(t){for(var i=[],n=0,r=t.length;n<r;++n)i.push(this.Fi(t[n]));return i},G.prototype.getCsConnectionList=function(t){for(var i=[],n=0,r=t.length;n<r;++n)i.push(this.Gi(t[n]));return i},G.prototype.getAllCsNodes=function(){return this.nList},G.prototype.getAllCsConnections=function(){return this.cList},G.prototype.hI=function(t){return t.Jh||this.oI(t),t},G.prototype.eI=function(t){return t.Jh&&(t.Jh=!1,t._n=null,t.Qh=!1,t.padding=null,t.titleKeepOutArea=null,t.uf=!1),t},G.prototype.sI=function(t,i){
i=i||this.zh;var n=t.$n;n!==i&&(this.To(n._n,t),i._n.push(t),t.$n=i)},G.prototype.Dj=function(t,i,n){t.x=i,t.y=n,this.Vi(t)},G.prototype.uI=function(t,i){var n=t.ti,r=t.sl;r!==i&&(this.To(n.ki,t),this.To(r.Rl,t),t.Xu=!1,t.ti=i,(t.sl=i).ki.push(t),i.Rl.push(t),t.Hu=null,t.hl=null,t.rl=[],t.ignore=!1)},G.prototype.getRootChangeNode=function(){return this.zh},G.prototype.clear=function(){this.xi()},G.prototype.xi=function(){this.XR.ya()!==this.nList.length&&this.reportError("The node num in map may be incorrect."),this.FR.ya()!==this.cList.length&&this.reportError("The connection num in map may be incorrect."),this.zh=this.GR(null,!0),this.zh.T2=!0,this.nList=[],this.cList=[],this.XR.Oa(),this.jR.Oa(),this.FR.Oa()},G.prototype.changeNodeToGroupNode=function(t,i,n,r){t=this.Fi(t);return t?(null!==t._n||(this.hI(t),t.Qh=i,t.titleKeepOutArea=n,t.padding=r),t):(this.reportError("BaseChangeState: request to convert a node to a group node that is not in the change state"),null)},
G.prototype.convertGroupNodeToNode=function(t){var i=this.Fi(t);if(!i)return this.reportError("BaseChangeState: request to convert a group to a normal node that is not in the change state"),null;if(null===i._n)return this.reportError("BaseChangeState: request to convert a group to a normal node that is already a normal node"),null;if(0<i._n.length){var n=i._n.length;if(0<n)for(var r=i._n.concat(),s=0;s<n;s++){var h=r[s];this._e(h.hostNode),h.$n===i&&(h.$n=this.zh,this.zh._n.push(h))}i._n=null}return this.eI(i),i},G.prototype.removeNode=function(t){t=this.Fi(t);if(t){for(var i=this.getAllConnectionsForNodeWithDescent(t),n=i.length,r=0;r<n;++r)this.removeConnection(i[r].Si);this.removeNodeObj(t)}else this.reportError("BaseChangeState: request to remove a node that is not in the change state")},G.prototype._e=function(t){var i=this.Fi(t);null!==i?i.$n!==(t=this.searchCurrentParentNode(t))&&(this.sI(i,t),this.B2(t,t.ignore),this.ko(),this.Oo()):this.reportError(
"BaseChangeState: request to re-parent a node that is not in the change state")},G.prototype.hf=function(t){for(var i=t.length,n=0;n<i;++n)this._e(t[n])},G.prototype.aI=function(t,i,n,r){t=this.ru(t);t?(r=this.Fi(r))?(r===t.sl||this.uI(t,r),this.Dj(t,i,n)):this.reportError("BaseChangeState: port's new owing node is not in the change state"):this.reportError("BaseChangeState: request to remove a port that is not in the change state")},G.prototype.removePort=function(t,i){t=this.ru(t);t?this.removePortObj(t):i||this.reportError("BaseChangeState: request to remove a port that is not in the change state")},G.prototype.removeConnection=function(t,i){t=this.Gi(t);t?this.removeConnectionObj(t):i||this.reportError("BaseChangeState: request to remove a connection that is not in the change state")},G.prototype.s1=function(t){return{x:t.x+t.w/2,y:t.y+t.h/2}},G.prototype.r1=function(t,i){for(var n,r,s,h=t.gluePointLists[i],e=null,u=null,o=null,a=null,f=h.length,l=0;l<f;l++)(s=h[l]
)&&"attachment"===s.type&&(n=s.changePort)&&(n.ignore||n.cn||n.Xu||(r=n.x+n.w/2,s=n.y+n.h/2,null===e?(o=e=r,a=u=s):(r<e&&(e=r),s<u&&(u=s),o<r&&(o=r),a<s&&(a=s))));return null===e?null:{x:e,y:u,w:o-e,h:a-u}},G.prototype.h1=function(t,i){var n=this.r1(t,"top"),r=this.r1(t,"bottom"),n=this.o1(n,r),r=this.r1(t,"left"),t=this.r1(t,"right"),t=this.o1(r,t);return n&&t?{x:n.x,y:t.y,w:n.w,h:t.h}:n?{x:n.x,y:i.y,w:n.w,h:0}:t?{x:i.x,y:t.y,w:0,h:t.h}:null},G.prototype.Yf=function(t){return t.length<1?{x:0,y:0,w:0,h:0}:u.getBoundsOfBoxes(t)},G.prototype.o1=function(t,i){var n=[];return t&&n.push(t),i&&n.push(i),u.getBoundsOfBoxes(n)},G.prototype.El=function(t,i){return u.isPointInBox(t.x,t.y,i)},G.prototype.enlargeBoxWithPadding=function(t,i){return u.addBoxPadding(t,i)},G.prototype.Lo=function(){for(var t,i=this.nList,n=i.length,r=0;r<n;++r)for(var s,h=(s=i[r].ki).length,e=0;e<h;++e)t=s[e],this.Vi(t)},G.prototype.Vi=function(t){t.isUserLoc?this.e1(t):this.n1(t)},G.prototype.n1=function(t){
var i=t.ti,n=t.x+t.w/2,r=t.y+t.h/2,s=n-i.x,h=r-i.y,e=s/i.w,u=h/i.h,i=this.hn(n,r,i.x,i.y,i.w,i.h);t.pos={nodeSide:i,dx:s,dy:h,relx:e,rely:u}},G.prototype.e1=function(t){if(!t.isUserLoc)return this.reportError("The port is not user defined port"),void this.n1(t);t.Xu||this.l1(t),this.n1(t)},G.prototype.l1=function(t){var i,n=t.userLoc;return n?(i=t.ti,t.x=i.x+i.w*n.perX+n.absX-t.w/2,t.y=i.y+i.h*n.perY+n.absY-t.h/2):this.reportError("Port has not user defined location."),!!n},G.prototype.Uo=function(t){for(var i,n=this.nList,r=n.length,s=0;s<r;++s)i=n[s],this._l(i,t)},G.prototype._l=function(t,i){for(var n,r=t.ki,s=r.length,h=0;h<s;++h)n=r[h],this.vn(n,i)},G.prototype.vn=function(t,i){t.isUserLoc?this.$d(t,i):this.a1(t,i)},G.prototype.a1=function(t,i){var n=t.ti,r=n.x,s=n.y,h=n.w,e=n.h,u=t.pos;switch(i){case"sideOffset":var o=u.nodeSide;"left"===o?s+=u.dy:"right"===o?(r+=h,s+=u.dy):"bottom"===o?(r+=u.dx,s+=e):r+=u.dx;break;case"relative":r+=h*u.relx,s+=e*u.rely;break;case"absolute":
r+=u.dx,s+=u.dy;break;default:this.reportError("BaseChangeState: invalid port position rule")}t.x=r-t.w/2,t.y=s-t.h/2},G.prototype.$d=function(t,i){if(!t.isUserLoc)return this.reportError("The port is not user defined port"),void this.a1(t,i);t.Xu?this.a1(t,i):(this.l1(t),this.n1(t))},G.prototype.hn=function(t,i,n,r,s,h){return u.getClosestBoxSide(t,i,{x:n,y:r,w:s,h:h})},G.prototype.getAllConnectionsForNodeWithDescent=function(t){var i=this._2(t),n=t._n;if(null!==n)for(var r=0,s=n.length;r<s;++r)for(var h=this.getAllConnectionsForNodeWithDescent(n[r]),e=0,u=h.length;e<u;++e){var o=h[e];i.indexOf(o)<0&&i.push(o)}return i},G.prototype._2=function(t){for(var i,n=[],r=this.cList,s=r.length,h=0;h<s;++h)(i=r[h]).P2!==t&&i.I2!==t||n.push(i);return n},G.prototype.Ii=function(t){for(var i,n=[],r=this.cList,s=r.length,h=0;h<s;++h)(i=r[h]).bi!==t&&i.yi!==t||n.push(i);return n},G.prototype._i=function(t){for(var i,n=[],r=this.cList,s=r.length,h=0;h<s;++h)(i=r[h]).mi!==t&&i.pi!==t||n.push(i)
;return n},G.prototype.ed=function(t,i){var n=t.$n,r=i.$n;if(r===this.zh)return r;for(;null!==n.$n;){for(r=i.$n;null!==r.$n;){if(n===r)return n;r=r.$n}n=n.$n}return n},G.prototype.d1=function(t){for(var i=t.$n,n=null;i!==this.zh;)i=(n=i).$n;return n},G.prototype.f1=function(t){for(var i=null,n=t.$n;n!==this.zh;)!1===n.Qh&&(i=n),n=n.$n;return i},G.prototype.Nu=function(t,i){if(i===this.zh)return!0;for(var n=t.$n;n!==this.zh;){if(n===i)return!0;n=n.$n}return!1},G.prototype.Ke=function(t,i){if(!i.Jh||!i.Qh)return!1;var n=t.bi,t=t.yi;if(n===i)return!1;if(t===i)return!1;n=this.Nu(n,i),i=this.Nu(t,i);return(!n||!i)&&(!!n||!!i)},G.prototype.B2=function(t,i){t.ignore=i;for(var n,r=!t.Qh||i,s=t._n,h=s.length,e=0;e<h;++e)(n=s[e]).ignore=r,null!==n._n&&this.B2(n,r)},G.prototype.xo=function(){for(var t,i=this.nList,n=i.length,r=0;r<n;++r)t=i[r],this.Zd(t)},G.prototype.Zd=function(t){for(var i,n=t.ki.slice(0),r=n.length,s=0;s<r;++s)i=n[s],this.fa(i)},G.prototype.fa=function(t){var i,n,r,s=this._i(t
);s.length<1||(i=t.sl,n=t.ti,r=t.Hu,null!==(s=this.oa(t,s[0]))&&s!==n&&(t.ti=s,t.Hu=null,s===i?(t.Hu=t.hl,t.Xu=!1):t.Xu=!0,s!==n&&(this.To(n.ki,t),s.ki.push(t)),n!==i&&r&&r.vl()))},G.prototype.oa=function(t,i){return t===i.mi?i.bi:t===i.pi?i.yi:(this.reportError("BaseChangeState: connection does not reference expected port"),null)},G.prototype.Vz=function(){this.jz(this.nList,this.cList)},G.prototype.jz=function(t,i){t&&t.sort(function(t,i){return t.x*t.x+t.y*t.y-(i.x*i.x+i.y*i.y)}),i&&i.sort(J);for(var n=this.fI.bind(this),r=t?t.length:0,s=0;s<r;s++)t[s].ki.sort(n)},G.prototype.fI=function(t,i){var n=this._i(t),t=this._i(i);if(n.length<1)return-1;if(t.length<1)return 1;i=this.cList,n=n[0],t=t[0];return i.indexOf(n)-i.indexOf(t)};var J=function(t,i){var n=t.bi,r=t.yi,t=i.bi,i=i.yi;if(!n||!r)return 1;if(!t||!i)return-1;i=K(n,r)-K(t,i);return i=0===i&&0===(i=n.x-t.x)?n.y-t.y:i},K=function(t,i){var n=t.x+t.w/2,r=t.y+t.h/2,t=i.x+i.w/2,i=i.y+i.h/2;return(t-n)*(t-n)+(i-r)*(i-r)};function Q(t
,i,n){G.call(this,W(t),t.reportError),this.hostInterfaceObj=t,this.initialize(i,n)}G.prototype.To=function(t,i,n){i=t.indexOf(i);return i<0?(n||this.reportError("BaseChangeState: array item not found to remove"),-1):(t.splice(i,1),i)},G.prototype.ko=function(){for(var t=this.cList,i=t.length,n=0;n<i;++n)this.Pi(t[n])},G.prototype.Pi=function(t){t.Si;var i=t.Bi,n=t.su;t.Bi=null,t.su=null,t.Wu=!1,t.U2=!1,t.Qu=!1,t.Zu=!1,t.$u=!1,t.j2=!1,t.ignore=!0,t.nodeDist=0,t.E2=null;var r,s,h=t.mi,e=t.pi,u=t.P2,o=t.I2;h&&e&&u&&o&&(t.ignore=!1,r=this.f1(u),s=this.f1(o),h.ignore=!1,e.ignore=!1,null!==r&&(u=r,h.ignore=!0),null!==s&&(o=s,e.ignore=!0),(null===r||r!==s)&&(!u.Jh||u.Qh||u!==o&&!this.Nu(o,u))&&(!o.Jh||o.Qh||u!==o&&!this.Nu(u,o))?(t.mi=h,t.pi=e,t.bi=u,t.yi=o,t.mi&&(t.mi.changeCon=t),t.pi&&(t.pi.changeCon=t),u.$n!==o.$n&&(t.j2=!0),this.Nu(u,o)?(t.Wu=!0,t.$u=!0):this.Nu(o,u)&&(t.Wu=!0,t.Zu=!0),u===o&&(t.Qu=!0),t.Wu||t.Qu||(t.U2=!0),t.Bi=i,t.su=n,n=o.x-u.x,u=o.y-u.y,t.nodeDist=n*n+u*u
):t.ignore=!0)},G.prototype.oI=function(t){return t.Jh=!0,t.Qh=!0,t._n=[],t.padding={top:0,bottom:0,left:0,right:0},t.titleKeepOutArea={x:0,y:0,w:0,h:0},t},G.prototype.GR=function(t,i){var n=this.lI(t);return t&&(this.XR.da(t,n),this.nList.push(n)),i&&this.oI(n),n},G.prototype.$R=function(t,i){i=this.cI(t,i);return this.jR.da(t,i),i},G.prototype.tI=function(t){var i=this.vI(t);return this.FR.da(t,i),this.cList.push(i),i},G.prototype.lI=function(t){return new U(t)},G.prototype.cI=function(t,i){return new X(t,i)},G.prototype.vI=function(t){return new Y(t)},G.prototype.iI=function(t){var i=t.hostNode;this.XR.pa(i),this.To(this.nList,t)},G.prototype.nI=function(t){t=t.Ci;this.jR.pa(t)},G.prototype.rI=function(t){var i=t.Si;this.FR.pa(i),this.To(this.cList,t)},G.prototype.YR=function(){return this.UR?new F(this.UR):new j},Q.prototype.initialize=function(t,i){this.initNodeList(t),this.initPortsOnNodes(t),this.initEdgeList(i),this.initState()},Q.prototype.initState=function(){this.B2(this.zh,
!1),this.Lo(),this.ko(),this.Yo(),this.xo()},Q.prototype.initNodeList=function(t){for(var i=this.YR(),n=0,r=t.length;n<r;++n){var s=t[n];i.da(s,!0),this.Fi(s)&&this.reportError("The node has been added in change state")}for(n=0,r=t.length;n<r;++n)this.dI(t[n],i)},Q.prototype.initPortsOnNodes=function(t){for(var i=this.hostInterfaceObj,n=0,r=t.length;n<r;++n)for(var s=i.getAllPortsForNode(t[n]),h=0,e=s.length;h<e;++h)this.initOnePort(s[h])},Q.prototype.initEdgeList=function(t){for(var i=0,n=t.length;i<n;++i)this.initOneEdge(t[i])},Q.prototype.dI=function(t,i){var n=this.hostInterfaceObj;if(o=this.Fi(t))return o;var r=null,s=this.getValidHostParent(t,i);(r=s?(r=this.Fi(s))||this.dI(s,i):this.getRootChangeNode())||this.reportError("Parent Change State Node is not created");var h,e,u,s=n.isGroupNode(t),o=this.addNewNodeObj(t,s,r),i=n.getNodeRect(t);return s&&(h=n.isExpanded(t),e=n.getGroupNodePadding(t),u=n.getGroupNodeKeepOutArea(t,i)),this.setNodeInfo(o,{box:i,owner:r,isGroup:s,
isExpanded:h,padding:e,keepOutArea:u}),o},Q.prototype.initOnePort=function(t){var i=this.hostInterfaceObj;this.ru(t)&&this.reportError("The port has been added in change state");var n=i.getNodeOfPort(t),r=this.Fi(n),s=this.addNewPortObj(t,r),h=i.getPortRect(t),n=B.M2(i,t),r=i.getPortLocation?i.getPortLocation(t):void 0,t=i.getPortConnectDirection?i.getPortConnectDirection(t):void 0;return this.setPortInfo(s,{box:h,portBehavior:n,portDirection:t,portLocation:r}),s},Q.prototype.initOneEdge=function(t){var i=this.hostInterfaceObj;this.Gi(t)&&this.reportError("The connection has been added in change state");var n=i.getSourcePort(t),r=i.getTargetPort(t),s=null,h=null;n&&(s=this.ru(n)),r&&(h=this.ru(r));var h=this.addNewConnectionObj(t,s,h),e=i.getPath(t);if(e){for(var u=[],o=0,a=e.length;o<a;++o){var f=e[o];u.push({x:f.x,y:f.y})}this.setConnectionInfo(h,{pathXY:u})}return h},Q.prototype.update=function(){var t=this.hostInterfaceObj;t.stopDisplayUpdate(),this.Q2(this.getRootChangeNode()),
this.i1(),this.Eo(),t.updateDisplay()},Q.prototype.Q2=function(t){for(var i=this.hostInterfaceObj,n=t._n,r=0,s=n.length;r<s;++r){var h=n[r],e=this.askCsNodeRect(h),u=this.getHostNode(h);i.setNodeRect(u,e.x,e.y,e.w,e.h),h._n&&this.Q2(h)}},Q.prototype.i1=function(){for(var t=this.hostInterfaceObj,i=this.getAllCsNodes(),n=0,r=i.length;n<r;n++)for(var s=i[n].ki,h=0,e=s.length;h<e;h++){var u,o=s[h];o.ignore||(u=this.askCsPortRect(o),o=this.getHostPort(o),t.setPortRect(o,u.x,u.y,u.w,u.h))}},Q.prototype.Eo=function(){for(var t=this.hostInterfaceObj,i=this.getAllCsConnections(),n=0,r=i.length;n<r;++n){var s,h=i[n];h.ignore||(s=this.askCsConnectionPath(h),s=this.createHostPoints(t,s),h=this.getHostConnection(h),t.setPath(h,s))}},Q.prototype.getValidHostParent=function(t,i){t=this.hostInterfaceObj.getParentNode(t);return t&&(i.va(t)||this.Fi(t))?t:null},Q.prototype.createHostPoints=function(t,i){if(!i)return[];for(var n=[],r=0,s=i.length;r<s;++r){var h=i[r];n.push(t.makePoint(h.x,h.y))}return n}
;var W=function(i){var t=null;return t=i.getObjectKey?function(t){return i.getObjectKey(t)}:t};function Z(t,i,n){var r=t.reportError.bind(t);_.call(this,null,r),this.t=t,this.gI=i,this.co=n}function $(t){U.call(this,t)}function tt(t,i){X.call(this,t,i),this.nT=0,this.iT=0}function it(t){Y.call(this,t),this.mI=0,this.bI=0,this.pI=0,this.xI=0}function nt(t,i,n,r,s){G.call(this,rt,s),this.OS=t,this.qS=i,this.reportError=s||alert,this.$S=!0,this.initialize(n,r)}n.common.ObjectHelper.inherit(Q,G),Z.prototype.clear=function(){this.changeStateObj&&this.changeStateObj.xi(),this.changeStateObj=null,this.t=null,this.gI=null,this.co=null},Z.prototype.eT=function(){return!!this.changeStateObj},Z.prototype.generatePaths=function(t){this.ll();t=this.changeStateObj.getCsConnectionList(t);_.prototype.generatePaths.call(this,t),this.U()},Z.prototype.ll=function(){var t;this.cx||(t=this.yI(),this.t2(t),_.prototype.ll.call(this))},Z.prototype.yI=function(){return new Q(this.t,this.gI,this.co)},
Z.prototype.U=function(){this.changeStateObj.update()},n.common.ObjectHelper.inherit(Z,_),n.common.ObjectHelper.inherit($,U),n.common.ObjectHelper.inherit(tt,X),n.common.ObjectHelper.inherit(it,Y),nt.prototype.eT=function(){return 0<this.nList.length},nt.prototype.initialize=function(t,i){var n,r,s=0,h=0;for(null!==t&&(s=t.length),null!==i&&(h=i.length),n=0;n<s;++n){var e=t[n],u=e.isNestedViewMode(),o=this.GR(e,u);this.C2(o),this.V2(o)}for(n=0;n<h;++n){var a=i[n],f=a.getStart(),l=a.getEnd(),c=null,v=null;f&&(c=this.ru(f)),l&&(v=this.ru(l)),v=this.addNewConnectionObj(a,c,v),this.D2(v)}for(n=0;n<s;++n)o=this.nList[n],r=this.searchCurrentParentNode(o.hostNode),(o.$n=r)._n.push(o);for(this.B2(this.zh,!1),n=0;n<s;++n)!1!==(o=this.nList[n]).Jh&&(!1!==o.Qh&&!o.ignore||(o.uf=!0));this.ko(),this.Oo(),this.xo(),this.A2=void 0,this.q2=void 0,this.pe=0,this.be=[],this.Ne=[],this.ye=[]},nt.ChangeReason_None=0,nt.ChangeReason_UpdateAll=1,nt.ChangeReason_NewConnection=2,
nt.ChangeReason_ModifyConnection=4,nt.ChangeReason_NewNode=8,nt.ChangeReason_ModifyNode=16,nt.ChangeReason_NewPort=32,nt.ChangeReason_ModifyPort=64,nt.ChangeReason_EndcompoundCommands=128,nt.prototype.De=function(t){this.be.indexOf(t)<0&&this.be.push(t)},nt.prototype.Le=function(t){this.Ne.indexOf(t)<0&&this.Ne.push(t)},nt.prototype.wI=function(){this.pe=0,this.be=[],this.Ne=[]},nt.prototype.addNewNode=function(t){var i=t.isNestedViewMode(),n=this.searchCurrentParentNode(t),i=this.addNewNodeObj(t,i,n);return this.C2(i),i.ignore=n.ignore||!1===n.Qh,this.Ne.push(i),i},nt.prototype.convertNodeToGroupNode=function(t){var i=this.Fi(t);if(!i)return this.reportError("aStarModelManager: request to convert a node to a group node that is not in the change state"),null;if(null!==i._n)return i;var n={w:i.w,h:i.h},r=this.qS.getGroupNodeKeepOutArea(t,n),s=!1!==t.isGroupingAllowed()&&t.isExpanded(),n=t.getNodePaddings(t);return n.top+=r?r.h:0,G.prototype.changeNodeToGroupNode.call(this,t,s,r,n),i},
nt.prototype.convertGroupNodeToNode=function(t){var i=this.Fi(t);return i?null===i._n?null:(G.prototype.convertGroupNodeToNode.call(this,t),i):(this.reportError("aStarModelManager: request to convert a group to a normal node that is not in the change state"),null)},nt.prototype.removeNode=function(t){t=this.Fi(t);if(t){for(var i=this.getAllConnectionsForNodeWithDescent(t),n=i.length,r=0;r<n;++r)this.D2(i[r]);this.removeNodeObj(t),this.$S=!1}},nt.prototype.addNewPort=function(t){var i=t.getOwner(),n=this.Fi(i);if(!n&&!(n=this.addNewNode(i)))return null;n=this.addNewPortObj(t,n);return this.W2(n),n},nt.prototype.movePort=function(t){var i,n,r=this.ru(t);r?(i=t.getOwner(),n=t.getRenderingPosition(),G.prototype.aI.call(this,t,n.x,n.y,i),t=t.getResolvedSymbolConnectionPoint(),r.nT=t.x,r.iT=t.x):this.reportError("aStarModelManager: request to remove a port that is not in the change state")},nt.prototype.removePort=function(t){G.prototype.removePort.call(this,t,!0)},
nt.prototype.changePortLabel=function(t){},nt.prototype.addNewConnection=function(t){var i=t.getStart(),n=t.getEnd(),r=null,s=null;i&&(r=this.ru(i)),n&&(s=this.ru(n));s=this.addNewConnectionObj(t,r,s);return this.D2(s),this.be.push(s),s},nt.prototype.removeConnection=function(t){G.prototype.removeConnection.call(this,t,!0)},nt.prototype.changeConnectionLabel=function(t){},nt.prototype.update=function(t){if(t<1)return 0;var i=this.OS.CM();return i.beginTransaction(n.messages.ModelChangeMessage),this.Q2(this.zh,t),t<2&&(this.i1(),this.ca(),this.Eo(),this.t1()),i.endTransaction(),--t},nt.prototype.Q2=function(t,i){for(var n,r,s,h,e,u,o=t._n,a=o.length,f=0;f<a;++f){s=(l=(r=(n=o[f]).hostNode).getBBox()).x,h=l.y,e=l.width,u=l.height,s+=(n.x-s)/i,h+=(n.y-h)/i,e+=(n.w-e)/i,u+=(n.h-u)/i;var l=r.getBBox();l&&l.x===s&&l.y===h&&l.width===e&&l.height===u||r.modifyBoundingBox(s,h,e,u),null!==n._n&&this.Q2(n,i)}};nt.prototype.i1=function(){for(var t,i=this.nList,n=i.length,r=0;r<n;++r)for(var s,h=(
s=i[r].ki).length,e=0;e<h;++e)(t=s[e]).ignore||function(t,i,n,r,s,h){var e,u,o,a,f,l,c,v,d=t.getBBox();d&&d.x===i&&d.y===n&&d.width===r&&d.height===s||((e=t.getLocation())&&(l=(u=t.getOwner().getBBox()).x,v=u.y,f=u.width,c=u.height,f=f-(d=Math.abs(i-l)),c=c-(l=Math.abs(n-v)),(v=t.translateRenderingToAnchorPosition({x:n,y:n})).x>u.x&&v.x<u.x+u.width&&v.y>u.y&&v.y<u.y+u.height?a=o=0:d<Math.min(f,l,c)?o=a=0:f<Math.min(l,c)?(a=0,o=1):a=l<c?o=0:(o=0,1),e.setInputPercentX(o),e.setInputPercentY(a)),t.setRenderingPosition(i,n),t.setWidthValue(r),t.setHeightValue(s));h=h.ru(t);h&&!h.Xu&&h.ti.Jh&&t.setProxy(null)}(t.Ci,t.x,t.y,t.w,t.h,this)};nt.prototype.ca=function(){for(var t=this.nList,i=t.length,n=0;n<i;++n){var r,s=(r=t[n]).hostNode,h=this.qS.DS;!function(t,i,n){if(i)for(var r,s,h=t.getBBox(),t=h.width,h=h.height,e=Math.round(t/n.x)-1,u=Math.round(h/n.y)-1,o=["top","bottom","left","right"],a=o.length,f=0;f<a;++f){r=i[o[f]],s=e,1<f&&(s=u);for(var l=1;l<=s;++l)r[l]||(0,!1)}}(s,
r.gluePointLists,h)}};nt.prototype.Eo=function(){for(var t,i=this.cList,n=i.length,r=0;r<n;++r)!function(t,i){var n=null,r=t.getGeometry();if((n=r?r.getPoints():n)||i)if(n&&i){var r=n.length,s=i.length;if(r===s){for(var h=0;h<s;h++)if(!i[h].equal(n[h]))return t.setPath(i)}else t.setPath(i)}else t.setPath(i)}((t=i[r]).Si,t.su)},nt.prototype.t1=function(){},nt.prototype.Yf=function(t,i){var n=t.length;if(n<1)return{x:0,y:0,w:0,h:0};for(var r=t[0],s=r.x,h=r.y,e=s+r.w,u=h+r.h,o=1;o<n;++o)(v=(r=t[o]).x)<s&&(s=v),(d=r.y)<h&&(h=d),e<(v+=r.w)&&(e=v),u<(d+=r.h)&&(u=d);for(var a=i?i.length:0,f=0;f<a;f++){var l,c,v,d,g=i[f];g.sourceChangeNod&&g.targetChangeNod||(c=g.Si)&&(g.bi||(l=c.getStartPoint())&&((v=l.x)<s&&(s=v),(d=l.y)<h&&(h=d),e<v&&(e=v),u<d&&(u=d)),g.targetChangeNod||(c=c.getEndPoint())&&((v=c.x)<s&&(s=v),(d=c.y)<h&&(h=d),e<v&&(e=v),u<d&&(u=d)))}return{x:s,y:h,w:e-s,h:u-h}},nt.prototype.Oo=function(){for(var t,i,n=this.nList,r=n.length,s={w:0,h:0},h=0;h<r;++h)(t=n[h]
).titleKeepOutArea=null,t.Jh&&t.Qh&&(s.w=t.w,s.h=t.h,(i=this.qS.getGroupNodeKeepOutArea(t.hostNode,s))&&(i.w=Math.min(s.w,i.w),i.h=Math.min(s.h,i.h)),t.titleKeepOutArea=i)},nt.prototype.V2=function(t){for(var i=[],n=t.hostNode.getPorts(),r=0,s=n.length;r<s;r++){var h=n[r];h.isProxy()||i.push(h)}for(var e,s=i.length,u=0;u<s;++u)e=i[u],e=this.addNewPortObj(e,t),this.W2(e)},nt.prototype.searchCurrentParentNode=function(t){var i=t.getOwner();if(i===t.getOwningSheet())return this.zh;if(!i.isNestedViewMode())return this.zh;i=this.Fi(i);return i||this.zh};nt.prototype.ia=function(t){for(var i,n,r,s=t.hostNode,h=t.ki,e=h.length,u=[],o=0;o<e;++o)for(var a,f=(a=h[o].Ci.getConnections()).length,l=0;l<f;++l)i=function(t){t=t.getStart();if(void 0===t)return null;t=t.getOwner();return void 0===t?null:t}(n=a[l]),n=function(t){t=t.getEnd();if(void 0===t)return null;t=t.getOwner();return void 0===t?null:t}(n),i&&n&&(r=i===s?this.Fi(n):this.Fi(i))&&u.indexOf(r)<0&&u.push(r);return u},
nt.prototype.C2=function(t){var i=t.hostNode;if(null!==i){var n=i.getBBox();if(this.$S&&(this.$S=t.x===n.x&&t.y===n.y&&t.w===n.width&&t.h===n.height),t.x=n.x,t.y=n.y,t.w=n.width,t.h=n.height,t.Jh=i.isNestedViewMode(),t.Qh=!1!==i.isNestedViewMode()&&i.isExpanded(),t._n&&0<t._n.length){var r=t._n.length;if(0<r)for(var s=t._n.concat(),h=0;h<r;h++)this._e(s[h].hostNode)}t.Jh&&(n={w:t.w,h:t.h},n=this.qS.getGroupNodeKeepOutArea(i,n),t.titleKeepOutArea=n,(i=i.getNodePaddings(i)).top+=n?n.h:0,t.padding=i,null==t._n&&(t._n=[]))}},nt.prototype.W2=function(t){var i,n,r,s,h=t.Ci;null!==h&&(i=h.isPinned()?"generalPort":"layoutAllocatedPortFloat",n={absoluteX:(r=h.getLocation()).getInputValueX(),absoluteY:r.getInputValueY(),percentX:r.getInputPercentX(),percentY:r.getInputPercentY()},r=1===(s=h.getConnectionDirection()).x?"right":-1===s.x?"left":1===s.y?"bottom":-1===s.y?"top":"any",s=h.getBBox(),this.setPortInfo(t,{box:{x:s.x,y:s.y,w:s.width,h:s.height},portBehavior:i,portDirection:r,portLocation:n
}),h=h.getResolvedSymbolConnectionPoint(),t.nT=h.x,t.iT=h.y)},nt.prototype.D2=function(t){var i=t.Si;if(null!==i){t.mi=null,t.pi=null,t.bi=null,t.yi=null,t.P2=null,t.I2=null;var n=i.getStart(),r=i.getEnd();n&&(t.mi=this.ru(n),(n=n.getOwner())&&(t.bi=this.Fi(n))),r&&(t.pi=this.ru(r),(r=r.getOwner())&&(t.yi=this.Fi(r)));var i=i.getGeometry(),s=i?i.getPoints():null;if(s){for(var h=[],e=0,u=s.length;e<u;++e){var o=s[e];h.push({x:o.x,y:o.y})}t.Bi=h}}},nt.prototype.To=function(t,i,n){return G.prototype.To.call(this,t,i,!0)},nt.prototype.ko=function(){for(var t=this.cList.length,i=0;i<t;++i)this.Pi(this.cList[i])},nt.prototype.Pi=function(t){var i=t.Si;t.su=null,t.mi=null,t.pi=null,t.bi=null,t.yi=null,t.P2=null,t.I2=null,t.Wu=!1,t.U2=!1,t.Qu=!1,t.Zu=!1,t.$u=!1,t.j2=!1,t.ignore=!1,t.nodeDist=0,t.E2=null;var n,r,s,h=i.getStart(),e=i.getEnd();h&&e&&(n=h.getOwner(),r=e.getOwner(),n&&r&&(s=this.Fi(n),i=this.Fi(r),t.P2=s,t.I2=i,s&&i&&(n=this.ru(h),r=this.ru(e),n&&r&&(t.ignore=!1,h=this.f1(s),
e=this.f1(i),n.ignore=!1,r.ignore=!1,null!==h&&(s=h,n.ignore=!0),null!==e&&(i=e,r.ignore=!0),(null===h||h!==e)&&(!s.Jh||s.Qh||s!==i&&!this.Nu(i,s))&&(!i.Jh||i.Qh||s!==i&&!this.Nu(s,i))?(t.mi=n,t.pi=r,t.bi=s,t.yi=i,s.$n!==i.$n&&(t.j2=!0),this.Nu(s,i)?(t.Wu=!0,t.$u=!0):this.Nu(i,s)&&(t.Wu=!0,t.Zu=!0),s===i&&(t.Qu=!0),t.Wu||t.Qu||(t.U2=!0),r=i.x-s.x,s=i.y-s.y,t.nodeDist=r*r+s*s):t.ignore=!0))))},nt.prototype.Fi=function(t,i){return G.prototype.Fi.call(this,t,!1)},nt.prototype.ru=function(t,i){return G.prototype.ru.call(this,t,!1)},nt.prototype.Gi=function(t,i){return G.prototype.Gi.call(this,t,!1)},nt.prototype.lI=function(t){return new $(t)},nt.prototype.cI=function(t,i){return new tt(t,i)},nt.prototype.vI=function(t){return new it(t)};var rt=function(t){return t.guid};function st(t,i){r.call(this,null,i),this.enableAlignPathEndPoints(!0),this.jP(!1),this.setValidConfigMode("origin");t=t.WS();this.NP.rP=t||10,this.NP.sP=t||10}n.common.ObjectHelper.inherit(nt,G),st.prototype.ii=function(t
,i,n){t={x:t.x,y:t.y};return n=n?n+1:1,"down"===i?t.y+=n:"left"===i?t.x-=n:"right"===i?t.x+=n:"up"===i&&(t.y-=n),t};function ht(t){for(var i=t.length,n=0,r=0;r<i-1;r++){var s=t[r],h=t[r+1];n+=Math.abs(s.x-h.x)+Math.abs(s.y-h.y)}return n}function et(t,i,n){o.call(this,t,n),this.IS=t,this.qS=i,this.fB(!1),this.setValidConfigMode("origin"),this.initParams(i)}st.prototype.findOnePath=function(t,i,n,r,s,h){for(var e=this.NP,u=e.iP,o=e.nP,a=e.rP,f=e.sP,l=i.length,c=s.length,v=[],d=0;d<l;d++)for(var g=i[d],m=0;m<c;m++){var b=s[m],p=new P(this.reportError);p.pP(u,o,a,f),this.LP=p;var x=this.ii(t,g,n),y=this.ii(r,b,h),w=p.AP(x.x,x.y),M=p.AP(y.x,y.y),k=this.QP(w.x,w.y),p=this.QP(M.x,M.y);k.closed=!0,p.closed=!0,this.FP(g,w),this.FP(b,M),this.GP(w.x,w.y)||this.GP(M.x,M.y)||this.JP(w.x,w.y)||this.JP(M.x,M.y)||(M.dir=b,(S=this.findPathUsingAStar(w,M))&&0<S.length&&(null!==S&&this.KP(S,x,g,y,b),v.push(S)))}var S=null;return 0<v.length&&(v.sort(function(t,i){t=ht(t);return ht(i)<t}),(S=v[0]).unshift(
{x:t.x,y:t.y}),S.push({x:r.x,y:r.y})),S},st.prototype.i2=function(t,i){this.t2(t),this.setRootNode(t.zh);var n=t.qS.WS();this.setCellSize(n,n);n=t.qS.nl();this.setMinRunOut(n.x,n.y),this.xw=this.vP("origin"),this.cx=!0;for(var r,s,h=t.nList,e=h.length,u=[],o=0;o<e;++o)(s=(r=h[o]).hostNode)&&s.isVisible()&&u.push(r);var a,f,l=t.cList,e=l.length,c=[];for(o=0;o<e;++o)(f=(a=l[o]).Si)&&f.isVisible()&&c.push(a);t=t.Yf(u,c);this.WL(this.xw,u,t,4)},n.common.ObjectHelper.inherit(st,r),et.prototype.$t=function(t,i,n,r,s,h){return this.initParams(this.qS),o.prototype.findPath.apply(this,arguments)},et.prototype.initParams=function(t){var i=t.getEdgeToEdgeDist();this.setEdgeDist(i.x,i.y);i=t.el();this.setEdgeToNodeDist(i.x,i.y);i=t.nl();this.setMinRunOut(i.x,i.y);t=t.getStandardPortSize();this.setStandardPortSize(t.w,t.h),this.ll()},et.prototype.oi=function(t,i,n){return this.al(this.nList,this.reportError).oi(t,i,n)},et.prototype.hi=function(t,i){return this.al(this.nList,this.reportError).hi(t,i
)},et.prototype.ui=function(t,i,n,r,s){return this.al(this.nList,this.reportError).ui(t,i,n,r,s)},et.prototype.dl=function(t,i,n,r,s){return this.al(this.nList,this.reportError).dl(t,i,n,r,s)},et.prototype.fl=function(t,i,n,r,s){return this.al(this.nList,this.reportError).fl(t,i,n,r,s)},et.prototype.ul=function(t,i,n,r,s){return this.al(this.nList,this.reportError).ul(t,i,n,r,s)},et.prototype.cl=function(t,i,n,r,s,h){return this.al(this.nList,this.reportError).cl(t,i,n,r,s,h)},et.prototype.wl=function(t,i,n){return this.al(this.nList,this.reportError).wl(t,i,n)},n.common.ObjectHelper.inherit(et,o),n.common.ObjectHelper.rootNamespace=n.common.ObjectHelper.rootNamespace||{};var ut=n.common.ObjectHelper.rootNamespace;ut.Routing=ut.Routing||{},ut.Routing.HVPathFinder=Z,ut.Routing.HVPathsAlgorithm=_,ut.Routing.aStarModelManager=nt,ut.Routing.aStarPathPlanning=st,ut.Routing.aStarSimpleHVPaths=et;var ot={};return ot.HVPathFinder=Z,ot.HVPathsAlgorithm=_,ot.aStarModelManager=nt,
ot.aStarPathPlanning=st,ot.aStarSimpleHVPaths=et,ot.AStarPathPlanningAlgorithm=r,ot.GluePointHelper=v,ot.HVSegment=T,ot.Helper=B,ot.NormalObjectMap=j,ot.RankIndexSegManager=O,ot.HVSegmentManager=A,ot.DistributeAlgorithm=z,ot.AStarSearchGrid=P,ot.SimpleHVPathsAlgorithm=o,ot.ValidSettingCalculator=t,ot.AllocateForFixedPort=b,ot.Routing=ut.Routing||{},ot.Routing.HVPathFinder=Z,ot.Routing.HVPathsAlgorithm=_,ot.Routing.aStarModelManager=nt,ot.Routing.aStarPathPlanning=st,ot.Routing.aStarSimpleHVPaths=et,ot},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("@diagramming/core")):"function"==typeof define&&define.amd?define(["@diagramming/core"],n):((t=t||self).diagramfoundation=t.diagramfoundation||{},t.diagramfoundation.astar=n(t.diagramfoundation.core));