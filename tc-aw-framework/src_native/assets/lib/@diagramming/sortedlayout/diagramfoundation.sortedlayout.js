// @<COPYRIGHT>@
// ==================================================
// Copyright Siemens 2020.
// PL Diagram Foundation 1973.0.1-0
// ==================================================
// @<COPYRIGHT>@
var t,n;t=this,n=function(l,t,h){"use strict";function d(){}function i(t,i){l.TableNode.call(this,t,i),this.j0=[],this.P0=[],this.N0=null,this.isProcessing=!1}function g(t,i){l.GridSpace.call(this,i),this.tm=t}function c(t,i,r,n,s,h){l.ModelSpace.call(this,t,i,s),this.Ct=r,this.tm=n,h||this.Nt(i,t.Ft)}function f(t,i,r,n,s,h){l.TableOperator.call(this,t,s),this.changeStateObj=i,this.im=null,this.Ct=null,h||this.ft(r,n)}function s(t,i,r){this.reportError=r,this.u0=[],this.allRelEdgeItems=[],this.rm=i,this.F0=this.K0(t)}function r(t,i){this.reportError=i,t.nm&&this.reportError("The relation data for node already exist"),(t.nm=this).hostNode=t,this.T0=[],this.outRelEdges=[]}function n(t,i,r,n){t.sm&&n("The relation data for connection already exist"),(t.sm=this).hostEdge=t,this.srcRelNode=i,this.tarRelNode=r}function u(t,i,r,n,s,h,e,o,u){l.GluePoint.call(this,t,i,h,e,o,u),this.upperRange=r,this.lowerRange=n,this.t0=s,this.i0=(n-r)/(s+1)}function o(t,i,r){l.AllocateGluePoints.call(this,t,i,
r)}l=l&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,h=h&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h,d.Map=t.NormalObjectMap,d.traverseGraphBFS=function(t,i,r,n,s,h){var e=new d.Map(n),o=[];for(o.push(t);0<o.length;){var u=o.shift();if(!e.hm(u)){e.da(u,!0);var f=i(u);r&&f.sort(r);for(var a=[],c=0,v=f.length;c<v;++c){var l=f[c];e.hm(l)||(o.push(l),a.push(l))}s(u,f,a,h)}}},i.prototype.exportState=function(t){var i={};return i.node=t.getId(this.refNode.hostNode),i.ir=this.ir,i.ic=this.ic,i.inNodes=this.toHostNodeList(this.j0,t),i.outNodes=this.toHostNodeList(this.P0,t),i.srcNode=this.N0?t.getId(this.N0.refNode.hostNode):void 0,i},i.prototype.restoreFromState=function(t,i){},i.prototype.toHostNodeList=function(t,i){for(var r=[],n=0,s=t.length;n<s;++n){var h=i.getId(t[n].refNode.hostNode);r.push(h)}return r},i.prototype.toTableNodeList=function(t,i){for(var r=[],n=0,s=t.length;n<s;++n){
var h=t[n],h=i.getCsObjById(h).tabNode;r.push(h)}return r},h.common.ObjectHelper.inherit(i,l.TableNode),g.prototype.removeNode=function(t){var i=t.N0;i&&(l.LayoutHelper.removeItemInList(t,i.P0),l.LayoutHelper.removeItemInList(t,i.j0)),l.GridSpace.prototype.removeNode.call(this,t)},g.prototype.em=function(t,i,r,n){if(t){var s=i.length;if(!(s<1))for(var h=this.getLayerSeqOfNode(t,n),e=h.layer,t=h.seq,o=this.om(e,r,n),r=this.um(t,s,n),u=r.startSeq,r=r.endSeq,u=(h=this.fm(o,t,u,r,s,n)).startSeq,r=h.endSeq,f=0;f<s;++f)this.At(i[f],o,f+u,n)}else this.reportError("Seed table node does not exist.")},g.prototype.am=function(t,i,r){l.LayoutHelper.setAttrOnItems(this.nt,"isProcessing",!1),this.cm();var n=this.vm(t,i),t=t.csNode,t=this.St(t,!0);return this.expandMultipleLevel(t,i,r),n},g.prototype.expandMultipleLevel=function(t,i,r){var n=this.lm(t,i),s=n.hasPositionedNode,n=n.allHavePosition;if(!n)if(s)this.dm([t],i,r);else if(!this.gm(t,i,r)){for(var h=this.Tt,e=this.nt,o=0,u=e.length;o<u;++o){
var f=e[o];f.isProcessing&&f!==t&&(null===f.ir&&null===f.ic||h.b1(f))}this.dm([t],i,r)}},g.prototype.mm=function(t,i,r){var n=this.pm([t],i),s=this.dc(n),h=!1,e=r===this.wt||r===this.lt,o=this.Tt;if(0<s.length){var n=this.getLayerSeqOfNode(t,r),t=n.layer,u=n.seq,f=this.om(t,i,r),a=e?(a=o.M1(f))||{min:o.minCol,max:o.maxCol}:(a=o.O1(f))||{min:o.minRow,max:o.maxRow},t=a.min,a=a.max,c=Math.abs(u-(t-1)),v=Math.abs(u-(a+1)),l=Math.min(c,v),d=e?o.C1(u,f,t,a,s.length):o.H1(u,f,t,a,s.length);1<d.length&&d.sort(function(t,i){return t.dis>i.dis?1:t.dis<i.dis?-1:0});for(var g=d.length,m=0;m<g;m++){var p=d[m];if(p.dis>l)return!1;if(p.dis===l)if(e){if(u>this.A1){if(l===v)return!1}else if(u<this.A1&&l===c)return!1}else if(u>this.B1){if(l===v)return!1}else if(u<this.B1&&l===c)return!1;var w,b,y=p.e-p.s+1,S=!0,T=[];y%2!=0?w=p.s+Math.floor(y/2):(y=p.s+Math.floor(y/2),e?y>this.A1?(w=y-1,b=!1):(w=y,w=!0):b=y>this.B1?(w=y-1,!1):(w=y,!0)),T.push({nodes:s,layer:f,start:p.s});for(var x=this.pm(s,i),M=this.dc(
x),k=f+this.wm(i,r);0<M.length;){for(var q=M.length,L=P=q%2!=0||b?w-Math.floor(q/2):w-Math.floor(q/2)+1,O=1;O<=q;L++,O++)if(e){if(o.m1(k,L)){S=!1;break}}else if(o.m1(L,k)){S=!1;break}if(!1===S){T=[];break}T.push({nodes:M,layer:k,start:P}),k+=this.wm(i,r),x=this.pm(M,i),M=this.dc(x)}if(!1!==S){for(var H=T.length,R=0;R<H;R++)for(var N=T[R],I=N.nodes,E=N.layer,P=N.start,V=I.length,A=0;A<V;A++)this.At(I[A],E,P+A,r);h=!0;break}}}return h},g.prototype.lm=function(t,i){var r=this.bm(t,i);r[0]!==t&&this.reportError("The collected nodes have incorrect status.");for(var n=!1,s=!0,h=1,e=r.length;h<e;++h){var o=r[h];o.isProcessing&&(null!==o.ir?n=!0:s=!1)}return{hasPositionedNode:n,allHavePosition:s}},g.prototype.bm=function(t,i){var r=this.ym,n={nodeList:[]};return d.traverseGraphBFS(t,function(t){return i?t.P0:t.j0},null,function(t,i){return t.refNode.hostNode===i.refNode.hostNode},r,n),n.nodeList},g.prototype.ym=function(t,i,r,n){n=n.nodeList;t.isProcessing&&n.push(t)},g.prototype.dm=function(t
,i,r){if(!(t.length<1)){for(var n=[],s=0,h=t.length;s<h;++s){var e=t[s],o=this.pm([e],i),u=this.dc(o);this.em(e,u,i,r),n=n.concat(o)}this.dm(n,i,r)}},g.prototype.vm=function(t,i){var r=this.Sm,n=t.csNode,s=this.St(n,!0),n={};return n.self=this,n.isOutgoing=i,n.newTabNodeList=[],n.relationedNodeMap=new d.Map,n.relationedNodeMap.da(s,!0),d.traverseGraphBFS(t,function(t){return t.childItems},null,function(t,i){return t.csNode.hostNode===i.csNode.hostNode},r,n),n.newTabNodeList},g.prototype.Sm=function(t,i,r,n){for(var s=n.self,h=n.isOutgoing,e=n.newTabNodeList,o=n.relationedNodeMap,t=t.csNode,u=[],f=0,a=r.length;f<a;++f){var c=r[f].csNode;(l=s.St(c,!1))&&o.va(l)||u.push(c)}for(var v=s.Tm(t,u,h),f=0,a=v.length;f<a;++f)e.push(v[f]);for(f=0,a=u.length;f<a;++f){var l=s.St(u[f],!1);o.da(l,!0)}t=s.St(t,!0);t&&(t.isProcessing=!0)},g.prototype.gm=function(t,i,r){var n=this.xm(t,i,r);return!!this.Mm(n,t,i,r)&&(!!this.km(n,t,i,r)&&!!this.qm(n,i,r))},g.prototype.Mm=function(t,i,r,n){
var s=t.lagestLineInx,h=t.toLayer(s);if(h===this.getLayerSeqOfNode(i,n).layer)return!0;if(this.tm.preventInsert&&!this.uc(h,n))return!1;for(var e=t.longestLineNodes,o=0,u=e.length;o<u;++o){var f=o,f=t.toSeq(f);if(this.gc(h,f,n))return!1;this.At(e[o],h,f,n)}return!0},g.prototype.km=function(t,i,r,n){var s=t.lagestLineInx,h=t.toLayer(s);if(h===this.getLayerSeqOfNode(i,n).layer)return!0;for(var e=this.wm(r,n),o=h,u=!0,f=s-1;0<f;--f){if(o-=e,this.tm.preventInsert&&!this.uc(o,n))return!1;var a=t.lineTable[f];if(!(u=this.Lm(t,a,r,n)))break}return u},g.prototype.Lm=function(t,i,r,n){return!!this.Om(t,i,r,n)&&(!!this.Hm(t,i,r,n)&&!!this.Rm(t,i,r,n))},g.prototype.Om=function(t,i,r,n){t.topNodeSeq;for(var s=0,h=i.length;s<h;++s){var e=i[s],o=this.Nm(e,r);if(o.length<1)e.ir=null,e.ic=null;else{var u=o[0],f=o[o.length-1],a=this.getLayerSeqOfNode(u,n),o=a.seq,u=a.layer,f=(a=this.getLayerSeqOfNode(f,n)).seq;if(f<o)return this.reportError("The end seq is smaller than start seq"),!1;if(u!==a.layer
)return this.reportError("The node layer is incorrect"),!1;u=u-+this.wm(r,n),f=this.Im(o,f,n);if(!this.cc(u,f,f,n))return!1;this.At(e,u,f,n)}}return!0},g.prototype.Hm=function(t,i,r,n){var s=null,h=null;if(!this.Em(t,i,r,n))return!1;for(var e=0,o=i.length;e<o;++e){var u=i[e];if(0<this.Nm(u,r).length){s=u,h=e;break}}if(!s)return this.reportError("Tree structure is not correct"),!1;for(var f=i.length,a=null,c=null,e=h;e<f;++e){u=i[e];if(0<this.Nm(u,r).length)var v=this.getLayerSeqOfNode(u,n),a=v.seq+1,c=v.layer;else{v=this.gc(c,a,n);if(v)if(!this.Pm(v,a+1,n,!0))return!1;this.At(u,c,a,n),a+=1}}return!0},g.prototype.Rm=function(t,i,r,n){if(i.length<1)return!0;var s=i[0],h=i[i.length-1],e=this.getLayerSeqOfNode(s,n),o=(e.layer,e.seq),u=((e=this.getLayerSeqOfNode(h,n)).layer,e.seq);if(u<o)return this.reportError("The fist node seq is bigger than last node"),!1;for(var f=t.minSeq;o<f;){if(!this.Pm(s,o+1,n,!0))return!1;if((e=this.getLayerSeqOfNode(s,n)).seq!==o+1)return this.reportError(
"The move result is not correct."),!1;o=e.seq}for(var a=t.maxSeq;a<u;){if(!this.Pm(h,u-1,n,!0))return!1;if((e=this.getLayerSeqOfNode(h,n)).seq!==u-1)return this.reportError("The move result is not correct."),!1;u=e.seq}return!0},g.prototype.Em=function(t,i,r,n){for(var s=null,h=[],e=0,o=i.length;e<o;++e){var u=i[e];if(null!==u.ir||null!==u.ic){s=u;break}h.push(u)}if(0<h.length&&!s)return this.reportError("The tree sturcture is incorrect."),!1;if(h.length<1)return!0;var f=this.getLayerSeqOfNode(s,n),a=f.seq,c=f.layer,f=a-1,a=f-h.length+1;return!!this.cc(c,a,f,n)&&(this.wc(h,c,a,f,n),!0)},g.prototype.qm=function(t,i,r){for(var n=t.lagestLineInx,s=t.toLayer(n),h=this.wm(i,r),e=t.maxLine,o=n;o<e;++o){if(s+=h,this.tm.preventInsert&&!this.uc(s,r))return!1;var u=t.lineTable[o],f=t.lineTable[o+1];if(!this.Vm(t,u,f,i,r))return!1}return!0},g.prototype.Vm=function(t,i,r,n,s){for(var h=r.length,e=null,o=null,u=0,f=0,a=i.length;f<a;++f){var c=i[f],v=this.Nm(c,n),l=v.length;if(!(l<1)){
var d=this.getLayerSeqOfNode(c,s),g=d.layer,m=d.seq,p=this.om(g,n,s),d=this.um(m,l,s),g=d.startSeq,m=d.endSeq;if(e){d=!1;if((m=!this.cc(p,g,m,s)?(g=o+1)+v.length-1:m)+(h-u-l)>t.maxSeq&&(g=(m=t.maxSeq)-(h-u)+1,d=!0),!this.cc(p,g,m,s))return!1;if(d){for(var w=[],b=f;b<i.length;++b)var y=i[b],y=this.Nm(y,n),w=w.concat(y);return this.wc(w,p,g,m,s),!0}this.wc(v,p,g,m,s),e=c,(o=m)+(h-(u+=l))>t.maxSeq&&this.reportError("There is no empty space for left nodes")}else{if((m=g<t.minSeq?(g=t.minSeq)+l-1:m)>t.maxSeq&&(g=(m=t.maxSeq)-l+1),m+(h-u-l)>t.maxSeq&&(m=(g=t.maxSeq-h+1)+l-1),!this.cc(p,g,m,s))return!1;this.wc(v,p,g,m,s),e=c,(o=m)+(h-(u+=l))>t.maxSeq&&this.reportError("There is no empty space for left nodes")}}}return!0},g.prototype.xm=function(t,i,r){for(var n=[s=[t]],s=n[0],h=this.pm(s,i);1<=h.length;)n.push(h),s=h,h=this.pm(s,i);for(var e=null,o=0,u=0,f=n.length;u<f;++u){var a=n[u];a.length>o&&(o=a.length,e=u)}var c=n[e],v=c.length,l=v%2==0?Math.floor(v/2):Math.floor((v-1)/2),
d=this.getLayerSeqOfNode(t,r),g=this.wm(i,r),r={};return r.lineTable=n,r.longestLineNodes=c,r.lagestLineInx=e,r.minOrder=0,r.maxOrder=o-1,r.minLine=0,r.maxLine=n.length-1,r.centerOrder=l,r.centerLine=0,r.topNodeLayer=d.layer,r.topNodeSeq=d.seq,r.toSeq=function(t){return t-l+d.seq},r.toLayer=function(t){return t*g+d.layer},r.minSeq=r.toSeq(r.minOrder),r.maxSeq=r.toSeq(r.maxOrder),r.minLayer=r.toLayer(r.minLine),r.maxLayer=r.toLayer(r.maxLine),g&&(c=r.minLayer,r.minLayer=r.maxLayer,r.maxLayer=c),r},g.prototype.Am=function(t,i){for(var r=[],n=0,s=t.length;n<s;++n)var h=this.Dm(t[n],i),r=r.concat(h);return r},g.prototype.pm=function(t,i){var r=this.Am(t,i);if(r.length<1)return[];for(var n=[],s=0,h=r.length;s<h;++s){var e=r[s];e.isProcessing&&n.push(e)}return n},g.prototype.Dm=function(t,i){return i?t.P0:t.j0},g.prototype.Nm=function(t,i){for(var r=[],n=this.Dm(t,i),s=0,h=n.length;s<h;++s){var e=n[s];e.isProcessing&&r.push(e)}return r},g.prototype.fm=function(t,i,r,n,s,h){var e=r,o=n;if(
this.tm.preventInsert){if(this.uc(t,h)&&this.cc(t,r,n,h))return{startSeq:e,endSeq:o}}else if(this.cc(t,r,n,h))return{startSeq:e,endSeq:o};var u=this.Tt,f=null;return(f=h===this.ct||h===this.pt?u.T1(i,t):u.L1(t,i)).atHead?e=(o=n<(o=f.inx)?n:o)-s+1:o=(e=(e=f.inx)<r?r:e)+s-1,{startSeq:e,endSeq:o}},g.prototype.Pm=function(t,i,r,n){var s=this.getLayerSeqOfNode(t,r),s=(s.layer,s.seq);if(s===i)return!0;for(var h=s<i,e=Math.abs(i-s),o=0;o<e;++o)if(!this.jm(t,h,r,n))return!1;return!0},g.prototype.jm=function(t,i,r,n){if(n&&!t.isProcessing)return!1;var s=this.getLayerSeqOfNode(t,r),h=s.layer,e=s.seq,s=i?e+1:e-1,e=this.gc(h,s,r);if(e&&!this.jm(e,i,r,n))return!1;i=h,n=s;return r!==this.ct&&r!==this.pt||(i=s,n=h),this.Tt.Bt(t,i,n),!0},g.prototype.wm=function(t,i){return i===this.ct||i===this.lt?t?1:-1:t?-1:1},g.prototype.om=function(t,i,r){return t+this.wm(i,r)},g.prototype.Tm=function(t,i,r){if(!i||i.length<1)return[];var n=this.St(t,!0);if(!n)return[];for(var s=[],h=r?n.P0:n.j0,e=0,
o=i.length;e<o;++e){var u=i[e],f=this.St(u,!1);f||(f=this.rt(u),s.push(f)),f.N0=n,h.push(f)}return s},g.prototype.cm=function(){for(var t=this.nt,i=0,r=t.length;i<r;++i){var n=t[i];n.P0=[],n.j0=[],n.N0=null}},g.prototype.rt=function(t){t=new i(t,this.reportError);return this.nt.push(t),t},g.prototype.Im=function(t,i,r){var n,s=this.bc(this.B1,this.A1,r).seq,h=0;return(i-t+1)%2==0?(n=Math.floor((t+i)/2),r=Math.ceil((t+i)/2),h=n,Math.abs(n-s)>Math.abs(r-s)&&(h=r)):h=Math.floor((t+i)/2),h},g.prototype.um=function(t,i,r){r=this.Cm(t,i,r),t-=Math.floor((i-1)/2);return{startSeq:t+=r,endSeq:t+i-1}},g.prototype.Cm=function(t,i,r){return i%2==0&&t<=this.bc(this.B1,this.A1,r).seq?-1:0},g.prototype.Um=function(t,i,r){l.LayoutHelper.setAttrOnItems(this.nt,"isProcessing",!1),this.cm();var n=this.vm(t,i),t=t.csNode,t=this.St(t,!0);return this.Bm(t,i,r),n},g.prototype.Bm=function(t,i,r){for(var n=t.ir,s=t.ic,h=[t];0<h.length;)h=this.Gm(h,i,r);null!==n&&null!==s&&this.N1(n-t.ir,s-t.ic)},
g.prototype.Gm=function(t,i,r){for(var n=[],s=0,h=t.length;s<h;++s){var e=t[s],o=this.Nm(e,i);o.length<1||(this.zm(e,o,i,r),n=n.concat(o))}return n},g.prototype.zm=function(t,i,r,n){if(t){var s=i.length;if(!(s<1)){for(var h=this.getLayerSeqOfNode(t,n),e=h.layer,o=h.seq,u=this.om(e,r,n),t=this.Fm(o,s),o=t.startSeq,t=t.endSeq,f=(h=this.Xm(u,o,t,n)).startSeq,a=(h.endSeq,0);a<s;++a)this.At(i[a],u,a+f,n);f!==o&&this.Ym(e,r,n)}}else this.reportError("Seed table node does not exist.")},g.prototype.Ym=function(t,i,r){var n=this.bc(this.B1,this.A1,r),s=(n.seq,n.layer),h=this.wm(i,r);if(0<h&&t<s)this.reportError("Grow dir is Right (or Down), but layerInx < rootLayer");else if(h<0&&s<t)this.reportError("Grow dir is Left (or Up), but layerInx > rootLayer");else for(var e=t;this.Jm(e,i,r)&&e!==s;)e-=h},g.prototype.Jm=function(t,i,r){for(var n=this.mc(t,r),s=!1,h=0,e=n.length;h<e;++h)this.Km(n[h],i,r)&&(s=!0);return s},g.prototype.Km=function(t,i,r){var n=this.Nm(t,i);if((n=this.fc(n)).length<1
)return!1;var s=n[0],h=n[n.length-1],i=this.getLayerSeqOfNode(s,r),n=i.seq,s=i.layer,h=(i=this.getLayerSeqOfNode(h,r)).seq;if(h<n)return this.reportError("The end seq is smaller than start seq"),!1;if(s!==i.layer)return this.reportError("The node layer is incorrect"),!1;h=this.Qm(n,h);return this.Wm(t,h,r)},g.prototype.Xm=function(t,i,r,n){var s=i,h=r;if(this.cc(t,i,r,n))return{startSeq:s,endSeq:h};var e=null;return(e=n===this.ct||n===this.pt?this.Tt.O1(t):this.Tt.M1(t))&&null!==e.max?{startSeq:s=e.max+1,endSeq:h=s+(r-i)}:(this.reportError("The layer is empty."),{startSeq:s,endSeq:h})},g.prototype.Fm=function(t,i){t-=Math.ceil((i-1)/2);return{startSeq:t,endSeq:t+i-1}},g.prototype.Qm=function(t,i){return Math.ceil((t+i)/2)},g.prototype.Wm=function(t,i,r){var n=this.getLayerSeqOfNode(t,r),t=n.layer,n=n.seq,i=i-n;return 0!=i&&(i<0&&this.reportError("The new node position is at left (or top) of current position."),r===this.ct||r===this.pt?this.Tt.D1(n,t,i):this.Tt.V1(t,n,i),!0)},
g.prototype.exportState=function(t){for(var i={},r=[],n=this.nt,s=0,h=n.length;s<h;++s){var e=n[s].exportState(t);r.push(e)}return i.nodeGrids=r,i},g.createFromState=function(t,i,r,n,s){for(var h=new g(i,r),e=[],o=n.nodeGrids,u=0,f=o.length;u<f;++u){var a=(d=o[u]).ir,c=d.ic,v=s.getCsObjById(d.node),l=h.Dt(v,a,c,!0);e.push(l)}for(u=0,f=o.length;u<f;++u){var d=o[u];(l=e[u]).restoreFromState(d,s)}return h.Et(t.ir,t.ic),h},h.common.ObjectHelper.inherit(g,l.GridSpace),c.prototype.moveNode=function(t,i,r){var n=this.Wg(),s=this.tm.nodeOverlapXYPencentage;return i+=t.w*s.x,r+=t.h*s.y,i>=n.minX&&i<=n.maxX&&r>=n.minY&&r<=n.maxY?this.Zm(t,i,r,n):this.$m(t,i,r,n)},c.prototype._m=function(t,i,r,n,s,h){return!(r<=t&&t<=n&&s<=i&&i<=h)},c.prototype.tp=function(t,i,r){var n=this.Tt.m1(t,i),s={moved:!1,row:0,col:0};return n?n===r?s:void 0:(s.moved=!0,s.row=t,s.col=i,s)},c.prototype.Zm=function(t,i,r,n){var s={moved:!1,row:0,col:0},h=this.Tt,i=this.Xg(i,r),r=i.Row,i=i.Col;if(t.ir===r&&t.ic===i)return s
;var e=n.minRow,o=n.maxRow,u=n.minCol,f=n.maxCol;if(h.m1(r,i)){for(var a,c,v,l,d,g,m=2,p=r-1,w=i;m<=3;){for(a=w,d=1;d<=m;d++,a++)if(!this._m(p,a,e,o,u,f))if(g=this.tp(p,a,t))return g;for(a-=1,c=p+1,d=1;d<=m;d++,c++)if(!this._m(c,a,e,o,u,f))if(g=this.tp(c,a,t))return g;for(c-=1,v=a-=1,d=1;d<=m;d++,v--)if(!this._m(c,v,e,o,u,f))if(g=this.tp(c,v,t))return g;for(v+=1,l=c-=1,d=1;d<=m;d++,l--)if(!this._m(l,v,e,o,u,f))if(g=this.tp(l,v,t))return g;m+=2,p=(l+=1)-1,w=v}return s}return s.moved=!0,s.row=r,s.col=i,s},c.prototype.$m=function(t,i,r,n){var s={moved:!0,row:0,col:0},n=this.ip(t,i,r,n);return s.row=n.extendRow,s.col=n.extendCol,s},c.prototype.ip=function(t,i,r,n){var s=n.minRow,h=n.maxRow,e=n.minCol,o=n.maxCol,u=n.minX,f=n.maxX,a=n.minY,c=n.maxY,v=t.w,l=t.h,d=0,g=0,m=0,n=this.ai("H"),t=this.ai("V");return i<u?(d=Math.ceil((u-i)/(v+t)),r<a?(g=s-Math.ceil((a-r)/(l+n)),m=e-d):c<r?(g=h+Math.ceil((r-c)/(l+n)),m=e-d):(m=e-d,g=this.Yg(i,r))):f<i?(d=Math.ceil((i-f)/(v+t)),r<a?(g=s-Math.ceil((a-r
)/(l+n)),m=o+d):c<r?(g=h+Math.ceil((r-c)/(l+n)),m=o+d):(m=o+d,g=this.Yg(i,r))):r<a?(g=s-Math.ceil((a-r)/(l+n)),m=this._g(i,r)):c<r&&(g=h+Math.ceil((r-c)/(l+n)),m=this._g(i,r)),{extendRow:g,extendCol:m}},c.prototype.rp=function(t,i){i="H"===i?this.Ct.ir:this.Ct.ic;return t.Xt<i},c.prototype.np=function(t,i){i="H"===i?this.Ct.ir:this.Ct.ic;return t.Xt>i},c.prototype.sp=function(t){var i="H"===t.Jw?this.Ct.ir:this.Ct.ic,i=t.Xt-i;return 0<i?1:i<0?-1:0},c.prototype.Rt=function(t,i){var r=this.hp();switch(r){case l.NodePlacementOption.AnchorPointAlignment:this.jt(t);break;case l.NodePlacementOption.LayoutDirection:this.ep(t,i);break;default:this.reportError("Unsupported node placement option: "+r),this.jt(t)}},c.prototype.ep=function(t,i){var r=t.ir,n=t.ic,s=t.w,h=t.h,e=this.Rg(r,n),o=e.hNodeBar,u=e.vNodeBar;switch(o&&u||this.reportError("Cannot find target cell."),i){case this.ct:case this.pt:var f=u;a=this.sp(f)<0?this.Fg(r,n,0-s,0):this.Ug(r,n),t.Hi(a.x,a.y);break;case this.lt:
case this.wt:var a,f=o;a=this.sp(f)<0?this.zg(r,n,0,0-h):this.Ug(r,n),t.Hi(a.x,a.y);break;default:this.reportError("Unknown layout direction: "+i),a=this.Ug(r,n),t.Hi(a.x,a.y)}},c.prototype.hp=function(){var t=this.tm;return t&&void 0!==t.nodePlacement?t.nodePlacement:l.NodePlacementOption.AnchorPointAlignment},c.prototype.exportState=function(t){var i={};return i.hNodeBarList=this.exportBarList(this.hNodeBarList,t),i.hSegBarList=this.exportBarList(this.hSegBarList,t),i.vNodeBarList=this.exportBarList(this.vNodeBarList,t),i.vSegBarList=this.exportBarList(this.vSegBarList,t),i.hSegBarHead=this.hSegBarList[-1].exportState(t),i.vSegBarHead=this.vSegBarList[-1].exportState(t),i},c.prototype.exportBarList=function(t,i){for(var r=[],n=0,s=t.length;n<s;++n){var h=t[n].exportState(i);r.push(h)}return r},c.createFromState=function(t,i,r,n,s,h,e){var o=h.hNodeBarList,u=h.hSegBarList,f=h.vNodeBarList,a=h.vSegBarList;u[-1]=h.hSegBarHead,a[-1]=h.vSegBarHead;u=l.TableBar.createBarListFromState(i,s,o
,u,e),e=l.TableBar.createBarListFromState(i,s,f,a,e),s=new c(t,i,r,n,s,!0);return s.hNodeBarList=u.nodeBarList,s.hSegBarList=u.segBarList,s.vNodeBarList=e.nodeBarList,s.vSegBarList=e.segBarList,s},h.common.ObjectHelper.inherit(c,l.ModelSpace),f.prototype.ft=function(t,i){this.gridSpaceObj=new g(i,this.reportError),this.op(t),this._t={ir:0,ic:0},this.im={x:t.x,y:t.y},this.Ct=this.gridSpaceObj.Dt(t,this._t.ir,this._t.ic,!0);t=this.gridSpaceObj.It();this.modelSpaceObj=new c(this.layoutSessionData,t,this.Ct,i,this.reportError)},f.prototype.up=function(t,i,r){null!==this.St(t,!0)&&(i=this.snapX(i),r=this.snapY(r),t.userFlag=!0)},f.prototype.moveNode=function(t,i,r){var n=this.Lv(),r=n.moveNode(t,i,r);r.moved&&(n.removeNode(t),this.gridSpaceObj.It().Bt(t,r.row,r.col),n.addNewNode(t,this.layoutSessionData.Ft))},f.prototype.fp=function(t){t=this.St(t,!1);null!==t&&this.removeNode(t)},f.prototype.removeNode=function(t){this.modelSpaceObj.removeNode(t),this.gridSpaceObj.removeNode(t)},
f.prototype.ap=function(t,i,r){t=this.St(t,!0);null!==t&&(i=this.snapX(i),r=this.snapY(r),this.resizeNode(t,i,r))},f.prototype.resizeNode=function(t,i,r){t.jn(i,r),this.modelSpaceObj.resizeNode(t)},f.prototype.Yl=function(t,i,r,n,s,h){this.ap(t,n,s)},f.prototype.cp=function(t,i){var r=this.gridSpaceObj,n=this.Ct,s=this.layoutSessionData.Ft;r.Et(n.ir,n.ic);i=r.am(t,i,s);this.vp(i),this.modelSpaceObj.Gt(i,s)},f.prototype.vp=function(t){for(var i=0,r=t.length;i<r;++i){var n=t[i],s=n.Zn();this.op(s),n.Hi(s.x,s.y),n.jn(s.w,s.h)}},f.prototype.op=function(t){if(t!==this.changeStateObj.zh){var i,r,n,s=this.layoutSessionData.edgeDist,h=this.snapX(t.x),e=this.snapY(t.y),o=Math.ceil(t.w/s.x)*s.x,u=Math.ceil(t.h/s.y)*s.y;0===o&&(o=s.x),0===u&&(u=s.y),i=h-t.x,r=e-t.y,t.x=h,t.y=e,t.w=o,t.h=u;for(var f,a=(f=t.ki).length,c=0;c<a;++c)(n=f[c]).x+=i,n.y+=r}},f.prototype.lp=function(t,i){var r=this.gridSpaceObj,n=this.Ct,s=this.layoutSessionData.Ft;r.Et(n.ir,n.ic);i=r.Um(t,i,s);this.vp(i),
this.modelSpaceObj.Gt(i,s)},f.prototype.exportState=function(t){var i={};return i.oriPt=this.im,i.oriCell=this._t,i.rootNode=t.getId(this.Ct.refNode.hostNode),i.gridData=this.gridSpaceObj.exportState(t),i.modelData=this.modelSpaceObj.exportState(t),i},f.createFromState=function(t,i,r,n,s,h){var e=s.oriCell,o=g.createFromState(e,r,n,s.gridData,h),u=o.ac(e.ir,e.ic).tabNode,e=o.It(),h=c.createFromState(t,e,u,r,n,s.modelData,h),n=new f(t,i,null,r,n,!0);return n.im=s.oriPt,n._t=s.oriCell,n.Ct=u,n.gridSpaceObj=o,n.modelSpaceObj=h,n},h.common.ObjectHelper.inherit(f,l.TableOperator),s.prototype.getHostRootNode=function(){return this.F0.hostNode},s.prototype.ls=function(){for(var t=[],i=this.u0,r=0,n=i.length;r<n;++r)t.push(i[r].hostNode);return t},s.prototype.G0=function(t,i,r,n){for(var s=[],h=0,e=i.length;h<e;++h){var o=this.H0(i[h],r[h],n[h]);o&&0<o.length&&(s=s.concat(o))}for(var u=!0,h=0,e=t.length;h<e;++h)if(!this.J0(t[h])){u=!1;break}u||this.reportError(
"The input nodes and edges are not match. Some input nodes are not added into relation tree.")},s.prototype.M0=function(t,i){for(var r=[],n=0,s=i.length;n<s;++n){var h=this.Q0(i[n]);h&&0<h.length&&(r=r.concat(h))}for(var e=t.slice(0);0<r.length;){var o=r.pop();if(!l.LayoutHelper.removeItemInList(o,e)){this.reportError("The input nodes and edges are not match. Some extra nodes are removed from relation tree.");break}}for(var u=!0,n=0,s=t.length;n<s;++n)if(this.J0(t[n])){u=!1;break}u||this.reportError("The input nodes and edges are not match. Some input nodes are not removed from relation tree."),this.dp()||this.reportError("There are some nodes cannot be reached from root.")},s.prototype.H0=function(t,i,r){if(!(h=this.V0(t))){var n=[],s=this.J0(i);s||(s=this.K0(i),n.push(i));i=this.J0(r);i||(i=this.K0(r),n.push(r));var h=this.W0(t,s,i);return s.X0(h,!0),i.X0(h,!1),n}},s.prototype.Q0=function(t){var i=this.V0(t);if(i){var r=i.srcRelNode,n=i.tarRelNode,s=r.Y0(i,!0),t=n.Y0(i,!1)
;s&&t||this.reportError("There is issue for relation's source and target node."),i.clear(),l.LayoutHelper.removeItemInList(i,this.allRelEdgeItems);t=[],i=this.gp(r);return i&&t.push(i),n!==r&&(i=this.gp(n))&&t.push(i),t}},s.prototype.gp=function(t){if(t.$0()&&t!==this.F0){var i=t.hostNode;return t.clear(),l.LayoutHelper.removeItemInList(t,this.u0),i}},s.prototype.removeNode=function(t){var i=this.J0(t);if(i){for(var r=i.T0;0<r.length;)this.Q0(r[0].hostEdge),r=i.T0;for(r=i.outRelEdges;0<r.length;)this.Q0(r[0].hostEdge),r=i.outRelEdges;(i=this.J0(t))&&this.reportError("The node is not removed.")}},s.prototype.mp=function(){return this.pp().orderHostNodes},s.prototype.wp=function(){return this.pp().hostTreeList},s.prototype.pp=function(){var t=[],i=[],r=this.u0;l.LayoutHelper.setAttrOnItems(r,"hasExpendOut",!1),l.LayoutHelper.setAttrOnItems(r,"hasExpendIn",!1);var n=[];for(n.push(this.F0);0<n.length;){var s,h=n.shift();h.hasExpendOut||(h.hasExpendOut=!0,s=this.bp(h,!0,i,t,n),
l.LayoutHelper.setAttrOnItems(s,"hasExpendOut",!0)),h.hasExpendIn||(h.hasExpendIn=!0,s=this.bp(h,!1,i,t,n),l.LayoutHelper.setAttrOnItems(s,"hasExpendIn",!0))}return{hostTreeList:i,orderHostNodes:t}},s.prototype.bp=function(t,i,r,n,s){var h=t.hostNode;l.LayoutHelper.findItemInList(h,n)<0&&n.push(h);var e=this.yp(h,i),h=e.hostTreeItem,o=e.traversedRelNodeItemList;o[0]!==t&&this.reportError("The traversed relation items have incorrect status."),1<o.length&&(h.isOutgoing=i,r.push(h));for(var u=1,f=o.length;u<f;++u){var a=o[u],c=a.hostNode;l.LayoutHelper.findItemInList(c,n)<0&&n.push(c),a.hasExpendOut&&a.hasExpendIn||s.push(a)}return o},s.prototype.yp=function(t,e){var r=this,i=this.J0(t),n=this.Sp,s={hostNode:t,childItems:[]},h={};return h.self=this,h.hostItemMap=new d.Map,h.hostItemMap.da(t,s),h.traversedRelNodeItemList=[],d.traverseGraphBFS(i,function(t){for(var i=t.w0(e),r=[],n=0,s=i.length;n<s;++n){var h=i[n];h.hasExpendOut||h.hasExpendIn||r.push(h)}return r},function(t,i){return r.rm(
t.hostNode,i.hostNode)},function(t,i){return t.hostNode===i.hostNode},n,h),{hostTreeItem:s,traversedRelNodeItemList:h.traversedRelNodeItemList}},s.prototype.Sp=function(t,i,r,n){var s=n.self,h=n.hostItemMap;n.traversedRelNodeItemList.push(t);t=t.hostNode,t=h.va(t);if(t)for(var e=t.childItems,o=0,u=r.length;o<u;++o){var f=r[o].hostNode,a={hostNode:f,childItems:[]};e.push(a),h.da(f,a)}else s.reportError("There is no corresponding tree item for host node.")},s.prototype.dp=function(){return this.getAllLinkedNodeOnTree().length===this.u0.length},s.prototype.getAllLinkedNodeOnTree=function(){var t=this.F0,i=this.Tp,r={allNodeList:[]};return d.traverseGraphBFS(t,function(t){var i=t.w0(!0),t=t.w0(!1);return i.concat(t)},null,function(t,i){return t.hostNode===i.hostNode},i,r),r.allNodeList},s.prototype.Tp=function(t,i,r,n){n=n.allNodeList,t=t.hostNode;n.indexOf(t)<0&&n.push(t)},s.prototype.J0=function(t){return t.nm},s.prototype.V0=function(t){return t.sm},s.prototype.K0=function(t){this.J0(t
)&&this.reportError("The input node has created relation item.");t=new r(t,this.reportError);return this.u0.push(t),t},s.prototype.W0=function(t,i,r){this.V0(t)&&this.reportError("The input edge has created relation item.");r=new n(t,i,r,this.reportError);return this.allRelEdgeItems.push(r),r},s.prototype.clear=function(){for(var t=this.u0,i=0,r=t.length;i<r;++i)t[i].clear();for(var n=this.allRelEdgeItems,i=0,r=n.length;i<r;++i)n[i].clear();this.u0=[],this.allRelEdgeItems=[]},r.prototype.X0=function(t,i){i=i?this.outRelEdges:this.T0;-1<i.indexOf(t)?this.reportError("The relation has already exist on node"):i.push(t)},r.prototype.Y0=function(t,i){i=i?this.outRelEdges:this.T0;return l.LayoutHelper.removeItemInList(t,i)},r.prototype.$0=function(){return this.outRelEdges.length<1&&this.T0.length<1},r.prototype.w0=function(t){var i=this.T0,r="srcRelNode";t&&(i=this.outRelEdges,r="tarRelNode");for(var n=[],s=0,h=i.length;s<h;++s){var e=i[s][r];n.indexOf(e)<0&&n.push(e)}return n},
r.prototype.clear=function(){this.hostNode.nm=null,this.hostNode=null},n.prototype.clear=function(){this.hostEdge.sm=null,this.hostEdge=null},u.prototype.getPoint=function(){var t=this.changeNode,i=t.x,r=t.y;switch(this.nodeSide){case"bottom":i+=this.upperRange+this.i0*(this.rank+1),r+=t.h;break;case"left":r+=this.upperRange+this.i0*(this.rank+1);break;case"right":i+=t.w,r+=this.upperRange+this.i0*(this.rank+1);break;case"top":i+=this.upperRange+this.i0*(this.rank+1)}return{x:i,y:r}},u.prototype.tl=function(){var t=this.changeNode,i=this.nodeSide;this.rank;t.gluePointLists[i].push(this)},u.prototype.pl=function(){this.vl(),this.changePort.Hu=null,this.changePort.hl===this&&(this.changePort.hl=null)},u.prototype.vl=function(){for(var t=this.changeNode,i=this.nodeSide,r=t.gluePointLists[i],n=0,s=r.length;n<s;n++)if(r[n]===this){r.splice(n,1);break}},h.common.ObjectHelper.inherit(u,l.GluePoint),o.prototype.Iu=function(t){var i,r=this.Au,n=this.changeStateObj.nList,s=n.length;if(
"fixed"!==t)if("equalSpacedOnOneSide"!==t){for(var h,e=0;e<s;++e)if(!(i=n[e]).ignore)for(var o,u=(o=i.ki).length,f=0;f<u;++f)(h=o[f]).Hu||!1===r.Tl(h)&&this.Nf(h);for(e=0;e<s;++e)(i=n[e]).ignore||this.Qa(i)}else{var a=this.n0();this.s0(a);for(var e=0;e<s;++e)(i=n[e]).ignore||(i.G2(),this.r0(i,a));b(a)}else for(var e=0;e<s;++e)(i=n[e]).ignore||this.$a(i)},o.prototype.xp=function(){for(var t,i,r=this.changeStateObj.nList,n=r.length,s=0;s<n;++s)if(!(t=r[s]).ignore&&t.vs!==l.UpdateReasons.NONE)if(t.vs&l.UpdateReasons.NEW)i||(i=this.n0(this.changeStateObj.Mp()),this.s0(i)),this.kp(t,i);else if(t.vs,l.UpdateReasons.MOVE,t.vs&l.UpdateReasons.RESIZE)for(var h=this.qp(t),e=0,o=h.length;e<o;e++){var u=h[e].side,f=h[e].ports,a=t.gluePointLists[u],u=a.length<=0?0:a[a.length-1].getPoint()[this.Lp()]-t[this.Lp()],a=t[this.l0()];this.m0(t,f,u,a)}};function a(t,i,r){return i=i.getPoint(),r=r.getPoint(),i=i[t.Lp()],t=r[t.Lp()],i<t?-1:t<i?1:0}o.prototype.qp=function(t){for(var i=[],r=this.Lp(),
n="y"===r?["left","right"]:["top","bottom"],s=0,h=n.length;s<h;s++){var e=t.gluePointLists[n[s]];e.sort(a.bind(null,this));for(var o=[],u=e.length-1;0<=u;u--){var f=e[u];if(!(f.getPoint()[r]-t[r]>=t[this.l0()]))break;o.unshift(f.changePort),f.pl()}i.push({side:n[s],ports:o})}return i},o.prototype.h0=function(t){for(var i=this.Au,r=t.ki,n=r.length,s=[],h=[],e=[],o=0;o<n;++o){var u=r[o];i.Tl(u)?(this.changeStateObj.u1(u)?s:h).push(u):e.push(u)}var f=this.li,t=this.layoutSessionData.Ft;return s.sort(p.bind(null,f,t)),h.sort(w.bind(null,f,t)),{sourcePorts:s,targetPorts:h,unconnectedPorts:e}};function v(t,i,r,n){var s=0;return(0==r||1==r)&&"outgoing"==n||(2==r||3==r)&&"incoming"==n?t.layer<=i.layer&&t.seq==i.seq?s=1:t.layer<=i.layer&&t.seq<i.seq?s=2:t.layer>i.layer&&t.seq<i.seq?s=3:t.layer>i.layer&&t.seq==i.seq?s=4:t.layer>i.layer&&t.seq>i.seq?s=5:t.layer<=i.layer&&t.seq>i.seq&&(s=6):(0!=r&&1!=r||"incoming"!=n)&&(2!=r&&3!=r||"outgoing"!=n)||(
t.layer>=i.layer&&t.seq==i.seq?s=1:t.layer>=i.layer&&t.seq<i.seq?s=2:t.layer<i.layer&&t.seq<i.seq?s=3:t.layer<i.layer&&t.seq==i.seq?s=4:t.layer<i.layer&&t.seq>i.seq?s=5:t.layer>=i.layer&&t.seq>i.seq&&(s=6)),s}function e(t,i){for(var r=0,n=i.length;r<n;r++)if(0<=i[r].nodes.indexOf(t))return!0;return!1}function m(t){var i=t.length;if(!(i<=0)){for(var r=t[0].conn.xORyValue,n=t[0].conn.xORyValue,s=1;s<i;s++)t[s].conn.xORyValue<r&&(r=t[s].conn.xORyValue),t[s].conn.xORyValue>n&&(n=t[s].conn.xORyValue);return{upperRange:r,lowerRange:n}}}var p=function(t,i,r,n){var s=r.ti,h=r.changeCon.yi,e=n.changeCon.yi,s=t.Tv(s),o=t.Tv(h),u=t.Tv(e),e=v(o,s,i,"outgoing"),s=v(u,s,i,"outgoing"),f=i===l.LayoutDirection.LeftToRight||i===l.LayoutDirection.TopToBottom,i=i===l.LayoutDirection.LeftToRight||i===l.LayoutDirection.RightToLeft;if(s<e)return 1;if(e<s)return-1;switch(e){case 1:case 4:if(o.layer<u.layer)return f?1:-1;if(o.layer>u.layer)return f?-1:1;break;case 2:case 3:if(o.layer>u.layer)return f?1:-1;if(
o.layer<u.layer)return f?-1:1;if(o.seq>u.seq)return 1;if(o.seq<u.seq)return-1;break;case 5:case 6:if(o.layer<u.layer)return f?1:-1;if(o.layer>u.layer)return f?-1:1;if(o.seq>u.seq)return 1;if(o.seq<u.seq)return-1}i=i?"y":"x",r=r.changeCon.pi.Hu,n=n.changeCon.pi.Hu;if(r&&n){r=r.getPoint(),n=n.getPoint();if(r[i]>n[i])return 1;if(r[i]<n[i])return-1}return 0},w=function(t,i,r,n){var s=r.ti,h=r.changeCon.bi,e=n.changeCon.bi,s=t.Tv(s),o=t.Tv(h),u=t.Tv(e),e=v(o,s,i,"incoming"),s=v(u,s,i,"incoming"),f=i===l.LayoutDirection.LeftToRight||i===l.LayoutDirection.TopToBottom,i=i===l.LayoutDirection.LeftToRight||i===l.LayoutDirection.RightToLeft;if(s<e)return 1;if(e<s)return-1;switch(e){case 1:case 4:if(o.layer>u.layer)return f?1:-1;if(o.layer<u.layer)return f?-1:1;break;case 2:if(o.seq<u.seq)return 1;if(o.seq>u.seq)return-1;if(o.layer<u.layer)return f?1:-1;if(o.layer>u.layer)return f?-1:1;break;case 3:if(o.seq>u.seq)return 1;if(o.seq<u.seq)return-1;if(o.layer<u.layer)return f?1:-1;if(o.layer>u.layer
)return f?-1:1;break;case 5:if(o.seq>u.seq)return 1;if(o.seq<u.seq)return-1;if(o.layer>u.layer)return f?1:-1;if(o.layer<u.layer)return f?-1:1;break;case 6:if(o.seq<u.seq)return 1;if(o.seq>u.seq)return-1;if(o.layer>u.layer)return f?1:-1;if(o.layer<u.layer)return f?-1:1}i=i?"y":"x",r=r.changeCon.mi.Hu,n=n.changeCon.mi.Hu;if(r&&n){r=r.getPoint(),n=n.getPoint();if(r[i]>n[i])return 1;if(r[i]<n[i])return-1}return 0},b=function(t){for(var i=0,r=t.length;i<r;i++)for(var n=t[i].connections,s=0,h=n.length;s<h;s++)n[s].isStraightLine&&(delete n[s].isStraightLine,delete n[s].xORyValue)};function y(t,i,r){l.SimpleHVPaths.call(this,t,i),this.tableOperatorObj=r}function S(t,i,r,n,s,h,e,o){this.reportError=o,this.Op=t,this.Hp=i,this.nList=r,this.edgeDist={x:20,y:20},this.edgeDist.x=n.x,this.edgeDist.y=n.y,this.Rp={w:s.w,h:s.h},this.Np=this.Ip(this.Rp.w,this.edgeDist.x),this.Ep=this.Ip(this.Rp.h,this.edgeDist.y),this.modelSpaceObj=h,this.hNodeBarList=h.hNodeBarList,this.vNodeBarList=h.vNodeBarList,
this.hSegBarList=h.hSegBarList,this.vSegBarList=h.vSegBarList,this.nc=e,this.nc.G1={x:0,y:0},this.nc.P1={x:0,y:0},this.Pp(),this.Vp(t,this.hSegBarList,this.hNodeBarList),this.Vp(i,this.vSegBarList,this.vNodeBarList),this.Ap=[],this.K1={H:"down",V:"right"}}function T(t,i,r,n,s,h,e,o){l.RsopDistribute.call(this,t,i,r,n,s,h,o);this.hNodeBarList=e.hNodeBarList,this.vNodeBarList=e.vNodeBarList,this.hSegBarList=e.hSegBarList,this.vSegBarList=e.vSegBarList}o.prototype.n0=function(t){for(var i=[],r=t||this.changeStateObj.cList,n=r.length,s=0;s<n;s++){var h,e,o=r[s];this.li.Dv(o)||(h=o.bi,e=o.yi,this.li.pc(h,e)&&this.li.Nv(h,e)&&this.Dp({nodes:[h,e],connections:[o]},i))}return i},o.prototype.Dp=function(t,i){if(i.length<=0)i.push(t);else{for(var r=!1,n=0,s=i.length;n<s;n++){var h=i[n],e=h.nodes,o=h.connections;if(this.li.pc(e[0],t.nodes[0])){e.indexOf(t.nodes[0])<0&&e.push(t.nodes[0]),e.indexOf(t.nodes[1])<0&&e.push(t.nodes[1]),h.connections.indexOf(t.connections[0])<0&&o.push(t.connections[0])
,r=!0;break}}r||i.push(t)}},o.prototype.s0=function(t){for(var i=0,r=t.length;i<r;i++)for(var n=t[i].nodes,s=t[i].connections,h=this.v0(n),e=0,o=s.length;e<o;e++)s[e].isStraightLine=!0,s[e].xORyValue=h/2},o.prototype.v0=function(t){for(var i=this.l0(),r=t[0][i],n=1,s=t.length;n<s;n++)t[n][i]<r&&(r=t[n][i]);return r},o.prototype.l0=function(){var t=this.layoutSessionData.Ft;return t===l.LayoutDirection.LeftToRight||t===l.LayoutDirection.RightToLeft?"h":"w"},o.prototype.Lp=function(){var t=this.layoutSessionData.Ft;return t===l.LayoutDirection.LeftToRight||t===l.LayoutDirection.RightToLeft?"y":"x"},o.prototype.kp=function(t,i){var r=this.h0(t),i=e(t,i);this.jp(t,r.sourcePorts,"source")||this.d0(t,r.sourcePorts,i),this.jp(t,r.targetPorts,"target")||this.d0(t,r.targetPorts,i)},o.prototype.jp=function(t,i,r){if(i.length<=0)return!0;var n="source"===r,s="bottom";switch(this.layoutSessionData.Ft){case 0:s=n?"bottom":"top";break;case 1:s=n?"right":"left";break;case 2:s=n?"top":"bottom";break
;case 3:s=n?"left":"right"}return!(t.gluePointLists[s].length<=0)&&(this.Cp(t,i),!0)},o.prototype.Cp=function(t,i){for(var r,n=[],s=[],h=0,e=0,o=i.length;e<o;e++)1&i[e].vs?n.push(i[e]):(r=i[e].Hu.getPoint()[this.Lp()]-t[this.Lp()],0<n.length&&(s.push({ports:n,upperRange:h,lowerRange:r}),n=[]),h=r);0<n.length&&s.push({ports:n,upperRange:h,lowerRange:t[this.l0()]});for(e=0,o=s.length;e<o;e++)this.m0(t,s[e].ports,s[e].upperRange,s[e].lowerRange)},o.prototype.r0=function(t,i){var r=this.h0(t),i=e(t,i);this.d0(t,r.sourcePorts,i),this.d0(t,r.targetPorts,i)},o.prototype.d0=function(t,i,r){if(!(i.length<=0)){var n=[];if(r){var s=this.b0(t,i);if(s.middle.length<=0)n.push(s.upper),n.push(s.lower);else{this.m0(t,s.upper,0,s.middleUpperValue);for(var h=0,e=s.middle.length;h<e;h++)this.m0(t,[s.middle[h].port],s.middle[h].conn.xORyValue,s.middle[h].conn.xORyValue);this.m0(t,s.lower,s.middleLowerValue,t[this.l0()])}}else n.push(i);for(var o=n.length,u=0;u<o;u++){var f=n[u];this.m0(t,f,0,t[this.l0()])
}}},o.prototype.b0=function(t,i){for(var r={upper:[],middle:[],lower:[]},n=0,s=i.length;n<s;n++){for(var h,e=i[n],o=!1,u=this.changeStateObj._i(e),f=0,a=u.length;f<a;f++)if(u[f].isStraightLine){o=!0,h=u[f];break}o?r.middle.push({port:e,conn:h}):(r.middle.length<=0?r.upper:r.lower).push(e)}this.g0(t,r);t=m(r.middle);return t&&(r.middleUpperValue=t.upperRange,r.middleLowerValue=t.lowerRange),r},o.prototype.g0=function(t,i){if(!(i.middle.length<=1)){for(var r=!1,n=i.middle[0].conn.xORyValue,s=1,h=i.middle.length;s<h;s++)i.middle[s].conn.xORyValue===n&&(r=!0);if(r){for(var e=t[this.l0()],o=i.upper.concat(),u=i.middle.concat(),f=i.lower.concat();1<u.length;){var a=o.length,c=f.length,v=n;0<a&&(v/=a+1);a=e-n;0<c&&(a/=c+1),a<=v?o.push(u.shift()):f.unshift(u.pop())}var l=n,t=o.length;0<t&&(l/=t+1);for(s=(h=t)-1;0<=s;s--)o[s].conn&&(o[s].conn.xORyValue=n-l*(h-s));var d=e-n,t=f.length;0<t&&(d/=t+1);for(s=0,h=t;s<h;s++)f[s].conn&&(f[s].conn.xORyValue=n+d*(s+1));this.p0(i.middle,n,o,f)}}},
o.prototype.p0=function(t,i,r,n){for(var s=t[0].conn.yi[this.l0()],h=0,e=0,o=0,u=r.length;o<u;o++)r[o].conn&&h++;for(o=0,u=n.length;o<u;o++)n[o].conn&&e++;t=m(t);if(t.upperRange<=0)for(var f=i/(h+1),o=h-1;0<=o;o--)r[o].conn.xORyValue=i-f*(h-o);if(t.lowerRange>=s)for(f=(s-i)/(e+1),o=0;o<e;o++)n[o].conn.xORyValue=i+f*(o+1)},o.prototype.m0=function(t,i,r,n){for(var s=i.length,h=0;h<s;++h){var e=i[h],o=this.changeStateObj._i(e);new u("attachment",this.changeStateObj.wi(e),r,n,s,h,t,e,o)}},o.prototype.yf=function(t){var i=t.Hu;if(i)for(var r=i.changeNode,n=i.nodeSide,s=r.gluePointLists[n],h=s.length-1;0<=h;h--)(i=s[h])&&i.changePort===t&&i.pl()},o.prototype.Vu=function(){},o.prototype.Fu=function(t){for(var i,r,n=this.changeStateObj,s=t.ki,h=s.length,e=0;e<h;++e)(i=s[e]).ignore||(r=i.Hu)&&(r=r.getPoint(),i.Hi(r.x-i.w/2,r.y-i.h/2),n.Vi(i))},h.common.ObjectHelper.inherit(o,l.AllocateGluePoints),y.prototype.$t=function(t,i,r,n,s,h){var e=t.ti,o=n.ti,u=this.ii(t,i,r),t=this.ii(n,s,h),n=null;if(
this.si(u,t)){if(this.hi(u,t))return this.ri(e,i,u,o,s,t,r);(n=[]).push(i),n.push(u),n.push(t),n.push(s)}else{h=this.ni(u,t,r);if(this.oi(u,h,t)&&(h=this.ni(t,u,r),this.oi(u,h,t)))return this.ri(e,i,u,o,s,t,r);(n=[]).push(i),n.push(u),n.push(h),n.push(t),n.push(s)}return n&&(this.fi(n,0)&&n.splice(1,1),this.fi(n,n.length-3)&&n.splice(n.length-2,1)),n},y.prototype.ri=function(t,i,r,n,s,h,e){var o=this.tableOperatorObj.Tv(t),u=this.tableOperatorObj.Tv(n),n="left"===e||"right"===e?"H":"V",o=o.seq>=u.seq?"up":"down",u=this.tableOperatorObj.ei(t,n,o),t=(u.min+u.max)/2;u.upBar&&u.nextBar||(f=this.tableOperatorObj.modelSpaceObj.ai(n)/2,"up"==o?t=u.max-f:"down"==o&&(t=u.min+f));var u={x:r.x,y:r.y},f={x:h.x,y:h.y},e="left"===e||"right"===e?"y":"x";u[e]=t,f[e]=t;t=[];return t.push(i),t.push(r),t.push(u),t.push(f),t.push(h),t.push(s),t},y.prototype.ii=function(t,i,r){var n=t.ti,s="left"===r||"right"===r?"V":"H",h="right"===r||"down"===r?"down":"up",t=this.tableOperatorObj.ei(n,s,h),n=(t.min+t.max
)/2;t.upBar&&t.nextBar||(s=this.tableOperatorObj.modelSpaceObj.ai(s)/2,"up"==h?n=t.max-s:"down"==h&&(n=t.min+s));i={x:i.x,y:i.y};return"down"===r?i.y=n:"left"===r||"right"===r?i.x=n:"up"===r&&(i.y=n),i},y.prototype.hi=function(t,i){for(var r,n=Math.min(t.x,i.x),s=Math.max(t.x,i.x),h=Math.min(t.y,i.y),e=Math.max(t.y,i.y),o=this.changeStateObj.nList,u=o.length,f=0;f<u;++f)if(!(r=o[f]).ignore&&this.ui(r,n,h,s,e))return!0;return!1},h.common.ObjectHelper.inherit(y,l.SimpleHVPaths),S.prototype.Tw=function(t,i){for(var r=-1,n=t.length;r<n;++r){var s=t[r];s&&this.Up(s,i)}var h=this.Op;"H"===i&&(h=this.Hp),this.Bp(h)},S.prototype.Up=function(t,i){var r=this.nc,n=t.segs;if(!(n.length<2)){var s=this.edgeDist.y,h=this.Np;"V"===i&&(s=this.edgeDist.x,h=this.Ep);for(var e=r.Vw(n),o=e.shift();o;)if(o.length<2)o=e.shift();else{if(o=r.Dw(o),this.modelSpaceObj.rp(t,i))for(u=(o=this.Gp(o,t,i,s,h).remainSegs).length-1;0<u;--u){f=o[u];this.zp(f,t,-s,i,h)}else for(var u=(o=this.Fp(o,t,i,s,h).remainSegs
).length-1;0<u;--u){var f=o[u];this.zp(f,t,s,i,h)}o=e.shift()}}},S.prototype.Bp=function(t){for(var i=0,r=t.length;i<r;++i){var n,s=t[i];s.port1&&(n=s.gp1.getPoint(),s.p1.x=n.x,s.p1.y=n.y),s.port2&&(n=s.gp2.getPoint(),s.p2.x=n.x,s.p2.y=n.y)}},S.prototype.Fp=function(t,i,r,n,s){for(var h=[],e=[],o=t.length-1,u=0,f=t.length-1;u<f;++u){var a=t[u];if(!this.Xp(a,i,r,n,s)){o=u;break}h.push(a)}for(u=o,f=t.length;u<f;++u)e.push(t[u]);return{movedSegs:h,remainSegs:e}},S.prototype.Gp=function(t,i,r,n,s){for(var h=[],e=[],o=0,u=t.length-1;0<u;--u){var f=t[u];if(!this.Yp(f,i,r,n,s)){o=u;break}h.push(f)}for(u=o;0<=u;--u)e.push(t[u]);return{movedSegs:h,remainSegs:e}},S.prototype.Xp=function(t,i,r,n,s){var h=-n,e=t.ew()+h,o=i.segs,u=[];if(this.Jp(r,e,t.p1,t.p2,h,o,u),u.push(t),this.Kp(u)+h<i.rg()+(0===s?n:s))return!1;for(var f=0,a=u.length;f<a;++f){var c=u[f];c.lw(c.ew()+h)}return!0},S.prototype.Yp=function(t,i,r,n,s){var h=n,e=t.ew()+h,o=i.segs,u=[];this.Jp(r,e,t.p1,t.p2,h,o,u),u.push(t);t=this.Qp(u
);if(i.hg()-(0===s?n:s)<t+h)return!1;for(var f=u.length-1;0<=f;--f){var a=u[f];a.lw(a.ew()+h)}return!0},S.prototype.Jp=function(t,i,r,n,s,h,e){for(var o=[],u=0,f=h.length;u<f;++u)(a=h[u]).Wp(t,i,r,n)&&e.indexOf(a)<0&&(e.push(a),o.push(a));for(u=0,f=o.length;u<f;++u){var a=o[u];this.Jp(t,a.ew()+s,a.p1,a.p2,s,h,e)}},S.prototype.Kp=function(t){var i=t.length;if(!(i<1)){for(var r=t[0].ew(),n=1;n<i;++n){var s=t[n].ew();s<r&&(r=s)}return r}this.reportError("The input seg list is empty.")},S.prototype.Qp=function(t){var i=t.length;if(!(i<1)){for(var r=t[0].ew(),n=1;n<i;++n){var s=t[n].ew();r<s&&(r=s)}return r}this.reportError("The input seg list is empty.")},S.prototype.Ip=function(t,i){return Math.round(t/2/i)*i+i},S.prototype.zp=function(t,i,r,n,s){var h=t.ew()+r;this.Zp(n,h,t.p1,t.p2,i,r,s);var e=i.og(),o=e.min+s,s=e.max-s,h=t.ew()+r,r=i.Zw+Math.abs(r);if(this.modelSpaceObj.rp(i,n)){if(s<h)return void this.reportError("The segment bar cannot grow to right or bottom.");h<o&&i.grow(r,"up")
}else{if(h<o)return void this.reportError("The segment bar cannot grow to left or top.");s<h&&i.grow(r,"down")}t.lw(h)},S.prototype.Zp=function(t,i,r,n,s,h,e){for(var o=s.segs,u=0,f=o.length;u<f;++u){var a=o[u];a.ew()===i&&(a.port1||a.port2||a.Wp(t,i,r,n)&&this.zp(a,s,h,t,e))}},S.prototype.Vp=function(t,i,r){for(var n=0,s=t.length;n<s;++n){var h=t[n],e=h.ew(),o=this.$p(i,e);(o=o||this.$p(r,e))?o.tg(h):this.reportError("Some segments are not added in bar in RSOP.")}},S.prototype._p=function(t){for(var i=-1,r=t.length;i<r;++i){var n=t[i];n&&n.sg()}},S.prototype.Pp=function(){this._p(this.hNodeBarList),this._p(this.vNodeBarList),this._p(this.hSegBarList),this._p(this.vSegBarList)},S.prototype.$p=function(t,i){for(var r=-1,n=t.length;r<n;++r){var s=t[r];if(s&&s.dg(i))return s}return null},h.common.ObjectHelper.inherit(T,l.RsopDistribute);var x=T.__base__.prototype;function M(t,i,r){l.RemoveSegOverlaps.call(this,t,i,r),this.zo=this.layoutSessionData.zo;r=r.Lv()
;this.hNodeBarList=r.hNodeBarList,this.vNodeBarList=r.vNodeBarList,this.hSegBarList=r.hSegBarList,this.vSegBarList=r.vSegBarList,this.Mb=new S(this.hPathSegList,this.vPathSegList,this.changeStateObj.nList,this.edgeDist,this.zo,r,this.nc,this.reportError),this.nc=new T(this.layoutSessionData,this.hPathSegList,this.vPathSegList,this._1,this.W1,this.changeStateObj,r,this.reportError)}T.prototype.pw=function(t,i){var r=x.pw.call(this,t,i),n=r.min,r=r.max;if(t.length<2)this.reportError("TableRsopDistribute: the num of overlaps is small than 2.");else{t=t[0].ew(),t=this.Hb(t,i);if(t){i=t.rg(),t=t.hg();return this.Ib(n=null===n||n<i?i:n,r=null===r||t<r?t:r)}this.reportError("TableRsopDistribute: the corresponding bar is not found.")}},T.prototype.Hb=function(t,i){var r,i="H"===i?(r=this.hNodeBarList,this.hSegBarList):(r=this.vNodeBarList,this.vSegBarList);return this.Eb(i,t)||this.Eb(r,t)},T.prototype.Eb=function(t,i){for(var r=-1,n=t.length;r<n;++r){var s=t[r];if(s&&s.dg(i))return s}
return null},h.common.ObjectHelper.inherit(M,l.RemoveSegOverlaps),M.prototype.Hw=function(){var t=this.layoutSessionData.Ft,i=t===l.LayoutDirection.LeftToRight||t===l.LayoutDirection.RightToLeft?"H":"V",t=this;this.changeStateObj.isPartialUpdate&&(r=this.Vb(),n=this.Ab(r),t.hSegBarList=r.hSegBarList,t.vSegBarList=r.vSegBarList,t.hPathSegList=n.hPathSegList,t.vPathSegList=n.vPathSegList);var r=this.Db(t.hPathSegList),n=this.Db(t.vPathSegList);this.Cb(t),this.tc&&("H"==i?(this.Mb.Tw(t.vSegBarList,"V"),this.Mb.Tw(t.hSegBarList,"H")):(this.Mb.Tw(t.hSegBarList,"H"),this.Mb.Tw(t.vSegBarList,"V")),this.ho.So()),this.Ub(t.hPathSegList,r,this._1),this.Ub(t.vPathSegList,n,this.W1),"H"==i?(this.Tw(t.vPathSegList,"V",!1),this.Tw(t.hPathSegList,"H",!1)):(this.Tw(t.hPathSegList,"H",!1),this.Tw(t.vPathSegList,"V",!1)),this.Cw(t.hPathSegList,"H"),this.Cw(t.vPathSegList,"V"),this.Gb()},M.prototype.Db=function(t){for(var i=[],r=0,n=t.length;r<n;++r)i.push(t[r].ew());return i},M.prototype.Ub=function(t,i
,r){for(var n=0,s=t.length;n<s;++n){var h=t[n],e=i[n],o=h.ew();e!==o&&r.nw(h,e,o)}};function k(t,i,r,n){for(var s=-1,h=t.length;s<h;s++){var e=t[s];if(e)for(var o=i.rp(e,n)?e.max-r:e.min+r,u=e.segs,f=0,a=u.length;f<a;f++)u[f].lw(o)}}M.prototype.Cb=function(t){var i=this.Mb.modelSpaceObj,r=this.Mb.Np,n=this.Mb.Ep;k(t.vSegBarList,i,n,"V"),k(t.hSegBarList,i,r,"H")},M.prototype.Gb=function(){this.Mb.Pp();for(var t=["top","bottom","left","right"],i=this.changeStateObj.nList,r=0,n=i.length;r<n;++r){var s=i[r];s.segList=null;for(var h=0,e=t.length;h<e;++h){var o=s.gluePointLists[t[h]];if(o)for(var u=0,f=o.length;u<f;++u){var a=o[u];a&&(a.segList=null)}}}};function q(t){for(var i=[],r=-1,n=t.length;r<n;r++){var s=t[r];if(s)for(var h=0,e=s.segs.length;h<e;h++)if(s.segs[h].connection.Ti){i.push(s);break}}return i}M.prototype.Vb=function(){var t=q(this.vSegBarList);return{hSegBarList:q(this.hSegBarList),vSegBarList:t}};function L(t){for(var i=[],r=0,n=t.length;r<n;r++)var s=t[r],i=i.concat(s.segs
);return i}function O(t,i,r){l.HVPaths.call(this,t,i,r,t.isRSOPEnabled)}function H(){l.LayoutSessionData.call(this)}function R(t,i,r,n){l.ChangeState.call(this,t,i,r,n)}function N(t){this.We=null,this.hostInterfaceObj=t,this.reportError=t.reportError,this.layoutSessionData=new H,this.changeStateObj=null,this.ho=null,this.tableOperatorObj=null,this.relationTreeObj=null,this.compoundCommands=!1,this.nodeOverlapXYPencentage={x:.5,y:.5},this.zb=!0,this.tm={nodeOverlapXYPencentage:this.nodeOverlapXYPencentage,preventInsert:!0,nodePlacement:l.NodePlacementOption.AnchorPointAlignment,layoutSpacingMode:"compact"},this.Fb=function(){return 0},this.isPartialUpdate=!1}M.prototype.Ab=function(t){var i=L(t.vSegBarList),r=L(t.hSegBarList),n=L(this.vNodeBarList),t=L(this.hNodeBarList),i=i.concat(n);return{hPathSegList:r=r.concat(t),vPathSegList:i}},h.common.ObjectHelper.inherit(O,l.HVPaths),O.prototype.fs=function(){this.jw(this.layoutSessionData.at)?this.Ew():(this.vi(),this.lc&&new M(
this.layoutSessionData,this.changeStateObj,this.li).Hw(),this.Fw())},O.prototype.vi=function(){this.ci=new y(this.layoutSessionData,this.changeStateObj,this.li);for(var t,i=this.changeStateObj,r=i.isPartialUpdate?this.di():i.cList,n=r.length,s=0;s<n;++s)(t=r[s]).ignore||this.gi(t)},O.prototype.gi=function(t){var i=t.bi,r=t.yi,n=t.mi,s=t.pi,h=n.Hu,e=s.Hu;if(!h||!e)return t.Bi=null,void(t.E2=null);var o=h.getPoint(),u=e.getPoint(),f=this.Li[h.nodeSide],a=this.Li[e.nodeSide];t.Wu&&(t.Zu?f=this.Yw(i,h,f):a=this.Yw(r,e,a));a=this.ci.$t(n,o,f,s,u,a);t.Bi=a,t.Ti=!0},h.common.ObjectHelper.inherit(H,l.LayoutSessionData),R.prototype.Mp=function(){for(var t=[],i=this.cList,r=i.length,n=0;n<r;n++)i[n].vs&l.UpdateReasons.NEW&&t.push(i[n]);return t},h.common.ObjectHelper.inherit(R,l.ChangeState),N.prototype.setNodeOverlapXYPercentage=function(t,i){this.nodeOverlapXYPencentage.x=t,this.nodeOverlapXYPencentage.y=i},N.prototype.setNodePlacement=function(t){this.tm.nodePlacement=t},
N.prototype.setLayoutSpacingMode=function(t){"compact"!==t&&"balance"!==t&&(this.reportError("Layout spacing mode only support: compact/balance. Input is "+t),t="compact"),this.tm.layoutSpacingMode=t},N.prototype.isActive=function(){return null!==this.changeStateObj},N.prototype.deactivateSortedLayout=function(){this.clear(!1)},N.prototype.clear=function(t){null!==this.changeStateObj&&this.changeStateObj.xi(),null!==this.tableOperatorObj&&this.tableOperatorObj.qi(),t||null===this.relationTreeObj||this.relationTreeObj.clear(),this.changeStateObj=null,this.ho=null,this.tableOperatorObj=null,this.relationTreeObj=null},N.prototype.activateSortedLayout=function(t){t=new s(t,this.Xb(),this.reportError);this.Yb(t,[])},N.prototype.Yb=function(t,i){var r=this.hostInterfaceObj,n=this.layoutSessionData;n.Ft=r.getLayoutDirection(),n.nodeDist=r.getNodeToNodeDist(),n.edgeDist=r.getEdgeToEdgeDist(),r.getStandardPortSize&&(n.zo=r.getStandardPortSize()),n.minSegmentLength=r.getMinSegmentLength(),
n.at=r.getIncUpdatePathType(),n.isRSOPEnabled=r.isRSOPEnabled(),n.Vo=!r.isMakeRoomInRSOPDisabled();var s=(this.relationTreeObj=t).getHostRootNode(),h=t.ls();this.changeStateObj=new R(r,n,h,i),this.tableOperatorObj=new f(n,this.changeStateObj,this.Ni(s,!0),this.tm,this.reportError),this.ho=new o(n,this.changeStateObj,this.tableOperatorObj);n=this.changeStateObj;n.Lo(),this.Jb(t),n.Uo("sideOffset"),this.ho.Iu("equalSpacedOnOneSide"),this.U()},N.prototype.Jb=function(t){this.tableOperatorObj;for(var i=this.Xb(),r=t.wp(),n=r.length,s=0;s<n;++s){var h=r[s],e=h.isOutgoing;!0!==e&&!1!==e&&this.reportError("The flag has invalid value");h=this.buildChangeNodeTree(h,i);this.Kb(h,e)}},N.prototype.reLayout=function(){if(!1===this.isActive())return this.reportError("SortedLayout Mode is not Active!"),!1;for(var t=this.relationTreeObj,i=[],r=this.changeStateObj.cList,n=0,s=r.length;n<s;++n)i.push(r[n].Si);return this.clear(!0),this.Yb(t,i),!0},N.prototype.updateOnNodeMoved=function(t){if(
!1===this.isActive())return this.reportError("SortedLayout Mode is not Active!"),!1;var i=this.changeStateObj.Fi(t);if(!i)return this.reportError("changeState: a node that is not in the change state"),!1;i=this.tableOperatorObj.St(i,!0),t=this.hostInterfaceObj.getNodeRect(t);return this.tableOperatorObj.moveNode(i,t.x,t.y),this.isPartialUpdate?this.ho.xp():this.ho.Iu("equalSpacedOnOneSide"),this.U(),!0},N.prototype.filterOn=function(t,i){if(!1===this.isActive())return this.reportError("SortedLayout Mode is not Active!"),!1;this.relationTreeObj.M0(t,i);for(var r=0,n=i.length;r<n;++r)this.Qb(i[r]);for(r=0,n=t.length;r<n;++r)this.Wb(t[r]);return!0},N.prototype.filterOff=function(t,i,r){if(!1===this.isActive())return this.reportError("SortedLayout Mode is not Active!"),!1;1!==r&&this.reportError("The show option 2 and 3 is not implemented yet."),!1===this.Of(t)&&this.reportError("Some nodes have already exited in graph."),!1===this.If(i)&&this.reportError(
"Some connections have already exited in graph.");r=this.changeStateObj;return this.jb(t,i),r.Lo(),this.Jb(this.relationTreeObj),r.Uo("sideOffset"),this.Zb(i),this.ho.Iu("equalSpacedOnOneSide"),this.U(),!0},N.prototype.Wb=function(t){var i=this.Ni(t,!1);i&&(0<this.changeStateObj.Ii(i).length&&this.reportError("The node should have no connections when node is removed."),this.tableOperatorObj.fp(i),this.changeStateObj.removeNode(t))},N.prototype.removeConnection=function(t){return!1===this.isActive()?(this.reportError("SortedLayout Mode is not Active!"),!1):(this.Ri(t,!1)&&(this.relationTreeObj.Q0(t),this.Qb(t)),!0)},N.prototype.Qb=function(t){var i=this.Ri(t,!1);if(!i)return!0;var r=i.mi;1===this.changeStateObj._i(r).length&&(this.ho.yf(r),this.changeStateObj.removePort(r.Ci));r=i.pi;return 1===this.changeStateObj._i(r).length&&(this.ho.yf(r),this.changeStateObj.removePort(r.Ci)),this.ho.pf(i),this.changeStateObj.removeConnection(t),!0},N.prototype.removeNode=function(t){if(
!1===this.isActive())return this.reportError("SortedLayout Mode is not Active!"),!1;var i=this.Ni(t,!1);if(!i)return!0;this.relationTreeObj.removeNode(t),this.tableOperatorObj.fp(i);for(var r=this.changeStateObj.Ii(i),n=r.length,s=0;s<n;++s)this.Qb(r[s].Si);return this.changeStateObj.removeNode(t),!0},N.prototype.updateOnNodeResized=function(t,i){if(!1===this.isActive())return this.reportError("SortedLayout Mode is not Active!"),!1;if(i){if(!t||0===t.length)return this.reportError("No Nodes to be resized."),!1;for(var r=!0,n=0;n<t.length;n++){if(!this.nodeInTable(t[n]))return this.reportError("Some nodes have not been added into layout."),!1;var s,h=this.Ni(t[n],!0);h.isOutOfControl||((s=this.hostInterfaceObj.getNodeRect(t[n])).h===h.h&&s.w===h.w||(r=r&&!1,this.tableOperatorObj.ap(h,s.w,s.h)))}return r||(this.isPartialUpdate?this.ho.xp():this.ho.Iu("equalSpacedOnOneSide"),this.U()),!0}for(var e=this.changeStateObj,n=0;n<t.length;n++)e.Y2(t[n]);return!0},
N.prototype.expandOutgoing=function(t,i){return this.expandMultipleLevel(t,i,!0)},N.prototype.expandIncoming=function(t,i){return this.expandMultipleLevel(t,i,!1)},N.prototype.expandMultipleLevel=function(t,i,r){if(!1===this.isActive())return this.reportError("SortedLayout Mode is not Active!"),!1;var n=t.hostNode;if(!this.Ni(n,!0))return!1;n=this.getAllNodesInHostTree(t);this.jb(n,i);n=this.buildChangeNodeTree(t,this.Xb()),t=this.changeStateObj;t.Lo(),this.Kb(n,r),t.Uo("sideOffset");this.Zb(i);return this.isPartialUpdate?this.ho.xp():this.ho.Iu("equalSpacedOnOneSide"),this.U(),!0},N.prototype.Kb=function(t,i){"balance"===this.tm.layoutSpacingMode?this.tableOperatorObj.lp(t,i):this.tableOperatorObj.cp(t,i)},N.prototype.jb=function(t,i){for(var r=this.hostInterfaceObj,n=[],s=[],h=0,e=i.length;h<e;++h){var o=i[h],u=r.getSourceNode(o),o=r.getTargetNode(o);n.push(u),s.push(o)}this.relationTreeObj.G0(t,i,n,s)},N.prototype.Zb=function(t){for(var i=[],r=this.hostInterfaceObj,
n=this.changeStateObj,s=0,h=t.length;s<h;++s){var e=t[s];if(!(a=this.Ri(e,!1))){var o,u=r.getSourcePort(e),f=r.getTargetPort(e);if(!u||!f)return this.reportError("SortedLayout: Can not add dangling connection!"),!1;!1===n.ji(u)&&(o=n.addNewPort(u))&&(o.Oi=2),!1===n.ji(f)&&(o=n.addNewPort(f))&&(o.Oi=1),n.addNewConnection(e);var a=this.Ri(e,!0);n.Pi(a),i.push(a)}}return i},N.prototype.Xb=function(){return this.Fb},N.prototype.registerCompareNodesCallback=function(t){this.Fb=t},N.prototype.nodeInTable=function(t){return this.changeStateObj.zi(t)},N.prototype.connectionInTable=function(t){return this.changeStateObj.Di(t)},N.prototype.portInTable=function(t){return this.changeStateObj.ji(t)},N.prototype.beginCompoundCommands=function(){this.compoundCommands=!0},N.prototype.endCompoundCommandsAndUpdate=function(){this.compoundCommands=!1,this.U()},N.prototype.U=function(){var t;this.ho.Vu(),this.ho.So(),!1===this.compoundCommands&&((t=this.changeStateObj).isPartialUpdate=this.isPartialUpdate
,this.$b(),new O(this.layoutSessionData,t,this.tableOperatorObj),t.update(1),this.We&&this.We.call(this),t.Ei())},N.prototype.buildChangeNodeTree=function(t,r){var i=t.hostNode,n=this.Ni(i,!0);if(!n)return null;var s={csNode:n,childItems:[]},i={};i.self=this,i.csItemMap=new d.Map,i.csItemMap.da(n,s);n=this.callBackCreateChangeNodeTree;return d.traverseGraphBFS(t,function(t){return t.childItems},function(t,i){return r(t.hostNode,i.hostNode)},function(t,i){return t.hostNode===i.hostNode},n,i),s},N.prototype.callBackCreateChangeNodeTree=function(t,i,r,n){var s=n.self,h=n.csItemMap,t=t.hostNode,t=s.Ni(t,!0);if(!t)return null;for(var e=s.changeStateObj,o=h.va(t).childItems,u=0,f=r.length;u<f;++u){var a=r[u].hostNode,c=s.Ni(a,!1),a={csNode:c=c||e.addNewNode(a),childItems:[]};o.push(a),h.da(c,a)}},N.prototype.getAllNodesInHostTree=function(t){var i=this.callBackGetAllNodesInTree,r={allNodeList:[]};return d.traverseGraphBFS(t,function(t){return t.childItems},null,function(t,i){
return t.hostNode===i.hostNode},i,r),r.allNodeList},N.prototype.callBackGetAllNodesInTree=function(t,i,r,n){n=n.allNodeList,t=t.hostNode;n.indexOf(t)<0&&n.push(t)},N.prototype.reportError=function(t){this.reportError(t)},N.prototype.Ni=function(t,i){t=this.changeStateObj.Fi(t);return t||(i&&this.reportError("SortedLayout: node not found in change state"),null)},N.prototype.nf=function(t){return null!==this.Ni(t)&&(this.reportError("SortedLayout: request to a add new node for a node that is already defined"),!0)},N.prototype.Of=function(t){for(var i=t.length,r=0;r<i;++r)if(this.nf(t[r]))return!1;return!0},N.prototype.Ri=function(t,i){t=this.changeStateObj.Gi(t);return t||(i&&this.reportError("SortedLayout: connection not found in change state"),null)},N.prototype.wf=function(t){return null!==this.Ri(t,!1)&&(this.reportError("SortedLayout: request to a add new connnection for an connection that is already defined in SortedLayout"),!0)},N.prototype.If=function(t){for(var i=t.length,
r=0;r<i;++r)if(this.wf(t[r]))return!1;return!0},N.prototype._b=function(){var t=this.changeStateObj,i=t.nList,r=this.relationTreeObj.mp();if(r.length===i.length){for(var n=[],s=0,h=r.length;s<h;++s){var e=this.Ni(r[s],!0);if(!e)return void this.reportError("Change node does not exist for a node.");n.push(e)}t.nList=n}else this.reportError("The node num is not correct.")},N.prototype.$b=function(){var t;switch(this._b(),this.layoutSessionData.Ft){case l.LayoutDirection.TopToBottom:t="bottom";break;case l.LayoutDirection.LeftToRight:t="right";break;case l.LayoutDirection.BottomToTop:t="top";break;case l.LayoutDirection.RightToLeft:t="left"}for(var i=this.changeStateObj,r=i.nList,n=i.cList,s=[],h=0,e=r.length;h<e;h++)for(var o=r[h].gluePointLists[t],u=0,f=o.length;u<f;u++)for(var a=o[u].attachmentList,c=0,v=a.length;c<v;c++)s.push(a[c].changeCon);s.length===n.length?i.cList=s:this.reportError("The connection number is not correct.")},N.prototype.exportState=function(t){var i={}
;return i.layoutSessionData=this.layoutSessionData,i.nodeOverlapXYPencentage=this.nodeOverlapXYPencentage,i.retainOriginalPosition=this.zb,i.configObj=this.tm,i.isPartialUpdate=this.isPartialUpdate,{cfgData:i,tableData:this.tableOperatorObj.exportState(t)}},N.createFromState=function(t,i,r,n,s,h){var e=new N(t);e.Fb=n;t=s.cfgData,n=s.tableData;e.layoutSessionData=t.layoutSessionData,e.nodeOverlapXYPencentage=t.nodeOverlapXYPencentage,e.zb=t.retainOriginalPosition,e.tm=t.configObj,e.isPartialUpdate=t.isPartialUpdate;s=h.getObjById(n.rootNode);return I(e,s,i,r),e.changeStateObj=new R(e.hostInterfaceObj,e.layoutSessionData,i,r),e.tableOperatorObj=f.createFromState(t.layoutSessionData,e.changeStateObj,t.configObj,e.reportError,n,P(h,e)),e.ho=new o(e.layoutSessionData,e.changeStateObj,e.tableOperatorObj),E(e.changeStateObj.cList,e.hostInterfaceObj),e};var I=function(t,i,r,n){i=new s(i,t.Xb(),t.reportError);return t.relationTreeObj=i,t.jb(r,n),i},E=function(t,i){for(var r=0,
n=t.length;r<n;++r){for(var s=t[r],h=i.getPath(s.Si),e=[],o=0,u=h.length;o<u;++o){var f=h[o];e.push({x:f.x,y:f.y})}s.su=h,s.Bi=e}},P=function(i,r){return{getCsObjById:function(t){t=i.getObjById(t);return r.Ni(t,!0)}}};function V(t){this.idCount=0,this.hostInterfaceObj=t,this.ty=new l.LayoutHelper.Map,this.iy=new l.LayoutHelper.Map,this.ry=new l.LayoutHelper.Map,this.ny=[],this.sy=this.hy()}function A(t){this.uid=0,this.xs=t,this.As={x:0,y:0,w:0,h:0},this.Ls=!1,this.Ds=!1,this.ey=null,this.oy=[],this.uy=[],this.fy=!0,this.ay=!1}function D(t){this.uid=0,this.xs=t,this.hh=[],this.cy=null,this.vy=null,this.fy=!0}function j(t){this.uid=0,this.xs=t,this.As={x:0,y:0,w:0,h:0},this.ey=null,this.ly=null,this.dy=[],this.fy=!0}function C(){D.call(this,null),this.gy=!0}function U(){j.call(this,null),this.gy=!0}function B(i){this.hostInterfaceObj=i,l.LayoutHelper.copyMethodsFrom(this,this.hostInterfaceObj),this.getNodeRect=function(t){return t.ir()},this.setNodeRect=function(t,i,r,n,s){t.gr(i,r,n,s)
},this.getStandardPortSize=function(){return{w:0,h:0}},this.getPortRect=function(t){return t.ir()},this.setPortRect=function(t,i,r,n,s){t.gr(i,r,n,s)},this.getParentNode=function(t){t=t.getParentNode();return t&&this.reportError("There should be no parent relation for sorted layout."),t},this.getNodePriority=function(t){return 1},this.isExpanded=function(t){t=t.isExpanded();return t&&this.reportError("There should be no expanded node for sorted layout."),t},this.isGroupNode=function(t){t=t.isGroupNode();return t&&this.reportError("There should be no group for sorted layout."),t},this.getGroupNodePadding=function(t){return t&&this.reportError("There should be no node with padding for sorted layout."),{top:0,bottom:0,left:0,right:0}},this.getGroupNodeKeepOutArea=function(t,i){return this.reportError("There should be no node with keep out area for sorted layout."),{x:0,y:0,w:0,h:0}},this.getSourcePort=function(t){return t.getSourcePort()},this.getTargetPort=function(t){
return t.getTargetPort()},this.getNodeOfPort=function(t){return t.my()},this.getAllPortsForNode=function(t){return t.bo()},this.getAllConnectionsForPort=function(t){return t.py()},this.getSourceNode=function(t){return t.getSourceNode()},this.getTargetNode=function(t){return t.getTargetNode()},this.getPath=function(t){return t.getPath()},this.setPath=function(t,i){t.setPath(i)},this.setGluePoints=function(t,i){},this.getPortLabel=function(t){return null},this.getConnectionLabel=function(t){return null},this.getLabelRect=function(t){return null},this.setLabelRect=function(t,i,r,n,s){},this.stopDisplayUpdate=function(){},this.updateDisplay=function(){},this.makePoint=function(t,i){return{x:t,y:i}},this.getPortBehavior=function(t){return"layoutAllocatedPortFloat"},this.getObjectKey=function(t){return t.uid},this.reportError=function(t){i.reportError(t)}}function G(t,i,r,n){this.layoutSessionData=t,this.hostInterfaceObj=i,this.changeStateObj=r,this.li=n,this.wy=new V(i),this.by=new B(i),
this.lt=l.LayoutDirection.TopToBottom,this.ct=l.LayoutDirection.LeftToRight,this.wt=l.LayoutDirection.BottomToTop,this.pt=l.LayoutDirection.RightToLeft}V.prototype.yy=function(t){var i=this.Sy(t);this.Ty(i,[]),this.xy();t=this.My(t);return{slTree:t,slEdges:this.ky(t)}},V.prototype.qy=function(t,i,r){var n=i.slice(0);n.push(t);for(var s=0,h=n.length;s<h;++s)this.addNode(n[s],n);for(var e=this.Ly(t),i=this.Oy(e,r),t=i.slStructEdges,o=i.hostRemainEdges,u=[],s=0,h=o.length;s<h;++s){var f=this.addEdge(o[s]);u.push(f)}this.ty.ya()!==n.length&&this.ty.ya()!==n.length-1&&this.reportError("The input nodes may have issue."),this.ry.ya()!==r.length&&this.reportError("The input edges may have issue."),this.Hy(this.sy,!0),this.Ry(),this.Ny(),this.xy();r=this.Iy();return e!==this.sy&&(l.LayoutHelper.removeItemInList(e,r)||this.reportError("Seed node is not in SL node list.")),{slSeedNode:e,slNodes:r,slStructEdges:t=this.Ey(t,!0),slNormalEdges:u=this.Ey(u,!0)}},V.prototype.Py=function(t,i,r){
i=i.slice(0);i.push(t),this.Ty(i,r),this.xy();i=this.Iy(),r=this.Vy(),t=this.Ly(t);return l.LayoutHelper.removeItemInList(t,i)||this.reportError("Seed node is not in SL node list."),{slSeedNode:t,slNodes:i,slEdges:r}},V.prototype.Ty=function(t,i){for(var r=0,n=t.length;r<n;++r)this.addNode(t[r],t);for(r=0,n=i.length;r<n;++r)this.addEdge(i[r]);this.ty.ya()!==t.length&&this.ty.ya()!==t.length-1&&this.reportError("The input nodes may have issue."),this.ry.ya()!==i.length&&this.reportError("The input edges may have issue."),this.Hy(this.sy,!0),this.Ry(),this.Ny()},V.prototype.addNode=function(t,i){var r=this.ty;if(h=this.Ly(t))return h;var n=this.hostInterfaceObj,s=n.getNodeRect(t),h=this.createRawNode(t);r.da(t,h);r=h.As;r.x=s.x,r.y=s.y,r.w=s.w,r.h=s.h,h.Ls=n.isGroupNode(t),h.Ds=n.isExpanded(t);s=null,n=n.getParentNode(t);return(s=!n?this.sy:s)||l.LayoutHelper.findItemInList(t,i)<0&&(s=this.sy),s=s||this.addNode(n,i),this.Ay(h,s),h},V.prototype.addEdge=function(t){var i=this.ry,r=i.va(t)
;if(r)return r;var n=this.hostInterfaceObj,s=n.getSourcePort(t),h=n.getTargetPort(t),e=n.getNodeOfPort(s),n=n.getNodeOfPort(h),e=this.Ly(e),n=this.Ly(n);if(!e||!n)return this.reportError("Edge's end node may be not in input node list"),null;r=this.createRawEdge(t),i.da(t,r);e=this.Dy(s,e),n=this.Dy(h,n);return this.jy(r,e,n),r},V.prototype.Dy=function(t,i){var r=this.iy,n=r.va(t);if(n)return n;n=this.createRawPort(t),r.da(t,n);r=this.hostInterfaceObj.getPortRect(t),t=n.As;return t.x=r.x,t.y=r.y,t.w=r.w,t.h=r.h,this.Cy(n,i),n},V.prototype.Cy=function(t,i){(t.ey||t.ly)&&this.reportError("SL port has been added on some node."),t.ey=i,t.ly=i,l.LayoutHelper.addUniqueItemInList(t,i.uy)},V.prototype.Ay=function(t,i){t.ey=i,l.LayoutHelper.addUniqueItemInList(t,i.oy)},V.prototype.jy=function(t,i,r){t.cy=i,t.vy=r,l.LayoutHelper.addUniqueItemInList(t,i.dy),l.LayoutHelper.addUniqueItemInList(t,r.dy)},V.prototype.Hy=function(t,i){for(var r=t.oy,n=(n=i)&&!(t.Ls&&!t.Ds),s=0,h=r.length;s<h;++s){
var e=r[s];this.Uy(e,n),this.Hy(e,n)}},V.prototype.Ry=function(){for(var t=this.ry.Na(),i=0,r=t.length;i<r;++i){var n=t[i];n.fy=!0,this.By(n)&&(n.fy=!1)}},V.prototype.Uy=function(t,i){t.fy=i;for(var r=t.uy,n=0,s=r.length;n<s;++n)r[n].fy=i},V.prototype.Ny=function(){for(var t=this.py(),i=0,r=t.length;i<r;++i){var n=t[i];n.fy&&(this.Gy(n.cy),this.Gy(n.vy))}},V.prototype.Gy=function(t){var i=t.ey,r=this.zy(i);r&&(l.LayoutHelper.removeItemInList(t,i.uy),t.ey=r,t.ly=i,l.LayoutHelper.addUniqueItemInList(t,r.uy),t.fy=!0)},V.prototype.Iy=function(){var t=this.ty.Na();return this.Ey(t,!0)},V.prototype.Vy=function(){var t=this.ry.Na();return this.Ey(t,!0)},V.prototype.Fy=function(){for(var t=[],i=this.Vy(),r=0,n=i.length;r<n;++r){var s=i[r],h=s.getSourcePort(),s=s.getTargetPort();h&&t.indexOf(h)<0&&t.push(h),s&&t.indexOf(s)<0&&t.push(s)}return t},V.prototype.Ey=function(t,i){for(var r=[],n=0,s=t.length;n<s;++n){var h=t[n];h.fy===i&&r.push(h)}return r},V.prototype.Sy=function(t){var i=[];i.push(
t.hostNode);for(var r=t.childItems,n=r?r.length:0,s=0;s<n;++s){var h=this.Sy(r[s]);0<h.length&&(i=i.concat(h))}return i},V.prototype.My=function(t){var i=t.hostNode,i=this.Ly(i);if(!i.fy)return null;for(var r=[],n=t.childItems,s=n?n.length:0,h=0;h<s;++h){var e=this.My(n[h]);e&&r.push(e)}return{hostNode:i,childItems:r}},V.prototype.ky=function(t){for(var i=[],r=t.hostNode,n=t.childItems,s=0,h=n.length;s<h;++s){var e=n[s].hostNode,e=this.Xy(r,e);i.push(e)}for(s=0,h=n.length;s<h;++s)var o=this.ky(n[s]),i=i.concat(o);return i},V.prototype.Oy=function(t,i){for(var r=[],n=i.slice(0),s=t.Yy(),h=t.oy,e=0,o=h.length;e<o;++e){var u=null,f=h[e],a=f.Yy(),c=this.Jy(s,a,n),a=c.hostRelationEdge,n=c.hostRemainEdges;(u=a?this.addEdge(a):this.Xy(t,f))&&r.push(u),n=(c=this.Oy(f,n)).hostRemainEdges,r=r.concat(c.slStructEdges)}return{slStructEdges:r,hostRemainEdges:n}},V.prototype.Jy=function(t,i,r){for(var n=this.hostInterfaceObj,s=-1,h=0,e=r.length;h<e;++h){var o=r[h],u=n.getSourceNode(o),
o=n.getTargetNode(o);if(u===t&&o===i){s=h;break}}var f=null,a=r.slice(0);return-1<s&&(f=r[s],a.splice(s,1)),{hostRelationEdge:f,hostRemainEdges:a}},V.prototype.Xy=function(t,i){var r=this.createRawFakeEdge(),n=this.createRawFakePort(),s=this.createRawFakePort();return this.Cy(n,t),this.Cy(s,i),this.jy(r,n,s),this.ny.push(r),r},V.prototype.hy=function(){var t=this.createRawNode(null);return t.Ls=!0,t.Ds=!0,t.ay=!0,t},V.prototype.xy=function(){var t=this.Iy(),i=t.length;if(0!==i){for(var r=t[0].ir(),n=r.w,s=r.h,h=1;h<i;++h)0<(r=t[h].ir()).w&&n>r.w&&(n=r.w),0<r.h&&s>r.h&&(s=r.h);this.sy.gr(0,0,n,s)}},V.prototype.Ly=function(t){return t?this.ty.va(t):this.sy},V.prototype.ls=function(){for(var t=[],i=this.ty.Na(),r=0,n=i.length;r<n;++r)t.push(i[r].Yy());return t},V.prototype.Ky=function(){return this.ty.Na()},V.prototype.py=function(){return this.ry.Na()},V.prototype.Qy=function(t){return t?t.oy:[]},V.prototype.By=function(t){var i=t.cy.ey,r=t.vy.ey,n=this.zy(i),t=this.zy(r);return!(
!n||n!==t)||(!(!i.Ls||i.Ds||!this.Uv(r,i))||!(!r.Ls||r.Ds||!this.Uv(i,r)))},V.prototype.Wy=function(t,i){if(i===this.sy)return i;for(var r=t.ey;r;){if(this.Uv(i,r))return r;r=r.ey}return null},V.prototype.Uv=function(t,i){var r=this.sy;if(i===r)return!0;for(var n=t.ey;n!==r;){if(n===i)return!0;n=n.ey}return!1},V.prototype.zy=function(t){for(var i=null,r=t.ey;r;)r.Ds||(i=r),r=r.ey;return i},V.prototype.createRawNode=function(t){t=new A(t);return t.uid=this.idCount++,t},V.prototype.createRawPort=function(t){t=new j(t);return t.uid=this.idCount++,t},V.prototype.createRawEdge=function(t){t=new D(t);return t.uid=this.idCount++,t},V.prototype.createRawFakePort=function(){var t=new U;return t.uid=this.idCount++,t},V.prototype.createRawFakeEdge=function(){var t=new C;return t.uid=this.idCount++,t},V.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},A.prototype.Yy=function(){return this.xs},A.prototype.gr=function(t,i,r,n){this.As.x=t,this.As.y=i,this.As.w=r,this.As.h=n},
A.prototype.ir=function(){var t=this.As;return{x:t.x,y:t.y,w:t.w,h:t.h}},A.prototype.getParentNode=function(){return null},A.prototype.isExpanded=function(){return!!this.isGroupNode()&&this.Ds},A.prototype.isGroupNode=function(){return!1},A.prototype.bo=function(){return this.uy},D.prototype.Yy=function(){return this.xs},D.prototype.getSourcePort=function(){return this.cy},D.prototype.getTargetPort=function(){return this.vy},D.prototype.getSourceNode=function(){return this.getSourcePort().my()},D.prototype.getTargetNode=function(){return this.getTargetPort().my()},D.prototype.getPath=function(){return this.hh},D.prototype.setPath=function(t){this.hh=t},j.prototype.Yy=function(){return this.xs},j.prototype.ir=function(){var t=this.As;return{x:t.x,y:t.y,w:t.w,h:t.h}},j.prototype.gr=function(t,i,r,n){this.As.x=t,this.As.y=i,this.As.w=r,this.As.h=n},j.prototype.my=function(){return this.ey},j.prototype.py=function(){return this.dy},h.common.ObjectHelper.inherit(C,D),
h.common.ObjectHelper.inherit(U,j),G.prototype.Da=function(t){var i=this.wy.yy(t),r=i.slTree,t=i.slEdges,i=this.wy.Iy();r&&(t.length<1||(r=r.hostNode,l.LayoutHelper.removeItemInList(r,i)||this.reportError("Seed node is not in SL node list."),this.Zy(r,i,t,[]),this.$y()))},G.prototype.yo=function(t,i,r){var n=this.wy.qy(t,i,r),t=n.slSeedNode,i=n.slNodes,r=n.slStructEdges,n=n.slNormalEdges;this.Zy(t,i,r,n),this.$y()},G.prototype._y=function(t,i,r){t=this.wy.Py(t,i,r),i=t.slSeedNode,r=t.slNodes,t=t.slEdges;this.Zy(i,r,t,[]),this.$y()},G.prototype.Zy=function(t,i,r,n){var s=new h.common.ObjectHelper.rootNamespace.Layout.SortedLayout(this.by);s.setLayoutSpacingMode("balance"),s.setNodePlacement(l.NodePlacementOption.LayoutDirection),s.activateSortedLayout(t),s.beginCompoundCommands(),s.filterOff(i,r,1),0<n.length&&(s.setLayoutSpacingMode("compact"),s.filterOff([],n,1)),s.endCompoundCommandsAndUpdate(),s.deactivateSortedLayout()},G.prototype.$y=function(){this.tS(),this.iS(),this.rS()},
G.prototype.tS=function(){var t=this.changeStateObj,i=this.wy,r=i.ls();this.ha(r);for(var n=0,s=r.length;n<s;++n){var h=r[n];(u=t.Fi(h,!0))&&(f=u.$n,l.LayoutHelper.removeItemInList(u,f._n))}for(var e=[],o=i.Ky(),n=0,s=o.length;n<s;++n){var u,f,a=o[n],c=a.ir(),h=a.Yy();(u=t.Fi(h,!0))&&(e.push(u),(f=u.$n)._n.push(u),this.nS(u,c.x,c.y))}for(n=0,s=e.length;n<s;++n)t._l(e[n],"relative")},G.prototype.iS=function(){for(var t=this.changeStateObj,i=this.hostInterfaceObj,r=this.wy.py(),n=0,s=r.length;n<s;++n){var h=r[n],e=h.Yy();if(e){e=t.Gi(e,!0);if(e){var o=h.getPath();if(1<o.length){for(var u=[],f=[],a=0,c=o.length;a<c;++a){var v=o[a];u.push({x:v.x,y:v.y}),f.push(i.makePoint(v.x,v.y))}e.Bi=u,e.su=f}}}}},G.prototype.rS=function(){for(var t=this.changeStateObj,i=this.wy.Fy(),r=0,n=i.length;r<n;++r){var s=i[r],h=s.Yy();if(h){h=t.ru(h,!0);if(h){if(h.Hu||h.hl)return;s=s.ir();h.x=s.x,h.y=s.y,t.Vi(h)}}}},G.prototype.ha=function(t){for(var i=this.changeStateObj,r=i.zh,n=0,s=t.length;n<s;++n){
var h=i.Fi(t[n],!0);h&&h.Jh&&(h.$n===r&&h.Qh?h.uf=!1:h.uf=!0)}},G.prototype.nS=function(t,i,r){var n=this.li,s=this.Ha();t.$n.uf||(i=n.snapX(i),r=n.snapY(r),n.Tf(t,i,r,s))},G.prototype.Ha=function(){var t="any";switch(this.layoutSessionData.Ft){case this.lt:t="leftOrRightOrDown";break;case this.wt:t="leftOrRightOrUp";break;case this.ct:t="upOrDownOrRight";break;case this.pt:t="upOrDownOrLeft"}return t},G.prototype.reportError=function(t){this.hostInterfaceObj.reportError(t)},h.common.ObjectHelper.rootNamespace=h.common.ObjectHelper.rootNamespace||{};var z=h.common.ObjectHelper.rootNamespace;z.Layout=z.Layout||{},z.Layout.SortedLayout=N,z.Layout.TreeSLLayouter=G;t={};return t.Layout=z.Layout||{},t.Layout.SortedLayout=N,t.Layout.TreeSLLayouter=G,t},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("@diagramming/layoutcore"),require("@diagramming/astar"),require("@diagramming/core")):"function"==typeof define&&define.amd?define(["@diagramming/layoutcore",
"@diagramming/astar","@diagramming/core"],n):((t=t||self).diagramfoundation=t.diagramfoundation||{},t.diagramfoundation.sortedlayout=n(t.diagramfoundation.layoutcore,t.diagramfoundation.astar,t.diagramfoundation.core));