/*
Copyright (c) 2012-2014 Chris Pettitt

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
// @<COPYRIGHT>@
// ==================================================
// Portions Copyright Siemens 2020.
// Enhance to support nested node
// Enhance to support fixed port
// ==================================================
// @<COPYRIGHT>@
var t,n;t=this,n=function(n,r,t){"use strict";r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;try{N=r}catch(n){}var o=N=N||window.graphlib;try{nn=t}catch(n){}var G=nn=nn||window._,a=i;function i(){var n={};n.h=n.Wo=n,this.Jo=n}function u(n){n.Wo.h=n.h,n.h.Wo=n.Wo,delete n.h,delete n.Wo}function e(n,r){if("_next"!==n&&"_prev"!==n)return r}i.prototype.dequeue=function(){var n=this.Jo,r=n.Wo;if(r!==n)return u(r),r},i.prototype.enqueue=function(n){var r=this.Jo;n.Wo&&n.h&&u(n),n.h=r.h,r.h.Wo=n,(r.h=n).Wo=r},i.prototype.toString=function(){for(var n=[],r=this.Jo,t=r.Wo;t!==r;)n.push(JSON.stringify(t,e)),t=t.Wo;return"["+n.join(", ")+"]"};var f=o.Graph,c=function(r,n){if(r.nodeCount()<=1)return[];n=function(n,o){var i=new f,u=0,e=0;G.forEach(n.nodes(),function(n){i.setNode(n,{v:n,in:0,out:0})}),G.forEach(n.edges(),function(n){var r=i.edge(n.v,n.w)||0,t=o(n);i.setEdge(n.v,n.w,r+t),e=Math.max(e,i.node(n.v
).out+=t),u=Math.max(u,i.node(n.w).in+=t)});var r=G.range(e+u+3).map(function(){return new a}),t=u+1;return G.forEach(i.nodes(),function(n){d(r,t,i.node(n))}),{graph:i,buckets:r,zeroIdx:t}}(r,n||v),n=function(n,r,t){var o,i=[],u=r[r.length-1],e=r[0];for(;n.nodeCount();){for(;o=e.dequeue();)l(n,r,t,o);for(;o=u.dequeue();)l(n,r,t,o);if(n.nodeCount())for(var a=r.length-2;0<a;--a)if(o=r[a].dequeue()){i=i.concat(l(n,r,t,o,!0));break}}return i}(n.graph,n.buckets,n.zeroIdx);return G.flatten(G.map(n,function(n){return r.outEdges(n.v,n.w)}),!0)},v=G.constant(1);function l(o,i,u,n,e){var a=e?[]:void 0;return G.forEach(o.inEdges(n.v),function(n){var r=o.edge(n),t=o.node(n.v);e&&a.push({v:n.v,w:n.w}),t.out-=r,d(i,u,t)}),G.forEach(o.outEdges(n.v),function(n){var r=o.edge(n),n=n.w,n=o.node(n);n.in-=r,d(i,u,n)}),o.removeNode(n.v),a}function d(n,r,t){(t.out?t.in?n[t.out-t.in+r]:n[n.length-1]:n[0]).enqueue(t)}var s={run:function(t){var n="greedy"===t.graph().acyclicer?c(t,function(r){return function(n
){return r.edge(n).weight}}(t)):function(t){var o=[],i={},u={};return G.forEach(t.nodes(),function r(n){G.has(u,n)||(u[n]=!0,i[n]=!0,G.forEach(t.outEdges(n),function(n){G.has(i,n.w)?o.push(n):r(n.w)}),delete i[n])}),o}(t);G.forEach(n,function(n){var r=t.edge(n);t.removeEdge(n),r.forwardName=n.name,r.reversed=!0,t.setEdge(n.w,n.v,r,G.uniqueId("rev"))})},undo:function(o){G.forEach(o.edges(),function(n){var r,t=o.edge(n);t.reversed&&(o.removeEdge(n),r=t.forwardName,delete t.reversed,delete t.forwardName,o.setEdge(n.w,n.v,t,r))})}};var g=o.Graph,M={addDummyNode:h,simplify:function(o){var i=(new g).setGraph(o.graph());return G.forEach(o.nodes(),function(n){i.setNode(n,o.node(n))}),G.forEach(o.edges(),function(n){var r=i.edge(n.v,n.w)||{weight:0,minlen:1},t=o.edge(n);i.setEdge(n.v,n.w,{weight:r.weight+t.weight,minlen:Math.max(r.minlen,t.minlen)})}),i},asNonCompoundGraph:function(r){var t=new g({multigraph:r.isMultigraph()}).setGraph(r.graph());return G.forEach(r.nodes(),function(n){
r.children(n).length||t.setNode(n,r.node(n))}),G.forEach(r.edges(),function(n){t.setEdge(n,r.edge(n))}),t},successorWeights:function(t){var n=G.map(t.nodes(),function(n){var r={};return G.forEach(t.outEdges(n),function(n){r[n.w]=(r[n.w]||0)+t.edge(n).weight}),r});return G.zipObject(t.nodes(),n)},predecessorWeights:function(t){var n=G.map(t.nodes(),function(n){var r={};return G.forEach(t.inEdges(n),function(n){r[n.v]=(r[n.v]||0)+t.edge(n).weight}),r});return G.zipObject(t.nodes(),n)},intersectRect:function(n,r){var t,o=n.x,i=n.y,u=r.x-o,e=r.y-i,r=n.width/2,n=n.height/2;if(!u&&!e)throw new Error("Not possible to find intersection inside of the rectangle");u=Math.abs(e)*r>Math.abs(u)*n?(t=(n=e<0?-n:n)*u/e,n):(t=r=u<0?-r:r)*e/u;return{x:o+t,y:i+u}},buildLayerMatrix:function(o){var i=G.map(G.range(p(o)+1),function(){return[]});return G.forEach(o.nodes(),function(n){var r=o.node(n),t=r.rank;G.isUndefined(t)||(i[t][r.order]=n)}),i},normalizeRanks:function(r){var t=G.min(G.map(r.nodes(),
function(n){return r.node(n).rank}));G.forEach(r.nodes(),function(n){n=r.node(n);G.has(n,"rank")&&(n.rank-=t)})},removeEmptyRanks:function(t){var o=G.min(G.map(t.nodes(),function(n){return t.node(n).rank})),i=[];G.forEach(t.nodes(),function(n){var r=t.node(n).rank-o;i[r]||(i[r]=[]),i[r].push(n)});var u=0,e=t.graph().nodeRankFactor;G.forEach(i,function(n,r){G.isUndefined(n)&&r%e!=0?--u:u&&G.forEach(n,function(n){t.node(n).rank+=u})})},addBorderNodeTopBottom:function(n,r,t,o){return h(n,"border",{oriNode:o,nType:t,width:0,height:0},r)},maxRank:p,partition:function(n,r){var t={lhs:[],rhs:[]};return G.forEach(n,function(n){(r(n)?t.lhs:t.rhs).push(n)}),t},removeNodesByNType:function(t,o){G.forEach(t.nodes(),function(n){var r=t.node(n).nType;0<=o.indexOf(r)&&t.removeNode(n)})},removeEdgesByEType:function(t,o){G.forEach(t.edges(),function(n){var r=t.edge(n).eType;0<=o.indexOf(r)&&t.removeEdge(n)})},getEdgeParent:function(n,r){var t=null,o=r.v,i=r.w,u=n.parent(o),r=n.parent(i);t=u===r?u:(
r=0<n.children(o).length,u=0<n.children(i).length,u&&m(n,o,i)?i:r&&m(n,i,o)?o:b(n,o,i));return void 0===t?null:t},findOutmostGroup:function(n,r,t){t=t||null;var o=n.parent(r);o=o||null;if(o===t)return o;var i=void 0;for(;o;){var u=n.parent(o);if((u=u||null)===t){i=o;break}o=u}return i},findCommonParent:b,isADescentOfB:m,getTopMostGroup:function(n,r){var t=null,o=n.parent(r);for(;o;)t=o,o=n.parent(o);return t},getLayerIdDP:function(n){n=n.graph().dpmaps;return n?n.LAYER_ID_DP_KEY:null},getEdgePortConstraintDP:function(n){n=n.graph().dpmaps;return n?n.EDGE_PORT_CONSTRAINT_DP_KEY:null},reportError:function(n){console&&console.error&&console.error("Dagre: "+n)},time:function(n,r){var t=G.now();try{return r()}finally{console.log(n+" time: "+(G.now()-t)+"ms")}},notime:function(n,r){return r()}};function h(n,r,t,o){for(var i;i=G.uniqueId(o),n.hasNode(i););return t.dummy=r,n.setNode(i,t),i}function p(r){return G.max(G.map(r.nodes(),function(n){n=r.node(n).rank;if(!G.isUndefined(n))return n}))}
function b(n,r,t){for(var o=n.parent(r);o&&!m(n,t,o);)o=n.parent(o);return o||null}function m(n,r,t){for(var o=n.parent(r);o;){if(o===t)return!0;o=n.parent(o)}return!1}var y={run:function(r){r.graph().dummyChains=[],G.forEach(r.edges(),function(n){!function(n,r){var t,o,i,u=r.v,e=n.node(u).rank,a=r.w,f=n.node(a).rank,c=r.name,v=n.edge(r),l=v.labelRank;if(f!==e+1){for(n.removeEdge(r),i=0,++e;e<f;++i,++e)v.points=[],o={nType:"normalize",width:0,height:0,edgeLabel:v,edgeObj:r,rank:e},t=M.addDummyNode(n,"edge",o,"_d"),e===l&&(o.nType="edge-label",o.width=v.width,o.height=v.height,o.dummy="edge-label",o.labelpos=v.labelpos),w(n,u,t,r,v,c),0===i&&n.graph().dummyChains.push(t),u=t;w(n,u,a,r,v,c)}}(r,n)})},undo:function(c){G.forEach(c.graph().dummyChains,function(n){var r=c.node(n),t=r.edgeLabel,o=r.edgeObj;for("onGroup"===t.eType&&(t.oriAttr.points=t.points),c.setEdge(o,t);r.dummy;){t.points.push({x:r.x,y:r.y}),"edge-label"===r.dummy&&(t.x=r.x,t.y=r.y,t.width=r.width,t.height=r.height);for(
var i=null,u=c.successors(n),e=0,a=u.length;e<a;++e){var f=u[e];if(c.node(f).edgeObj===o){i=f;break}}if(!i)break;n=i,r=c.node(n)}})}};function w(n,r,t,o,i,u){i={eType:"normalize",weight:i.weight,oriEdge:o,oriAttr:i};n.setEdge(r,t,i,u)}var k=function(o){var i={};G.forEach(o.sources(),function r(n){var t=o.node(n);if(G.has(i,n))return t.rank;i[n]=!0;n=G.min(G.map(o.outEdges(n),function(n){return r(n.w)-o.edge(n).minlen}));return n!==Number.POSITIVE_INFINITY&&null!=n||(n=0),t.rank=n})},x=function(o){var i={};G.forEach(o.nodes(),function r(n){var t=o.node(n);if(G.has(i,n))return t.rank;i[n]=!0;n=G.max(G.map(o.inEdges(n),function(n){return r(n.v)+o.edge(n).minlen}));return n!==Number.NEGATIVE_INFINITY&&null!=n||(n=0),t.rank=n})},r=function(n,r){return n.node(r.w).rank-n.node(r.v).rank-n.edge(r).minlen},N=function(n,r,t){var o=n[t];o||(o=[],n[t]=o);o.push(r)},t=function(n,r,t){var o=!1,t=n[t];!t||0<=(r=t.indexOf(r))&&(t.splice(r,1),o=!0);return o};var E=o.Graph,R=r,T=function(n){var r,
t=new E({directed:!1}),o=n.nodes()[0],i=n.nodeCount();t.setNode(o,{});for(;function(i,u){return G.forEach(i.nodes(),function t(o){G.forEach(u.nodeEdges(o),function(n){var r=n.v,r=o===r?n.w:r;i.hasNode(r)||R(u,n)||(i.setNode(r,{}),i.setEdge(o,r,{}),t(r))})}),i.nodeCount()}(t,n)<i;)r=function(r,t){return G.minBy(t.edges(),function(n){if(r.hasNode(n.v)!==r.hasNode(n.w))return R(t,n)})}(t,n),r=t.hasNode(r.v)?R(n,r):-R(n,r),function(n,r,t){G.forEach(n.nodes(),function(n){r.node(n).rank+=t})}(t,n,r);return t};var L=r,O=k,_=o.alg.preorder,B=o.alg.postorder,I=M.simplify,z=C;function C(n){n=I(n),O(n);var r,t=T(n);for(A(t),F(t,n);r=D(t);)P(t,n,r,S(t,n,r))}function F(i,u){var n=(n=B(i,i.nodes())).slice(0,n.length-1);G.forEach(n,function(n){var r,t,o;t=u,o=n,n=(r=i).node(o).parent,r.edge(o,n).cutvalue=j(r,t,o)})}function j(o,i,u){var e=o.node(u).parent,a=!0,n=i.edge(u,e),f=0;return n||(a=!1,n=i.edge(e,u)),f=n.weight,G.forEach(i.nodeEdges(u),function(n){var r=n.v===u,t=r?n.w:n.v;t!==e&&(r=r===a,
n=i.edge(n).weight,f+=r?n:-n,o.hasEdge(u,t)&&(t=o.edge(u,t).cutvalue,f+=r?-t:t))}),f}function A(n,r){arguments.length<2&&(r=n.nodes()[0]),function r(t,o,i,u,n){var e=i,a=t.node(u);o[u]=!0;G.forEach(t.neighbors(u),function(n){G.has(o,n)||(i=r(t,o,i,n,u))});a.low=e;a.lim=i++;n?a.parent=n:delete a.parent;return i}(n,{},1,r)}function D(r){return G.find(r.edges(),function(n){return r.edge(n).cutvalue<0})}function S(r,t,n){var o=n.v,i=n.w;t.hasEdge(o,i)||(o=n.w,i=n.v);var o=r.node(o),i=r.node(i),u=o,e=!1;o.lim>i.lim&&(u=i,e=!0);i=G.filter(t.edges(),function(n){return e===W(0,r.node(n.v),u)&&e!==W(0,r.node(n.w),u)});return G.minBy(i,function(n){return L(t,n)})}function P(n,r,t,o){var i,u,e=t.v,t=t.w;n.removeEdge(e,t),n.setEdge(o.v,o.w,{}),A(n),F(n,r),i=n,u=r,r=G.find(i.nodes(),function(n){return!u.node(n).parent}),r=(r=_(i,r)).slice(1),G.forEach(r,function(n){var r=i.node(n).parent,t=u.edge(n,r),o=!1;t||(t=u.edge(r,n),o=!0),u.node(n).rank=u.node(r).rank+(o?t.minlen:-t.minlen)})}function W(n,r
,t){return t.low<=r.lim&&r.lim<=t.lim}C.initLowLimValues=A,C.initCutValues=F,C.calcCutValue=j,C.leaveEdge=D,C.enterEdge=S,C.exchangeEdges=P;var q=x,U=N,H=t,J=function(n){n.nodes().length<1||(q(n),function(n){if(!(n.nodes().length<1)){!function(t){G.forEach(t.edges(),function(n){var r=t.edge(n);switch(r.oriWeight=r.weight,r.eType){case"root":case"nesting":case"crossRelation":r.weight=0;break;default:r.weight=1}})}(n);var r=function(t){var o={};return G.forEach(t.nodes(),function(n){var r;t.children(n).length<1&&(r=t.node(n).rank,U(o,n,r))}),o}(n),t=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;G.forEach(r,function(n,r){(r=parseInt(r))<t&&(t=r),o<r&&(o=r)});for(var i=n.graph().nodeRankFactor*n.graph().edgefactor,u=o-1;t<=u;--u)!function(n,r,t,o){var i=t[r];if(i&&!(i.length<1)){i=i.slice(0);for(var u=0,e=i.length;u<e;++u){var a=i[u],f=function(n,r){var t=[],o=n.node(r);"bb"===o.nType?(o=o.oriNode,t=function r(t,n){var o=[];G.forEach(t.children(n),function(n){t.children(n
).length<1?o.push(n):(n=r(t,n),o=o.concat(n))});return o}(n,o)):t.push(r);return t}(n,a),a=function(n,r){for(var t=void 0,o=0,i=r.length;o<i;++o){var u=r[o],e=n.node(u).rank,u=function(n,r,t){for(var o=void 0,i=n.outEdges(r),u=0,e=i.length;u<e;++u){var a=i[u];t.indexOf(a.w)<0&&(a=n.node(a.w).rank-n.edge(a).minlen,(void 0===o||a<o)&&(o=a))}return o}(n,u,r);if(void 0!==u){e=u-e;if(0===(t=void 0===t||e<t?e:t))break}}void 0===t&&(t=0);return t}(n,f);a<1||0<(a=function(t,o,n,r){if(n<1)return 0;for(var i=[],u=[],e=0,a=o.length;e<a;++e){var f=o[e],c=t.node(f).rank;G.forEach(t.inEdges(f),function(n){var r;o.indexOf(n.v)<0&&((r=t.edge(n)).Qo=c-t.node(n.v).rank,i.indexOf(r)<0&&i.push(r))}),G.forEach(t.outEdges(f),function(n){var r;o.indexOf(n.w)<0&&((r=t.edge(n)).Qo=t.node(n.w).rank-c,u.indexOf(r)<0&&u.push(r))})}var v=0;0<u.length&&(v=function(n,r,t,o,i){var u=-1;if(i<=o)for(var e=K(n,r,t,0),a=i;a<=o;){if(!(K(n,r,t,a)<e))break;u=a,a+=i}u<0&&(u=0);return u}(t,i,u,n,r));return G.forEach(i,
function(n){delete n.Qo}),G.forEach(u,function(n){delete n.Qo}),v}(n,f,a,o))&&function(i,n,u,e){G.forEach(n,function(n){var r=i.node(n),t=r.rank,o=t+u;H(e,n,t),U(e,n,o),r.rank=o})}(n,f,a,t)}}}(n,u,r,i);!function(r){G.forEach(r.edges(),function(n){n=r.edge(n);n.weight=n.oriWeight,delete n.oriWeight})}(n)}}(n))};function K(n,r,t,o){return Q(0,r,o)+Q(0,t,-o)}function Q(n,r,t){for(var o=0,i=0,u=r.length;i<u;++i){var e=r[i];o+=(e.Qo+t)*e.weight}return o}var V=k,X=x,Y=function(n){switch(n.graph().ranker){case"network-simplex":$(n);break;case"tight-tree":!function(n){V(n),T(n)}(n);break;case"longest-path":Z(n);break;case"tight-tree-rev":!function(n){X(n),T(n)}(n);break;case"longest-path-rev":X(n);break;case"simple-compact":J(n.compG);break;default:$(n)}};var Z=V;function $(n){z(n)}var nn={run:function(r){var t=M.addDummyNode(r,"root",{},"_root"),o=rn(r),i=G.max(G.values(o))-1,u=2*i+1;r.graph().nestingRoot=t,G.forEach(r.edges(),function(n){r.edge(n).minlen*=u});var e=tn(r)+1;G.forEach(
r.children(),function(n){!function i(u,e,a,f,c,v,l){var n=u.children(l);if(!n.length)return void(l!==e&&u.setEdge(e,l,{weight:0,minlen:a}));var d=M.addBorderNodeTopBottom(u,"_bt","bt",l),s=M.addBorderNodeTopBottom(u,"_bb","bb",l),r=u.node(l);u.setParent(d,l);r.borderTop=d;u.setParent(s,l);r.borderBottom=s;G.forEach(n,function(n){i(u,e,a,f,c,v,n);var r=u.node(n),t=r.borderTop||n,o=r.borderBottom||n,n=r.borderTop?f:2*f,r=t!==o?1:c-v[l]+1;u.setEdge(d,t,{weight:n,minlen:r,nestingEdge:!0}),u.setEdge(o,s,{weight:n,minlen:r,nestingEdge:!0})});u.parent(l)||u.setEdge(e,d,{weight:0,minlen:c+v[l]})}(r,t,u,e,i,o,n)}),r.graph().nodeRankFactor=u},cleanup:function(t){var n=t.graph();t.removeNode(n.nestingRoot),delete n.nestingRoot,G.forEach(t.edges(),function(n){var r=t.edge(n).eType;"nesting"!==r&&"crossRelation"!==r||t.removeEdge(n)})},treeDepths:rn,sumWeights:tn};function rn(i){var u={};return G.forEach(i.children(),function(n){!function r(n,t){var o=i.children(n);o&&o.length&&G.forEach(o,
function(n){r(n,t+1)}),u[n]=t}(n,1)}),u}function tn(t){return G.reduce(t.edges(),function(n,r){return n+t.edge(r).weight},0)}var on=o.Graph,un=nn.sumWeights,en=M.findOutmostGroup,an=M.findCommonParent,fn=M.isADescentOfB,cn=M.reportError,vn={buildAcylicNestingGraph:function(n){var r=ln(n),t=n.graph(),o=r.reverseDeps,i=t.nestingRoot,u=t.nodeRankFactor,r=un(n)+1,t=dn(n);return sn(t,i,u,r,o),function(f,c,v){var l;G.forEach(c.edges(),function(n){var r,t,o,i,u,e=n.v,a=n.w;c.parent(e)!==c.parent(a)&&(r=fn(c,e,a),t=fn(c,a,e),r||t||(o=an(c,e,a),(r=en(c,e,o))!==(t=en(c,a,o))?(t===o&&(t=a),o=0<c.children(r=r===o?e:r).length,e=0<c.children(t).length,!o&&e?(i=r,u=c.node(t).borderTop,l=yn(null,t,v),hn(f,c,n,i,u,l)):o&&!e?(i=c.node(r).borderBottom,u=t,l=yn(null,r,v),hn(f,c,n,i,u,l)):o&&e?(i=c.node(r).borderBottom,u=c.node(t).borderTop,l=yn(null,r,v)+yn(null,t,v),hn(f,c,n,i,u,l)):cn("v outer group and w outer group are both leaf node.")):cn("v and w have same outer group.")))})}(t,n,o),function(d,s,g
){var h;G.forEach(s.edges(),function(n){var r,t,o,i,u,e,a,f=n.v,c=n.w,v=0<s.children(f).length,l=0<s.children(c).length;(v||l)&&(r=fn(s,f,c),t=fn(s,c,f),o=r||t,!v&&l?r?(u=s.node(c).borderBottom,h=yn(f,c,g),gn(d,s,n,f,u,h,o)):(i=s.node(c).borderTop,h=yn(null,c,g),gn(d,s,n,f,i,h,o)):v&&!l?t?(i=s.node(f).borderTop,h=yn(c,f,g),gn(d,s,n,i,c,h,o)):(u=s.node(f).borderBottom,h=yn(null,f,g),gn(d,s,n,u,c,h,o)):(h=r?(e=s.node(f).borderBottom,a=s.node(c).borderBottom,yn(f,c,g)):t?(e=s.node(f).borderTop,a=s.node(c).borderTop,yn(c,f,g)):(e=s.node(f).borderBottom,a=s.node(c).borderTop,yn(null,f,g)+yn(null,c,g)),gn(d,s,n,e,a,h,o)))})}(t,n,o),function(u,e){var n=function(r){function t(n){i[n]||(i[n]=!0,G.forEach(r.outEdges(n),function(n){o.indexOf(n)<0&&o.push(n),t(n.w)}))}var o=[],i={};return G.forEach(r.nodes(),t),o}(e);G.forEach(n,function(n){var r=n.v,t=n.w,o=0<e.children(r).length,i=0<e.children(t).length;o||i||(i=u.graph().remainEdgeGraph,pn(u,t,r,{})?pn(u,r,t,{})?i.setEdge(n,e.edge(n)):((
i=e.edge(n)).forwardName=n.name,i.reversed=!0,u.setEdge(t,r,i,G.uniqueId("rev"))):u.setEdge(n,e.edge(n)))})}(t,n),t},addBackRemainingEdgesBeforeOrder:function(o){var i=o.graph().remainEdgeGraph,u=o.graph().rankEdgeGraph,n=i.edges().slice(0);G.forEach(n,function(n){var r=i.edge(n),t=r.eType;("onGroup"===t?mn(o,n,r,u):("origin"!==t&&cn("Unexpected edge type: "+t),bn(o,n,r,u)))&&i.removeEdge(n)})},insertNecessaryRankBeforeOrder:function(i){var u,e;1!==i.graph().edgefactor&&(u=[],e=[],G.forEach(i.edges(),function(n){var r=n.v,t=n.w,o=i.edge(n),r=i.node(r),t=i.node(t);"onGroup"===o.eType&&(r=r.rank,t=t.rank,1===Math.abs(t-r)&&(t=Math.min(r,t),u[t]||(u[t]=[]),u[t].push(n),e.push(t)))}),e.sort(function(n,r){return r-n}),G.forEach(e,function(r){G.forEach(i.nodes(),function(n){n=i.node(n);n.rank>r&&n.rank++})}))},undoForEdgesOnGroup:function(a){G.forEach(a.edges(),function(n){var r,t,o,i,u,e=a.edge(n);"onGroup"===e.eType&&(o=n.v,u=n.w,r=a.node(o),i=a.node(u),t=r.nType,n=i.nType,
o="bt"===t||"bb"===t?r.oriNode:o,n="bt"===n||"bb"===n?i.oriNode:u,i=e.oriAttr,u=e.oriEdge.name,i.points=e.points,a.setEdge(o,n,i,u))})},cleanup:nn.cleanup,prepareForRanking:ln,buildNestingGraphForInit:dn,buildNestingGraphForNestingAndRoot:sn,replaceEdgesOnGroup:gn,addBackRemainingEdgeForLeafEdge:bn,addBackRemainingEdgeForOnGroup:mn};function ln(r){var o,i,n=M.addDummyNode(r,"root",{},"_root"),t=(o=r,i={},G.forEach(o.children(),u),i);function u(n){var r=0,t=o.children(n);return 0<t.length&&G.forEach(t,function(n){n=u(n);r<n+1&&(r=n+1)}),i[n]=r}var e=G.max(G.values(t)),a=2*e+1;return r.graph().nestingRoot=n,r.graph().nodeRankFactor=a,G.forEach(r.edges(),function(n){r.edge(n).minlen*=a}),{height:e,reverseDeps:t}}function dn(t){var o=new on({multigraph:t.isMultigraph(),compound:t.isCompound()}).setGraph(t.graph());G.forEach(t.nodes(),function(n){o.setNode(n,t.node(n))}),G.forEach(t.nodes(),function(n){var r=t.parent(n);r&&o.setParent(n,r)}),o.graph().oriGraph=t;var n=new on({directed:!0,
compound:!0,multigraph:!0});n.setDefaultNodeLabel(function(n){return o.node(n)}),o.graph().remainEdgeGraph=n;n=new on({directed:!0,compound:!0,multigraph:!0});return n.setDefaultNodeLabel(function(n){return o.node(n)}),o.graph().rankEdgeGraph=n,o}function sn(r,t,o,i,u){G.forEach(r.children(),function(n){!function i(u,e,a,f,c,v){var l;var n=u.children(v);if(!n.length)return void(v===e||u.parent(v)||(l=yn(null,v,c),u.setEdge(e,v,{eType:"root",weight:0,minlen:a-l})));var r=u.node(v);var d=M.addBorderNodeTopBottom(u,"_bt","bt",v);var s=M.addBorderNodeTopBottom(u,"_bb","bb",v);u.setParent(d,v);r.borderTop=d;u.setParent(s,v);r.borderBottom=s;G.forEach(n,function(n){i(u,e,a,f,c,n);var r=u.node(n),t=r.borderTop||n,o=r.borderBottom||n,r=r.borderTop?f:2*f;l=yn(n,v,c),u.setEdge(d,t,{eType:"nesting",weight:r,minlen:l,nestingEdge:!0}),u.setEdge(o,s,{eType:"nesting",weight:r,minlen:l,nestingEdge:!0})});u.parent(v)||(l=yn(null,v,c),u.setEdge(e,d,{eType:"root",weight:0,minlen:a-l}))}(r,t,o,i,u,n)})}
function gn(n,r,t,o,i,u,e,a){var f=n.graph().remainEdgeGraph,c=r.edge(t),v=c.weight,c=c.minlen;(c=e?u:c-u)<0&&cn("The edge min-len is small than 0: "+c);c=c,v=v,c={eType:"onGroup",oriEdge:t,oriAttr:r.edge(t),weight:v,minlen:c};(a||pn(n,i,o,{})?f:n).setEdge(o,i,c,t.name)}function hn(n,r,t,o,i,u){var e=r.edge(t),r=e.weight,t=e.minlen-u;t<1?cn("The edge min-len is small than 0: "+t):(e=!1,(u=pn(n,i,o,{}))&&((u=pn(n,o,i,{}))||(e=!0)),u||(e&&(e=i,i=o,o=e),n.setEdge(o,i,{eType:"crossRelation",weight:r,minlen:t},G.uniqueId("rel"))))}function pn(n,r,t,o){if(r===t)return!0;for(var i=!(o[r]=!0),u=n.successors(r),e=0,a=u.length;e<a;++e){var f=u[e];if(!o[f]&&(i=pn(n,f,t,o)))break}return i}function bn(n,r,t,o){var i=!0,u=r.v,e=r.w,a=n.node(u).rank,f=n.node(e).rank;return a<f?n.setEdge(r,t):f<a?(t.forwardName=r.name,t.reversed=!0,n.setEdge(e,u,t,G.uniqueId("rev"))):(o.setEdge(r,t),i=!1),i}function mn(n,r,t,o){var i=!0,u=(r=function(n,r,t){"onGroup"!==t.eType&&cn("It is not on-group edge.");var o=(
v=t.oriEdge).v,i=v.w,u=fn(n,o,i),e=fn(n,i,o);if(u||e)return r;var a=n.node(o),f=n.node(i),c=a.borderTop||o,t=a.borderBottom||o,v=f.borderTop||i,u=f.borderBottom||i,e=n.node(c).rank,a=n.node(t).rank,o=n.node(v).rank,f=n.node(u).rank,i=t,n=v;return a<o?(i=t,n=v):f<e?(i=c,n=u):a===f||e===o||o<e&&a<f?(i=t,n=u):(o<e||e<o)&&(i=c,n=v),{v:i,w:n,name:r.name}}(n,r,t)).v,e=r.w,a=n.node(u).rank,f=n.node(e).rank;return a<f?n.setEdge(u,e,t,r.name):f<a?(function(n){var r=n.oriEdge;n.reversed=!0,n.forwardName=r.name;var t={v:r.w,w:r.v,name:r.name};n.oriEdge=t;n=n.oriAttr;n.forwardName=r.name,n.reversed=!0}(t),n.setEdge(e,u,t,G.uniqueId("rev"))):(o.setEdge(r,t),i=!1),i}function yn(n,r,t){n=null===n?0:t[n],t=t[r],r=0;return void 0===n||void 0===t?cn("Node has no reverse depth."):(r=t-n)<0&&cn("Nesting distance is negative."),r}var wn=vn.addBackRemainingEdgeForOnGroup,kn=vn.addBackRemainingEdgeForLeafEdge,Mn=N,xn=M.getLayerIdDP,r=function(t){var o=xn(t);o&&G.forEach(t.nodes(),function(n){var r=t.node(n)
;"origin"===r.nType&&(r.userRank=o.get(n))})},k=function(r,t){var n=r.graph().nodeRankFactor*r.graph().edgefactor;t=Nn(0,t,0,n),En(r,t),G.forEach(r.children(),function(n){0<r.children(n).length&&!function r(t,n,o){G.forEach(t.children(n),function(n){0<t.children(n).length&&r(t,n,o)});var i=t.node(n);var u=i.borderTop;n=G.min(G.map(t.outEdges(u),function(n){var r=t.edge(n),r=t.node(n.w).rank-r.minlen;return r}));Mn(o,u,n);t.node(u).rank=n;i=i.borderBottom;n=G.max(G.map(t.inEdges(i),function(n){var r=t.edge(n),r=t.node(n.v).rank+r.minlen;return r}));Mn(o,i,n);t.node(i).rank=n}(r,n,t)}),En(r,t)},x=function(o){var i=o.graph().remainEdgeGraph,u=o.graph().rankEdgeGraph,n=o.edges().slice(0);G.forEach(n,function(n){var r=o.edge(n),t=r.eType;"onGroup"===t?(o.removeEdge(n),r.reversed&&(n=function(n,r){n=Rn(n,r);return r.oriEdge=Rn(r.oriEdge,r.oriAttr),n}(n,r)),wn(o,n,r,u)||i.setEdge(n,r)):"origin"===t&&(o.removeEdge(n),r.reversed&&(n=Rn(n,r)),kn(o,n,r,u)||i.setEdge(n,r))})};function Nn(n,r,t,o){
var i=G.min(G.map(r,function(n,r){return parseInt(r)})),u=[];G.forEach(r,function(n,r){r=parseInt(r),u[r-i]=n});var e={},a=t;return G.forEach(u,function(n){n&&0<n.length&&(e[a]=n,a+=o)}),e}function En(t,n){G.forEach(n,function(n,r){r=parseInt(r),G.forEach(n,function(n){t.node(n).rank=r})})}function Rn(n,r){n={v:n.w,w:n.v,name:r.forwardName};return delete r.forwardName,delete r.reversed,n}var Gn=r,Tn=k,Ln=x,On=N,nn=function(n){Gn(n);var r=function(t){var o={};return G.forEach(t.nodes(),function(n){var r;t.children(n).length<1&&("origin"===(r=t.node(n)).nType&&(r=r.userRank,On(o,n,r=null==r?0:r)))}),o}(n);Tn(n,r),Ln(n)};var _n=r,Bn=k,In=Nn,zn=En,Cn=x,Fn=N,jn=t,An=M.reportError,Dn=function(n){_n(n);var r=function(o){var i={},u={};G.forEach(o.nodes(),function(n){var r,t;0<o.children(n).length||(t=(r=o.node(n)).rank,Fn(i,n,t),"origin"===r.nType&&(u[t]=!0))});var t={};return G.map(u,function(n,r){r=parseInt(r);t[r]=i[r]}),t}(n);r=In(n,r,0,1),zn(n,r),function(o,i){G.forEach(o.nodes(),
function(n){var r,t;0<o.children(n).length||null!=(t=(r=o.node(n)).userRank)&&(jn(i,n,r.rank)||An("Node is not found in layer: "+r.rank),Fn(i,n,t))})}(n,r),Bn(n,r),Cn(n)};var Sn=function(c){var v=function(o){var i={},u=0;return G.forEach(o.children(),function n(r){var t=u;G.forEach(o.children(r),n),i[r]={low:t,lim:u++}}),i}(c);G.forEach(c.graph().dummyChains,function(n){for(var r,t=(r=c.node(n)).edgeObj,o=function(n,r,t,o){var i,u,e=[],a=[],f=Math.min(r[t].low,r[o].low),c=Math.max(r[t].lim,r[o].lim);i=t;for(;i=n.parent(i),e.push(i),i&&(r[i].low>f||c>r[i].lim););u=i,i=o;for(;(i=n.parent(i))!==u;)a.push(i);return{path:e.concat(a.reverse()),lca:u}}(c,v,t.v,t.w),i=o.path,u=o.lca,e=0,a=i[e],f=!0;n!==t.w;){if(r=c.node(n),f){for(;(a=i[e])!==u&&c.node(a).maxRank<r.rank;)e++;a===u&&(f=!1)}if(!f){for(;e<i.length-1&&c.node(a=i[e+1]).minRank<=r.rank;)e++;a=i[e]}c.setParent(n,a),n=c.successors(n)[0]}})};var Pn=vn.prepareForRanking,Wn=vn.buildNestingGraphForInit,
qn=vn.buildNestingGraphForNestingAndRoot,Un=vn.replaceEdgesOnGroup,Hn=M.isADescentOfB,Jn={buildAcylicNestingGraph_userRank:function(n){var r=Pn(n),t=n.graph(),o=r.reverseDeps,i=t.nestingRoot,r=t.nodeRankFactor,t=Wn(n);return function(n,r,t,o,i){qn(n,r,t,o,i),n.removeNode(r)}(t,i,r,0,o),function(l,d){G.forEach(d.edges(),function(n){var r,t,o,i,u,e,a=n.v,f=n.w,c=0<d.children(a).length,v=0<d.children(f).length;(c||v)&&(r=Hn(d,a,f),t=Hn(d,f,a),o=r||t,!c&&v?r?(u=d.node(f).borderBottom,Un(l,d,n,a,u,0,o,!0)):(i=d.node(f).borderTop,Un(l,d,n,a,i,0,o,!0)):c&&!v?t?(i=d.node(a).borderTop,Un(l,d,n,i,f,0,o,!0)):(u=d.node(a).borderBottom,Un(l,d,n,u,f,0,o,!0)):(f=r?(e=d.node(a).borderBottom,d.node(f).borderBottom):(e=t?d.node(a).borderTop:d.node(a).borderBottom,d.node(f).borderTop),Un(l,d,n,e,f,0,o,!0)))})}(t,n),function(o,i){G.forEach(i.edges(),function(n){var r=n.v,t=n.w,r=0<i.children(r).length,t=0<i.children(t).length;r||t||o.graph().remainEdgeGraph.setEdge(n,i.edge(n))})}(t,n),t}}
;var Kn=function(e){G.forEach(e.children(),function n(r){var t=e.children(r),o=e.node(r);if(t.length&&G.forEach(t,n),G.has(o,"minRank")){o.borderLeft=[],o.borderRight=[];for(var i=o.minRank,u=o.maxRank+1;i<u;++i)Qn(e,"borderLeft","_bl","bl",r,o,i),Qn(e,"borderRight","_br","br",r,o,i)}})};function Qn(n,r,t,o,i,u,e){var a=u[r][e-1],t=M.addDummyNode(n,"border",{nType:o,oriNode:i,width:0,height:0,rank:e,borderType:r},t);u[r][e]=t,n.setParent(t,i),a&&n.setEdge(a,t,{weight:1})}var Vn=M.reportError,r=function(n,r,t,o){var i=0,u=null;for(;i<t.length-1;){var e=t[i],e=((u=u||Xn(n,e)).oriList,u.topList);u.botList;if(e.length<1)++i,u=null;else{for(var a=i+1,f=null,c=null,v=null;a<t.length&&(f=Xn(n,t[a]),c=f.oriList,v=f.topList,f.botList,!(0<c.length||0<v.length));)++a;if(a===t.length){Vn("Fail to find rank for padding bottom");break}var l=Yn(r,e,"top")/(a-i);if(0<=l)for(var d=i;d<a;++d)o[d]<l&&(o[d]=l);else Vn("pad separation is invalid: "+l);i=a,u=f}}},k=function(n,r,t,o){var i=t.length-1,u=null
;for(;0<i;){var e=t[i],e=((u=u||Xn(n,e)).oriList,u.topList,u.botList);if(e.length<1)--i,u=null;else{for(var a=i-1,f=null,c=null,v=null;0<=a&&(f=Xn(n,t[a]),c=f.oriList,f.topList,v=f.botList,!(0<c.length||0<v.length));)--a;if(a<0){Vn("Fail to find rank for padding top");break}var l=Yn(r,e,"bottom")/(i-a);if(0<=l)for(var d=a;d<i;++d)o[d]<l&&(o[d]=l);else Vn("pad separation is invalid: "+l);i=a,u=f}}},x=function(n,r,t,o){return n+r*o-t*o+t/2};function Xn(t,n){var o=[],i=[],u=[];return G.forEach(n,function(n){var r=t.node(n);"origin"!==r.nType?"bt"!==r.nType?"bb"===r.nType&&u.push(n):i.push(n):o.push(n)}),{oriList:o,topList:i,botList:u}}function Yn(r,n,t){var o=0;return G.forEach(n,function(n){n=r.node(n).oriNode,n=r.node(n).padding;o<n[t]&&(o=n[t])}),o}var Zn=function(r,t){var o=r.graph().rankdir.toLowerCase();"tb"!==o&&G.forEach(r.nodes(),function(n){n=r.node(n).padding;n&&function(n,r,t){{var o;"bt"===r?(o=n.top,n.top=n.bottom,n.bottom=o):"lr"===r?(o=n.top,n.top=n.left,n.left=o,
o=n.bottom,n.bottom=n.right,n.right=o):"rl"===r&&(t?(o=n.right,n.right=n.top,n.top=n.left,n.left=n.bottom,n.bottom=o):(o=n.top,n.top=n.right,n.right=n.bottom,n.bottom=n.left,n.left=o))}}(n,o,t)})},$n={adjust:function(n){var r=n.graph().rankdir.toLowerCase();"lr"!==r&&"rl"!==r||nr(n);Zn(n,!1)},undo:function(n){var r=n.graph().rankdir.toLowerCase();"bt"!==r&&"rl"!==r||function(r){G.forEach(r.nodes(),function(n){tr(r.node(n))}),G.forEach(r.edges(),function(n){n=r.edge(n);G.forEach(n.points,tr),G.has(n,"y")&&tr(n)})}(n);"lr"!==r&&"rl"!==r||(function(r){G.forEach(r.nodes(),function(n){or(r.node(n))}),G.forEach(r.edges(),function(n){n=r.edge(n);G.forEach(n.points,or),G.has(n,"x")&&or(n)})}(n),nr(n));Zn(n,!0)}};function nr(r){G.forEach(r.nodes(),function(n){rr(r.node(n))}),G.forEach(r.edges(),function(n){rr(r.edge(n))})}function rr(n){var r=n.width;n.width=n.height,n.height=r}function tr(n){n.y=-n.y}function or(n){var r=n.x;n.x=n.y,n.y=r}var ir=o.Graph,ur=M.reportError,er=function(r,n){
G.forEach(n,function(n){!function(n,r){var t=function(o,n){G.forEach(n,function(n,r){o.node(n).tmpOrder=r});var i=new ir({directed:!0,compound:!0,multigraph:!0});return G.forEach(n,function(n){i.setNode(n,o.node(n));for(var r=n,t=o.parent(r);t;)i.setNode(t,o.node(t)),i.setParent(r,t),r=t,t=o.parent(r)}),G.forEach(i.children(),function(n){!function r(t,n){var o=t.children(n);if(o.length<1)return;G.forEach(o,function(n){0<t.children(n).length&&r(t,n)});o=G.min(G.map(o,function(n){return t.node(n).tmpOrder}));t.node(n).tmpOrder=o}(i,n)}),i}(n,r),n=[];(function t(o,n,r,i){var u=r.slice(0);var e=null;var a=null;if(n)for(var f=0;f<u.length;){var c=u[f],v=o.node(c).nType;"bl"!==v?"br"!==v?++f:(a&&ur("There are more than one right border node."),a=c,u.splice(f,1)):(e&&ur("There are more than one left border node."),e=c,u.splice(f,1))}!n||e&&a||ur("There no left or right border node.");n=G.sortBy(u,function(n){return o.node(n).tmpOrder});e&&i.push(e);G.forEach(n,function(n){var r=o.children(n)
;r.length<1?i.push(n):t(o,n,r,i)});a&&i.push(a)})(t,null,t.children(),n),r.length!==n.length&&ur("Node num is incorrect: "+n.length);G.forEach(n,function(n,r){t.node(n).tmpOrder2=r}),r.sort(function(n,r){return t.node(n).tmpOrder2-t.node(r).tmpOrder2}),G.forEach(t.nodes(),function(n){n=t.node(n);delete n.tmpOrder,delete n.tmpOrder2})}(r,n)})};var ar=o.Graph,fr=M.getEdgePortConstraintDP;function cr(n,r,t){for(var o=0,i=0,u=0,e=t.length;u<e;u++){for(var a,f=t[u].edgeList,c=null,v=0,l=f.length;v<l;v++){var d=f[v];if(d.w===r||d.v===r){c=d;break}}c&&(o+=(a=0===(a=n.edge(c).weight)||void 0===a?1:a)*u,i++)}return 0<i?o/i:0}function vr(n,r,t,o,i,u){for(var e={top:[],bottom:[],left:[],right:[],free:[]},a=0,f=t.length;a<f;a++){var c=t[a],v=function(n,r,t){var o=r,r=n.edge(r);"normalize"===r.eType&&(o=r.oriEdge,r=r.oriAttr);t=t.get(o),r=!!r&&r.reversed;return{oriEdge:o,edgeCons:t,reversed:r}}(n,c,o),l=v.edgeCons,d=v.reversed,v=null;(v=l?(d?c.w:c.v)===r?l.source:l.target:v
)&&"fixedLocation"===v.type?(v.side&&"auto"!==v.side||(v.side=function(n,r,t,o){var i=n.node(r),u=i.width*t.percentX+t.absoluteX,e=i.height*t.percentY+t.absoluteY,a=i.width-u,f=i.height-e,r=Math.abs(u),t=Math.abs(e),i=Math.abs(a),u=Math.abs(f),e="bottom",a=Math.abs(r-i),f=Math.abs(t-u);e=a<.5&&f<.5?lr(n,o):((i=[{side:"top",dist:t},{side:"bottom",dist:u},{side:"left",dist:r},{side:"right",dist:i}]).sort(function(n,r){return n.dist-r.dist}),i[0].side);return e}(n,r,v.location,i)),void 0!==v.sideOffset&&null!==v.sideOffset||(v.sideOffset=function(n,r,t,o){var i=n.node(r),u=0;switch(o){case"top":case"bottom":u=i.width*t.percentX+t.absoluteX;break;case"left":case"right":u=i.height*t.percentY+t.absoluteY}return u}(n,r,v.location,v.side)),v.edge=c,v.edgeList=[c],v.owningNode=r,e[v.side].push(v)):u||((v=e.free[0])?v.edgeList.push(c):(v={edge:c,edgeList:[c],owningNode:r,side:lr(n,i),sideOffset:0,isFree:!0},e.free.push(v)))}for(var s=["top","bottom","left","right"],a=0,f=s.length;a<f;a++){
var g=s[a];e[g].sort(function(n,r){return n.sideOffset-r.sideOffset}),e[g]=function(n){for(var r=n[0],t=r?[r]:[],o=1,i=n.length;o<i;o++){var u=n[o];Math.abs(u.sideOffset-r.sideOffset)<.5?r.edgeList.push(u.edge):(t.push(u),r=u)}return t}(e[g])}return e}function lr(n,r){var t="bottom";switch(n.graph().rankdir.toLowerCase()){case"tb":t=r?"top":"bottom";break;case"bt":t=r?"bottom":"top";break;case"lr":t=r?"right":"left";break;case"rl":t=r?"left":"right"}return t}function dr(n,r,t){var o=[],i=r.free,n=n.graph().rankdir.toLowerCase();if(t)switch(n){case"tb":o=o.concat(r.left.reverse()),o=(o=(o=i?o.concat(i):o).concat(r.top)).concat(r.right);break;case"bt":o=o.concat(r.left),o=(o=(o=i?o.concat(i):o).concat(r.bottom)).concat(r.right.reverse());break;case"lr":o=o.concat(r.top.reverse()),o=(o=(o=i?o.concat(i):o).concat(r.left)).concat(r.bottom);break;case"rl":o=o.concat(r.top),o=(o=(o=i?o.concat(i):o).concat(r.right)).concat(r.bottom.reverse())}else switch(n){case"tb":o=o.concat(r.left),o=(o=(
o=i?o.concat(i):o).concat(r.bottom)).concat(r.right.reverse());break;case"bt":o=o.concat(r.left.reverse()),o=(o=(o=i?o.concat(i):o).concat(r.top)).concat(r.right);break;case"lr":o=o.concat(r.top),o=(o=(o=i?o.concat(i):o).concat(r.right)).concat(r.bottom.reverse());break;case"rl":o=o.concat(r.top.reverse()),o=(o=(o=i?o.concat(i):o).concat(r.left)).concat(r.bottom)}return o}var sr=function(n,r){var t=fr(n);if(!t)return r;for(var o=0;o<2;o++){var i=o%2==0,u=0,e=r.length-2,a=1;i&&(u=r.length-1,a=-(e=1));for(var f=u;;){if(i?f<e:e<f)break;var c=r[f],v=r[f+a];!function(t,n,r,o,i){for(var u=[],e=0,a=n.length;e<a;e++){var f=n[e],c=G.filter(t.nodeEdges(f),function(n){return 0<=r.indexOf(n.v)||0<=r.indexOf(n.w)}),c=vr(t,f,c,i,o),c=dr(t,c,o);u=u.concat(c)}r.sort(function(n,r){return cr(t,n,u)-cr(t,r,u)})}(n,c,v,i,t),f+=a}}return r},gr=function(o){var i={},n=G.filter(o.nodes(),function(n){return!o.children(n).length}),r=G.max(G.map(n,function(n){return o.node(n).rank})),u=G.map(G.range(r+1),
function(){return[]});n=G.sortBy(n,function(n){return o.node(n).rank});return G.forEach(n,function n(r){var t;G.has(i,r)||(i[r]=!0,t=o.node(r),u[t.rank].push(r),G.forEach(o.successors(r),n))}),sr(o,u),er(o,u),u};var hr=function(n,r,t){var o=0;if(!fr(n))return o;for(var i=1;i<r.length;++i)o+=function(n,r,t,o){var i=0,u=fr(n);if(!u)return i;for(var e=[r,t],a=0,f=e.length;a<f;a++)for(var c=e[a],v=0!==a,l=v?r:t,d=0,s=c.length;d<s;d++){var g,h,p=c[d];"origin"===n.node(p).nType&&((h=G.filter(n.nodeEdges(p),function(n){return 0<=l.indexOf(n.v)||0<=l.indexOf(n.w)})).length<2||(g=vr(n,p,h,u,v,!0),p=dr(n,g,v),h=function(n,r,t,o,i){for(var u=new ar({directed:!0,compound:!0,multigraph:!0}),e=[],a=[],f=0,c=o.length;f<c;f++){var v=o[f],l=v.edgeList;if(!(l.length<1)){var d={nType:"port",width:0,height:0,portOrder:e.length,portCons:v},s=M.addDummyNode(u,"port",d,"_port");v.port=s,e.push(s);for(var g=v.owningNode,h=0,p=l.length;h<p;h++){var b=l[h],m=b.v===g?b.w:b.v;u.setNode(m,n.node(m)),a.indexOf(m
)<0&&a.push(m);var y=s,w=m;i&&(y=m,w=s);m=n.edge(b);u.setEdge(y,w,G.merge({oriEdge:b},m),G.uniqueId("_pedge"))}}}var k=i?r:t;return a.sort(function(n,r){return k.indexOf(n)-k.indexOf(r)}),{subG:u,portLayer:e,oppositeNodeLayer:a}}(n,r,t,p,v),g=h.subG,p=h.portLayer,h=h.oppositeNodeLayer,i+=v?o(g,h,p):o(g,p,h)))}return i}(n,r[i-1],r[i],t);return o},pr=function(n,r){for(var t=0,o=1;o<r.length;++o)t+=br(n,r[o-1],r[o]);return t+=hr(n,r,br)};function br(r,n,t){for(var o=G.zipObject(t,G.map(t,function(n,r){return r})),i=G.flatten(G.map(n,function(n){return G.sortBy(G.map(r.outEdges(n),function(n){return{pos:o[n.w],weight:r.edge(n).weight}}),"pos")}),!0),u=1;u<t.length;)u<<=1;n=2*u-1;--u;var e=G.map(new Array(n),function(){return 0}),a=0;return G.forEach(i.forEach(function(n){var r=n.pos+u;e[r]+=n.weight;for(var t=0;0<r;)r%2&&(t+=e[r+1]),e[r=r-1>>1]+=n.weight;a+=n.weight*t})),a}var mr=function(o,n){return G.map(n,function(n){var r=o.inEdges(n);if(r.length){r=G.reduce(r,function(n,r){
var t=o.edge(r),r=o.node(r.v);return{sum:n.sum+t.weight*r.order,weight:n.weight+t.weight}},{sum:0,weight:0});return{v:n,barycenter:r.sum/r.weight,weight:r.weight}}return{v:n}})};var yr=function(n,r){var o={};return G.forEach(n,function(n,r){r=o[n.v]={indegree:0,in:[],out:[],vs:[n.v],i:r};G.isUndefined(n.barycenter)||(r.barycenter=n.barycenter,r.weight=n.weight)}),G.forEach(r.edges(),function(n){var r=o[n.v],t=o[n.w];G.isUndefined(r)||G.isUndefined(t)||(t.indegree++,r.out.push(o[n.w]))}),function(t){var n=[];function r(r){return function(n){n.merged||(G.isUndefined(n.barycenter)||G.isUndefined(r.barycenter)||n.barycenter>=r.barycenter)&&function(n,r){var t=0,o=0;n.weight&&(t+=n.barycenter*n.weight,o+=n.weight);r.weight&&(t+=r.barycenter*r.weight,o+=r.weight);n.vs=r.vs.concat(n.vs),n.barycenter=t/o,n.weight=o,n.i=Math.min(r.i,n.i),r.merged=!0}(r,n)}}for(;t.length;){var o=t.pop();n.push(o),G.forEach(o.in.reverse(),r(o)),G.forEach(o.out,function(r){return function(n){n.in.push(r),
0==--n.indegree&&t.push(n)}}(o))}return G.map(G.filter(n,function(n){return!n.merged}),function(n){return G.pick(n,["vs","i","barycenter","weight"])})}(G.filter(o,function(n){return!n.indegree}))};var wr=function(n,r){var t=M.partition(n,function(n){return G.has(n,"barycenter")}),n=t.lhs,o=G.sortBy(t.rhs,function(n){return-n.i}),i=[],u=0,e=0,a=0;n.sort(function(t){return function(n,r){return n.barycenter<r.barycenter?-1:n.barycenter>r.barycenter?1:t?r.i-n.i:n.i-r.i}}(!!r)),a=kr(i,o,a),G.forEach(n,function(n){a+=n.vs.length,i.push(n.vs),u+=n.barycenter*n.weight,e+=n.weight,a=kr(i,o,a)});n={vs:G.flatten(i,!0)};e&&(n.barycenter=u/e,n.weight=e);return n};function kr(n,r,t){for(var o;r.length&&(o=G.last(r)).i<=t;)r.pop(),n.push(o.vs),t++;return t}var Mr=function t(o,n,i,u){var r=o.children(n),e=o.node(n),a=e?e.borderLeft:void 0,f=e?e.borderRight:void 0,c={};r&&r.sort(function(n,r){var n=o.node(n),r=o.node(r),n=(n.borderLeft?o.node(n.borderLeft):n).order,r=(r.borderLeft?o.node(r.borderLeft
):r).order;return n-r});a&&(r=G.filter(r,function(n){return n!==a&&n!==f}));var n=mr(o,r);G.forEach(n,function(n){var r;o.children(n.v).length&&(r=t(o,n.v,i,u),c[n.v]=r,G.has(r,"barycenter")&&Nr(n,r))});var e=yr(n,i);xr(e,c);r=wr(e,u);a&&(r.vs=G.flatten([a,r.vs,f],!0),o.predecessors(a).length&&(n=o.node(o.predecessors(a)[0]),e=o.node(o.predecessors(f)[0]),G.has(r,"barycenter")||(r.barycenter=0,r.weight=0),r.barycenter=(r.barycenter*r.weight+n.order+e.order)/(r.weight+2),r.weight+=2));return r};function xr(n,r){G.forEach(n,function(n){n.vs=G.flatten(n.vs.map(function(n){return r[n]?r[n].vs:n}),!0)})}function Nr(n,r){G.isUndefined(n.barycenter)?(n.barycenter=r.barycenter,n.weight=r.weight):(n.barycenter=(n.barycenter*n.weight+r.barycenter*r.weight)/(n.weight+r.weight),n.weight+=r.weight)}var Er=o.Graph,Rr=function(i,t,u){var e=function(n){var r;for(;n.hasNode(r=G.uniqueId("_root")););return r}(i),a=new Er({compound:!0}).setGraph({root:e}).setDefaultNodeLabel(function(n){return i.node(n)}
);return G.forEach(i.nodes(),function(o){var n=i.node(o),r=i.parent(o);(n.rank===t||n.minRank<=t&&t<=n.maxRank)&&(a.setNode(o),a.setParent(o,r||e),G.forEach(i[u](o),function(n){var r=n.v===o?n.w:n.v,t=a.edge(r,o),t=G.isUndefined(t)?0:t.weight;a.setEdge(r,o,{weight:i.edge(n).weight+t})}),G.has(n,"minRank")&&a.setNode(o,{borderLeft:n.borderLeft[t],borderRight:n.borderRight[t]}))}),a};var Gr=function(i,u,n){var e,a={};G.forEach(n,function(n){for(var r,t,o=i.parent(n);o;){if((r=i.parent(o))?(t=a[r],a[r]=o):(t=e,e=o),t&&t!==o)return void u.setEdge(t,o);o=r}})};var Tr=o.Graph,Lr=M.reportError,Or=function(t,n){var o=function(i){var u={},n=function(n){var o={},i=n.graph().rankEdgeGraph;return G.forEach(i.edges(),function(n){var r=n.v,t=n.w,r=i.node(r).rank;r===i.node(t).rank?((t=o[r])||(o[r]=t=[]),t.push(n)):Lr("v and w are not in same rank")}),o}(i);return G.forEach(n,function(n,r){var t,o,n=(n=n,t=i.graph().rankEdgeGraph,o=new Tr({directed:!0,compound:!0,multigraph:!0}),G.forEach(n,function(
n){o.setNode(n.v,t.node(n.v)),o.setNode(n.w,t.node(n.w)),o.setEdge(n,t.edge(n))}),function(t){var o=[],i={};return G.forEach(t.nodes(),function(n){var r;i[n]||(r=new Tr({directed:!0,compound:!0,multigraph:!0}),function r(t,n,o,i){if(o[n])return void Lr("Node has been visited.");o[n]=!0;var u=t.outEdges(n);var n=t.inEdges(n);n=u.concat(n);G.forEach(n,function(n){i.setNode(n.v,t.node(n.v)),i.setNode(n.w,t.node(n.w)),i.setEdge(n,t.edge(n)),o[n.v]||r(t,n.v,o,i),o[n.w]||r(t,n.w,o,i)});return}(t,n,i,r),o.push(r))}),o}(o));u[r]=n}),u}(t);G.forEach(n,function(n,r){r=o[r];r&&(function(n,o){var i=[],u={},e={};G.forEach(n,function(r){var t,n;e[r]||(t=null,G.forEach(o,function(n){n.node(r)&&(t=n)}),t?(n=function(o){if(o.edges().length<1)return Lr("There is no edges"),null;var a=new Tr({directed:!1,compound:!1,multigraph:!0});G.forEach(o.edges(),function(n){var r=n.v,t=n.w,n=o.edge(n).weight;a.edge(r,t)?a.edge(r,t).weight+=n:a.setEdge(r,t,{weight:n})});var f=[a.edges()[0].v],c={},v=[c[f[0]]=0,0]
;return G.forEach(a.edges(),function(n){var r=a.edge(n).weight,t=c[n.v],o=c[n.w],i=n.v,u=(n.w,o),e=!1;null==t?(i=n.v,n.w,u=o):null==o?(i=n.w,n.v,u=t):e=!0,e?_r(null,t,o,r,f,v,c):_r(i,function(n,r,t){var o=0,i=Number.POSITIVE_INFINITY;r+=.5;for(var u=0,e=n.length;u<e;++u){var a=n[u];(a+=Math.floor(Math.abs(u-r))*t)<i&&(i=a,o=u)}return o}(v,u,r),u,r,f,v,c)}),f}(t),G.forEach(n,function(n){i.push(n),u[n]=i.length-1,e[n]=!0})):(i.push(r),u[r]=i.length-1,e[r]=!0))}),i.length!==n.length&&Lr("New layer node number is incorrect.");n.sort(function(n,r){return u[n]-u[r]})}(n,r),er(t,[n]))})};function _r(n,r,t,o,i,u,e){if(n&&(i.splice(r,0,n),G.forEach(i,function(n,r){e[n]=r}),i=u[r],u.splice(r,0,i),r<=t&&(t+=1)),r<t)for(var a=r+1;a<=t;++a)u[a]+=o;else if(t<r)for(a=t+1;a<=r;++a)u[a]+=o;else u[t]+=o}var Br=o.Graph,Ir=function(n){var r=M.maxRank(n),t=zr(n,G.range(1,r+1),"inEdges"),o=zr(n,G.range(r-1,-1,-1),"outEdges"),i=gr(n);Fr(n,i),0<n.graph().rankEdgeGraph.edges().length&&(i=function(n,r,t,o){if(
!(0<n.graph().rankEdgeGraph.edges().length))return r;Or(n,r),Fr(n,r);for(var i=0;i<2;++i)Cr(i%2?t:o,1<=i%2),r=M.buildLayerMatrix(n),Or(n,r),Fr(n,r);return r}(n,i,t,o));for(var u,e=Number.POSITIVE_INFINITY,a=0,f=0;f<4;++a,++f){Cr(a%2?t:o,2<=a%4),i=M.buildLayerMatrix(n);var c=pr(n,i);c<e&&(f=0,u=G.cloneDeep(i),e=c)}Fr(n,u)};function zr(r,n,t){return G.map(n,function(n){return Rr(r,n,t)})}function Cr(n,r){var o=new Br;G.forEach(n,function(t){var n=t.graph().root,n=Mr(t,n,o,r);G.forEach(n.vs,function(n,r){t.node(n).order=r}),Gr(t,o,n.vs)})}function Fr(t,n){G.forEach(n,function(n){G.forEach(n,function(n,r){t.node(n).order=r})})}var jr=o.Graph,Ar=M.reportError,N=function(o,i){var u,n=M.buildLayerMatrix(o),e=G.merge(Dr(o,n),Sr(o,n)),a={};G.forEach(["u","d"],function(t){u="u"===t?n:G.values(n).reverse(),G.forEach(["l","r"],function(n){"r"===n&&(u=G.map(u,function(n){return G.values(n).reverse()}));var r=("u"===t?o.predecessors:o.successors).bind(o),r=qr(0,u,e,r),r=Ur(o,i,u,r.root,r.align,
"r"===n);"r"===n&&(r=G.mapValues(r,function(n){return-n})),a[t+n]=r})});var r=Hr(o,a);return Jr(a,r),Kr(a,o.graph().align)};function Dr(c,n){var v={};return G.reduce(n,function(n,o){var u=0,e=0,a=n.length,f=G.last(o);return G.forEach(o,function(n,r){var t=function(r,n){if(r.node(n).dummy)return G.find(r.predecessors(n),function(n){return r.node(n).dummy})}(c,n),i=t?c.node(t).order:a;!t&&n!==f||(G.forEach(o.slice(e,r+1),function(o){G.forEach(c.predecessors(o),function(n){var r=c.node(n),t=r.order;!(t<u||i<t)||r.dummy&&c.node(o).dummy||Pr(v,n,o)})}),e=r+1,u=i)}),o}),v}function Sr(a,n){var e={};function f(r,n,t,o,i){var u;G.forEach(G.range(n,t),function(n){u=r[n],a.node(u).dummy&&G.forEach(a.predecessors(u),function(n){var r=a.node(n);r.dummy&&(r.order<o||r.order>i)&&Pr(e,n,u)})})}return G.reduce(n,function(t,o){var i,u=-1,e=0;return G.forEach(o,function(n,r){"border"!==a.node(n).dummy||(n=a.predecessors(n)).length&&(i=a.node(n[0]).order,f(o,e,r,u,i),e=r,u=i),f(o,e,o.length,i,t.length)}),
o}),e}function Pr(n,r,t){t<r&&(o=r,r=t,t=o);var o=n[r];o||(n[r]=o={}),o[t]=!0}function Wr(n,r,t){var o;return t<r&&(o=r,r=t,t=o),G.has(n[r],t)}function qr(n,r,a,f){var c={},v={},l={};return G.forEach(r,function(n){G.forEach(n,function(n,r){c[n]=n,v[n]=n,l[n]=r})}),G.forEach(r,function(n){var e=-1;G.forEach(n,function(n){var r=f(n);if(r.length)for(var t=((r=G.sortBy(r,function(n){return l[n]})).length-1)/2,o=Math.floor(t),i=Math.ceil(t);o<=i;++o){var u=r[o];v[n]===n&&e<l[u]&&!Wr(a,n,u)&&(v[u]=n,v[n]=c[n]=c[u],e=l[u])}})}),{root:c,align:v}}function Ur(o,n,r,t,i,u){var e,a,f,c,v,l,d={},s=(e=o,a=n,n=r,f=t,c=u,v=new jr,r=e.graph(),l=function(e,a,f){return function(n,r,t){var o,i=n.node(r),u=n.node(t),t=0;if(t+=i.width/2,G.has(i,"labelpos"))switch(i.labelpos.toLowerCase()){case"l":o=-i.width/2;break;case"r":o=i.width/2}if(o&&(t+=f?o:-o),o=0,t+=(i.dummy?a:e)/2,t+=(u.dummy?a:e)/2,t+=u.width/2,G.has(u,"labelpos"))switch(u.labelpos.toLowerCase()){case"l":o=u.width/2;break;case"r":o=-u.width/2}
return o&&(t+=f?o:-o),o=0,t}}(r.nodesep,r.edgesep,c),G.forEach(n,function(i){var u;G.forEach(i,function(n){var r,t,o=f[n];v.setNode(o),u&&(r=f[u],t=v.edge(r,o),v.setEdge(r,o,Math.max(l(e,n,u),t||0)),function(n,r,t,o,i,u,e,a){if(!(o.length<2)){a&&(o=G.values(o).reverse(),l=u,u=e,e=l);var f=i[u],c=i[e],v=n.node(u),l=n.node(e);if("bl"===v.nType){u=o.indexOf(u);if(u<0)Ar("Node is not found in layer.");else for(var d=r.node(v.oriNode).padding,s=u+1,g=o.length;s<g;++s){var h=o[s];if(h)if("origin"===(w=n.node(h)).nType||"bl"===w.nType){var p=a?i[h]:f,b=a?f:i[h],m=d.left+w.width/2,y=t.edge(p,b);t.setEdge(p,b,Math.max(m,y||0));break}}}else if("br"===l.nType){e=o.indexOf(e);if(e<0)Ar("Node is not found in layer.");else for(d=r.node(l.oriNode).padding,s=e-1;0<=s;--s){var w,h=o[s];if(h)if("origin"===(w=n.node(h)).nType||"br"===w.nType){p=a?c:i[h],b=a?i[h]:c,m=d.right+w.width/2,y=t.edge(p,b);t.setEdge(p,b,Math.max(m,y||0));break}}}}}(e,a,v,i,f,u,n,c)),u=n})}),v),g=u?"borderLeft":"borderRight"
;function h(n,r){for(var t=s.nodes(),o=t.pop(),i={};o;)i[o]?n(o):(i[o]=!0,t.push(o),t=t.concat(r(o))),o=t.pop()}return h(function(n){d[n]=s.inEdges(n).reduce(function(n,r){return Math.max(n,d[r.v]+s.edge(r))},0)},s.predecessors.bind(s)),h(function(n){var r=s.outEdges(n).reduce(function(n,r){return Math.min(n,d[r.w]-s.edge(r))},Number.POSITIVE_INFINITY),t=o.node(n);r!==Number.POSITIVE_INFINITY&&t.borderType!==g&&(d[n]=Math.max(d[n],r))},s.successors.bind(s)),G.forEach(i,function(n){d[n]=d[t[n]]}),d}function Hr(i,n){return G.minBy(G.values(n),function(n){var t=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;return G.forIn(n,function(n,r){r=i.node(r).width/2;t=Math.max(n+r,t),o=Math.min(n-r,o)}),t-o})}function Jr(e,a){var n=G.values(a),f=G.min(n),c=G.max(n);G.forEach(["u","d"],function(u){G.forEach(["l","r"],function(n){var r,t,o=u+n,i=e[o];i!==a&&(r=G.values(i),(t="l"===n?f-G.min(r):c-G.max(r))&&(e[o]=G.mapValues(i,function(n){return n+t})))})})}function Kr(t,o){return G.mapValues(
t.ul,function(n,r){if(o)return t[o.toLowerCase()][r];r=G.sortBy(G.map(t,r));return(r[1]+r[2])/2})}var Qr=N,Vr=r,Xr=k,Yr=x,Zr=M.reportError,$r=function(t){var n=t;(function(o,n){var i,t,u,e,r=M.buildLayerMatrix(o);r.length<1||(0<=(i=o.graph().layeralignment)&&i<=1||(Zr("Invalid layer alignment: "+i),i=.5),t=o.graph().ranksep,u=[],G.forEach(r,function(n,r){u[r]=t}),Vr(o,n,r,u),Xr(o,n,r,u),e=0,G.forEach(r,function(n,r){var t=0;G.forEach(n,function(n){n=o.node(n).height;t<n&&(t=n)}),G.forEach(n,function(n){n=o.node(n);n.y=Yr(e,t,n.height,i)});r=u[r];e+=t+r}))})(t=M.asNonCompoundGraph(t),n),G.forEach(Qr(t,n),function(n,r){t.node(r).x=n})};t=function(u){var e=Math.min(u.graph().ranksep,u.graph().edgesep,u.graph().nodesep),a=u.graph().rankEdgeGraph;G.forEach(a.edges(),function(n){var r=n.v,t=n.w,o=a.node(r),i=a.node(t),r=o.order,t=i.order,n={e:n,eAttr:a.edge(n)};1===Math.abs(r-t)?nt(u,n,null):(o={x:o.x,y:o.y+o.height/2+e/2},i={x:i.x,y:i.y+i.height/2+e/2},nt(u,n,[o,i]))})};function nt(n,r,t){
var o=r.e,i=r.eAttr,r=i;"onGroup"===i.eType&&(r=i.oriAttr),i.points=t,r.points=t,n.setEdge(o,i),n.graph().remainEdgeGraph.removeEdge(o)}var rt=o.Graph,tt=M.findOutmostGroup,ot=M.findCommonParent,it=M.isADescentOfB,ut=M.reportError,N=function(e,a,f){a=a||null;var c=new rt({multigraph:e.isMultigraph(),compound:e.isCompound()}).setGraph(G.merge({},e.graph()));a&&c.setNode(a,G.merge({},e.node(a)));var n=a?e.children(a):e.children();return G.forEach(n,function(n){c.setNode(n,G.merge({padding:null},e.node(n))),a&&c.setParent(n,a)}),G.forEach(e.edges(),function(n){var r,t=n.v,o=n.w,i=null,u=null;t===a&&o===a?f&&(i=t,u=o):it(e,t,o)?o===a&&(i=(r=tt(e,t,a))===a?t:r,u=o):it(e,o,t)?t===a&&(i=t,u=(r=tt(e,o,a))===a?o:r):ot(e,t,o)===a&&(i=tt(e,t,a),(u=tt(e,o,a))===a&&(u=o),(i=i===a?t:i)&&u||ut("Outer node is not found.")),i&&u&&(c.node(i)&&c.node(u)||ut("Outer node is not direct child of compound node."),r=e.edge(n),c.setEdge(i,u,G.merge({backEdge:n},r),n.name),r.proxyEdge=null,i===t&&u===o||(
r.proxyEdge={v:i,w:u,name:n.name}))}),c},r=function(t,o){G.forEach(t.nodes(),function(n){var r=t.node(n),n=o.node(n);r&&n&&(n.x=r.x,n.y=r.y,n.width=r.width,n.height=r.height)}),G.forEach(t.edges(),function(n){var r=t.edge(n),n=r.backEdge,n=o.edge(n);r&&n&&(r=r.points,n.points=r.slice(0))})},k=function(a){G.forEach(a.edges(),function(n){var r,t,o,i,u=a.edge(n),e=u.proxyEdge;e&&(r=u.points,t=n.v,u=n.w,n=e.v,e=e.w,t!==n&&(i={x:(o=a.node(t)).x,y:o.y},r.unshift(i)),u!==e&&(i={x:(o=a.node(u)).x,y:o.y},r.push(i)))})},x=function(r,t,o){G.forEach(r.nodes(),function(n){n=r.node(n);n.x+=t,n.y+=o}),G.forEach(r.edges(),function(n){n=r.edge(n);G.forEach(n.points,function(n){n.x+=t,n.y+=o})})};var et=N,at=r,ft=k,ct=x,vt=function(n,r,t){var o={};return function n(r,t,o,i){var u=t?r.children(t):r.children();if(u.length<1)return null;for(var e=0,a=u.length;e<a;++e)n(r,u[e],o,i);var f=et(r,t);var c=o(f);at(c,r);t&&((f=r.node(t)).birthPos={x:f.x,y:f.y});i[t]=c;return c}(n,r,t,o),function r(t,n,o){{var i,u
,e;n&&(u=t.node(n),e=u.birthPos,i=u.x-e.x,u=u.y-e.y,e=o[n],ct(e,i,u),at(e,t))}n=n?t.children(n):t.children();G.forEach(n,function(n){0<t.children(n).length&&r(t,n,o)})}(n,r,o),ft(n),n};var lt=o.Graph,dt=N,st=r,gt=k,ht=x,pt=M.isADescentOfB,bt=function(i,n,r){var t=0,o=0;n&&(a=i.node(n),t=a.x,o=a.y);var u=n?i.children(n):i.children();G.forEach(u,function(n){0<i.children(n).length&&((n=i.node(n)).birthPos={x:n.x,y:n.y})});var e=dt(i,n,!0),e=r(e);{var a;n&&(a=e.node(n),t=t-a.x,a=o-a.y,ht(e,t,a))}return st(e,i),G.forEach(u,function(n){var r,t,o;0<i.children(n).length&&(o=(r=i.node(n)).birthPos,t=r.x-o.x,o=r.y-o.y,n=function(o,i,u){i=i||null;var e=new lt({multigraph:o.isMultigraph(),compound:o.isCompound()}).setGraph(G.merge({},o.graph()));i&&e.setNode(i,o.node(i));return G.forEach(o.nodes(),function(n){var r;i&&!pt(o,n,i)||(e.setNode(n,o.node(n)),(r=o.parent(n))&&(e.setNode(r,o.node(r)),e.setParent(n,r)))}),G.forEach(o.edges(),function(n){var r=n.v,t=n.w;e.node(r)&&e.node(t)&&(
r===i&&t===i&&!u||e.setEdge(n,o.edge(n)))}),e}(i,n,!1),r.x-=t,r.y-=o,ht(n,t,o))}),gt(i),i};var mt=function(n){var t=M.asNonCompoundGraph(n),r={};G.forEach(t.nodes(),function(n){r[n]=t.node(n).x}),function(t,r){function o(n){var r=t.node(n);r.borderLeft&&r.borderRight&&(i.push(n),G.forEach(t.children(n),o))}var i=[];G.forEach(t.children(),o);var u={};for(;0<i.length;){var n=i.pop();if(!G.has(u,n)){var e=[],a=[],f=!0;if(G.forEach(t.children(n),function(n){var r=t.node(n);"origin"===r.nType&&(r.borderLeft&&r.borderRight?G.has(u,n)?a.push(n):f=!1:e.push(n))}),f){for(var c=G.min(G.map(e,function(n){return r[n]-t.node(n).width/2})),v=G.max(G.map(e,function(n){return r[n]+t.node(n).width/2})),l=0,d=a.length;l<d;l++){var s,g=a[l];g&&(M=t.node(g).borderLeft,x=t.node(g).borderRight,s=G.min(G.map(M,function(n){if(n)return r[n]})),g=G.max(G.map(x,function(n){if(n)return r[n]})),(void 0===c||s<c)&&(c=s),(void 0===v||v<g)&&(v=g))}var h=t.node(n),p=h.padding,b=p.left,m=p.right,y=h.borderTop,
w=t.nodeEdges(y);w&&0<w.length&&((k=t.node(y).x)<c-b&&(c=k),v+m<k&&(v=k));var y=h.borderBottom,k=t.nodeEdges(y);k&&0<k.length&&((y=t.node(y).x)<c-b&&(c=y),v+m<y&&(v=y));var M=h.borderLeft,x=h.borderRight,N=c-p.left,E=v+p.right;N=yt(t,n,N,!1),E=yt(t,n,E,!0);for(l=0,d=M.length;l<d;l++)(R=M[l])&&(r[R]=N);for(var R,l=0,d=x.length;l<d;l++)(R=x[l])&&(r[R]=E);u[n]=!0}else i.unshift(n)}}}(n,r),G.forEach(r,function(n,r){t.node(r).x=n})};function yt(n,r,t,o){for(var i=t,u=n.graph().nodesep,e=n.graph().edgesep,a=Math.min(u,e)/2,e=n.node(r),f=e.minRank,c=e.maxRank,v=n.children(r),l=0,d=v.length;l<d;++l){var s=v[l],g=n.node(s);if("normalize"===g.nType){s=g.rank;if(f<=s&&s<=c&&g.x===t){i+=o?a:-a;break}}}return i}var wt=o.Graph,kt=M.reportError,r=function(u){G.forEach(u.nodes(),function(n){var r,t,o,i;u.children(n).length&&(r=u.node(n),t=u.node(r.borderTop),o=u.node(r.borderBottom),i=u.node(G.last(r.borderLeft)),n=u.node(G.last(r.borderRight)),r.width=Math.abs(n.x-i.x),r.height=Math.abs(o.y-t.y),
r.x=i.x+r.width/2,r.y=t.y+r.height/2)})},k=function(u,e){var a=new wt({multigraph:e.isMultigraph(),compound:e.isCompound()}).setGraph(e.graph());G.forEach(e.nodes(),function(n){for(var r=!0,t=e.parent(n);t;){if(!e.node(t).expanded){r=!1;break}t=e.parent(t)}r&&a.setNode(n,e.node(n))}),G.forEach(a.nodes(),function(n){var r=e.parent(n);r&&G.has(a.nodes(),r)&&a.setParent(n,r)});function f(n,r){for(var t=n,o=r.parent(t);o;)r.node(o).expanded||(t=o),o=r.parent(o);return t}return G.forEach(e.edges(),function(n){var r=n.v,t=n.w,o=f(r,e),i=f(t,e);o===i&&r!==o&&t!==i||(a.setEdge(o,i,e.edge(n),n.name),r===o&&t===i||(u.edge(n).substitute=a.edge(o,i)))}),a},x=function(n){for(var r=n.children(),t=0,o=r.length;t<o;++t){var i=r[t];0<n.children(i).length&&!function r(t,n){var o=t.children(n);G.forEach(o,function(n){0<t.children(n).length&&r(t,n)});var i=null;var u=null;for(var e=0,a=o.length;e<a;++e){var f=o[e],c=t.node(f),v=c.nType;"origin"===v&&(v=c.borderTop||f,f=c.borderBottom||f,v=t.node(v).rank,
f=t.node(f).rank,(v<i||null===i)&&(i=v),(u<f||null===u)&&(u=f))}if(null===i||null===u)return void kt("Min/Max child rank is not found.");var l=t.node(n);var d=l.borderTop;var s=l.borderBottom;n=t.node(d);l=t.node(s);var d=n.rank;var s=l.rank;d=i-d-1;s=s-u-1;if(d<0||s<0)return void kt("The delta rank is negative.");n.rank+=d;l.rank-=s}(n,i)}};var Mt=nn,xt=M.normalizeRanks,Nt=M.removeEmptyRanks,Et=t,Rt=M,Gt=o.Graph,Tt=Rt.removeNodesByNType,Lt=Rt.removeEdgesByEType,Ot=r,_t=k,Bt=x,t=function(r,n){var t=n&&n.debugTiming?Rt.time:Rt.notime;t("layout",function(){var n=t("  buildLayoutGraph",function(){return o=r,i=new Gt({multigraph:!0,compound:!0}),n=qt(o.graph()),i.setGraph(G.merge({},Ct,Wt(n,zt),G.pick(n,Ft))),G.forEach(o.nodes(),function(n){var r,t=qt(o.node(n));i.setNode(n,G.merge({},At,G.mapValues(G.pick(t,jt),function(n){return n}))),i.setParent(n,o.parent(n)),0<o.children(n).length&&(r=(t=o.node(n).padding)?{top:t.top,bottom:t.bottom,left:t.left,right:t.right}:{top:r=i.graph(
).ranksep/2,bottom:r,left:r=(i.graph().nodesep+i.graph().edgesep)/2,right:r},i.node(n).padding=r)}),G.forEach(o.edges(),function(n){var r=qt(o.edge(n));i.setEdge(n,G.merge({},St,Wt(r,Dt),G.pick(r,Pt)))}),i;var o,i,n});t("  removeCollapsedObjects",function(){n=_t(r,n)}),t("  runLayout",function(){n=function(n,r){var t=n.graph().onelevel,o="inside-out"!==n.graph().grouplayoutstrategy,i=n.graph().ranker;"user-defined"!==i&&"user-defined-mixed"!==i||(o=!0);{var u;n=t?(u=G.bind(It,null,G,r),bt(n,null,u)):o?It(n,r):(u=G.bind(It,null,G,r),vt(n,null,u))}return n}(n,t)}),t("  updateInputGraph",function(){var o,i;o=r,i=n,G.forEach(o.nodes(),function(n){var r=o.node(n),t=i.node(n);r&&(r.x=t?t.x:0,r.y=t?t.y:0,(n=i.children(n))&&n.length&&(r.width=(t||r).width,r.height=t?t.height:r.width))}),G.forEach(o.edges(),function(n){var r=o.edge(n),n=i.edge(n);G.isUndefined(n)&&(n=r.substitute),r.points=n?n.points:[],G.has(n,"x")&&(r.x=n.x,r.y=n.y)}),o.graph().width=i.graph().width,o.graph().height=i.graph(
).height})})};function It(c,n){return n("    initStatus",function(){var n;(function(r){G.forEach(r.nodes(),function(n){r.node(n).nType="origin"}),G.forEach(r.edges(),function(n){r.edge(n).eType="origin"})})(n=c),function(r){G.forEach(r.edges(),function(n){r.edge(n).points=null})}(n)}),n("    makeSpaceForEdgeLabels",function(){var r,t;1!==(t=(r=c).graph()).edgefactor&&(t.ranksep/=2,G.forEach(r.edges(),function(n){n=r.edge(n);n.minlen*=2,"c"!==n.labelpos.toLowerCase()&&("TB"===t.rankdir||"BT"===t.rankdir?n.width+=n.labeloffset:n.height+=n.labeloffset)}))}),n("    removeSelfEdges",function(){var t;t=c,G.forEach(t.edges(),function(n){var r;n.v===n.w&&((r=t.node(n.v)).selfEdges||(r.selfEdges=[]),r.selfEdges.push({e:n,label:t.edge(n)}),t.removeEdge(n))})}),n("    autoUserDefinedRankMode",function(){!function(n){if("user-defined-mixed"===n.graph().ranker){var r=!0,t=Rt.getLayerIdDP(n);if(t){for(var o=n.nodes(),i=0,u=o.length;i<u;++i){var e=o[i];if(n.children(e).length<1)if("origin"===n.node(e
).nType){e=t.get(e);if(null==e){r=!1;break}}}r&&(n.graph().ranker="user-defined")}}}(c)}),n("    buildAcylicNestingGraph",function(){c=function(n){var r=null,t=n.graph().ranker;r="user-defined"===t?Jn.buildAcylicNestingGraph_userRank(n):vn.buildAcylicNestingGraph(n);return r}(c)}),n("    rank",function(){var n,r;"user-defined"===(r=(n=c).graph().ranker)?Mt(n):"user-defined-mixed"===r?(Y(Rt.asNonCompoundGraph(n)),Dn(n)):((r=Rt.asNonCompoundGraph(n)).compG=n,Y(r))}),n("    injectEdgeLabelProxies",function(){var t;1!==(t=c).graph().edgefactor&&G.forEach(t.edges(),function(n){var r=t.edge(n);r.width&&r.height&&(r=t.node(n.v),n={rank:(t.node(n.w).rank-r.rank)/2+r.rank,e:n},Rt.addDummyNode(t,"edge-proxy",n,"_ep"))})}),n("    shrinkRanksforBorderNodes",function(){Bt(c)}),n("    removeEmptyRanks",function(){Nt(c)}),n("    nestingGraph.cleanup",function(){vn.cleanup(c)}),n("    normalizeRanks",function(){xt(c)}),n("    addBackRemainingEdges",function(){var n;n=c,
vn.addBackRemainingEdgesBeforeOrder(n),vn.insertNecessaryRankBeforeOrder(n)}),n("    assignRankMinMax",function(){var r,t;r=c,t=0,G.forEach(r.nodes(),function(n){n=r.node(n);n.borderTop&&(n.minRank=r.node(n.borderTop).rank,n.maxRank=r.node(n.borderBottom).rank,t=G.max(t,n.maxRank))}),r.graph().maxRank=t}),n("    removeEdgeLabelProxies",function(){var t;1!==(t=c).graph().edgefactor&&G.forEach(t.nodes(),function(n){var r=t.node(n);"edge-proxy"===r.dummy&&(t.edge(r.e).labelRank=r.rank,t.removeNode(n))})}),n("    normalize.run",function(){y.run(c)}),n("    parentDummyChains",function(){Sn(c)}),n("    addBorderSegments",function(){Kn(c)}),n("    order",function(){Ir(c)}),n("    insertSelfEdges",function(){var i,n;i=c,n=Rt.buildLayerMatrix(i),G.forEach(n,function(n){var o=0;G.forEach(n,function(n,r){var t=i.node(n);t.order=r+o,G.forEach(t.selfEdges,function(n){Rt.addDummyNode(i,"selfedge",{width:n.label.width,height:n.label.height,rank:t.rank,order:r+ ++o,e:n.e,label:n.label},"_se")}),
delete t.selfEdges})})}),n("    adjustCoordinateSystem",function(){$n.adjust(c)}),n("    position",function(){$r(c)}),n("    positionSelfEdges",function(){var e;e=c,G.forEach(e.nodes(),function(n){var r,t,o,i,u=e.node(n);"selfedge"===u.dummy&&(r=(i=e.node(u.e.v)).x+i.width/2,t=i.y,o=u.x-r,i=i.height/2,e.setEdge(u.e,u.label),e.removeNode(n),u.label.points=[{x:r+2*o/3,y:t-i},{x:r+5*o/6,y:t-i},{x:r+o,y:t},{x:r+5*o/6,y:t+i},{x:r+2*o/3,y:t+i}],u.label.x=u.x,u.label.y=u.y)})}),n("    positionHorizEdges",function(){Et(c)}),n("    compactCompoundNodes",function(){c.graph().compactgroup&&mt(c)}),n("    removeBorderNodes",function(){var n;Ot(n=c),Tt(n,["bl","br"])}),n("    normalize.undo",function(){var n;Lt(n=c,["nesting","crossRelation"]),y.undo(n),Tt(n,["normalize"])}),n("    fixupEdgeLabelCoords",function(){var t;1!==(t=c).graph().edgefactor&&G.forEach(t.edges(),function(n){var r=t.edge(n);if(G.has(r,"x"))switch("l"!==r.labelpos&&"r"!==r.labelpos||(r.width-=r.labeloffset),r.labelpos){
case"l":r.x-=r.width/2+r.labeloffset;break;case"r":r.x+=r.width/2+r.labeloffset}})}),n("    undoCoordinateSystem",function(){$n.undo(c)}),n("    translateGraph",function(){function r(n){var r=n.x,t=n.y,o=n.width,n=n.height;i=Math.min(i,r-o/2),u=Math.max(u,r+o/2),e=Math.min(e,t-n/2),a=Math.max(a,t+n/2)}var t,i,u,e,a,n,o,f;t=c,i=Number.POSITIVE_INFINITY,u=0,e=Number.POSITIVE_INFINITY,a=0,n=t.graph(),o=n.marginx||0,f=n.marginy||0,G.forEach(t.nodes(),function(n){r(t.node(n))}),G.forEach(t.edges(),function(n){n=t.edge(n);G.has(n,"x")&&r(n)}),i-=o,e-=f,G.forEach(t.nodes(),function(n){n=t.node(n);n.x-=i,n.y-=e}),G.forEach(t.edges(),function(n){n=t.edge(n);G.forEach(n.points,function(n){n.x-=i,n.y-=e}),G.has(n,"x")&&(n.x-=i),G.has(n,"y")&&(n.y-=e)}),n.width=u-i+o,n.height=a-e+f}),n("    assignNodeIntersects",function(){var a;a=c,G.forEach(a.edges(),function(n){var r,t=a.edge(n),o=a.node(n.v),i=a.node(n.w),u=t.points?(r=t.points[0],t.points[t.points.length-1]):(t.points=[],r=i,o),e=o.nType,
n=i.nType;"bt"===e||"bb"===e?t.points.unshift({x:o.x,y:o.y}):t.points.unshift(Rt.intersectRect(o,r)),"bt"===n||"bb"===n?t.points.push({x:i.x,y:i.y}):t.points.push(Rt.intersectRect(i,u))})}),n("    undoForEdgesOnGroup",function(){var n;n=c,vn.undoForEdgesOnGroup(n),Tt(n,["bt","bb"])}),n("    reversePoints",function(){var r;r=c,G.forEach(r.edges(),function(n){n=r.edge(n);n.reversed&&n.points.reverse()})}),n("    acyclic.undo",function(){s.undo(c)}),c}var zt=["nodesep","edgesep","ranksep","marginx","marginy"],Ct={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb",edgefactor:1,layeralignment:.5,compactgroup:!0,grouplayoutstrategy:"global",onelevel:!1},Ft=["acyclicer","ranker","rankdir","align","edgefactor","layeralignment","compactgroup","grouplayoutstrategy","onelevel","dpmaps"],jt=["width","height","x","y","expanded"],At={width:0,height:0,x:0,y:0,expanded:!0},Dt=["minlen","weight","width","height","labeloffset"],St={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r",points:[]},
Pt=["labelpos","points"];function Wt(n,r){return G.mapValues(G.pick(n,r),Number)}function qt(n){var t={};return G.forEach(n,function(n,r){t[r.toLowerCase()]=n}),t}var Ut=o.Graph;r={graphlib:o,layout:t,debug:{debugOrdering:function(r){var n=M.buildLayerMatrix(r),t=new Ut({compound:!0,multigraph:!0}).setGraph({});return G.forEach(r.nodes(),function(n){t.setNode(n,{label:n}),t.setParent(n,"layer"+r.node(n).rank)}),G.forEach(r.edges(),function(n){t.setEdge(n.v,n.w,{},n.name)}),G.forEach(n,function(n,r){t.setNode("layer"+r,{rank:"same"}),G.reduce(n,function(n,r){return t.setEdge(n,r,{style:"invis"}),r})}),t}},util:{time:M.time,notime:M.notime},version:"0.8.4"},k=r.graphlib,x=r.layout,o=r.util,t=r.version;n.debug=r.debug,n.default=r,n.graphlib=k,n.layout=x,n.util=o,n.version=t,Object.defineProperty(n,"Zo",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("graphlib"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","graphlib",
"lodash"],n):n(((t=t||self).diagramfoundation=t.diagramfoundation||{},t.diagramfoundation.dagre=t.diagramfoundation.dagre||{},t.diagramfoundation.dagre.core={}),t.graphlib,t._);