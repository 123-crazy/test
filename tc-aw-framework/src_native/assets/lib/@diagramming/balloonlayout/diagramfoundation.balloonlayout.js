// @<COPYRIGHT>@
// ==================================================
// Copyright Siemens 2020.
// PL Diagram Foundation 1973.0.1-0
// ==================================================
// @<COPYRIGHT>@
var t,n;t=this,n=function(m,e,t,n){"use strict";m=m&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var O={};function r(t,n,r){this.t=t,this.n=n,this.r=r,this.i="neighbors",this.o={nodeAttrs:["x","y","w","h","expanded","padding"],nodeDefault:{x:0,y:0,w:0,h:0,expanded:!1,padding:{top:20,bottom:20,left:20,right:20}},edgeAttrs:["path"],edgeDefault:{path:[]}},this.u=null,this.a=[]}O.Point=t.Point,O.Vector=t.Vector,O.Rect=t.Rect,O.MathUtil=t.MathUtil;function o(t,n){return m.mapValues(m.pick(t,n),function(t){return t})}function f(t){return"_"+t.v+"_"+t.w+"_"+t.name}r.prototype.f=function(t){this.u=t};function u(t,n,r){var i=[],o={},u=null;for(i.push(n),o[n]=0;0<i.length;){var a=i.shift(),f=t.neighbors(a),u=a;m.forEach(f,function(t){void 0===o[t]&&(o[t]=o[a]+1,i.push(t))})}
return n=[],r&&(n=s(t,o,u)),{node:u,distance:o[u],chain:n}}function h(r,t,n,i){var o={},u={},a=[],f=0;for(a.push(t),o[t]=!0,f++;0<a.length;){var e=a.shift(),h=o[e],s=u[e],c=r.neighbors(e);c.sort(function(t,n){return r.neighbors(n).length-r.neighbors(t).length});for(var v=0,d=c.length;v<d;v++){var l=c[v];o[l]||u[l]||(s?u[l]=!0:h&&(n.indexOf(l)>i&&3<=r.neighbors(l).length?u[l]=!0:(o[l]=!0,f++)),a.push(l))}}return f}var s=function(r,n,t){var i=[],o=n[t],u=t;for(i.push(t),o--;0<=o;){var a=r.neighbors(u),a=m.filter(a,function(t){return n[t]===o});a.sort(function(t,n){return r.neighbors(n).length-r.neighbors(t).length});a=a[0];i.push(a),u=a,o--}return i};r.prototype.e=function(t){var n,t=m.intersection(this.a,t.nodes());return n=0<t.length?t[0]:n};function a(t,n){var r,i=n.length,o=t.nodes().length;return i%2==0?o-(t=h(t,n[o=(r=i/2)-1],n,o))<=t?n[o]:n[r]:n[Math.floor(i/2)]}function c(t,n,r){var i=t.nodes().length,o={},u=[],a=0;for(u.push(n),o[n]=!0,a++;0<u.length;){var f=u.shift(),f=t[r](f)
;0<f.length&&m.forEach(f,function(t){o[t]||(o[t]=!0,a++,u.push(t))})}return a===i}r.prototype.s=function(t,n){var r,i,o,u,a=t.nodes().length===(e=t,i=!1,o={},u=0,r&&0<r.length&&(i={},m.forEach(r,function(t){i[t]=!0})),m.forEach(e.edges(),function(t){var n=t.v,r=t.w;n!==r&&(i&&(i[n]||i[r])||(o[t=n+"_"+r]||o[r+"_"+n]||(o[t]=!0,u++)))}),u)+1,f=t.sources()||[],r=t.sinks()||[],e=null;if(1===f.length){if(a||c(t,f[0],"successors"))return this.i="successors",f[0]}else if(0===f.length)for(var e,h=(e=this.c(t)).seqL.concat();0<h.length;){var s=h.shift();if(c(t,s,"successors"))return this.i="successors",s}if(1===r.length){if(a||c(t,r[0],"predecessors"))return this.i="predecessors",r[0]}else if(0===r.length)for(h=(e=e||this.c(t)).seqR.concat();0<h.length;){s=h.pop();if(c(t,s,"predecessors"))return this.i="predecessors",s}return null},r.prototype.d=function(t){var n=t;n.nodes().length;if(3===this.n.l&&(this.i="neighbors",i=this.e(n)))return i;var r,i,r=(t=(r=n).nodes()[0],t=u(r,t,!1),u(r,t.node,!0
).chain);return 0!==this.n.l&&3!==this.n.l||!(i=this.s(n,r))?i=1===this.n.l?(this.i="neighbors",a(n,r)):(this.i="neighbors",0===(t=m.filter(n.nodes(),function(t){return 3<=n.neighbors(t).length})).length?a(n,r):1===t.length?t[0]:function(t,n){for(var r,i=t.nodes().length,o=(n.length,0),u=n.length;o<u;o++){var a=n[o];if(!(t.neighbors(a).length<3)){var f=h(t,a,n,o);if(i-f<=f){r=a;break}}}return r}(n,r)):i},r.prototype.c=function(t){for(var n=this.M(t),r=[],i=[];0<n.nodes().length;){for(var o=n.sinks();0<o.length;){var u=o.pop();n.removeNode(u),i.unshift(u)}for(var a=n.sources();0<a.length;){var f=a.pop();n.removeNode(f),r.push(f)}var e=n.nodes().length;if(0<e){for(var h=n.nodes()[0],s=n.successors(h).length-n.predecessors(h).length,c=1;c<e;c++){var v=n.nodes()[c],d=n.successors(v).length-n.predecessors(v).length;s<d&&(s=d,h=v)}n.removeNode(h),r.push(h)}}return{seqL:r,seqR:i}};r.prototype.g=function(){var t=this.M(this.u);!function(u){var o=[];m.forEach(u.nodes(),function(r){
var t=u.children(r);if(0<t.length)if(u.node(r).expanded)o.push(r);else do{var i=[];m.forEach(t,function(t){var n=u.children(t);0<n.length&&(i=i.concat(n)),u.node(t).p=r,o.push(t)}),t=i}while(0<t.length)});var t=m.filter(u.edges(),function(t){return 0<=o.indexOf(t.v)&&o.indexOf(t.w)<0||0<=o.indexOf(t.w)&&o.indexOf(t.v)<0});m.forEach(t,function(t){var n,r,i=t.v,o=t.w;t.name;u.node(i).p?(n=u.node(i).p,r=m.uniqueId("crossing_"),u.setEdge(n,o,{},r),u.edge(n,o,r).m=t):u.node(o).p&&(n=u.node(o).p,r=m.uniqueId("crossing_"),u.setEdge(i,n,{},r),u.edge(i,n,r).m=t)}),m.forEach(o,function(t){u.removeNode(t)})}(t);var i,o,n=function(n){for(var t=n.nodes().concat(),r=t.length,i={},o=[],u=0;0<r;){var a=t.shift();if(r--,!i[a]){i[a]=!0,o[u]=[a];for(var f=n.neighbors(a);0<f.length;){var e=[];m.forEach(f,function(t){i[t]||(o[u].push(t),i[t]=!0,0<(t=m.filter(n.neighbors(t),function(t){return!i[t]})).length&&(e=e.concat(t)))}),f=e}u++}}return o}(t);return i=t,o=[],m.forEach(n,function(t){var n=new e.Graph({
directed:!0,compound:!0,multigraph:!0}),r=[];m.forEach(t,function(t){n.setNode(t,i.node(t));t=m.filter(i.nodeEdges(t),function(t){return r.indexOf(t)<0});0<t.length&&(r=r.concat(t))}),m.forEach(r,function(t){n.setEdge(t,i.edge(t))}),o.push(n)}),o},r.prototype.M=function(n){var r=new e.Graph({directed:!0,compound:!0,multigraph:!0}),i=this;return m.forEach(n.nodes(),function(t){r.setNode(t,m.merge({},i.o.nodeDefault,o(n.node(t),i.o.nodeAttrs))),r.setParent(t,n.parent(t))}),m.forEach(n.edges(),function(t){r.setEdge(t,m.merge({},i.o.edgeDefault,o(n.edge(t),i.o.edgeAttrs)))}),r},r.prototype.b=function(t,n){var r=t,i=this,o={},u=[];for(u.push(n),o[n]=!0,r.node(n).level=0;0<u.length;){var a=u.shift(),f=r.node(a),e=f.level;f._=[];var h=r[this.i](a);0===this.n.q&&h.sort(function(t,n){return r[i.i](n).length-r[i.i](t).length}),m.forEach(h,function(t){var n;o[t]||((n=r.node(t)).O=a,f._.push(t),n.level=e+1,o[t]=!0,u.push(t))})}return r},r.prototype.j=function(o,t){var r={},n=o.node(t),i=!n.O,u=n._
,a=u.length;r.center={x:n.x,y:n.y},r.radius=n.radius+this.n.R,r.startAngle=this.n.D*Math.PI/180,r.wedgeAngles=[];var f,e,h,s,c,v,d,l=i?this.n.A*Math.PI/180:2*Math.PI;return 1===this.n.q?(f=[],e=l,h=u.concat(),t=m.sumBy(u,function(t){t=o.node(t);if(t.sizes)return t.sizes[0]+t.sizes[1]}),s=.25*l,0<t?(c=t,h.sort(function(t,n){return o.node(n).sizes[0]+o.node(n).sizes[1]-(o.node(t).sizes[0]+o.node(t).sizes[1])}),m.forEach(h,function(t){var n=o.node(t),r=e*n.sizes[0]/c,i=e*n.sizes[1]/c;e-=(r=s<r?s:r)+(i=s<i?s:i),c-=n.sizes[0]+n.sizes[1],f.push({id:t,angles:[r,i]})})):(v=m.sumBy(u,function(t){return o.node(t).radius}),h.sort(function(t,n){return o.node(n).radius-o.node(t).radius}),m.forEach(h,function(t){var n=o.node(t),r=e*n.radius/v/2;e-=2*(r=s<r?s:r),v-=n.radius,f.push({id:t,angles:[r,r]})})),m.forEach(u,function(n){var t=m.find(f,function(t){return t.id===n});r.wedgeAngles.push(t.angles)})):(d=l/a/2,m.forEach(u,function(t){r.wedgeAngles.push([d,d])})),this.n.A<360&&(
r.startAngle+=r.wedgeAngles[0][0]),1===a?r.wedgeAngles=[[Math.PI/2,Math.PI/2]]:i||2===a&&(r.wedgeAngles=[[Math.PI/4,Math.PI/4],[Math.PI/4,Math.PI/4]]),void 0!==n.spokeAngle&&(r.startAngle=1===a?n.spokeAngle:2===a?n.spokeAngle-Math.PI/4:n.spokeAngle+Math.PI+r.wedgeAngles[0][0]),r};r.prototype.B=function(o,t){var u,a,f,e,h=o.node(t),n=h._;0!==n.length&&(0===this.n.q&&(n=function(r,t){var t=r.node(t),n=t._.concat(),i=n.length,o=[];if(n.sort(function(t,n){return r.node(n).depth-r.node(t).depth}),t.O)for(;0<i;){var u=n.shift(),a=n.shift();u&&o.unshift(u),a&&o.push(a),i=n.length}else o=n;return o}(o,t)),a=(u=this).n.R,f=this.j(o,t),e=0,m.forEach(n,function(t,n){var r=o.node(t);0===n?(r.spokeAngle=f.startAngle,e+=f.wedgeAngles[n][1]):(r.spokeAngle=f.startAngle+e+f.wedgeAngles[n][0],e+=f.wedgeAngles[n][0]+f.wedgeAngles[n][1]),r.wedgeAngles=f.wedgeAngles[n];var i=Math.min(r.wedgeAngles[0],r.wedgeAngles[1]),n=(f.radius*Math.sin(i)-a/2)/(1-Math.sin(i)),i=r.radius<=n?f.radius+r.radius:(
r.radius+a/2)/Math.sin(i);r.x=h.x+i*Math.cos(r.spokeAngle),r.y=h.y-i*Math.sin(r.spokeAngle),u.B(o,t)}))},r.prototype.N=function(o){m.forEach(o.nodes(),function(t){t=o.node(t);t.radius=Math.sqrt(t.w*t.w+t.h*t.h)/2});var t=m.filter(o.nodes(),function(t){return 0===o.node(t)._.length});m.forEach(t,function(t){var n=0,r=o.node(t);r.depth=n;for(var i=r.O;i;)n++,(null==(r=o.node(i)).depth||r.depth<n)&&(r.depth=n),i=r.O});t=m.find(o.nodes(),function(t){return 0===o.node(t).level});t?this.B(o,t):this.r("BalloonOperator: No root found in graph.")},r.prototype.k=function(f,t){var r,t=f.node(t)._;0!==t.length&&(r=this,m.forEach(t,function(t){var i=f.node(t),n=[],o=new O.Vector(Math.cos(i.spokeAngle),Math.sin(i.spokeAngle)).normalize().clone();o.rotate(Math.PI/2);var u=i.radius,a=-i.radius;l(f,t,n),m.forEach(n,function(t){var n=f.node(t),r=new O.Vector(n.x-i.x,i.y-n.y).dot(o),t=r+n.radius,n=r-n.radius;u<t&&(u=t),n<a&&(a=n)}),i.sizes=[-a,u],r.k(f,t)}))},r.prototype.C=function(n){var t=m.find(
n.nodes(),function(t){return 0===n.node(t).level});t?(this.k(n,t),this.B(n,t)):this.r("BalloonOperator: No root found in graph.")};function d(t,n,r){return t=t.clone(),n=n.normalize(),t.x+=r*n.x,t.y-=r*n.y,t}function v(t,n){var r=t.x*n.x+t.y*n.y,i=t.x*n.y-n.x*t.y;return Math.abs(i)<1e-6?0<r?0:180:(t=Math.sqrt(t.x*t.x+t.y*t.y),n=Math.sqrt(n.x*n.x+n.y*n.y),n=180*Math.acos(r/(t*n))/Math.PI,n=i<0?360-n:n)}function j(t,n,r,i){return t=(t=new O.Vector(t.x-n.x,n.y-t.y)).normalize(),v(r,t)<v(r,i)}var l=function(t,n,r){for(var i=t.node(n)._,o=0,u=i.length;o<u;o++){var a=i[o];r.push(a),l(t,a,r)}};r.prototype.L=function(t,n,r){for(var i=t.node(n),n=i.O,o=t.node(n),u=this.n.R,a=void 0,f=new O.Vector(Math.cos(i.spokeAngle),Math.sin(i.spokeAngle)).normalize(),e=new O.Vector(Math.cos(i.spokeAngle+i.wedgeAngles[1]),Math.sin(i.spokeAngle+i.wedgeAngles[1])).normalize(),h=new O.Vector(Math.cos(i.spokeAngle-i.wedgeAngles[0]),Math.sin(i.spokeAngle-i.wedgeAngles[0])).normalize(),s=Math.abs(f.y)<1e-6,c=0,
v=r.length;c<v;c++)for(var d=t.node(r[c]),l=!function(t,n){n=O.Vector.cross(t,n);return-1===O.MathUtil.doubleCompare(n,0)}(f,new O.Vector(d.x-o.x,o.y-d.y))?e:h,M=s?function(t,n,r,i){for(var o=t.y,u=n.y-o,a=r.y*u-r.x*n.x,u=n.x*n.x+u*u,t=t.radius+i/2,i=r.x*r.x-1,n=2*r.x*a+2*n.x,f=O.MathUtil.W(i,n,a*a+t*t-u),e=[],h=0,s=f.length;h<s;h++)e.push({x:f[h],y:o});return e}(d,o,l,u):function(t,n,r,i,o){for(var u=-r.x/r.y,a=t.x-t.y*u,f=i.x*a+i.y*n.y-i.x*n.x,r=t.radius+o/2,t=i.x*u-i.y,o=a-n.x,i=2*f*t-2*o*u+2*n.y,n=f*f+r*r-o*o-n.y*n.y,e=O.MathUtil.W(t*t-u*u-1,i,n),h=[],s=0,c=e.length;s<c;s++){var v=e[s];h.push({x:u*v+a,y:v})}return h}(d,o,f,l,u),g=0,p=M.length;g<p;g++)if(j(M[g],o,h,e)){var w=M[g],m=w.x-o.x,b=w.y-o.y;if((q=Math.sqrt(m*m+b*b))<d.radius+o.radius+u)for(var y=s?function(t,n,r){for(var i=t.y,o=i-n.y,t=t.radius+n.radius+r,r=-2*n.x,t=n.x*n.x+o*o-t*t,u=O.MathUtil.W(1,r,t),a=[],f=0,e=u.length;f<e;f++)a.push({x:u[f],y:i});return a}(d,o,u):function(t,n,r,i){for(var o=-r.x/r.y,u=t.x-t.y*o,
r=t.radius+n.radius+i,t=u-n.x,i=2*t*o-2*n.y,n=t*t-r*r+n.y*n.y,a=O.MathUtil.W(o*o+1,i,n),f=[],e=0,h=a.length;e<h;e++){var s=a[e];f.push({x:o*s+u,y:s})}return f}(d,o,f,u),x=0,_=y.length;x<_;x++)if(j(y[x],o,h,e)){w=y[x];break}var m=w.x-d.x,b=w.y-d.y,q=Math.sqrt(m*m+b*b);0<new O.Vector(w.x-d.x,d.y-w.y).normalize().dot(f)&&(void 0===a||a<q)&&(a=q)}return a},r.prototype.F=function(n,t){var r=n.node(t),i=[];l(n,t,i);var o,u,t=this.L(n,t,i);void 0!==t&&(o=t*Math.cos(r.spokeAngle),u=t*Math.sin(r.spokeAngle),r.x+=o,r.y-=u,m.forEach(i,function(t){t=n.node(t);t.x+=o,t.y-=u}))},r.prototype.P=function(n){var r=this,i=0;m.forEach(n.nodes(),function(t){t=n.node(t).depth;i<t&&(i=t)});for(var o=1;o<i;)m.forEach(n.nodes(),function(t){n.node(t).depth===o&&r.F(n,t)}),o++};r.prototype.S=function(i){if(!(i.length<2)){m.forEach(i,function(t){var o,u,a,f,e;o=t,m.forEach(o.nodes(),function(t){var n=o.node(t),r=n.x-n.w/2,i=n.y-n.h/2,t=n.x+n.w/2,n=n.y+n.h/2;(void 0===u||i<u)&&(u=i),(void 0===a||a<t)&&(a=t),(
void 0===f||f<n)&&(f=n),(void 0===e||r<e)&&(e=r)}),o.setGraph({top:u,right:a,bottom:f,left:e,width:a-e,height:f-u})}),i.sort(function(t,n){var r=O.MathUtil.doubleCompare(n.graph().height,t.graph().height);return r=0===r?i.indexOf(t)-i.indexOf(n):r});var n=this.n.R,r=0,o=0;m.forEach(i,function(t){r+=t.graph().width+n,o<t.graph().width&&(o=t.graph().width)});for(var t=Math.sqrt((i[0].graph().height+n)*r),u=t<o?o:t,a=i.concat(),f=a.shift().graph(),e=f.left,h=f.top,t=f.right,s=f.bottom,c=f.width,v=(f.height,t+n),d=h;0<a.length;){var l,M,g=a.shift(),p=g.graph().width,w=g.graph().height;u<c+n+p&&(v=e,d=s+n,c=-n,s+=w+n),l=v-g.graph().left,M=d-g.graph().top,c+=n+p,v+=n+p,m.forEach(g.nodes(),function(t){t=g.node(t);t.x+=l,t.y+=M})}}};function M(i,o,t,n){var r,u,a,f,e,h=i.node(o),s=i.node(t),c=new O.Point(h.x,h.y),v=new O.Point(s.x,s.y);1===(t=n.length)?(r=n[0]).v===o?i.edge(r).path=[c,v]:r.w===o&&(i.edge(r).path=[v,c]):1<t&&(r=new O.Vector(v.x-c.x,c.y-v.y),u=new O.Vector(-r.y,r.x),h=Math.min(
h.w,h.h),s=Math.min(s.w,s.h),a=d(c,u,-(h=s<(h=h)?s:h)/2),f=d(v,u,-h/2),e=h/(t+1),m.forEach(n,function(t,n){var r=d(a,u,e*(n+1)),n=d(f,u,e*(n+1));t.v===o?i.edge(t).path=[r,n]:t.w===o&&(i.edge(t).path=[n,r])}))}r.prototype.z=function(t,u){var a=this.u;m.forEach(t,function(o){m.forEach(o.nodes(),function(t){var n=a.node(t),r=o.node(t);n.x=r.x,n.y=r.y,u[t]=!0}),m.forEach(o.edges(),function(t){var n;u[f(t)]||((n=o.edge(t).m)&&u[f(n)]||(n=o.nodeEdges(t.v,t.w),M(o,t.v,t.w,n),m.forEach(n,function(t,n){var r=a.edge(t),i=o.edge(t),t=f(t);r||(r=a.edge(i.m),t=f(i.m)),r.path=i.path,u[t]=!0})))})})},r.prototype.G=function(n){for(var r=this.u,t=r.nodes().concat();0<t.length;){var i,o,u=t.shift(),a=r.node(u);n[u]||(0===(o=r.children(u)).length?n[u]=!0:0===m.filter(o,function(t){return!n[t]}).length?(i=null,m.forEach(o,function(t){t=r.node(t),t=new O.Rect(t.x-t.w/2,t.y-t.h/2,t.w,t.h);i?i.union(t):i=t}),o=a.padding,a.w=i.width+o.left+o.right,a.h=i.height+o.top+o.bottom,a.x=i.x-o.left+a.w/2,
a.y=i.y-o.top+a.h/2,n[u]=!0):t.push(u))}},r.prototype.H=function(o){var u=this.u,t=u.edges();m.forEach(t,function(t){var n=t.v,r=t.w,i=f(t);u.edge(t);o[i]||(t=u.nodeEdges(n,r),M(u,n,r,t),m.forEach(t,function(t){i=f(t),o[i]=!0}))})},r.prototype.I=function(t){var n={};this.z(t,n),this.G(n),this.H(n)};var i={DirectedRoot:0,CenterRoot:1,WeightedCenterRoot:2,SelectedRoot:3},g={EvenlyDivided:0,FastProportional:1};function p(){this.l=i.DirectedRoot,this.R=40,this.D=0,this.A=360,this.q=g.FastProportional}function w(t){this.t=t,this.r=t.reportError,this.n=new p,this.J=!1,this.a=[],this.u=null,this.K=new r(this.t,this.n,this.r)}w.prototype.setRootNodePolicy=function(t){this.n.l=t},w.prototype.setAngleSpacing=function(t){this.n.q=t},w.prototype.setNodeOffset=function(t){this.n.R=t},w.prototype.setStartAngle=function(t){this.n.D=t},w.prototype.setRootWedgeAngle=function(t){t<=0||360<t?this.r("BalloonLayout: rootWedgeAngle should be in (0, 360]."):this.n.A=t},w.prototype.setRootNodes=function(t){
var n=this,r=[];this.a=t||[],m.forEach(this.a,function(t){n.isNodeInGraph(t)&&r.push(t.Q)}),this.K.a=r},w.prototype.T=function(){return null!==this.u&&0<this.u.nodes().length},w.prototype.isNodeInGraph=function(t){if(!this.T())return!1;for(var n=this.u,r=0,i=n.nodes().length;r<i;r++){var o=n.nodes()[r];if(n.node(o).hostNode===t)return!0}return!1},w.prototype.setGraphs=function(t,n){this.u=new e.Graph({directed:!0,compound:!0,multigraph:!0});var u=this,a=[],f=this.t;m.forEach(t,function(t,n){var r=f.getNodeRect(t),i=f.isGroupNode(t),o=f.isExpanded(t),i=i?f.getGroupNodePadding(t):null,n=n+"";u.u.setNode(n,{x:r.x+r.w/2,y:r.y+r.h/2,w:r.w,h:r.h,expanded:o,padding:i,hostNode:t}),t.Q=n,0<=u.a.indexOf(t)&&a.push(t.Q)}),m.forEach(t,function(t){var n=f.getParentNode(t);n&&u.u.setParent(t.Q,n.Q)}),m.forEach(n,function(t,n){var r=f.getSourceNode(t),i=f.getTargetNode(t),o=f.getPath(t);u.u.setEdge(r.Q,i.Q,{path:o,hostEdge:t},n)}),0<a.length&&(this.K.a=a),this.K.f(this.u)},
w.prototype.doLayout=function(){if(!this.T())return!1;var r=this,i=[],t=this.K.g();return m.forEach(t,function(t){var n=r.K.d(t),n=r.K.b(t,n);r.K.N(n),1===r.n.q&&r.K.C(n),r.K.P(n),1===r.n.q&&(r.K.C(n),r.K.P(n)),i.push(n)}),this.K.S(i),this.K.I(i),this.U(),!0},w.prototype.clear=function(){this.u=null,this.K=null},w.prototype.beginCompoundCommands=function(){this.J=!0},w.prototype.endCompoundCommandsAndUpdate=function(){this.J=!1,this.U()},w.prototype.U=function(){!1===this.J&&this.V()},w.prototype.V=function(){var n=this.u,r=this.t,t=n.nodes().concat(),i={};for(r.stopDisplayUpdate();0<t.length;){var o=t.shift(),u=n.parent(o);!u||i[u]?(u=n.node(o),r.setNodeRect(u.hostNode,u.x-u.w/2,u.y-u.h/2,u.w,u.h),i[o]=!0):t.push(o)}for(var a=0,f=(t=n.nodes()).length;a<f;a++)for(var o=t[a],e=n.node(o),h=e.x,s=e.y,e=e.hostNode,c=r.getAllPortsForNode(e),v=c?c.length:0,d=0;d<v;d++){var l=c[d],M=r.getPortRect(l),g=h-M.w/2,p=s-M.h/2;r.setPortRect(l,g,p,M.w,M.h)}m.forEach(n.edges(),function(t){t=n.edge(t)
;r.setPath(t.hostEdge,t.path)}),r.updateDisplay()},n.common.ObjectHelper.rootNamespace=n.common.ObjectHelper.rootNamespace||{};t=n.common.ObjectHelper.rootNamespace;t.Layout=t.Layout||{},t.Layout.BalloonLayout=w,t.Layout.BalloonLayout.RootNodePolicy=i,t.Layout.BalloonLayout.AngleSpacing=g;n={};return n.Layout=t.Layout||{},n.Layout.BalloonLayout=w,n},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("lodash"),require("graphlib"),require("@diagramming/utils"),require("@diagramming/core")):"function"==typeof define&&define.amd?define(["lodash","graphlib","@diagramming/utils","@diagramming/core"],n):((t=t||self).diagramfoundation=t.diagramfoundation||{},t.diagramfoundation.balloonlayout=n(t.X,t.graphlib,t.diagramfoundation.utils,t.diagramfoundation.core));