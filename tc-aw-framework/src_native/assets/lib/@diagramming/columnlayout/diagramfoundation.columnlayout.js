// @<COPYRIGHT>@
// ==================================================
// Copyright Siemens 2020.
// PL Diagram Foundation 1973.0.1-0
// ==================================================
// @<COPYRIGHT>@
var t,n;t=this,n=function(o,t){"use strict";function i(){o.LayoutSessionData.call(this),this.Ui=!0,this.Ji=!0,this.portArrangement="nodeSideMiddle",this.Ki="middle"}function r(t,i,n,s){o.ChangeState.call(this,t,i,n,s)}function e(t){this.reportError=t,this.x=0,this.y=0,this.w=0,this.h=0,this.Qi=[],this.Wi=[],this.Xi=o.LayoutDirection.TopToBottom,this.Yi=!0,this.nodeAlignment="center",this.Zi=null,this.$i=null,this.tn=!1,this.in=!0}o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,(t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t).common.ObjectHelper.inherit(i,o.LayoutSessionData),r.prototype.nn=function(t){for(var i=0,n=t.length;i<n;++i)this.sn(t[i])},r.prototype.sn=function(t){for(var i=t.ki,n=0,s=i.length;n<s;++n){var r=i[n];this.rn(r)}},r.prototype.rn=function(t){var i=t.ti.hostNode,n=t.Ci,s=this.hostInterfaceObj.getNodeRect(i),r=this.hostInterfaceObj.getPortRect(n),h=r.x+r.w/2,e=r.y+r.h/2,o=h-s.x,i=e-s.y,n=o/s.w,r=i/s.h,s=this.hn(h,e,s.x,s.y,s.w,
s.h);t.pos={nodeSide:s,dx:o,dy:i,relx:n,rely:r}},r.prototype.en=function(){var t=this.layoutSessionData.portArrangement,i=this.layoutSessionData.Ft;if("userDefined"!==t){for(var n=[],s=this.cList,r=0,h=s.length;r<h;++r){var e=this.on(s[r],t,i);if(e)for(var o=0,u=e.length;o<u;++o){var a=e[o];n.indexOf(a)<0&&n.push(a)}}for(var f=this.nList,r=0,h=f.length;r<h;++r)for(var c=f[r].ki,o=0,u=c.length;o<u;++o){var v=c[o];n.indexOf(v)<0&&this.un(v)}}else this.an()},r.prototype.an=function(){for(var t=this.nList,i=0,n=t.length;i<n;++i)for(var s=t[i].ki,r=0,h=s.length;r<h;++r){var e=s[r];this.un(e)}},r.prototype.on=function(t,i,n){var s=t.mi,r=t.pi,h=t.bi,e=t.yi;if(!(s&&r&&h&&e))return null;switch(i){case"nodeSideMiddle":n===o.LayoutDirection.LeftToRight||n===o.LayoutDirection.RightToLeft?h.x>e.x?(this.fn(s,h,"left"),this.fn(r,e,"right")):(this.fn(s,h,"right"),this.fn(r,e,"left")):h.y>e.y?(this.fn(s,h,"top"),this.fn(r,e,"bottom")):(this.fn(s,h,"bottom"),this.fn(r,e,"top"));break;case"nodeCenter":
this.fn(s,h,"center"),this.fn(r,e,"center");break;default:this.reportError("Unsupported port arrangement: "+i),this.fn(s,h,"center"),this.fn(r,e,"center")}return[s,r]},r.prototype.fn=function(t,i,n){if(t.cn){var s=t.x,r=t.y;switch(n){case"center":s=i.x+i.w/2,r=i.y+i.h/2;break;case"left":s=i.x,r=i.y+i.h/2;break;case"right":s=i.x+i.w,r=i.y+i.h/2;break;case"top":s=i.x+i.w/2,r=i.y;break;case"bottom":s=i.x+i.w/2,r=i.y+i.h;break;default:this.reportError("Unknown position option: "+n)}s-=t.w/2,r-=t.h/2,t.Hi(s,r),this.Vi(t)}else this.un(t)},r.prototype.un=function(t){this.vn(t,"relative")},r.prototype.vn=function(t,i){var n=t.ti,s=n.x,r=n.y,h=n.w,e=n.h,o=t.pos;switch(i){case"relative":s+=h*o.relx,r+=e*o.rely;break;case"sideOffset":var u=o.nodeSide;"left"===u?r+=o.dy:"right"===u?(s+=h,r+=o.dy):"bottom"===u?(s+=o.dx,r+=e):s+=o.dx;break;case"absolute":s+=o.dx,r+=o.dy;break;default:this.reportError("Layoutcore.ChangeState: invalid port position rule")}s-=t.w/2,r-=t.h/2,t.Hi(s,r)},
t.common.ObjectHelper.inherit(r,o.ChangeState),e.prototype.ln=function(){return this.Xi},e.prototype.dn=function(t){this.Xi=t,this.Yi=this.bn(t)},e.prototype.mn=function(t,i){this.pn([{x:t,y:i}])},e.prototype.pn=function(t){this.Wi=t,this.$i=null},e.prototype.yn=function(t){this.nodeAlignment=t},e.prototype.gn=function(t){this.Zi=t},e.prototype.kn=function(){return this.Zi},e.prototype.wn=function(t){this.Qi=t,n(this.Qi,this),this.$i=null},e.prototype.xn=function(){n(this.Qi,null),this.x=0,this.y=0,this.w=0,this.h=0,this.Qi=[],this.$i=null},e.prototype.Dn=function(){return this.Qi},e.prototype.Tn=function(){return this.Qi.length},e.prototype.Mn=function(t){return 0<=this.Qi.indexOf(t)},e.prototype.dispose=function(){this.xn(),this.$i=null},e.prototype.Hi=function(t,i){this.x=t,this.y=i},e.prototype.jn=function(t,i){this.w=t,this.h=i},e.prototype.Ln=function(t,i){var n=t-this.getX(),s=i-this.getY();this.Hi(t,i);for(var r=this.On(),h=0,e=r.length;h<e;++h){var o=r[h],u=o.getX()+n,
a=o.getY()+s;o.Ln(u,a)}},e.prototype.On=function(){return this.Qi},e.prototype.getX=function(){return this.x},e.prototype.getY=function(){return this.y},e.prototype.getW=function(){return this.w},e.prototype.getH=function(){return this.h},e.prototype.Sn=function(){return{x:this.getX()+this.getW()/2,y:this.getY()+this.getH()/2}},e.prototype.bn=function(t){switch(t){case o.LayoutDirection.TopToBottom:return!0;case o.LayoutDirection.LeftToRight:case o.LayoutDirection.RightToLeft:return!1;case o.LayoutDirection.BottomToTop:return!0;default:this.reportError("Unknown layout direction: "+t)}return!0},e.prototype.Un=function(t){var i=this.Qi;if(!(i.length<1)){var n=this.Nn();this.Cn(n,this.nodeAlignment,this.Yi,t);n=this.Vn(i);if(!t){var s=this.getX()-n.x,r=this.getY()-n.y;if(0!=s||0!=r){for(var h=0,e=i.length;h<e;++h){var o=i[h],u=o.getX()+s,a=o.getY()+r;o.Ln(u,a)}n.x=this.getX(),n.y=this.getY()}}this.Hi(n.x,n.y),this.jn(n.w,n.h)}},e.prototype.An=function(){var t=this.Vn(this.Qi);this.Hi(t.x,
t.y),this.jn(t.w,t.h)},e.prototype.Cn=function(t,i,n,s){if(!(t.length<2)){var r=0;if(s){for(var h=-1,e=0,o=t.length;e<o;++e)if(t[e].nodeObj===s){h=e;break}h<0?this.reportError("The pin node is not in node list"):r=h}for(var u=t[r],a=u.nodeObj,f=this.qn(a,i,n),e=r+1,o=t.length;e<o;++e){f=this.In(f,u,n,!1);var c=(b=t[e]).nodeObj,v=this.qn(c,i,n),l=f.x-v.x+c.getX(),d=f.y-v.y+c.getY();c.Ln(l,d),u=b}if(0<r)for(f=this.qn(t[r].nodeObj,i,n),e=r-1;0<=e;--e){var b,c=(b=t[e]).nodeObj;f=this.In(f,b,n,!0);v=this.qn(c,i,n),l=f.x-v.x+c.getX(),d=f.y-v.y+c.getY();c.Ln(l,d)}}},e.prototype.qn=function(t,i,n){var s=t.getX(),r=t.getY();switch(i){case"center":n?s+=t.getW()/2:r+=t.getH()/2;break;case"left":break;case"right":s+=t.getW();break;case"top":break;case"bottom":r+=t.getH();break;default:this.reportError("Unknown node alignment: "+i)}return{x:s,y:r}},e.prototype.In=function(t,i,n,s){var r,h=i.nodeObj,e=t.x,t=t.y;return s?(r=i.preDist,n?t-=h.getH()+r.y:e-=h.getW()+r.x):(r=i.postDist,n?t+=h.getH(
)+r.y:e+=h.getW()+r.x),{x:e,y:t}},e.prototype.Nn=function(){return this.$i||(this.$i=this.Rn(this.Qi,this.Wi)),this.$i},e.prototype.Rn=function(t,i){var n=[];if(1<i.length){i.length<t.length-1&&this.reportError("The node dist list has not enough num.");for(var s=0,r=t.length;s<r;++s){var h,e=t[s],o=0===s?(h=i[s],i[s]):s===r-1?(h=i[s-1],i[s-1]):(h=i[s-1],i[s]),u={nodeObj:e,preDist:h,postDist:o};n.push(u)}}else for(var a=i[0],s=0,r=t.length;s<r;++s){u={nodeObj:e=t[s],preDist:a,postDist:a};n.push(u)}return n},e.prototype.Vn=function(t){if(t.length<1)return{x:0,y:0,w:0,h:0};for(var i=t[0],n=i.getX(),s=i.getY(),r=n+i.getW(),h=s+i.getH(),e=1,o=t.length;e<o;++e)var u=t[e],a=u.getX(),f=u.getY(),c=a+u.getW(),u=f+u.getH(),n=Math.min(n,a),s=Math.min(s,f),r=Math.max(r,c),h=Math.max(h,u);return{x:n,y:s,w:r-n,h:h-s}},e.prototype.zn=function(t,i){for(var n=0,s=t.length;n<s;++n){var r=t[n],h=i[n];r.Ln(h.x,h.y),r.jn(h.w,h.h)}this.An()},e.prototype.Bn=function(t,i,n,s,r){var h=this.En(t,i,n,s)
;return h&&(t=this.kn(),r&&t?(i=this.Vn(this.Qi),t.Bn([this],[i],n,s,r)):this.An()),h},e.prototype.En=function(t,i,n,s){var r=!1;if(t.length!==i.length)return this.reportError("Input nodes num may be incorrect."),r;if(t.length<1)return r;for(var h=0,e=t.length;h<e;++h){var o=i[h];this.Fn(t[h],o.x,o.y,o.w,o.h,n,s)&&(r=!0)}return r},e.prototype.Fn=function(t,i,n,s,r,h,e){var o=this.Qi.indexOf(t);if(o<0)return this.reportError("Node is not found in section"),!1;var u=t.getX()!==i||t.getY()!==n||t.getW()!==s||t.getH()!==r;return u&&(t.Hi(i,n),t.jn(s,r),this.in&&this.Gn(t,this.nodeAlignment,h,e,this.Yi),this.Hn(o,h,e)),u},e.prototype.Gn=function(t,i,n,s,r){this.Jn(t,i,r);t=this.Qi.indexOf(t);this.Kn(t,n,s,r)},e.prototype.Jn=function(t,i,n){var s=this.qn(t,i,n),r=this.qn(this,i,n),h=0,i=0;n?h=r.x-s.x:i=r.y-s.y;h=t.getX()+h,i=t.getY()+i;t.Ln(h,i)},e.prototype.Hn=function(t,i,n){var s,r;t<0?this.reportError("The index is negative: "+t):(r=this.Nn(),this.Qi.length!==r.length&&this.reportError(
"The node number may be incorrect."),s=r[t],r=this.Yi,this.tn&&this.Pn(t,s,r,i,n),this.Qn(t,s,r,i,n))},e.prototype.Kn=function(t,i,n,s){var r,h;t<1||(h=this.Nn()[t],r=this.Qi,h=h.preDist,h=(s?h.y:h.x)-this.Wn(r[t-1],r[t],s),(i=!(i=i&&0<h)&&n&&h<0?!0:i)&&(i=n=0,s?i=h:n=h,(t=r[t]).Ln(t.getX()+n,t.getY()+i)))},e.prototype.Pn=function(t,i,n,s,r){if(!(t<1)){var h=this.Qi,i=i.preDist,i=(n?i.y:i.x)-this.Wn(h[t-1],h[t],n),s=s&&0<i;if(s=!s&&r&&i<0?!0:s){var e=0,o=0;n?o=0-i:e=0-i;for(var u=0;u<t;++u){var a=h[u];a.Ln(a.getX()+e,a.getY()+o)}}}},e.prototype.Qn=function(t,i,n,s,r){var h=this.Qi;if(!(t>=h.length-1)){i=i.postDist,i=(n?i.y:i.x)-this.Wn(h[t],h[t+1],n),s=s&&0<i;if(s=!s&&r&&i<0?!0:s){var e=0,o=0;n?o=i:e=i;for(var u=t+1,a=h.length;u<a;++u){var f=h[u];f.Ln(f.getX()+e,f.getY()+o)}}}},e.prototype.Wn=function(t,i,n){return n?(n=t.getY()+t.getH(),i.getY()-n):(t=t.getX()+t.getW(),i.getX()-t)};var n=function(t,i){for(var n=0,s=t.length;n<s;++n)t[n].gn(i)};function s(t,i){(this.refNode=t
).sectNode&&i&&i("ColSectionNode: Section node data already exit on reference node."),(t.sectNode=this).x=t.x,this.y=t.y,this.h=t.h,this.w=t.w,this.Zi=null}function h(t,i){this.layoutSessionData=t,this.reportError=i,this.sectList=null,this.sectPack=null}function u(t,i,n){o.HVPaths.call(this,t,i,n,t.isRSOPEnabled)}function a(t){this.reportError=t.reportError,this.hostInterfaceObj=t,this.layoutSessionData=new i,this.Xn(this.layoutSessionData,this.hostInterfaceObj),this.changeStateObj=null,this.Yn=null,this.isPartialUpdate=!0,this.compoundCommands=!1}s.prototype.Hi=function(t,i){this.x=t,this.y=i,this.refNode.Hi(t,i)},s.prototype.jn=function(t,i){this.w=t,this.h=i,this.refNode.jn(t,i)},s.prototype.getX=function(){return this.x},s.prototype.getY=function(){return this.y},s.prototype.getW=function(){return this.w},s.prototype.getH=function(){return this.h},s.prototype.Sn=function(){return{x:this.getX()+this.getW()/2,y:this.getY()+this.getH()/2}},s.prototype.Ln=function(t,i){
var n=t-this.getX(),s=i-this.getY();this.Hi(t,i);for(var r=this.getChildNodes(),h=0,e=r.length;h<e;++h){var o=r[h],u=o.x+n,a=o.y+s;o.Ln(u,a)}},s.prototype.Zn=function(){return this.refNode},s.prototype.gn=function(t){this.Zi=t},s.prototype.kn=function(){return this.Zi},s.prototype.getParentNode=function(){var t=null,i=this.Zn().$n;return t=i?i.sectNode:t},s.prototype.getChildNodes=function(){for(var t=[],i=this.Zn()._n,n=0,s=i?i.length:0;n<s;++n){var r=i[n].sectNode;t.push(r)}return t},h.prototype.clear=function(){this.sectPack&&this.sectPack.dispose();var t=this.sectList;if(t)for(var i=0,n=t.length;i<n;++i)t[i].dispose()},h.prototype.ts=function(t,i){for(var n=[],s=0,r=t.length;s<r;++s){var h=t[s],h=this.ns(h,i);n.push(h)}var e=this.ss(t),o=this.rs(this.layoutSessionData.Ki),u=Math.floor(n.length/2),u=this.hs(n,e,i,o,u);u.tn=!0,u.in=!1,this.sectList=n,this.sectPack=u},h.prototype.ss=function(t){for(var i=[],n=0,s=t.length;n<s;++n){var r=t[n].colDistVal;i.push({x:r,y:r})}return i},
h.prototype.hs=function(t,i,n,s,r){return this.es(t,i,n,s,r)},h.prototype.Bn=function(t,i){if(t.length!==i.length)return this.reportError("Input nodes num may be incorrect."),!1;if(t.length<1)return!0;var n=this.os(t,i),s=this.layoutSessionData.Ui,r=this.layoutSessionData.Ji;s||(r=!1);for(var h=0,e=n.length;h<e;++h){var o=n[h],u=o.sectObj,a=o.sectNodes,o=o.rects;u.Bn(a,o,s,r,!0)}},h.prototype.os=function(t,i){for(var n=[],s=0,r=t.length;s<r;++s){var h=t[s],e=i[s],o=h.kn();if(o){for(var u=null,a=0,f=n.length;a<f;++a){var c=n[a];if(c.sectObj===o){u=c;break}}u?(u.sectNodes.push(h),u.rects.push(e)):n.push(u={sectObj:o,sectNodes:[h],rects:[e]})}else this.reportError("Node is not added in section")}return n},h.prototype.ns=function(t,i){var n=this.ln(i),s=t.nodeList,i=t.nodeDistVal,t=t.nodeAlignment;return this.es(s,[{x:i,y:i}],n,t,0)},h.prototype.es=function(t,i,n,s,r){var h=new e(this.reportError);return h.dn(n),h.yn(s),h.pn(i),h.wn(t),0<t.length&&((r=t[r])||this.reportError(
"There is no pin node."),h.Un(r)),h},h.prototype.ln=function(t){var i=o.LayoutDirection.TopToBottom;switch(t){case o.LayoutDirection.LeftToRight:case o.LayoutDirection.RightToLeft:i=o.LayoutDirection.TopToBottom;break;case o.LayoutDirection.TopToBottom:case o.LayoutDirection.BottomToTop:i=o.LayoutDirection.LeftToRight;break;default:this.reportError("Unknown layout direction: "+t)}return i},h.prototype.rs=function(t){switch(t){case"middle":return"center";case"start":return"top";case"end":return"bottom";default:this.reportError("Unsupported graph alignment: "+t)}return"center"},h.prototype.us=function(t){return t.sectNode&&this.reportError("The section node has already created"),new s(t,this.reportError)},h.prototype.as=function(t){return t.sectNode},u.prototype.fs=function(){var t=this.changeStateObj,t=t.isPartialUpdate?this.di():t.cList;this.cs(t)},u.prototype.di=function(){for(var t=[],i=this.changeStateObj.cList,n=i.length,s=0;s<n;++s){var r=i[s],h=r.mi,e=r.pi;h&&e&&(
h.vs===o.UpdateReasons.NONE&&e.vs===o.UpdateReasons.NONE||t.push(r))}return t},t.common.ObjectHelper.inherit(u,o.HVPaths),a.prototype.setGraphAlignment=function(t){this.layoutSessionData.Ki=t},a.prototype.setPortLocationPolicy=function(t){this.layoutSessionData.portArrangement=t},a.prototype.setNodeResizeBehavior=function(t,i){this.layoutSessionData.Ui=t,this.layoutSessionData.Ji=i},a.prototype.isActive=function(){return null!==this.changeStateObj},a.prototype.activate=function(t,i){this.isActive()&&this.reportError("The layout need be deactivate before activate again");var n=this.layoutSessionData;this.Xn(n,this.hostInterfaceObj);var s=this.ls(t),i=new r(this.hostInterfaceObj,n,s,i);this.changeStateObj=i;i=this.ds(t),t=n.Ft;this.Yn=new h(n,this.reportError);i=this.bs(i);return this.Yn.ts(i,t),this.U(),!0},a.prototype.deactivate=function(){null!==this.changeStateObj&&this.changeStateObj.xi(),null!==this.Yn&&this.Yn.clear(),this.changeStateObj=null,this.Yn=null},
a.prototype.updateOnNodeResized=function(t){if(!this.isActive())return this.reportError("Layout is not Active!"),!1;for(var i=this.changeStateObj,n=this.Yn,s=this.hostInterfaceObj,r=[],h=[],e=[],o=0,u=t.length;o<u;++o){var a=t[o],f=i.Fi(a,!0);null!==f&&(r.push(f),(f=n.as(f))?(h.push(f),a=s.getNodeRect(a),e.push(a)):this.reportError("Node is not added in column"))}return n.Bn(h,e),"userDefined"===this.layoutSessionData.portArrangement&&i.nn(r),this.U(),!0},a.prototype.beginCompoundCommands=function(){this.compoundCommands=!0},a.prototype.endCompoundCommandsAndUpdate=function(){if(!this.isActive())return!1;this.compoundCommands=!1,this.U()},a.prototype.U=function(){var t;!1===this.compoundCommands&&((t=this.changeStateObj).isPartialUpdate=this.isPartialUpdate,t.en(),new u(this.layoutSessionData,t,this.Yn),t.update(1),t.Ei())},a.prototype.Xn=function(t,i){t.Ft=i.getLayoutDirection(),t.at="straightLine",t.Ft!==o.LayoutDirection.LeftToRight&&this.reportError(
"Current only LeftToRight direction is supported")},a.prototype.ls=function(t){for(var i=[],n=0,s=t.length;n<s;++n)var r=t[n].nodesInColumn,i=i.concat(r);return i},a.prototype.ds=function(t){for(var i=[],n=0,s=t.length;n<s;++n){var r=t[n],r={nodeList:this.ms(r.nodesInColumn),nodeDistVal:r.minNodeDistanceInColumn,colDistVal:r.minColumnDistance,nodeAlignment:r.nodeAlignmentInColumn};i.push(r)}return i},a.prototype.bs=function(t){for(var i=[],n=0,s=t.length;n<s;++n){var r=t[n],r={nodeList:this.ps(r.nodeList),nodeDistVal:r.nodeDistVal,colDistVal:r.colDistVal,nodeAlignment:r.nodeAlignment};i.push(r)}return i},a.prototype.ms=function(t){for(var i=this.changeStateObj,n=[],s=0,r=t.length;s<r;++s){var h=i.Fi(t[s],!0);h&&n.push(h)}return n},a.prototype.ps=function(t){for(var i=this.Yn,n=[],s=0,r=t.length;s<r;++s){var h=i.us(t[s]);n.push(h)}return n},a.prototype.nodeInLayout=function(t){return this.changeStateObj.zi(t)},a.prototype.connectionInLayout=function(t){return this.changeStateObj.Di(t)},
a.prototype.portInLayout=function(t){return this.changeStateObj.ji(t)},a.prototype.setIsPartialUpdate=function(t){this.isPartialUpdate=t},t.common.ObjectHelper.rootNamespace=t.common.ObjectHelper.rootNamespace||{};var f=t.common.ObjectHelper.rootNamespace;f.Layout=f.Layout||{},f.Layout.ColumnLayout=a;t={};return t.Layout=f.Layout||{},t.Layout.ColumnLayout=a,t},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("@diagramming/layoutcore"),require("@diagramming/core")):"function"==typeof define&&define.amd?define(["@diagramming/layoutcore","@diagramming/core"],n):((t=t||self).diagramfoundation=t.diagramfoundation||{},t.diagramfoundation.columnlayout=n(t.diagramfoundation.layoutcore,t.diagramfoundation.core));