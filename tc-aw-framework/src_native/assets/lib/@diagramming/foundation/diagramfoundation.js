// @<COPYRIGHT>@
// ==================================================
// Copyright Siemens 2020.
// PL Diagram Foundation 1973.0.1-0
// ==================================================
// @<COPYRIGHT>@
var t,n;t=this,n=function(Q,Dt,_t,St){"use strict";function d(){this.tM=null}function J(){d.call(this),this.nM=null,this.iM=null,this.rM=null,this.affectIndexing=null,this.sM=null,this.connections=[]}function ht(){Dt.common.ObjectBase.call(this);var s=!1,n=[],i=St.Constants.CURSOR_STANDARD;this.diagramManager=null,this.hooked=null,this.isExemptForMutex=!1,this.states=[],this.setEnabled=function(t){(s=t)?this.onEnabled():this.onDisabled()},this.isEnabled=function(){var t=this.hooked&&s;if(t){var n=this.diagramManager.getCommandManager();if(n.uM&&n.uM!==this&&!this.isExemptForMutex)return t=!1;for(var i=this.states.length,r=0;r<i;++r)if(n.getCommandStates().isActive(this.states[r])){t=!1;break}}return t},this.setCursor=function(t){i=t},this.getCursor=function(){return i},this.setShortcuts=function(t){n=t},this.getShortcuts=function(){return n}}function t(){ht.call(this)}function n(){ht.call(this)}function i(){ht.call(this)}function r(){ht.call(this),this.hM=null,this.eM=!1}function s(){
ht.call(this)}function u(){ht.call(this)}Q=Q&&Object.prototype.hasOwnProperty.call(Q,"default")?Q.default:Q,Dt=Dt&&Object.prototype.hasOwnProperty.call(Dt,"default")?Dt.default:Dt,_t=_t&&Object.prototype.hasOwnProperty.call(_t,"default")?_t.default:_t,St=St&&Object.prototype.hasOwnProperty.call(St,"default")?St.default:St,d.prototype.visit=function(t,n){var i=[],r=n.owner;if(r instanceof _t.SheetElement)i.push(r),r.visitModelChangeMessage(n,r);else if(r instanceof Dt.ReferenceObject){for(var s=0,u=(i=r.oM(_t.SheetElement)).length;s<u;++s)i[s].visitModelChangeMessage(n,r);i.push(r)}return i},d.prototype.fM=function(){for(var t=this.tM.getMessages(),n=this.tM.getMessageCount(),i=0;i<n;i++){var r=t[i],s=r.owner;this.visit(s,r)}},d.prototype.aM=function(t){this.tM=t},d.prototype.cM=function(){},d.prototype.clear=function(){},Dt.common.ObjectBase.inheritedBy(d),J.prototype.clear=function(){this.nM=[],this.iM=[],this.rM=[],this.affectIndexing=!1,this.tM=null},J.prototype.visit=function(t,n){
for(var i=d.prototype.visit.call(this,t,n);i.length;){var r=i.pop();if(r instanceof _t.SheetElement&&(!n.property||n.affectIndexing())&&!r.lM){var s=r.vM();if(s)switch(r.wM){case Dt.ChangeType.Property:for(var u=s.indexedElements,h=u.length,e=0;e<h;++e)this.nM.push(u[e]);var o=s.discardedIndexedElements;h=o.length;for(var f=0;f<h;++f)this.rM.push(o[f]);this.affectIndexing=!0,r.lM=!0,r instanceof _t.Connection&&this.connections.push(r);break;case Dt.ChangeType.Add:for(var a=s.indexedElements,h=a.length,c=0;c<h;++c)this.iM.push(a[c]);0<h&&(this.affectIndexing=!0,r.lM=!0),r instanceof _t.Connection&&this.connections.push(r);break;case Dt.ChangeType.Remove:var l=s.discardedIndexedElements;if(0<(h=l.length))for(var v=0;v<h;++v)this.rM.push(l[v]);else{h=(l=s.indexedElements).length;for(var w=0;w<h;++w)this.rM.push(l[w])}this.affectIndexing=!0,r.lM=!0}}}},J.prototype.aM=function(t){this.tM=t;t=this.tM.session.dM();t.mM();for(var n=t.ze(),i=0,r=n.length;i<r;i++)n[i].gM(!1)},
J.prototype.cM=function(){if(this.affectIndexing){var t=this.tM.session.getPerformanceCounter();t.preIndexing();var n=0,i=0,r=0;this.nM&&0<this.nM.length&&0<(i=this.nM.length)&&this.sM.MM(this.nM),this.iM&&0<(n=this.iM.length)&&this.sM.insert(this.iM),this.rM&&0<(r=this.rM.length)&&this.sM.remove(this.rM),t.postIndexing({Added:n,Updated:i,Removed:r});var s=this.connections.length;if(0<s){r=this.connections[0].getOwningSheet();if(r.isAllowJumpers()||!r.pM){var u=this.connections;r.pM=!1;var h=u[0].getSession().getElementsByType(_t.Connection),e=!1,o={};if(h){for(var f=h.length-1;0<=f;--f)h[f].isVisible()||h.splice(f,1);if(h.length==s){for(f=0;f<s;++f){(d=u[f]).clearJumper();o["C_"+d.guid]=d}e=!0}}for(f=0;f<s;++f)u[f].bM();for(var a,c,l,v,w,d,m={},f=0;f<s;++f)(d=u[f]).kM(m,e),o["C_"+d.guid]=d;for(w in m)Object.prototype.hasOwnProperty.call(m,w)&&(c=(a=m[w]).JumperOwner,l=a.CrossingConnection,(v=new _t.Jumper(c,a.x1,a.y1,a.x2,a.y2)).setShapeType(a.JumperShapType),v.setCrossingConnection(l
),v.setSegmentIdentifier(a.SegmentIdentifier),v.setSegmentIdentifierCrossing(a.SegmentIdentifierCrossing),c.addJumper(v),c.addCrossingConnection(l),l.addCrossingConnection(c),c.setUpToDate(!1),o["C_"+c.guid]=c);for(w in o)Object.prototype.hasOwnProperty.call(o,w)&&((d=o[w]).gM(!1),d.yM(),d.gM(!0));for(f=0;f<s;++f)u[f].bM(!0)}this.connections=[],r.pM=!0}this.clear()}},d.inheritedBy(J),ht.prototype.execute=function(){},ht.prototype.hook=function(t,n){this.hooked=!0,this.diagramManager=n},ht.prototype.unhook=function(){this.hooked=!1},ht.prototype.isHooked=function(){return this.hooked},ht.prototype.onEnabled=function(){},ht.prototype.onDisabled=function(){},ht.prototype.onEnabledByCommandState=function(t){},ht.prototype.onDisabledByCommandState=function(t){},ht.prototype.isInputKeysMatched=function(t,n){var i=t.length;if(0===i)return!0;for(var r=!1,s=0;s<i;s++){for(var u=!0,h=t[s].length,e=0;e<h&&(
u&=t[s][e]==St.KeyCode.CTRL&&n.ctrlKey||t[s][e]==St.KeyCode.SHIFT&&n.shiftKey||t[s][e]==St.KeyCode.ALT&&n.altKey||n.keyCode==t[s][e]);e++);if(r|=u)break}return r},Dt.common.ObjectBase.inheritedBy(ht),t.prototype.hook=function(t,n){ht.prototype.hook.call(this,t,n);var i=this;t.bind("keydown",function(t){t.ctrlKey&&67===t.keyCode&&i.isEnabled()&&(0<(t=n.getSelectedElements()).length&&n.copy(t))})},t.prototype.execute=function(){},ht.inheritedBy(t),n.prototype.hook=function(t,n){ht.prototype.hook.call(this,t,n);var i=this;t.bind("keydown",function(t){t.ctrlKey&&86===t.keyCode&&i.isEnabled()&&(t=n.getCursorPosAndKeyStatus(t),n.paste(t))})},n.prototype.execute=function(){},ht.inheritedBy(n),i.prototype.hook=function(s,u){ht.prototype.hook.call(this,s,u);var h=this;s.bind("selectstart",function(t){h.isEnabled()&&t.preventDefault()}),s.bind("SDF_dblclick",function(t){var n,i,r;h.isEnabled()&&(i=s.offset(),(n=new St.Point).x=t.pageX-i.left,n.y=t.pageY-i.top,(i=u.getScreenToSheetTransform())&&(
r=i.transformPoint(n),r=u.getElementsByPoint(r)),(void 0===r||null==r||r.length<1)&&u.fit())}),s.bind("SDF_dbltap",function(t,n,i){(!i||i.length<1)&&u.fit()})},i.prototype.execute=function(){},ht.inheritedBy(i),r.prototype.setDynamicPanAllowed=function(t){this.eM=t},r.prototype.isDynamicPanAllowed=function(){return this.eM},r.prototype.hook=function(i,h){ht.prototype.hook.call(this,i,h);var r=null,s=null,e=!1,o=0,f=0,a=0,c=0,l=this,u=!1;this.hM=i;function v(t){var n;e&&l.isEnabled()&&(r.requestMutex(l),n=t.pageX,t=t.pageY,w(n,t),e&&i.activateCursor(St.CursorID.PAN))}var w=function(t,n){var i=t-o,r=n-f,r=h.getScreenToSheetTransform().transformVector(new St.Vector(i,r));h.translateViewport(r),o=t,f=n};i.bind("mousedown",function(t){var n;l.isEnabled()&&!window.navigator.msMaxTouchPoints&&(s=h.getSheetConfigurationData(),n=h.getHoveredElements(),u=0===n.length,(1==t.button||l.isDynamicPanAllowed()&&u||s.viewData.isPanMode()&&0===t.button)&&(r=h.getCommandManager(),h.setHoveredElements(
null),e=!0,o=t.pageX,f=t.pageY,i.bind("mousemove",v),t.preventDefault()))}),i.bind("mouseup",function(t){e&&(e=!1,i.unbind("mousemove",v),s.viewData.isPanMode()||i.deactivateCursor(St.CursorID.PAN),r.releaseMutex(l))});function d(t){var n,i,r,s,u;l.isEnabled()&&(t.preventDefault(),e&&(1===(s=(u=t.originalEvent.touches).length)?(i=u[0].pageX,r=u[0].pageY,w(i,r)):2===s&&(n=u[0].pageX,t=u[0].pageY,i=u[1].pageX,r=u[1].pageY,s=new St.Vector(n-o,t-f),u=new St.Vector(i-a,r-c),0!==s.length()&&0!==u.length()&&(u=new St.Vector((s.x+u.x)/2,(s.y+u.y)/2),u=h.getScreenToSheetTransform().transformVector(u),h.translateViewport(u),o=n,f=t,a=i,c=r))))}i.bind("touchstart",function(t){var n;l.isEnabled()&&(t.preventDefault(),s=h.getSheetConfigurationData(),n=h.getHoveredElements(),u=0===n.length,t=(n=t.originalEvent.touches).length,((s.viewData.isPanMode()||l.isDynamicPanAllowed()&&u)&&1===t||2===t)&&(h.setHoveredElements(null),e=!0,o=n[0].pageX,f=n[0].pageY,2===t&&(a=n[1].pageX,c=n[1].pageY),i.bind(
"touchmove",d)))}),i.bind("touchend",function(t){l.isEnabled()&&(t.preventDefault(),e&&(e=!1,i.unbind("touchmove",d)))});var m=0,g=!1,M=!0;i.bind("MSGestureChange",function(t){var n;g&&(M&&((r=h.getCommandManager()).requestMutex(l),M=!1),(n=i.getInteractionCanvas()).translationX+=t.translationX,n.translationY+=t.translationY,t=new St.Vector(t.translationX,t.translationY),t=h.getScreenToSheetTransform().transformVector(t),h.translateViewport(t))}),i.bind("MSGestureEnd",function(t){M||(r.releaseMutex(l),M=!0)}),i.bind("MSPointerUp",function(t){g=!1,m=0}),i.bind("MSPointerDown",function(t){var n;window.navigator.msMaxTouchPoints&&(m++,n=h.getHoveredElements(),u=0===n.length,((s=h.getSheetConfigurationData()).viewData.isPanMode()||l.isDynamicPanAllowed()&&u)&&1===m||2===m?(M=g=!0,null!==(n=i.getInteractionCanvas()).translationX&&void 0!==n.translationX||(n.translationX=0),null!==n.translationY&&void 0!==n.translationY||(n.translationY=0),null!==n.gestureObject&&void 0!==n.gestureObject||(
n.gestureObject=new MSGesture,n.gestureObject.target=n),n.gestureObject.addPointer(t.pointerId)):g=!1)})},ht.inheritedBy(r),s.prototype.hook=function(r,s){ht.prototype.hook.call(this,r,s);var n,i,u,h,e=!1,o=!1,f=this,a=void 0;r.bind("mousedown",function(t){void 0===a&&(a=s.getSheetConfigurationData().assistantKeysForMultipleSelect),0===t.button&&f.isEnabled()&&!f.isInputKeysMatched(a,t)&&(o=!(e=!0),n=t.pageX,i=t.pageY)});function c(t){var n=new St.Point(u,h),i=s.getElementByPoint(n),t=s.getCursorPosAndKeyStatus(t);if(i&&s.isSelected(i)){n=s.getSymbolOccurrenceByPoint(n);if(n&&n.getSymbolOccurrenceType){n=n.getSymbolOccurrenceType();if(n===St.NestedNodeSymbolType.ExpandButton||n===St.NestedNodeSymbolType.CollapseButton)return}s.DeselectElement(t)}else s.setSingleSelectedElement(t)}r.bind("SDF_tap",function(t,n,i){c(t)}),r.bind("mouseup",function(t){var n,i;e&&!o&&f.isEnabled()&&(window.navigator.msMaxTouchPoints?(c(t),(i=s.getSelectedElements())&&0<i.length&&r.activateCursor(
St.CursorID.SINGLESELECT)):(n=s.getHoveredElements())&&0<n.length&&(t=s.getCursorPosAndKeyStatus(t),s.setSingleSelectedElement(t),(i=s.getSelectedElements())&&0<i.length&&r.activateCursor(St.CursorID.SINGLESELECT)))}),r.bind("mousemove",function(t){e&&f.isEnabled()&&(u=t.pageX,h=t.pageY,n===u&&i===h||(o=!0))})},s.prototype.execute=function(){},ht.inheritedBy(s);u.prototype.hook=function(f,a){ht.prototype.hook.call(this,f,a);var s=null,c=this;f.bind("mousewheel DOMMouseScroll wheel",function(t,n,i,r){var s,u,h,e,o;c.isEnabled()&&(t.preventDefault(),s=St.CommonUtil.getMouseWheelDelta(t.originalEvent||t),null!=(u=a.getScreenToSheetTransform())&&(e=f.offset(),h=t.pageX-e.left,o=t.pageY-e.top,e=a.getSheetConfigurationData().viewData.getScaleFactor(),e*=0<s?Math.pow(1.2,s):Math.pow(.8,-1*s),o=u.transformPoint(new St.Point(h,o)),a.setCurrentZoomFactor(o,e)),t.preventDefault())});var l=!1,v=[],w=1;f.bind("touchstart",function(t){if(c.isEnabled()){var n=t.originalEvent.touches,i=n.length;if(!(
i<2)){t.preventDefault();for(var r=f.offset(),s=0;s<i;s++){var u=new St.Point(n[s].pageX-r.left,n[s].pageY-r.top);v.push(u)}w=v[0].distanceToPoint(v[1]),l=!0}}}),f.bind("touchmove",function(t){if(c.isEnabled()&&l){t.preventDefault();var n=t.originalEvent.touches,i=n.length;if(!(i<2)){for(var r=f.offset(),s=[],u=0;u<i;u++){var h=new St.Point(n[u].pageX-r.left,n[u].pageY-r.top);s.push(h)}var e=new St.Vector(s[0].x-v[0].x,s[0].y-v[0].y),o=new St.Vector(s[1].x-v[1].x,s[1].y-v[1].y),t=180*e.angle(o)/Math.PI;Math.abs(t)<5||(o=(e=s[0].distanceToPoint(s[1]))/w,t=a.getSheetConfigurationData().viewData.getScaleFactor(),t*=o,(o=new St.Point(0,0)).x=(s[0].x+s[1].x)/2,o.y=(s[0].y+s[1].y)/2,o=a.getScreenToSheetTransform().transformPoint(o),a.setCurrentZoomFactor(o,t),v[0]=s[0],v[1]=s[1],w=e)}}}),f.bind("touchend",function(t){c.isEnabled()&&(t.preventDefault(),l=!1,v=[])});var u=[],h=!0;f.bind("MSGestureChange",function(t){var n,i,r;l&&(h&&((s=a.getCommandManager()).requestMutex(c),h=!1),(
n=f.getInteractionCanvas()).scale*=t.scale,i=a.getSheetConfigurationData(),n.scale>i.maxZoomRatio?n.scale=i.maxZoomRatio:n.scale<i.minZoomRatio&&(n.scale=i.minZoomRatio),r=f.offset(),i=t.clientX-r.left,r=t.clientY-r.top,r=a.getScreenToSheetTransform().transformPoint(new St.Point(i,r)),a.setCurrentZoomFactor(r,n.scale))}),f.bind("MSGestureEnd",function(t){l&&(s.releaseMutex(c),l=!1)}),f.bind("MSPointerUp pointerup",function(t){l=!1,u=[]}),f.bind("MSPointerDown pointerdown",function(t){if((window.navigator.msMaxTouchPoints||window.navigator.maxTouchPoints)&&"mouse"!==(t.originalEvent||t).pointerType){t=(t.originalEvent||t).pointerId;t&&u.indexOf(t)<0&&u.push(t);var n=u.length;if(2===n){l=!0;var i=f.getInteractionCanvas();null!==i.scale&&void 0!==i.scale||(i.scale=1),null!==i.gestureObject&&void 0!==i.gestureObject||(i.gestureObject=new MSGesture,i.gestureObject.target=i);t=a.getSheetConfigurationData();i.scale=t.viewData.getScaleFactor();for(var r=0;r<n;r++)i.gestureObject.addPointer(
u[r])}}})},u.prototype.execute=function(){},ht.inheritedBy(u);var Tt={None:0,Move:1,NorthwestResize:2,NorthResize:3,NortheastResize:4,EastResize:5,SoutheastResize:6,SouthResize:7,SouthwestResize:8,WestResize:9,Rotate:10,ConnectionStartDrag:11,ConnectionEndDrag:12,ConnectionBendingDrag:13,ConnectionSegEastWestDrag:14,ConnectionSegNorthSouthDrag:15,ConnectionSegNorthEastDrag:16,ConnectionSegNorthWestDrag:17,ConnectionMove:18,TableColumnDrag:19,TableRowDrag:20,TableEastRowSelection:21,TableWestRowSelection:22,TableNorthColumnSelection:23,TableSouthColumnSelection:24,Preselection:25};function h(){ht.call(this),this.xM=null}h.prototype.hook=function(e,p){ht.prototype.hook.call(this,e,p);function i(t,n){s&&s.equal(b)||(a=!1,k.highlight(t,n)),s=b.clone()}function r(t,n,i){var r=p.getScreenToSheetTransform();null!=r&&(n=n||e.offset(),t=i?t.originalEvent.touches[0]:t,b.x=t.pageX-n.left,b.y=t.pageY-n.top,u.x=t.screenX,u.y=t.screenY,(t=p.getSheet().getSession())&&t.setMousePostion(b,u),
b=r.transformPoint(b))}var s=new St.Point,b=new St.Point,u=new St.Point,o=!1,h=this,n=!1,f=[[Tt.Preselection,St.CursorID.PRESELECT,St.CursorID.PREMULTISELECT],[Tt.Move,St.CursorID.SINGLESELECT,St.CursorID.MULTISELECT],[Tt.NorthwestResize,St.CursorID.NWRESIZE,St.CursorID.DEFAULT],[Tt.NorthResize,St.CursorID.NRESIZE,St.CursorID.DEFAULT],[Tt.NortheastResize,St.CursorID.NERESIZE,St.CursorID.DEFAULT],[Tt.EastResize,St.CursorID.ERESIZE,St.CursorID.DEFAULT],[Tt.SoutheastResize,St.CursorID.SERESIZE,St.CursorID.DEFAULT],[Tt.SouthResize,St.CursorID.SRESIZE,St.CursorID.DEFAULT],[Tt.SouthwestResize,St.CursorID.SWRESIZE,St.CursorID.DEFAULT],[Tt.WestResize,St.CursorID.WRESIZE,St.CursorID.DEFAULT],[Tt.Rotate,St.CursorID.ROTATEHOV,St.CursorID.DEFAULT],[Tt.ConnectionStartDrag,St.CursorID.MOVE,St.CursorID.MOVE],[Tt.ConnectionEndDrag,St.CursorID.MOVE,St.CursorID.MOVE],[Tt.ConnectionBendingDrag,St.CursorID.MOVE,St.CursorID.MOVE],[Tt.ConnectionSegEastWestDrag,St.CursorID.MOVEHSEG,St.CursorID.MOVEHSEG],[
Tt.ConnectionSegNorthSouthDrag,St.CursorID.MOVEVSEG,St.CursorID.MOVEVSEG],[Tt.ConnectionSegNorthEastDrag,St.CursorID.MOVENESEG,St.CursorID.MOVENESEG],[Tt.ConnectionSegNorthWestDrag,St.CursorID.MOVENWSEG,St.CursorID.MOVENWSEG],[Tt.ConnectionMove,St.CursorID.MOVE,St.CursorID.MOVE],[Tt.TableRowDrag,St.CursorID.NRESIZE,St.CursorID.NRESIZE],[Tt.TableColumnDrag,St.CursorID.ERESIZE,St.CursorID.ERESIZE],[Tt.TableEastRowSelection,St.CursorID.MOVE,St.CursorID.MOVE],[Tt.TableWestRowSelection,St.CursorID.MOVE,St.CursorID.MOVE],[Tt.TableNorthColumnSelection,St.CursorID.MOVE,St.CursorID.MOVE],[Tt.TableSouthColumnSelection,St.CursorID.MOVE,St.CursorID.MOVE]],a=!1,k={triggerTooltipTimer:null,tooltipTimer:null,tooltipHideTimer:null,tooltipDelay:null,mousePtWhenShowTooltip:null,elementsForTooltip:[],hideTooltip:function(){n&&(k.clearTooltipHideTimer(),n=!1,p.hideTooltip()),k.elementsForTooltip=[]},showTooltip:function(){var t;k.clearTooltipTimer(),n||(n=p.showTooltip(e))&&(
k.elementsForTooltip=p.getHoveredElements(),k.mousePtWhenShowTooltip=b.clone()),p.tooltipEventSettings.settingsFlag?-1!==(t=p.tooltipEventSettings.tooltipTimer)?(t&&0<t&&t<=1e4||(t=1e4),k.tooltipHideTimer||(k.tooltipHideTimer=window.setTimeout(k.hideTooltip,t))):k.mousePtWhenShowTooltip=null:(t=p.getSheetConfigurationData().tooltipStayTime)&&0<t&&(k.tooltipHideTimer||(k.tooltipHideTimer=window.setTimeout(k.hideTooltip,t)))},triggerTooltip:function(){k.clearTriggerTooltipTimer();var t=p.getSheet().getSession(),n=p.getSheetConfigurationData().selectionPreferencesData.getHighlightRolloverDelay();t&&t.getSheetConfigurationData().selectionPreferencesData.isTooltipOnRollover()&&(k.tooltipDelay&&!a?k.tooltipTimer||(k.tooltipTimer=window.setTimeout(k.showTooltip,k.tooltipDelay)):n&&!a&&k.showTooltip())},fireHoverChangedEvent:function(t,n){var i=n,n=null,t=(i=t?[]:i)?i.length:0;t&&(n=i[t-1]),h.xM!==n&&(p.fireHoverChangedEvent(n,h.xM,b),h.xM=n)},updateCursor:function(t){var n,i,r=(
r=p.getOverlayByPoint2(b,[St.ElementType.UI,St.ElementType.OVERLAY]))||p.getOverlayByPoint(b);p.setHoverHighlightedConnectionOverlay(r=t?null:r),p.setHoverHighlightedTableOverlay(r),r&&(n=r.EM());for(var s=0,u=f.length;s<u;s++){var h=f[s];e.deactivateCursor(h[1]),e.deactivateCursor(h[2]),h[0]===n&&(i=h)}i&&(o?e.activateCursor(i[2]):e.activateCursor(i[1]),e.changePreferredCursor())},highlight:function(t,n){this.clearTriggerTooltipTimer();var i=p.getSheet(),r=p.getSheetSession().CM(),s=r.NM,u=r.OM,h=r.DM;try{var e=p.getSheetConfigurationData().clickTolerance;this.mousePtWhenShowTooltip&&b.distanceToPoint(this.mousePtWhenShowTooltip)>e&&this.hideTooltip();var o=i.getHoveredElements(),f=o.length<=0&&null===p.getElementByPoint(b),a=!St.ArrayUtil.isEqual(o,this.elementsForTooltip);(f||a)&&(this.clearTooltipTimer(),this.hideTooltip());var c=p.getSheetConfigurationData().selectionPreferencesData.getHighlightRolloverDelay();if(f||!(0<c)){p.setHoverHighlightedElement(b,t,n);var l=p.getSheet(
).getHoveredElements();this.fireHoverChangedEvent(n,l),this.updateCursor(n),n||(this.tooltipDelay=f?null:200,this.triggerTooltip())}else{this.tooltipDelay=null;var v=p.getSheetConfigurationData().rolloverDelay[c],w=p.applyPreSelectionFilter(b,t,n),l=(w.oldElements,w.newElements),d=w.isHoverChanged;if(d&&(r.beginTransaction(Dt.messages.ModelChangeMessage),p.getSheet().setHoveredElements([]),r.endTransaction(),l&&0<l.length&&!n)){if(r.NM=!0,r.OM=v,r.beginTransaction(Dt.messages.ModelChangeMessage),p.getSheet().setHoveredElements(l,!0),w.isPreselectionFilterHandled){var m=l.length;if(1<m)for(var g=0;g<m;g++){var M=l[g];M instanceof _t.Connection&&M._M()&St.ConnectionHandleOption.SEGMENTS&&M.setHighlightFlags(_t.HighlightFlags.EntireConnectionHover,!0)}}r.endTransaction(),r.DM=!0,r.NM=s,r.OM=u}this.fireHoverChangedEvent(n,l),this.updateCursor(n),this.triggerTooltipTimer=window.setTimeout(this.triggerTooltip,v)}}catch(t){k.clearTriggerTooltipTimer(),k.clearTooltipTimer(),r.NM=s,r.OM=u,r.SM(
),r.DM=h,window.console&&window.console.log(t.name+": "+t.message)}},clearTriggerTooltipTimer:function(){k.triggerTooltipTimer&&(window.clearTimeout(k.triggerTooltipTimer),k.triggerTooltipTimer=null)},clearTooltipTimer:function(){k.tooltipTimer&&(window.clearTimeout(k.tooltipTimer),k.tooltipTimer=null)},clearTooltipHideTimer:function(){k.tooltipHideTimer&&(window.clearTimeout(k.tooltipHideTimer),k.tooltipHideTimer=null)}};e.bind("mousedown",function(t,n){h.isEnabled()&&(a=!0,k.hideTooltip())}),e.bind("mousemove",function(t,n){o=t.ctrlKey,r(t,n,!1),h.isEnabled()&&(t=p.getCursorPosAndKeyStatus(t),i(t,!1))}),e.bind("mouseleave",function(t,n){o=t.ctrlKey,r(t,n,!1),h.isEnabled()&&(t=p.getCursorPosAndKeyStatus(t),i(t,!0),k.hideTooltip(),k.clearTooltipTimer(),k.clearTooltipHideTimer())}),e.bind("touchstart touchmove",function(t,n){o=t.ctrlKey,r(t,n,!0),h.isEnabled()&&(t=p.getCursorPosAndKeyStatus(t),i(t,!1))},!0)},h.prototype.execute=function(){},h.prototype.onDisabledByCommandState=function(
t){"CREATECONNECTION"===t&&this.diagramManager.setHoveredElements(null)},ht.inheritedBy(h);var _={};function e(t){Dt.EventArgs.call(this),this.getSheetElement=function(){return t}}function o(t,n,i,r,s,u,h){Dt.EventArgs.call(this);var e=t?[t.x,t.y]:null,o=n,f=i,a=r,c=s,l=u,v=h,w=null,d=null;this.setLocationIndicatorInfo=function(t){d=t},this.getLocationIndicatorInfo=function(){return d},this.getLocation=function(){return e},this.getContextSheetElement=function(){return o},this.getTargetElement=function(){return f},this.getNodeSide=function(){return a},this.getSegmentId=function(){return c},this.getConnectionEnd=function(){return l},this.getRelativeLoc=function(){return v},this.setHighlightElements=function(t){w=t},this.getHighlightElements=function(){return w}}function f(t,n,i,r,s,u,h){Dt.EventArgs.call(this);var e=t?[t.x,t.y]:null,o=n,f=i,a=r,c=s,l=u,v=h,w=null;this.getLocation=function(){return e},this.getContextSheetElement=function(){return o},this.getTargetElement=function(){
return f},this.getNodeSide=function(){return a},this.getSegmentId=function(){return c},this.getConnectionEnd=function(){return l},this.getRelativeLoc=function(){return v},this.setLocationIndicatorInfo=function(t){w=t},this.getLocationIndicatorInfo=function(){return w}}function D(t,n,i){Dt.EventArgs.call(this);var r=t,s=n||[],u=i;this.getContextSheetElement=function(){return r},this.getTargetElements=function(){return s},this.getConnectionEnd=function(){return u}}function v(t,n,i,r,s,u,h,e,o,f){Dt.EventArgs.call(this),this.TM(e,o,f);var a,c=t,l=n,v=i,w=r,d=s,m=u,g=h,M=!1,p=null;this.setLocationIndicatorInfo=function(t){p=t},this.getLocationIndicatorInfo=function(){return p},this.getScope=function(){return c},this.getDragType=function(){return l},this.getLocation=function(){return v},this.getSourceElements=function(){return w},this.getTargetElements=function(){return d},this.getOutElements=function(){return m},this.getOriginalEvent=function(){return g},this.setIsDropAccepted=function(t){
M=t},this.getIsDropAccepted=function(){return M},this.setDropTarget=function(t){a=t},this.getDropTarget=function(){return a}}function a(t,n,i,r,s){Dt.EventArgs.call(this);var u=null,h=null,e=null,o=null,f=null,a=null,c=null,l=null,v=null,w=null;this.getAlignmentTargets=function(){return f},this.setAlignmentTargets=function(t){f=t},this.getPrioritizedAlignmentModes=function(){return a},this.setPrioritizedAlignmentModes=function(t){a=t},this.getNewSheetElement=function(){return u},this.setNewSheetElement=function(t){u=t},this.getClickLocation=function(){return[t.x,t.y]},this.getContextSheetElement=function(){return n},this.getSegmentId=function(){return i},this.getClickSide=function(){return r},this.getRelativeLoc=function(){return s},this.setAllowedAlignSourceTypes=function(t){h=t},this.getAllowedAlignSourceTypes=function(){return h},this.setAllowedAlignTargetTypes=function(t){e=t},this.getAllowedAlignTargetTypes=function(){return e},this.setAlignmentMasters=function(t){o=t},
this.getAlignmentMasters=function(){return o},this.setAttachmentSourceTypes=function(t){c=t},this.getAttachmentSourceTypes=function(){return c},this.setAttachmentTargetTypes=function(t){l=t},this.getAttachmentTargetTypes=function(){return l},this.setAttachmentMasters=function(t){v=t},this.getAttachmentMasters=function(){return v},this.setLocationIndicatorInfo=function(t){w=t},this.getLocationIndicatorInfo=function(){return w}}function c(t){Dt.EventArgs.call(this);var n=t||[];this.getDeletingElements=function(){return n},this.setDeletingElements=function(t){n=t},this.addDeletingElement=function(t){n.push(t)},this.removeDeletingElement=function(t){t=n.indexOf(t);0<=t&&t<n.length&&n.splice(t,1)}}function l(t){Dt.EventArgs.call(this),this.getSheetElement=function(){return t}}function w(t,n,i,r,s){Dt.EventArgs.call(this),this.TM(i,n,r);var u=t,h=s;this.getKeyCode=function(){return u},this.getElements=function(){return h}}function S(t,n,i,r,s,u,h,e){Dt.EventArgs.call(this),this.TM(u,h,e)
;var o=t,f=n,a=i,c=r,l=s;this.getButton=function(){return o},this.getScreenLoc=function(){return f},this.getRelativeLoc=function(){return a},this.getSegmentId=function(){return l},this.getSheetElement=function(){return c}}function m(t,n){Dt.EventArgs.call(this);var i=t||[],r=n||[];this.getParentNode=function(){return i},this.setParentNode=function(t){i=t},this.getChildNode=function(){return r},this.setChildNode=function(t){r=t}}function g(t){Dt.EventArgs.call(this);var n=t||[],r=new Dt.Map;this.getSheetElements=function(){return n},this.insertResult=function(t,n,i){r.put(t.guid,{pasted:n,inherited:i})},this.getResults=function(t){return t?r[t.guid]:null}}function M(t){Dt.EventArgs.call(this);var n=t||[];this.getHighlightElements=function(){return n},this.addHighlightElement=function(t){n.push(t)},this.removeHighlightElement=function(t){t=n.indexOf(t);0<=t&&t<n.length&&n.splice(t,1)}}function p(t,n,i,r,s,u){Dt.EventArgs.call(this),this.TM(i,r,s);var h=t||[],e=n,o=u
;this.getSheetElements=function(){return h},this.setSheetElements=function(t){h=t},this.addSheetElement=function(t){h.indexOf(t)<0&&h.push(t)},this.removeSheetElement=function(t){t=h.indexOf(t);0<=t&&t<h.length&&h.splice(t,1)},this.isHover=function(){return e},this.getCursorLoc=function(){return o}}function b(t,n,i,r,s,u){Dt.EventArgs.call(this);var h=t,e=n||"",o=i?[i.x,i.y]:null,f=r,a=u,c=s;this.getSheetElement=function(){return h},this.getTooltip=function(){return e},this.setTooltip=function(t){e=t},this.getCursorLocation=function(){return o},this.setTooltipStayTime=function(t){f=t},this.getTooltipStayTime=function(){return f},this.setTooltipOption=function(t){a=t},this.getTooltipOption=function(){return a},this.getState=function(){return c}}function k(t,n,i,r,s,u){Dt.EventArgs.call(this),this.TM(i,r,s);var h=t?t.concat():[],e=n?n.concat():[],o=u;this.getAddedElements=function(){return h},this.getRemovedElements=function(){return e},this.getCursorLoc=function(){return o}}function tt(
t,n,i,r,s,u){Dt.EventArgs.call(this),this.TM(i,r,s);var h=t?t.concat():[],e=n?n.concat():[],o=u;this.getAddedElements=function(){return h},this.setAddedElements=function(t){h=t},this.addSelectCandidate=function(t){h.indexOf(t)<0&&h.push(t)},this.removeSelectCandidate=function(t){t=h.indexOf(t);0<=t&&t<h.length&&h.splice(t,1)},this.getRemovedElements=function(){return e},this.setRemovedElements=function(t){e=t},this.addDeselectCandidate=function(t){e.indexOf(t)<0&&e.push(t)},this.removeDeselectCandidate=function(t){t=e.indexOf(t);0<=t&&t<e.length&&e.splice(t,1)},this.getCursorLoc=function(){return o}}function y(t,n,i){Dt.EventArgs.call(this),this.getSVGSymbol=function(){return t},this.getCallbackName=function(){return i},this.getCallbackType=function(){return n}}function x(t,n,i,r){Dt.EventArgs.call(this);var s=i||"";this.getOwner=function(){return t},this.getTextBox=function(){return n},this.getValue=function(){return s},this.getPhase=function(){return r},this.setValue=function(t){s=t}
}function E(t,n,i,r,s,u){Dt.EventArgs.call(this);var h=t?[t.x,t.y]:null,e=n,o=null,f=null,a=null;this.getLocation=function(){return h},this.getNewSheetElement=function(){return e},this.setNewSheetElement=function(t){e=t},this.getContextSheetElement=function(){return i},this.getSegmentId=function(){return r},this.getClickSide=function(){return s},this.getRelativeLoc=function(){return u},this.setAlignmentData=function(t){o=t.alignmentSources,f=t.alignmentTargets,a=t.alignmentTypes},this.getAlignmentSources=function(){return o},this.getAlignmentTargets=function(){return f},this.getAlignmentTypes=function(){return a},this.getAlignmentData=function(t){return St.AlignResultType.getAlignmentData(o,f,a,t)}}function C(t,n,i,r,s,u,h,e,o,f,a){Dt.EventArgs.call(this),this.TM(o,f,a);var c,l,v=t||[],w=n||[],d=[],m=i||"",g=r,M=s,p=u,b=h||[],k=e||[],y=!1,x=null;this.setLocationIndicatorInfo=function(t){x=t},this.getLocationIndicatorInfo=function(){return x},this.getSheetElements=function(){return v},
this.getTransforms=function(){return w},this.setNewTransforms=function(t){d=t},this.getNewTransforms=function(){return d},this.getTransformType=function(){return m},this.getResizeHandle=function(){return g},this.getLocation=function(){return M},this.getDragEffect=function(){return p},this.getTargetElements=function(){return b},this.getOutElements=function(){return k},this.setIsDropAccepted=function(t){y=t},this.getIsDropAccepted=function(){return y},this.setDropTarget=function(t){c=t},this.getDropTarget=function(){return c},this.setTransformMaster=function(t){l=t},this.getTransformMaster=function(){return l}}function N(t,n,i,r,s,u,h,e){Dt.EventArgs.call(this),this.TM(u,h,e);var o,f=t||[],a=n||[],c=i||"",l=r,v=s,w=null,d=null,m=null,g=null;this.getSheetElements=function(){return f},this.getTransforms=function(){return a},this.getTransformType=function(){return c},this.getResizeHandle=function(){return l},this.getLocation=function(){return v},this.setAlignmentData=function(t){
w=t.alignmentSources,d=t.alignmentTargets,m=t.alignmentTypes},this.getAlignmentSources=function(){return w},this.getAlignmentTargets=function(){return d},this.getAlignmentTypes=function(){return m},this.getAlignmentData=function(t){return St.AlignResultType.getAlignmentData(w,d,m,t)},this.setOverlappedElements=function(t){o=t},this.getOverlappedElements=function(){return o},this.setQuickAlignElements=function(t){g=t},this.getQuickAlignElements=function(){return g}}function O(t,n,i,r,s,u,h){Dt.EventArgs.call(this),this.TM(s,u,h);function e(){if(f&&0<f.length){var t=f.length,n=a&&0<a.length?a:o;if(n&&n.length===t)for(var i=0;i<t;i++)f[i]!==n[i]&&(f[i].AM=n[i])}}var o=t||[],f=[],a=[],c=n||"",l=i,v=null,w=null,d=r,m="none",g=!0,M=null,p=null,b=null,k=null,y=null,x=null,E=null,C=null,N=null;this.getAlignmentTargets=function(){return p},this.setAlignmentTargets=function(t){p=t},this.getPrioritizedAlignmentModes=function(){return b},this.setPrioritizedAlignmentModes=function(t){b=t},
this.getSheetElements=function(){return o},this.setNewSheetElements=function(t){f=t,e()},this.setCopySources=function(t){a=t,e()},this.getNewSheetElements=function(){return f},this.getTransformType=function(){return c},this.getResizeHandle=function(){return l},this.setAllowedAlignSourceTypes=function(t){v=t},this.getAllowedAlignSourceTypes=function(){return v},this.setAllowedAlignTargetTypes=function(t){w=t},this.getAllowedAlignTargetTypes=function(){return w},this.getLocation=function(){return d},this.setDragEffect=function(t){m=t},this.getDragEffect=function(){return m},this.isAttachingAllowed=function(){return g},this.setAttachingAllowed=function(t){g=t},this.setAlignmentMasters=function(t){M=t},this.getAlignmentMasters=function(){return M},this.setAttachmentSourceTypes=function(t){k=t},this.getAttachmentSourceTypes=function(){return k},this.setAttachmentTargetTypes=function(t){y=t},this.getAttachmentTargetTypes=function(){return y},this.setAttachmentMasters=function(t){x=t},
this.getAttachmentMasters=function(){return x},this.setQuickAlignElements=function(t){E=t},this.getQuickAlignElements=function(){return E},this.setQuickAlignDirection=function(t){C=t},this.getQuickAlignDirection=function(){return C},this.setQuickAlignMode=function(t){N=t},this.getQuickAlignMode=function(){return N}}function T(t){Dt.EventArgs.call(this);var n=t||null;this.getViewportData=function(){return n}}function A(t,n,i,r,s){Dt.EventArgs.call(this);var u=t,h=n,e=i,o=r,f=[];if(s)for(var a=0;a<s.length;a++)f.push([s[a].x,s[a].y]);this.getEditConnection=function(){return u},this.getPhase=function(){return h},this.getStartAttachment=function(){return e},this.getEndAttachment=function(){return o},this.getPreviewPath=function(){return f}}function R(t,n,i){Dt.EventArgs.call(this);var r=t||null,s=n||null,u=i?[i.x,i.y]:[];this.getNewElement=function(){return r},this.getOldElement=function(){return s},this.getMousePosition=function(){return u}}function P(t){Dt.EventArgs.call(this),
this.m_renderContext=t,this.m_sheetElements=[],this.m_symbols=[],this.m_symbolStyles=[],this.m_symbolVisuals=[]}function H(t,n,i,r){Dt.EventArgs.call(this);var s=t||[],u=n||[],h=i,e=r;this.getScreenLoc=function(){return s},this.getRelativeLoc=function(){return u},this.getSegmentId=function(){return e},this.getSheetElement=function(){return h}}function L(t,n,i,r){Dt.EventArgs.call(this);var s=t||[],u=n||[],h=i,e=r;this.getScreenLoc=function(){return s},this.getRelativeLoc=function(){return u},this.getSegmentId=function(){return e},this.getSheetElement=function(){return h}}function I(t){Dt.EventArgs.call(this),this.connections=[],this.inputEndPoints=[],this.numOutputPoints=[],this.outputPoints=[],this.directions=[],this.reasons=[],this.inPreview=t,this.clickLocation=null,this.cursorLocation=null,this.segmentId=-1}function F(t,n,i,r,s,u,h,e,o,f){Dt.EventArgs.call(this),this.TM(e,o,f);var a,c,l=t||[],v=n||[],w=i||"",d=r,m=s,g=u,M=h;this.getSheetElements=function(){return l},
this.getTransforms=function(){return v},this.getTransformType=function(){return w},this.getTargetElement=function(){return M},this.getResizeHandle=function(){return d},this.getLocation=function(){return m},this.getDragEffect=function(){return g},this.setTransformMaster=function(t){a=t},this.getTransformMaster=function(){return a},this.setOverlappedElements=function(t){c=t},this.getOverlappedElements=function(){return c}}function V(t){Dt.EventArgs.call(this);var n=t||null;this.getViewportData=function(){return n}}function j(t){Dt.EventArgs.call(this);var n=t;this.getDomElement=function(){return n},this.setDomElement=function(t){n=t}}function W(t){var i=[];this.inEventLoop=!1;for(var r=this,n=0;n<_.NumOfEventTypes;n++)i.push(new Dt.Event);t&&t.register(Dt.messages.EventMessage,this,function(t){n=t.RM,n=i[n]=i[n]||new Dt.Event;if(n){r.inEventLoop=!0,n.notify(t.PM);var n=r.inEventLoop=!1;return n=t.PM.isHandled()||t.PM.isCancelled()?!0:n}}),this.addEventListener=function(t,n){
i[t].subscribe(n)},this.removeEventListener=function(t,n){i[t].unsubscribe(n)},this.clear=function(){i.splice(0,_.NumOfEventTypes)}}_.NumOfEventTypes=0,_.OnAddingNodeToNode=_.NumOfEventTypes++,_.OnAddNodeToNode=_.NumOfEventTypes++,_.OnRemovingNodeFromNode=_.NumOfEventTypes++,_.OnRemoveNodeFromNode=_.NumOfEventTypes++,_.OnCollapseNode=_.NumOfEventTypes++,_.OnExpandNode=_.NumOfEventTypes++,_.OnQueryCommands=_.NumOfEventTypes++,_.OnCommandExecution=_.NumOfEventTypes++,_.OnAttaching=_.NumOfEventTypes++,_.OnAttached=_.NumOfEventTypes++,_.OnPreHighlight=_.NumOfEventTypes++,_.OnQueryTooltip=_.NumOfEventTypes++,_.OnSelectionChanged=_.NumOfEventTypes++,_.OnElementCreating=_.NumOfEventTypes++,_.OnElementsDeleting=_.NumOfEventTypes++,_.OnTextChange=_.NumOfEventTypes++,_.OnInsertNodeOnConnection=_.NumOfEventTypes++,_.OnRemoveNodeFromConnections=_.NumOfEventTypes++,_.OnViewportChanged=_.NumOfEventTypes++,_.OnTransformStart=_.NumOfEventTypes++,_.OnTransformDelta=_.NumOfEventTypes++,
_.OnTransformEnd=_.NumOfEventTypes++,_.OnCopy=_.NumOfEventTypes++,_.OnPaste=_.NumOfEventTypes++,_.OnGroup=_.NumOfEventTypes++,_.OnUngroup=_.NumOfEventTypes++,_.OnSheetNavigation=_.NumOfEventTypes++,_.OnSVGCallback=_.NumOfEventTypes++,_.OnElementCreated=_.NumOfEventTypes++,_.OnPreselectionFilter=_.NumOfEventTypes++,_.OnKeydown=_.NumOfEventTypes++,_.OnDetaching=_.NumOfEventTypes++,_.OnGeometryChange=_.NumOfEventTypes++,_.OnMouseClick=_.NumOfEventTypes++,_.OnMouseDown=_.NumOfEventTypes++,_.OnMouseUp=_.NumOfEventTypes++,_.OnMouseDoubleClick=_.NumOfEventTypes++,_.OnHoverChanged=_.NumOfEventTypes++,_.OnRenderCallback=_.NumOfEventTypes++,_.OnSelectionChanging=_.NumOfEventTypes++,_.OnTap=_.NumOfEventTypes++,_.OnDoubleTap=_.NumOfEventTypes++,_.OnTouchHold=_.NumOfEventTypes++,_.OnDrag=_.NumOfEventTypes++,_.OnConnectionRouting=_.NumOfEventTypes++,_.OnPreTransformEnd=_.NumOfEventTypes++,_.OnViewportChanging=_.NumOfEventTypes++,_.OnDiagramExporting=_.NumOfEventTypes++,e.prototype.getType=function(
){return _.OnCollapseNode},Dt.EventArgs.inheritedBy(e),o.prototype.getType=function(){return _.OnAttaching},Dt.EventArgs.inheritedBy(o),f.prototype.getType=function(){return _.OnAttached},Dt.EventArgs.inheritedBy(f),D.prototype.getType=function(){return _.OnDetaching},Dt.EventArgs.inheritedBy(D),v.prototype.getType=function(){return _.OnDrag},Dt.EventArgs.inheritedBy(v),a.prototype.getType=function(){return _.OnElementCreating},Dt.EventArgs.inheritedBy(a),c.prototype.getType=function(){return _.OnElementsDeleting},Dt.EventArgs.inheritedBy(c),l.prototype.getType=function(){return _.OnExpandNode},Dt.EventArgs.inheritedBy(l),w.prototype.getType=function(){return _.OnKeydown},Dt.EventArgs.inheritedBy(w),S.prototype.getType=function(){return _.OnMouseClick},Dt.EventArgs.inheritedBy(S),Dt.EventArgs.inheritedBy(m),g.prototype.getType=function(){return _.OnPaste},Dt.EventArgs.inheritedBy(g),M.prototype.getType=function(){return _.OnPreHighlight},Dt.EventArgs.inheritedBy(M),
p.prototype.getType=function(){return _.OnPreselectionFilter},Dt.EventArgs.inheritedBy(p),b.prototype.getType=function(){return _.OnQueryTooltip},Dt.EventArgs.inheritedBy(b),k.prototype.getType=function(){return _.OnSelectionChanged},Dt.EventArgs.inheritedBy(k),tt.prototype.getType=function(){return _.OnSelectionChanging},Dt.EventArgs.inheritedBy(tt),y.prototype.getType=function(){return _.OnSVGCallback},Dt.EventArgs.inheritedBy(y),x.prototype.getType=function(){return _.OnTextChange},Dt.EventArgs.inheritedBy(x),E.prototype.getType=function(){return _.OnElementCreated},Dt.EventArgs.inheritedBy(E),C.prototype.getType=function(){return _.OnTransformDelta},Dt.EventArgs.inheritedBy(C),N.prototype.getType=function(){return _.OnTransformEnd},Dt.EventArgs.inheritedBy(N),O.prototype.getType=function(){return _.OnTransformStart},Dt.EventArgs.inheritedBy(O),T.prototype.getType=function(){return _.OnViewportChanged},Dt.EventArgs.inheritedBy(T),A.prototype.getType=function(){
return _.OnGeometryChange},Dt.EventArgs.inheritedBy(A),R.prototype.getType=function(){return _.OnHoverChanged},Dt.EventArgs.inheritedBy(R),P.prototype.addRenderTarget=function(t,n,i,r){this.m_sheetElements.push(t),this.m_symbols.push(n),this.m_symbolStyles.push(i),this.m_symbolVisuals.push(r)},P.prototype.getRenderTargets=function(){var t=this.m_symbols,n=t.length;if(n<1)return[];for(var i=new Array(n),r=this.m_sheetElements,s=this.m_symbolStyles,u=this.m_symbolVisuals,h=0;h<n;h++){var e=new St.RenderCallbackTarget(r[h],t[h],s[h],u[h]);i[h]=e}return i},P.prototype.getRenderContext=function(){return this.m_renderContext},P.prototype.clear=function(){this.m_renderContext=null,this.m_sheetElements=null,this.m_symbols=null,this.m_symbolStyles=null,this.m_symbolVisuals=null},P.prototype.getType=function(){return _.OnRenderCallback},Dt.EventArgs.inheritedBy(P),H.prototype.getType=function(){return _.OnTap},Dt.EventArgs.inheritedBy(H),L.prototype.getType=function(){return _.OnMouseClick},
Dt.EventArgs.inheritedBy(L),I.prototype.getConnections=function(){return this.connections},I.prototype.getInputEndPoints=function(){return this.inputEndPoints},I.prototype.getDirections=function(){return this.directions},I.prototype.getReasons=function(){return this.reasons},I.prototype.isInPreview=function(){return this.inPreview},I.prototype.getClickLocation=function(){return this.clickLocation},I.prototype.getCursorLocation=function(){return this.cursorLocation},I.prototype.getSegmentId=function(){return this.segmentId},I.prototype.addConnectionToRouting=function(t,n,i,r,s,u){this.connections.push(t),this.reasons.push(n),this.inputEndPoints=this.inputEndPoints.concat([i[0],i[1],s[0],s[1]]),this.directions=this.directions.concat([r[0],r[1],u[0],u[1]])},I.prototype.getConnectionRoutingResult=function(){for(var t={},n=this.connections,i=0,r=0,s=n.length;r<s;r++){for(var u=this.numOutputPoints[r],h=this.outputPoints,e=[],o=i;o<2*u+i;)e.push(new St.Point(h[o],h[o+1])),o+=2;i+=2*u,
t[n[r].guid]=e}return t},I.prototype.setConnections=function(t){this.connections=t},I.prototype.setNumOutputPoints=function(t){this.numOutputPoints=t},I.prototype.setOutputPoints=function(t){this.outputPoints=t},I.prototype.getType=function(){return _.OnConnectionRouting},Dt.EventArgs.inheritedBy(I),F.prototype.getType=function(){return _.OnPreTransformEnd},Dt.EventArgs.inheritedBy(F),V.prototype.getType=function(){return _.OnViewportPostChanged},Dt.EventArgs.inheritedBy(V),j.prototype.getType=function(){return _.OnDiagramExporting},Dt.EventArgs.inheritedBy(j);var At={};function z(){ht.call(this)}function Y(t,n,i){Dt.common.IdentifiableObject.call(this),this.HM=!0,this.LM=!0,this.IM=t,this.FM=new St.RenderStyle,this.VM=null,this.ey=null,this.FM.strokeColor=n||"#00A8FF",this.FM.lineWidth=i||1,this.jM=null}function et(t,n,i){Y.call(this,t,n,i),this.WM=null}function ot(t,n,i){var r;Y.call(this,t,n,i),this.zM=function(t){r=t},this.YM=function(){return r}}function ft(){
this.minSegmentLength=20}At.EventType=_,At.CollapseNodeEventArgs=e,At.AttachingEventArgs=o,At.AttachedEventArgs=f,At.DetachingEventArgs=D,At.DragEventArgs=v,At.ElementCreatingEventArgs=a,At.ElementsDeletingEventArgs=c,At.ExpandNodeEventArgs=l,At.KeydownEventArgs=w,At.MouseClickEventArgs=S,At.NestedNodeEventArgs=m,At.PasteEventArgs=g,At.PreHighlightEventArgs=M,At.PreselectionFilterEventArgs=p,At.QueryTooltipEventArgs=b,At.SelectionChangedEventArgs=k,At.SelectionChangingEventArgs=tt,At.SVGCallbackEventArgs=y,At.TextChangeEventArgs=x,At.ElementCreatedEventArgs=E,At.TransformDeltaEventArgs=C,At.TransformEndEventArgs=N,At.TransformStartEventArgs=O,At.ViewportChangedEventArgs=T,At.GeometryChangeEventArgs=A,At.HoverChangedEventArgs=R,At.RenderCallbackEventArgs=P,At.TapEventArgs=H,At.TouchHoldEventArgs=L,At.ConnectionRoutingEventArgs=I,At.PreTransformEndEventArgs=F,At.ViewportChangingEventArgs=V,At.DiagramExportingEventArgs=j,At.EventDispatcher=W,z.prototype.hook=function(d,m){
ht.prototype.hook.call(this,d,m);function s(t){var n,i=m.getScreenToSheetTransform(),r=!1;if(i){if(t){if(a=null,A=m.getSelectedElements()){var s=A.length;if(0<s)for(var u=0;u<s;u++)if(A[u].isTranslateAllowed()){r=!0,a=A[u],T=A[u];break}}var h=a&&a.getAnchorPosition()?a.getAnchorPosition().clone():null;h&&(N.x=h.x,N.y=h.y);var e=a.getOverlays();if(e&&e.length)for(u=0;u<e.length;u++)if((n=e[u].getId())===Tt.ConnectionMove||n===Tt.Move||n===Tt.Preselection){n=(x=e[u])?x.getId():void 0;break}}else{N=i.transformPoint(N),C.copyFrom(N),T=null;h=m.getHoveredElements();!h||0<(i=h.length)&&(r=(T=h[i-1])&&T.isTranslateAllowed()),n=(x=m.getOverlayByPoint(N))?x.getId():void 0}r&&n&&(g=n===Tt.ConnectionMove,o=n==Tt.Move||n==Tt.Preselection,(g||o)&&(f=!(_=!1),p=null,(y=m.getCommandManager()).enableCommand("HoverHighlightCommand",!1),M=m.isDanglingConnectionAllowed(),o?d.activateCursor(St.CursorID.MOVE):g&&M&&d.activateCursor(St.CursorID.MOVEENTIRECON)))}}var g,o,M,p,b,k,y=null,i=null,x=null,E=null,
C=new St.Point(0,0),N=new St.Point(0,0),O=new St.Point(0,0),D=new St.Point(0,0),_=!1,f=!1,S=!1,u=this,T=null,A=null,a=null,R=null,c=[],P=!0,H=function(){p=S=f=!1,c=[],P=!(R=x=T=b=E=null)},L=function(t,n,i){var r=!0,s=m.getSheet().getSession();return s&&(n=new At.DetachingEventArgs(t,n,i),i=new Dt.messages.EventMessage(n,At.EventType.OnDetaching),s.CM().BM(i)&&n.isCancelled()&&(r=!1)),r},I=function(t,n,i,r){var s=m.getSheetConfigurationData(),r=new At.TransformStartEventArgs(E,"translate",void 0,[O.x,O.y],n,i,r);r.setPrioritizedAlignmentModes(s.alignmentPriority);s=new Dt.messages.EventMessage(r,At.EventType.OnTransformStart);if(t.BM(s)){if(r.isCancelled())return H(),g?d.deactivateCursor(St.CursorID.MOVEENTIRECON):d.deactivateCursor(St.CursorID.MOVE),!1;if(r.isHandled()){s=r.getNewSheetElements();if(m.moveConstraint.ZM(r),P=r.isAttachingAllowed(),"move"==(R=r.getDragEffect())){m.previewManager.UM=!0,m.moveConstraint.disableMoveStrategy=!0;for(var u=0,h=(E=s).length;u<h;u++
)E[u].setHighlightFlags(_t.HighlightFlags.MovePreview,!0);x=T.getOverlays()[0],d.activateCursor(St.CursorID.DRAGMOVE)}else if("copy"==R){if(m.previewManager.UM=!0,m.moveConstraint.disableMoveStrategy=!0,s&&0<s.length){c=s;for(u=0,h=E.length;u<h;u++)c[u].setHighlightFlags(_t.HighlightFlags.CopyPreview,!0),T===E[u]&&(T=c[u]);m.setHoveredElements([T],!0),x=T.getOverlays()[0],E=c}else{c=m.cloneDummy(E);for(u=0,h=E.length;u<h;u++)c[u].AM=E[u],c[u].setHighlightFlags(_t.HighlightFlags.CopyPreview,!0),T===E[u]&&(T=c[u]);m.setHoveredElements([T],!0),x=T.getOverlays()[0],E=c}d.activateCursor(St.CursorID.DRAGCOPY)}else E=s}}return!0},F=function(t,n){if(!t.getLocation()||!t.getLocation().getReference())return!1;t=t.getLocation().getReference();return 0<=n.indexOf(t)||F(t,n)};d.bind("mousedown",function(t){0===t.button&&u.isEnabled()&&(i=d.offset(),N.x=t.pageX-i.left,N.y=t.pageY-i.top,s())}),d.bind("touchstart",function(t){t=t.originalEvent;u.isEnabled()&&(i=d.offset(),t=t.changedTouches[0],
N.x=t.pageX-i.left,N.y=t.pageY-i.top,s())});function h(t,n,i){var r=m.previewManager.GM(x);if(E&&E.length)for(var s=E.length,u=0;u<s;u++)E[u].XM()&_t.HighlightFlags.Preview&&E[u].setHighlightFlags(_t.HighlightFlags.Preview,!1);if(m.previewManager.$M&&m.setDropHighlightElements([m.previewManager.$M],!1),"move"==R){m.previewManager.UM=!1,m.moveConstraint.disableMoveStrategy=!1;for(u=0,s=E.length;u<s;u++)E[u].setHighlightFlags(_t.HighlightFlags.MovePreview,!1);d.deactivateCursor(St.CursorID.DRAGMOVE),d.deactivateCursor(St.CursorID.DROPREJECT)}else"copy"==R&&(m.previewManager.UM=!1,m.moveConstraint.disableMoveStrategy=!1,c&&0<c.length&&m.removeSheetElements(c,!0),d.deactivateCursor(St.CursorID.DRAGCOPY),d.deactivateCursor(St.CursorID.DROPREJECT));if(m.moveElements(O,R,T,r,m.previewManager.$M,t,n,i),o=E&&E.length?m.moveConstraint.getFocusElement(E):o){if(o.qM){var h=o.qM();s=h.length;for(u=0;u<s;u++)h[u].KM(null)}if(o.JM){var e=o.JM();s=e.length;for(u=0;u<s;u++)e[u].KM(null)}
m.updateOverlay();var o,i=m.moveConstraint.attachingUtil;i.isAttachingAccepted()&&(o=i.getAttachmentData(),i.sendAttachedEvent(o.attachingPoint))}m.getPreviewOverlays().QM(null),m.removePreviewRelatedOverlays(),m.moveConstraint.focusElement=null,m.moveConstraint.p2(),m.moveConstraint.alignment.clearAlignPoints(),m.setAlignmentSmartGuideLines(null),m.updateOverlay(),m.moveConstraint.reset(),m.moveConstraint.attachingUtil.clearAttachingCursor()}d.bind("mouseup",function(t){var n;f&&(O.x=t.pageX-i.left,O.y=t.pageY-i.top,(n=m.getScreenToSheetTransform())&&(O=n.transformPoint(O)),y.enableCommand("HoverHighlightCommand",!0),S&&h(t.altKey,t.ctrlKey,t.shiftKey),H(),o?(d.deactivateCursor(St.CursorID.MOVE),o=null):g&&(d.deactivateCursor(St.CursorID.MOVEENTIRECON),g=null)),!0===k&&(d.deactivateCursor(St.CursorID.MOVEREJECT),k=!1)}),d.bind("touchend",function(t){f&&(y.enableCommand("HoverHighlightCommand",!0),S&&h(),H()),!0===k&&(d.deactivateCursor(St.CursorID.MOVEREJECT),k=!1)});function e(t,n,i,
r,s){var u;if(s?(u=D.equal(O),E=A):(O=t.transformPoint(O),(u=C.equal(O))||C.copyFrom(O)),!u){if(!_){S=!0,E=s?E:m.getMoveElements();s=m.getSheet().getSession();if(s){E=m.moveConstraint.filterMoveElements(E);s=s.CM();if(s){var h=E.length;if(0<h&&!I(s,n,i,r))return y.enableCommand("HoverHighlightCommand",!0),k=_=!0,d.activateCursor(St.CursorID.MOVEREJECT),0;if(!(M=m.isDanglingConnectionAllowed())&&!(p=m.moveConstraint.checkMovingDanglingConnection(E,T)))return k=_=!(S=!1),d.activateCursor(St.CursorID.MOVEREJECT),0;if(M){h=E?E.length:0;for(var e=0;e<h;e++)if(E[e].getStart&&E[e].getEnd){var o=[],f=St.ConnectionEnd.NONE,a=E[e].getStart(),c=E[e].getEnd();if(a&&!F(a,E)&&(f|=St.ConnectionEnd.START,o.push(a)),c&&!F(c,E)&&(f|=St.ConnectionEnd.END,o.push(c)),f)if(!L(E[e],o,f))return H(),d.deactivateCursor(St.CursorID.MOVE),y.enableCommand("HoverHighlightCommand",!0),k=_=!0,d.activateCursor(St.CursorID.MOVEREJECT),0}if(!(p=m.moveConstraint.checkMoveElementsChained(E)))return k=_=!(S=!1),
d.activateCursor(St.CursorID.MOVEREJECT),0}}}g&&(b=m.moveConstraint.replacePrimaryMoveElement(E,T))!==T&&(m.moveConstraint.focusElement=b),_=!0,m.startPreview(E)}for(var l,v=!1,e=0,h=E.length;e<h;e++){var w=E[e].tk();if(w.isLockX||w.isLockY){v=!0;break}}!0===p&&!0===_&&E&&0<E.length&&(d.activateCursor(St.CursorID.MOVE),m.setPreviewOverlays(x,E,O.x-N.x,O.y-N.y,0,O,R,n,i,r),l=(r=b?m.moveConstraint.moveOffset(b):m.moveConstraint.moveOffset(T)).offsetForAlign,v||(O.x=N.x+r.offsetX,O.y=N.y+r.offsetY)),l&&(v?m.moveConstraint.move2(E,l,N,O,!P):m.moveConstraint.move(E,l,N,O,!P))}}d.bind("mousemove",function(t){var n;f&&u.isEnabled()&&(O.x=t.pageX-i.left,O.y=t.pageY-i.top,(n=m.getScreenToSheetTransform())&&e(n,t.altKey,t.ctrlKey,t.shiftKey))}),d.bind("touchmove",function(t){f&&u.isEnabled()&&(t=t.originalEvent.changedTouches[0],O.x=t.pageX-i.left,O.y=t.pageY-i.top,(t=m.getScreenToSheetTransform())&&e(t))});var l=void 0;d.bind("keydown",function(t){if(void 0===l&&(l=m.getSheetConfigurationData(
).assistantKeysForKeyboardMove),(u.isEnabled()||u.isEnabled()&&u.isInputKeysMatched(l,t))&&(t.keyCode==St.KeyCode.LEFT||t.keyCode==St.KeyCode.UP||t.keyCode==St.KeyCode.RIGHT||t.keyCode==St.KeyCode.DOWN)){s(!0);var n=m.getSheetConfigurationData(),i=n.gridPreferencesData.isSnapToGrid();switch(i&&n.gridPreferencesData.setSnapToGrid(!1),D=N.clone(),t.keyCode){case St.KeyCode.LEFT:O.x=D.x-n.keyboardMoveStepOffset,O.y=D.y;break;case St.KeyCode.UP:O.x=D.x,O.y=D.y-n.keyboardMoveStepOffset;break;case St.KeyCode.RIGHT:O.x=D.x+n.keyboardMoveStepOffset,O.y=D.y;break;case St.KeyCode.DOWN:O.x=D.x,O.y=D.y+n.keyboardMoveStepOffset}p=!0,m.moveConstraint.alignment.nk=!0;var r=m.getScreenToSheetTransform();f&&(e(r,t.altKey,t.ctrlKey,t.shiftKey,!0),y.enableCommand("HoverHighlightCommand",!0),h(t.altKey,t.ctrlKey,t.shiftKey),H(),o?(d.deactivateCursor(St.CursorID.MOVE),o=null):g&&(d.deactivateCursor(St.CursorID.MOVEENTIRECON),g=null),!0===k&&(d.deactivateCursor(St.CursorID.MOVEREJECT),k=!1),
m.moveConstraint.alignment.nk=!1,i&&n.gridPreferencesData.setSnapToGrid(!0))}})},z.prototype.execute=function(t){},ht.inheritedBy(z),Y.prototype.setId=function(t){this.VM=t},Y.prototype.getId=function(){return this.VM},Y.prototype.EM=function(){var t,n,i,r=this.getOwner();if(r&&r.getSession){var s=r.getSession();if(s&&this.isHiddenByLod(s))return t}return(t=this.VM)>=Tt.NorthwestResize&&t<=Tt.WestResize&&r&&r.getXform&&(i=(n=r.getXform()).getM0(),s=n.getM1(),r=n.getM3(),i===n.getM4()&&s===-r||(n=n.append(St.Matrix.flipX),t===Tt.NorthwestResize?t=Tt.SouthwestResize:t===Tt.SouthwestResize?t=Tt.NorthwestResize:t===Tt.NorthResize?t=Tt.SouthResize:t===Tt.SouthResize?t=Tt.NorthResize:t===Tt.NortheastResize?t=Tt.SoutheastResize:t===Tt.SoutheastResize&&(t=Tt.NortheastResize)),r=180*Math.acos(n.getM0())/Math.PI,0<(r=0<=180*Math.asin(n.getM1())/Math.PI?r:360-r
)&&r<=22.5?t+=0:22.5<r&&r<=67.5?t+=1:67.5<r&&r<=112.5?t+=2:112.5<r&&r<=157.5?t+=3:157.5<r&&r<=202.5?t+=4:202.5<r&&r<=247.5?t+=5:247.5<r&&r<=292.5?t+=6:292.5<r&&r<=337.5?t+=7:337.5<r&&r<=360&&(t+=0),t>Tt.WestResize&&(t-=9,t+=1)),t},Y.prototype.setOwner=function(t){this.ey=t},Y.prototype.getOwner=function(){return this.ey},Y.prototype.isVisible=function(){var t=this.ey;return t&&t.isVisible?this.HM&&t.isVisible():this.HM},Y.prototype.setVisible=function(t){this.HM=t},Y.prototype.isSelectable=function(){return this.LM},Y.prototype.setSelectable=function(t){this.LM=t},Y.prototype.setStyle=function(t){this.FM=t},Y.prototype.getStyle=function(){return this.FM},Y.prototype.setGeometry=function(t){this.IM=t},Y.prototype.getGeometry=function(){return this.IM},Y.prototype.ik=function(t,n){},Y.prototype.render=function(t,n){this.rk(t,n)},Y.prototype.rk=function(t,n,i){var r,s,u,h,e;this.isVisible()&&(r=this.FM,this.IM&&r&&(s=r.lineWidth,u=r.vectorEffect,r.vectorEffect&&this.sk(
)&&t.adjustStrokeWidthWithZoomRatio(r),(e=this.getOwner())&&null!=e.guid&&(h=n[e.guid]),this.uk(t,this.IM,r,h,i),r.lineWidth=s,r.vectorEffect=u))},Y.prototype.uk=function(t,n,i){},Y.prototype.select=function(t){return!1},Y.prototype.hk=function(){return null},Y.prototype.isHiddenByLod=function(t){var n=!1,i=this.getOwner();return n=i&&t.ek(t.ok(),i)?!0:n},Y.prototype.fk=function(){return!1},Y.prototype.sk=function(){var t=this.getOwner();return!t||t.getSizeCoordinateMode()===St.ElementCoordinateMode.Sheet},Y.prototype.ak=function(){var t=this.getOwner();if(t&&t.getElementType){t=t.getElementType();if(t!==St.ElementType.DEFAULT&&t!==St.ElementType.FEATURE)return!0}return!1},Y.prototype.getRenderCanvas=function(t){if(this.ak()){var n=this.getOwner().ck()+St.Constants.CANVAS_ID_SUFFIX_FOR_TEMPGEO;return t.lk(n)}
n=St.Constants.CANVAS_ID_PREFIX_FOR_SYSTEM+St.Constants.CANVAS_ID_FOR_DEFAULT+St.Constants.CANVAS_ID_FOR_SIZE_ON_SHEET+St.Constants.CANVAS_ID_SUFFIX+St.Constants.CANVAS_ID_SUFFIX_FOR_TEMPGEO;return t.lk(n)},Dt.common.IdentifiableObject.inheritedBy(Y),et.prototype.uk=function(t,n,i){var r,s,u;n&&0<n.length&&(s=!!(r=this.getOwner())&&r.vk(),this.WM&&(u=(u=r.getGeometry())?u.getLastPoint():null,s||!u||u.equal(n[0])||(n=this.WM.wk())),t.renderPath(n,i,null,r?r.getConnectionDisplayOption():null))},et.prototype.select=function(t){if(this.isSelectable()){var n=this.getGeometry(),i=this.getOwner();if(i&&i.vk())return _t.Polyline.dk(t.point,n,i.getConnectionDisplayOption(),t.tolerance);if(i){var r=i.getLines(),s=r.length;if(r&&0<s)for(var u=0;u<s;u++)if(r[u].distanceFromPoint(t.point)<t.tolerance)return!0}}return!1},et.prototype.isHiddenByLod=function(t){return!1},et.prototype.fk=function(){return!0},Y.inheritedBy(et),ot.prototype.uk=function(t,n,i){var r,s=this.getOwner().getGeometry();!s||(
r=s.getLastPoint())&&(s=new St.Point(n.getCenterX(),n.getCenterY()),n=n.clone(),r.equal(s)||(n.x+=r.x-s.x,n.y+=r.y-s.y),t.renderEllipse(n,i),s=new St.Line(new St.Point(n.x+(2-Math.sqrt(2))*n.width/4,n.y+(2-Math.sqrt(2))*n.height/4),new St.Point(n.x+(2+Math.sqrt(2))*n.width/4,n.y+(2+Math.sqrt(2))*n.height/4)),n=new St.Line(new St.Point(n.x+(2-Math.sqrt(2))*n.width/4,n.y+(2+Math.sqrt(2))*n.height/4),new St.Point(n.x+(2+Math.sqrt(2))*n.width/4,n.y+(2-Math.sqrt(2))*n.height/4)),t.renderLines([s,n],i))},ot.prototype.select=function(t,n){if(this.isSelectable()){var i=this.getGeometry();if(i.isPointInside(t,n)){var r=t.x-i.getCenterX(),n=t.y-i.getCenterY(),t=180*Math.atan(n/r)/Math.PI,i=180*Math.atan(i.height/i.width)/Math.PI,r=Math.abs(t)>=i?0<=n?St.Vector.PositiveY:St.Vector.NegativeY:0<=r?St.Vector.PositiveX:St.Vector.NegativeX;return this.zM(r),!0}}return!1},Y.inheritedBy(ot);function B(t){if(t){t=t.getConnectionDirection();if(0===t.x&&0===t.y)return!0}return!1}ft.prototype.mk=function(){
return{}},ft.prototype.gk=function(t,n){},ft.prototype.findPaths=function(t){for(var n={},i=0,r=t.length;i<r;i++){var s=t[i];n[s.connection.guid]=this.Mk(s)}return n},ft.prototype.Mk=function(t){var n=t.connection.getSession().getSheetConfigurationData();return this.minSegmentLength=n.minSegmentLength,(t.pk?n.autoRoutingTypeForPreview:n.autoRoutingType)!==St.ConnectionAutoRoutingType.StraightLine?this.bk(t):this.kk(t)},ft.prototype.bk=function(t){var n,i,r,s,u,h=t.connection,e=h.getSession().getSheetConfigurationData().minNodeToEdgeDist,o=e>this.minSegmentLength?e:this.minSegmentLength,f=[],a=t.yk,c=h.getStart(),e=h.getEnd(),c=B(c),e=B(e);return a==St.RoutingReason.Created?(i=t.startPoint,r=t.endPoint,f=[i],!(s=t.xk)||1!=s.length||c||h.vk()||(u=new St.Point(i.x+o*s[0].x,i.y+o*s[0].y),f.push(u)),!(n=t.Ek)||1!=n.length||e||h.vk()||(u=new St.Point(r.x+o*n[0].x,r.y+o*n[0].y),f.push(u)),f.push(r)):a&St.RoutingReason.StartPointMoved?(n=t.Ck,i=t.Nk,r=t.Ok===n.length-1?t.endPoint:t.Dk,f=[i],(
s=t._k)&&1==s.length&&!c&&(u=new St.Point(i.x+o*s[0].x,i.y+o*s[0].y),f.push(u)),f.push(r)):a&St.RoutingReason.EndPointMoved&&(i=t.Nk,r=0===t.Ok?t.startPoint:t.Dk,f=[i],(s=t._k)&&1==s.length&&!e&&(u=new St.Point(i.x+o*s[0].x,i.y+o*s[0].y),f.push(u)),f.push(r)),St.CommonUtil.removeCollinearPoints(f),f},ft.prototype.kk=function(t){var n=t.startPoint,i=t.endPoint,r=t.Sk,s=t.Tk,u=null;!r||(h=t.xk)&&0<h.length&&(u=h[0]);var h=null;!s||(s=t.Ek)&&0<s.length&&(h=s[0]);h=this.Ak(n,i,u,h);return t.yk=St.RoutingReason.Created,h},ft.prototype.Ak=function(t,n,i,r){var s=[t];return i&&!i.equal({x:0,y:0})&&s.push(St.MathUtil.getExtensionPoint(t,i,this.minSegmentLength)),r&&!r.equal({x:0,y:0})&&s.push(St.MathUtil.getExtensionPoint(n,r,this.minSegmentLength)),s.push(n),St.CommonUtil.removeCollinearPoints(s),s};var at={elementCreating:"mousemove",elementCreated:["mb1click","SDF_tap"],transformDelta:"mousemove",elementCreatingForDrag:"dragenter",elementCreatedForDrag:"drop",
transformDeltaForDrag:"dragover"};at.flip=St.KeyCode.F,at.rotation=St.KeyCode.R,at.connectionAttaching="mousemove",at.connectionCreating="SDF_dragstart",at.connectionGeomoryChange="mouseup",at.connectionCreated="mb1dblclick",at.connectionAttachingOnTouch=["touchmove","pointermove"],at.connectionCreatingOnTouch="SDF_touchdragstart";function Z(t){if(t.pageX!==t.screenX||t.pageY!==t.screenY){if(!X){for(var n=$.length,i=0;i<n;i++)$[i](t);X=!0}}else X=!1}function U(t){X=!1}function G(t,n,i){var r,s,u,h,e,o;"mb1click"===n?t.bind("SDF_click",function(t){0===t.button&&i(t)}):"mb2up"===n?t.bind("mouseup",function(t){1===t.button&&i(t)}):"mb3down"===n?t.bind("mousedown",function(t){2===t.button&&i(t)}):"mouseenter"===n?($.push(i),t.bind("mousemove",Z),t.bind("mouseout",U)):isNaN(n)?"mb1dblclick"===n?t.bind("dblclick",function(t){0===t.button&&i(t)}):"SDF_dragstart"===n?(u=!1,r=void 0,s=window.PointerEvent?["pointerdown","pointermove","pointerup"]:["mousedown","mousemove","mouseup"],t.bind(s[0],
function(t){"touch"!==(t.originalEvent||t).pointerType&&0==t.button&&(u=!0,r=t)}),t.bind(s[1],function(t){u&&(r.pageX===t.pageX&&r.pageY===t.pageY||(i(r),u=!1,r=void 0))}),t.bind(s[2],function(t){"touch"!==(t.originalEvent||t).pointerType&&0==t.button&&(u=!1,r=void 0)})):"SDF_touchdragstart"===n?(u=!1,t.bind("touchstart",function(t){t=t.originalEvent.touches;1===t.length&&(u=!0,h=t[0].pageX,e=t[0].pageY)}),t.bind("touchmove",function(t){var n;u&&(n=t.originalEvent.touches[0],h===n.pageX&&e===n.pageY||(i(t),u=!1))}),t.bind("touchend",function(t){u=!1}),o=0,t.bind("pointerdown",function(t){"touch"===t.originalEvent.pointerType&&(1===++o?(u=!0,h=t.pageX,e=t.pageY):u=!1)}),t.bind("pointermove",function(t){u&&(t.pageX==h&&t.pageY==e||(i(t),u=!1))}),t.bind("pointerup",function(t){"touch"===t.originalEvent.pointerType&&(o=0,u=!1)})):t.bind(n,function(t){i(t)}):t.bind("keydown",function(t){t.keyCode===n&&i(t)})}var X=!(at.connectionGeomoryChangeOnTouch=["touchend","pointerup"]),$=[]
;function q(){}q.prototype.register=function(t,n,i){if(n&&t&&i)if(Dt.common.ArrayHelper.isArrayType(n))for(var r=n.length,s=0;s<r;s++)G(t,n[s],i);else G(t,n,i)};var ct=new q;function K(){ht.call(this)}K.prototype.hook=function(o,k){ht.prototype.hook.call(this,o,k);var a=this,c=null,e=null,h=null,l=null,v=null,y=null,x=null,E=null,C=null,N=null,w=null,O=null,D=null,_=null,S=null,d=[],f=!1,m=!1,g=!1,M=!1,p=!1,u=(k.getSheetSession().getCursorConfiguration(),null),b=function(){_=D=O=w=N=null},T=function(){C=E=x=y=v=l=null,b(),S=null,d=[],c&&(c.setOwner(null),c=null),p=M=m=f=!1,u=h=e=null,o.deactivateCursor(St.CursorID.CREATECON)},A=function(t,n,i,r,s){var u,h,e,o,f,a,c=k.getSheet();return c&&(h=(a=c.getSession()).CM(),e=k.getSheetConfigurationData(),o=k.moveConstraint.attachingUtil,(s=new At.ElementCreatingEventArgs(t,n,i,r,s)).setPrioritizedAlignmentModes(e.alignmentPriority),o.locIndicatorUtil.enabled&&o.locIndicatorUtil.selectedIndicator&&((f=o.locIndicatorUtil.selectedIndicator.Rk
)&&s.setLocationIndicatorInfo(f)),f=new Dt.messages.EventMessage(s,At.EventType.OnElementCreating),h.BM(f)?s.isHandled()&&(u=s.getNewSheetElement()):n instanceof _t.Port&&(h.beginTransaction(Dt.messages.ModelChangeMessage),(u=new _t.Connection(c)).setOwner(c),c.addSheetElement(u),u.setStart(n,!0),u.setEndLocation(new _t.Location(t.x,t.y),!0),c=c.getPreferences(),u.setConnectionDisplayOption(c.getConnectionDisplayOption()),null!=(a=a.getSheetConfigurationData().defaultArrowheadShape)&&(a=new _t.Arrow(a),a=new _t.SymbolOccurrence(null,null,a),u.setStartArrow(a)),h.endTransaction())),u},R=function(t,n,i,r,s){var u=k.getSheet();if(!u)return!1;u=u.getSession(),r=new At.GeometryChangeEventArgs(t,n,i,r,s),s=new Dt.messages.EventMessage(r,At.EventType.OnGeometryChange);return!u.CM().BM(s)||!r.isCancelled()},P=function(){var t=d.length;if(1<t){var n=d[t-1],i=d[t-2];if(0!==St.MathUtil.doubleCompare(n.x,i.x)&&0!==St.MathUtil.doubleCompare(n.y,i.y))return!0;if(2<t){t=d[t-3];if(
0!==St.MathUtil.doubleCompare(t.x,i.x)&&0!==St.MathUtil.doubleCompare(t.y,i.y))return!0}}return!1},H=function(t,n,i,r,s,u){var h=null;if(V())return tt(x,O,E,D);if(!F()){var e=Z(),o=x;0<e.length&&(o=e[e.length-1]);var f=null;return e.length<2&&(f=E),tt(o,i,f,r)}o=t.getSession().dM();return o&&(f=t.getEndPoint(),(t=o.Pk(t,t.getStartPoint(),f||i,t.getStart(),t.getEnd()))&&(1<(e=(e=Z()).length)?t=o.Hk(t,t.Ck,i,r):(t.endPoint=i,t.Ek=[r],u&&(t.Lk=u)),s&&r&&(t.Ek=[r],u&&(t.Lk=u),t.attachingTargetPort=N,t.attachingTargetNode=w),t.Ik=P(),h=o.fs(t),1<e&&h.length>e&&h.splice(0,e-2))),h},L=function(t,n,i,r,s,u){var h=k.getSheet();if(!h)return null;h=h.getSession();if(!h)return null;if(t.isDefaultAutoRoutingOn())return O&&D?H(t,St.RoutingReason.EndPointMoved,O,D,!0,_):null;u=new At.ConnectionRoutingEventArgs(u);u.connections.push(t),u.reasons.push(St.RoutingReason.EndPointMoved),u.inputEndPoints=[n.x,n.y,r.x,r.y],u.directions=[i?i.x:0,i?i.y:0,s?s.x:0,s?s.y:0];s=new Dt.messages.EventMessage(u,
At.EventType.OnConnectionRouting);if(h.CM().BM(s)){for(var e=u.getConnectionRoutingResult(),o=u.getConnections(),f=0,a=o.length;f<a;f++){var c=o[f];c!==t&&(v=v||[]).push({connection:c,pathFromEvent:e[c.guid]})}return e[t.guid]}return O&&D?H(t,St.RoutingReason.EndPointMoved,O,D,!0,_):null},I=function(){var t=k.getSheetConfigurationData();return!(!t||!t.contextData.getConnectionCreationContext())},F=function(){var t=k.getSheetConfigurationData();return!t||t.contextData.getConnectionCreationRoutingType()==St.ConnectionBendControlOption.Orthogonal},V=function(){var t=k.getSheetConfigurationData();return!(!t||t.autoRoutingType!==St.ConnectionAutoRoutingType.StraightLine)},j=function(){var t=k.getSheetConfigurationData();return!(!t||!t.danglingConnectionAllowed)},W=function(){var t=20,n=k.getSheetConfigurationData();return t=n&&n.minPortExtensionDist?n.minPortExtensionDist:t},z=function(){var t=20,n=k.getSheetConfigurationData();return t=n&&n.minNodeToEdgeDist?n.minNodeToEdgeDist:t},
Y=function(){var t=20,n=k.getSheetConfigurationData();return t=n&&null!==n.minSegmentLength&&void 0!==n.minSegmentLength?n.minSegmentLength:t},B=function(t,n,i,r,s,u){var h,e,o,f;if(t?0<(f=t.getConnectionDirection()).length()&&(e=f.normalize(),h=t.getResolvedSymbolConnectionPoint(),o=t.getOwner().getBBox()):n&&i&&r&&0<=r.length()&&(e=r.normalize(),h=i,o=n),h&&o&&e){var a,c,l,r=new St.Point(0,0),n=k.moveConstraint.attachingUtil.cursorPt,n=o.isPointInside(n)&&o.isPointInside(s);return e.equal(St.Vector.PositiveX)?(a=h.x+W(),c=h.x+Y(),l=n?a:o.x+o.width+z(),r.x=Math.max(a,c,l),(u=u&&r.x>s.x&&s.x>i.x)&&(r.x=Math.min(r.x,s.x)),r.y=h.y):e.equal(St.Vector.PositiveY)?(a=h.y+W(),c=h.y+Y(),l=n?a:o.y+o.height+z(),r.y=Math.max(a,c,l),u&&(r.y=Math.min(r.y,s.y)),r.x=h.x):e.equal(St.Vector.NegativeX)?(a=h.x-W(),c=h.x-Y(),l=n?a:o.x-z(),r.x=Math.min(a,c,l),u&&(r.x=Math.max(r.x,s.x)),r.y=h.y):e.equal(St.Vector.NegativeY)?(a=h.y-W(),c=h.y-Y(),l=n?a:o.y-z(),r.y=Math.min(a,c,l),(u=u&&r.y>s.y&&s.y>i.y)&&(
r.y=Math.max(r.y,s.y)),r.x=h.x):r=null,r}return null},Z=function(t){t=(t||l).getGeometry(),t=t?t.getPoints():[];return 2===t.length&&0===St.MathUtil.doubleCompare(t[0].x,t[1].x)&&0===St.MathUtil.doubleCompare(t[0].y,t[1].y)&&t.pop(),t},U=function(t){t=(t||l).getConnectionRender().getPointsAfterTrim();return 2===t.length&&0===St.MathUtil.doubleCompare(t[0].x,t[1].x)&&0===St.MathUtil.doubleCompare(t[0].y,t[1].y)&&t.pop(),t},G=function(){var t,n;S||(t=Z(),n=x,0<t.length&&(n=t[t.length-1]),t=O.x-n.x,n=O.y-n.y,S=0<=St.MathUtil.doubleCompare(Math.abs(t),Math.abs(n))?"HV":"VH")},X=function(t){var n,i,r,s=Z(),u=x;0<s.length&&(u=s[s.length-1]),e?((i=s[s.length-2])&&(n=(n=new St.Vector(i.x-u.x,i.y-u.y)).normalize()),i=(s=k.getSheetConfigurationData()).selectionPreferencesData.getSelectionRadiusPixel(),s=s.viewData.getScaleFactor(),e.select(O,i/s)?(h=e.YM()).equal(St.Vector.PositiveX)||h.equal(St.Vector.NegativeX)?S="HV":h.equal(St.Vector.PositiveY)||h.equal(St.Vector.NegativeY
)?S="VH":n&&h.equal(n)&&(S=null):n?(h&&0===St.Vector.cross(h,n)||!h&&S)&&(u=t?(r=t.x-u.x,t.y-u.y):(r=O.x-u.x,O.y-u.y),n.equal(St.Vector.PositiveY)?S=0!==r&&0<u?"HV":"VH":n.equal(St.Vector.NegativeY)?S=0!==r&&u<0?"HV":"VH":n.equal(St.Vector.PositiveX)?S=0!==u&&0<r?"VH":"HV":n.equal(St.Vector.NegativeX)&&(S=0!==u&&r<0?"VH":"HV")):G()):G()},$=function(t,n,i,r,s){var u,h,e,o,f,a,c=[];return t&&i&&(c.push(t),n.equal(St.Vector.PositiveX)?r.equal(St.Vector.NegativeY)?(o=s.x-z(),i.x>o?(h=s.y-z(),e=s.y+s.height+z(),t.y>h&&t.y<e?(c.push(new St.Point(o,t.y)),c.push(new St.Point(o,h)),c.push(new St.Point(i.x,h))):c.push(new St.Point(i.x,t.y))):c.push(new St.Point(i.x,t.y))):r.equal(St.Vector.PositiveY)?(o=s.x-z(),i.x>o?(h=s.y-z(),e=s.y+s.height+z(),t.y>h&&t.y<e?(c.push(new St.Point(o,t.y)),c.push(new St.Point(o,e)),c.push(new St.Point(i.x,e))):c.push(new St.Point(i.x,t.y))):c.push(new St.Point(i.x,t.y))):r.equal(St.Vector.NegativeX)?(u=i.x-s.x+z(),c.push(new St.Point(i.x-u,t.y)),c.push(
new St.Point(i.x-u,i.y))):(u=s.x+s.width-i.x+z(),i.x+u>t.x?(c.push(new St.Point(i.x+u,t.y)),c.push(new St.Point(i.x+u,i.y))):c.push(new St.Point(t.x,i.y))):n.equal(St.Vector.NegativeX)?r.equal(St.Vector.NegativeY)?(f=s.x+s.width+z(),i.x<f?(h=s.y-z(),e=s.y+s.height+z(),t.y>h&&t.y<e?(c.push(new St.Point(f,t.y)),c.push(new St.Point(f,h)),c.push(new St.Point(i.x,h))):c.push(new St.Point(i.x,t.y))):c.push(new St.Point(i.x,t.y))):r.equal(St.Vector.PositiveY)?(f=s.x+s.width+z(),i.x<f?(h=s.y-z(),e=s.y+s.height+z(),t.y>h&&t.y<e?(c.push(new St.Point(f,t.y)),c.push(new St.Point(f,e)),c.push(new St.Point(i.x,e))):c.push(new St.Point(i.x,t.y))):c.push(new St.Point(i.x,t.y))):r.equal(St.Vector.PositiveX)?(u=s.x+s.width-i.x+z(),c.push(new St.Point(i.x+u,t.y)),c.push(new St.Point(i.x+u,i.y))):(u=i.x-s.x+z(),i.x-u<t.x?(c.push(new St.Point(i.x-u,t.y)),c.push(new St.Point(i.x-u,i.y))):c.push(new St.Point(t.x,i.y))):n.equal(St.Vector.PositiveY)?r.equal(St.Vector.NegativeX)?(h=s.y-z(),i.y>h?(o=s.x-z(),
f=s.x+s.width+z(),t.x>o&&t.x<f?(c.push(new St.Point(t.x,h)),c.push(new St.Point(o,h)),c.push(new St.Point(o,i.y))):c.push(new St.Point(t.x,i.y))):c.push(new St.Point(t.x,i.y))):r.equal(St.Vector.PositiveX)?(h=s.y-z(),i.y>h?(o=s.x-z(),f=s.x+s.width+z(),t.x>o&&t.x<f?(c.push(new St.Point(t.x,h)),c.push(new St.Point(f,h)),c.push(new St.Point(f,i.y))):c.push(new St.Point(t.x,i.y))):c.push(new St.Point(t.x,i.y))):r.equal(St.Vector.NegativeY)?(a=i.y-s.y+z(),c.push(new St.Point(t.x,i.y-a)),c.push(new St.Point(i.x,i.y-a))):(a=s.y+s.height-i.y+z(),i.y+a>t.y?(c.push(new St.Point(t.x,i.y+a)),c.push(new St.Point(i.x,i.y+a))):c.push(new St.Point(i.x,t.y))):n.equal(St.Vector.NegativeY)&&(r.equal(St.Vector.NegativeX)?(e=s.y+s.height+z(),i.y<e?(o=s.x-z(),f=s.x+s.width+z(),t.x>o&&t.x<f?(c.push(new St.Point(t.x,e)),c.push(new St.Point(o,e)),c.push(new St.Point(o,i.y))):c.push(new St.Point(t.x,i.y))):c.push(new St.Point(t.x,i.y))):r.equal(St.Vector.PositiveX)?(e=s.y+s.height+z(),i.y<e?(o=s.x-z(),
f=s.x+s.width+z(),t.x>o&&t.x<f?(c.push(new St.Point(t.x,e)),c.push(new St.Point(f,e)),c.push(new St.Point(f,i.y))):c.push(new St.Point(t.x,i.y))):c.push(new St.Point(t.x,i.y))):r.equal(St.Vector.PositiveY)?(a=s.y+s.height-i.y+z(),c.push(new St.Point(t.x,i.y+a)),c.push(new St.Point(i.x,i.y+a))):(a=i.y-s.y+z(),i.y-a<t.y?(c.push(new St.Point(t.x,i.y-a)),c.push(new St.Point(i.x,i.y-a))):c.push(new St.Point(i.x,t.y)))),c.push(i)),c},q=function(t,n,i){var r=!1,s=k.getSheetConfigurationData().minSegmentLength;return 0!==n.x?Math.abs(t.x-i.x)<=s&&(r=!0):0!==n.y&&Math.abs(t.y-i.y)<=s&&(r=!0),r},K=function(){var t,n,i,r,s,u,h,e,o,f,a,c,l,v,w,d,m=Z(),g=x,M=[g=0<m.length?m[m.length-1]:g],p=m.length<=1,b=k.getSheetConfigurationData();return p&&E&&0<E.length()?(t=B(null,C,x,E,g),c=0,(E=E.normalize()).equal(St.Vector.PositiveX)?(c=O.y-g.y,S=St.MathUtil.doubleCompare(t.x,O.x)<=0?(M.push(new St.Point(O.x,g.y)),"HV"):(M.push(t),Math.abs(c)>b.bendVerticaltolerance&&M.push(new St.Point(t.x,O.y)),"VH")
):E.equal(St.Vector.PositiveY)?(c=O.x-g.x,S=St.MathUtil.doubleCompare(t.y,O.y)<=0?(M.push(new St.Point(g.x,O.y)),"VH"):(M.push(t),Math.abs(c)>b.bendVerticaltolerance&&M.push(new St.Point(O.x,t.y)),"HV")):E.equal(St.Vector.NegativeX)?(c=O.y-g.y,S=0<=St.MathUtil.doubleCompare(t.x,O.x)?(M.push(new St.Point(O.x,g.y)),"HV"):(M.push(t),Math.abs(c)>b.bendVerticaltolerance&&M.push(new St.Point(t.x,O.y)),"VH")):E.equal(St.Vector.NegativeY)&&(c=O.x-g.x,S=0<=St.MathUtil.doubleCompare(t.y,O.y)?(M.push(new St.Point(g.x,O.y)),"VH"):(M.push(t),Math.abs(c)>b.bendVerticaltolerance&&M.push(new St.Point(O.x,t.y)),"HV")),D&&0<D.length()?y===N?M=[]:(p=B(null,_,O,D,g,!0),D=D.normalize(),l=new St.Vector(0,0),2===(w=M.length)?l=E:3===w&&("HV"==S?l.x=M[2].x>=M[1].x?1:-1:"VH"==S&&(l.y=M[2].y>=M[1].y?1:-1)),w=new St.Vector(0,0),E.equal(St.Vector.PositiveX)?"HV"==S?0<=St.MathUtil.doubleCompare(p.y,t.y)?D.equal(St.Vector.PositiveY)?(i=p.x-_.x+z(),0<=St.MathUtil.doubleCompare(p.x-i,t.x)?w.x=-1:w.x=1
):w.y=-1:D.equal(St.Vector.NegativeY)?(i=p.x-_.x+z(),0<=St.MathUtil.doubleCompare(p.x-i,t.x)?w.x=-1:w.x=1):w.y=1:"VH"==S&&(0<=St.MathUtil.doubleCompare(p.y,t.y)?D.equal(St.Vector.NegativeX)?(n=_.x+_.width+z(),St.MathUtil.doubleCompare(n,t.x)<=0?(s=C.y+C.height-t.y+z(),u=p.y-_.y+z(),0<=St.MathUtil.doubleCompare(p.y-u,t.y+s)?w.y=-1:w.y=1):w.y=-1):w.x=1:D.equal(St.Vector.NegativeX)?(n=_.x+_.width+z(),St.MathUtil.doubleCompare(n,t.x)<=0?(s=t.y-C.y+z(),u=_.y+_.height-p.y+z(),St.MathUtil.doubleCompare(p.y+u,t.y-s)<=0?w.y=1:w.y=-1):w.y=1):w.x=1):E.equal(St.Vector.NegativeX)?"HV"==S?0<=St.MathUtil.doubleCompare(p.y,t.y)?D.equal(St.Vector.PositiveY)?(i=_.x+_.width-p.x+z(),St.MathUtil.doubleCompare(p.x+i,t.x)<=0?w.x=1:w.x=-1):w.y=-1:D.equal(St.Vector.NegativeY)?(i=_.x+_.width-p.x+z(),St.MathUtil.doubleCompare(p.x+i,t.x)<=0?w.x=1:w.x=-1):w.y=1:"VH"==S&&(0<=St.MathUtil.doubleCompare(p.y,t.y)?D.equal(St.Vector.PositiveX)?(r=_.x-z(),0<=St.MathUtil.doubleCompare(r,t.x)?(s=C.y+C.height-t.y+z(),
u=p.y-_.y+z(),0<=St.MathUtil.doubleCompare(p.y-u,t.y+s)?w.y=-1:w.y=1):w.y=-1):w.x=-1:D.equal(St.Vector.PositiveX)?(r=_.x-z(),0<=St.MathUtil.doubleCompare(r,t.x)?(s=t.y-C.y+z(),u=_.y+_.height-p.y+z(),St.MathUtil.doubleCompare(p.y+u,t.y-s)<=0?w.y=1:w.y=-1):w.y=1):w.x=-1):E.equal(St.Vector.NegativeY)?"VH"==S?0<=St.MathUtil.doubleCompare(p.x,t.x)?D.equal(St.Vector.PositiveX)?(e=_.y+_.height-p.y+z(),St.MathUtil.doubleCompare(p.y+e,t.y)<=0?w.y=1:w.y=-1):w.x=-1:D.equal(St.Vector.NegativeX)?(e=_.y+_.height-p.y+z(),St.MathUtil.doubleCompare(p.y+e,t.y)<=0?w.y=1:w.y=-1):w.x=1:"HV"==S&&(0<=St.MathUtil.doubleCompare(p.x,t.x)?D.equal(St.Vector.PositiveY)?(h=_.y-z(),0<=St.MathUtil.doubleCompare(h,t.y)?(f=C.x+C.width-t.x+z(),a=p.x-_.x+z(),0<=St.MathUtil.doubleCompare(p.x-a,t.x+f)?w.x=-1:w.x=1):w.x=-1):w.y=-1:D.equal(St.Vector.PositiveY)?(h=_.y-z(),0<=St.MathUtil.doubleCompare(h,t.y)?(f=t.x-C.x+z(),a=_.x+_.width-p.x+z(),St.MathUtil.doubleCompare(p.x+a,t.x-f)<=0?w.x=1:w.x=-1):w.x=1):w.y=-1):E.equal(
St.Vector.PositiveY)&&("VH"==S?0<=St.MathUtil.doubleCompare(p.x,t.x)?D.equal(St.Vector.PositiveX)?(e=p.y-_.y+z(),0<=St.MathUtil.doubleCompare(p.y-e,t.y)?w.y=-1:w.y=1):w.x=-1:D.equal(St.Vector.NegativeX)?(e=p.y-_.y+z(),0<=St.MathUtil.doubleCompare(p.y-e,t.y)?w.y=-1:w.y=1):w.x=1:"HV"==S&&(0<=St.MathUtil.doubleCompare(p.x,t.x)?D.equal(St.Vector.NegativeY)?(o=_.y+_.height+z(),St.MathUtil.doubleCompare(o,t.y)<=0?(f=C.x+C.width-t.x+z(),a=p.x-_.x+z(),0<=St.MathUtil.doubleCompare(p.x-a,t.x+f)?w.x=-1:w.x=1):w.x=-1):w.y=1:D.equal(St.Vector.NegativeY)?(o=_.y+_.height+z(),St.MathUtil.doubleCompare(o,t.y)<=0?(f=t.x-C.x+z(),a=_.x+_.width-p.x+z(),St.MathUtil.doubleCompare(p.x+a,t.x-f)<=0?w.x=1:w.x=-1):w.x=1):w.y=1)),(M=$(t,l,p,w,_)).unshift(g),M.push(O)):Math.abs(c)>b.bendVerticaltolerance&&M.push(O)):(c=B(null,_,O,D,g,!0),X(c),D&&0<D.length()&&!q(O,D,g)?c.equal(g)||(D=D.normalize(),l=new St.Vector(0,0),"HV"==S?l.x=c.x>g.x?1:-1:"VH"==S&&(l.y=c.y>g.y?1:-1),w=new St.Vector(0,0),
"HV"==S?c.x>=g.x?c.y>=g.y?D.equal(St.Vector.PositiveY)?w.x=-1:w.y=-1:D.equal(St.Vector.NegativeY)?w.x=-1:w.y=1:c.y>=g.y?D.equal(St.Vector.PositiveY)?w.x=1:w.y=-1:D.equal(St.Vector.NegativeY)?w.x=1:w.y=1:"VH"==S&&(c.x>=g.x?c.y>=g.y?D.equal(St.Vector.PositiveX)?w.y=-1:w.x=-1:D.equal(St.Vector.PositiveX)?w.y=1:w.x=-1:c.y>=g.y?D.equal(St.Vector.NegativeX)?w.y=-1:w.x=1:D.equal(St.Vector.NegativeX)?w.y=1:w.x=1),(M=$(g,l,c,w,_)).push(O)):((w=m[m.length-2])&&(v=(v=new St.Vector(w.x-g.x,w.y-g.y)).normalize()),m=O.x-g.x,w=O.y-g.y,"HV"==S?Math.abs(m)>b.bendVerticaltolerance?(M.push(new St.Point(O.x,g.y)),Math.abs(w)>b.bendVerticaltolerance&&M.push(O)):(Math.abs(w)>b.bendVerticaltolerance&&M.push(new St.Point(g.x,O.y)),d=(d=new St.Vector(0,O.y-g.y)).normalize(),v&&v.equal(d)&&(M=[])):"VH"==S?Math.abs(w)>b.bendVerticaltolerance?(M.push(new St.Point(g.x,O.y)),Math.abs(m)>b.bendVerticaltolerance&&M.push(O)):(Math.abs(m)>b.bendVerticaltolerance&&M.push(new St.Point(O.x,g.y)),d=(d=new St.Vector(O.x-g.x
,0)).normalize(),v&&v.equal(d)&&(M=[])):M=[])),M},J=function(t){var n=O.x-t.x,i=O.y-t.y,n=180*Math.atan(n/i)/Math.PI,i=k.getSheet().getPreferences().getSegmentAngleTolerance();Math.abs(n)<=i?O.x=t.x:Math.abs(Math.abs(n)-90)<=i&&(O.y=t.y)},Q=function(t){var n=t.getConnectionDirection(),n=t.getXform().transformVector(n);return 0===St.MathUtil.doubleCompare(n.x,0)&&0!==n.x&&(n.x=0),0===St.MathUtil.doubleCompare(n.y,0)&&0!==n.y&&(n.y=0),n},tt=function(t,n,i,r){(u=u||new ft).minSegmentLength=Y();var s=Z(),i=y&&s.length<2?Q(y):i,r=N&&s.length<2?Q(N):r;return u.Ak(t,n,i,r)},nt=function(){var t=[],n=Z(),i=x;if(0<n.length&&(i=n[n.length-1]),V())return tt(x,O,E,D);if(F()){if(0===St.MathUtil.doubleCompare(O.x,i.x)&&0===St.MathUtil.doubleCompare(O.y,i.y))return t;var r=L(l,x,E,O,D,!0),t=r||K();l.Fk(t);var s=k.getSheetConfigurationData().connectionCaptureAlignmentTolerance,u=t.length;2<u&&(r=t[u-3],u=t[u-2],0===St.MathUtil.doubleCompare(r.x,u.x)&&0===St.MathUtil.doubleCompare(O.y,u.y)?Math.abs(
O.x-u.x)<s&&t.pop():0===St.MathUtil.doubleCompare(r.y,u.y)&&0===St.MathUtil.doubleCompare(O.x,u.x)&&Math.abs(O.y-u.y)<s&&t.pop()),O=0<t.length?t[t.length-1]:i}else O.equal(i)||k.moveConstraint.attachingUtil.isAttachingAccepted()||J(i),l.vk()?(t.push(i),t.push(O)):(s=null,n.length<2&&(s=E),t=tt(i,O,s,D));return t},r=function(){var t=k.getSheet().getSession();t.CM().beginTransaction(Dt.messages.ModelChangeMessage);var n,i=Z();if(l&&(k.moveConstraint.attachingUtil.isAttachingAccepted()||(n=l.getEndLocation())||(n=new _t.Location(O.x,O.y),l.setEndLocation(n,!0)),0<d.length&&x.equal(d[0])?l.setPath(d):l.setPath(i.concat(d))),v)for(var r=0,s=v.length;r<s;r++){var u=v[r].connection,h=v[r].pathFromEvent,e=Z(u);u.setPath(e.concat(h)),u.setUpToDate(!1)}k.setConnectionCreationOverlay(null),t.CM().endTransaction()},it=function(){c||((c=new et).WM=a,c.setOwner(l));var t=l.getRenderingProperties().toRenderStyle(),n=k.getSheetConfigurationData(),i=null;n.highlightOnPreview&&(
i=n.visualizationPreferencesData.getPreSelectionColor(),t.strokeColor=i),c.setStyle(t);var r=[c];if(l.vk()){t=[];0<d.length&&x.equal(d[0])?t=d:(t=U().concat(d.slice(1)),l.Fk(t)),c.setGeometry(t)}else if(c.setGeometry(d),v)for(var s=0,u=v.length;s<u;s++){var h=v[s].connection,e=v[s].pathFromEvent,o=new et,f=h.getRenderingProperties().toRenderStyle();i&&(f.strokeColor=i),o.WM=a,o.setOwner(h),o.setGeometry(e),r.push(o)}k.setConnectionCreationOverlay(r),k.updateOverlay(),k.moveConstraint.attachingUtil.connectionPreviewPath=d},rt=function(t){var n,i,r=k.getSheetConfigurationData();r.enableQuadrantIndicator&&t&&(n=(i=r.quadrantIndicatorStyle).lineWidth,r=r.visualizationPreferencesData.getPreSelectionColor(),i=new St.Rect(t.x-i.width/2,t.y-i.height/2,i.width,i.height),e?e.setGeometry(i):(e=new ot(i,r,n)).setOwner(l),k.setCursorQuadrantIndicator(e),k.updateOverlay())},st=function(t,n){var i=n&&"touch"!==t.originalEvent.pointerType?t.originalEvent.touches[0]||t.originalEvent.changedTouches[0]:t
,n=o.offset(),t=new St.Point(0,0);t.x=i.pageX-n.left,t.y=i.pageY-n.top;n=k.getScreenToSheetTransform();return t=n?n.transformPoint(t):t},ut=function(t,n){var i=k.moveConstraint.attachingUtil;i.reset(St.AttachingType.CreateConnection,l,n),i.retrieveCandidatesByPoint(n,l?St.ConnectionEnd.END:St.ConnectionEnd.START),i.getSubtype()===St.AttachingType.ConnectionEndAttachToPort?N=i.attachingElement.targetElement:w=i.getSubtype()===St.AttachingType.ConnectionEndAttachToNode?i.attachingElement.targetElement:N=null},n=function(t,n){if(a.isEnabled()&&I()&&!m){if(n){if("touch"!==t.originalEvent.pointerType&&"mouse"!==t.originalEvent.pointerType)if(1!==t.originalEvent.touches.length)return;var i=st(t,!0);ut(t,i)}i=k.moveConstraint.attachingUtil;if(!n||i.isAttachingAccepted()){if(g=!(m=!0),i.isAttachingAccepted()){if(i.locIndicatorUtil.enabled)if(!i.locIndicatorUtil.selectedIndicator)return void T();var r=i.getAttachmentData();x=r.attachingPoint,E=r.directionVector,C=r.Lk;var s=i.attachingElement,
u=s.targetElement,h=s.nodeSide,e=s.segmentId,r=[s.percentX,s.percentY]}else{s=(x=st(t,!1)).clone(),t=k.moveConstraint.snap;t.isSnapSegmentActive()&&(t.snapPointToGrid(s),t.isSnapX&&(x.x+=t.snapX),t.isSnapY&&(x.y+=t.snapY))}l||((l=A(x,u,e,h,r))?((y=l.getStart())?((r=k.getSheet().getSession()).CM().beginTransaction(Dt.messages.ModelChangeMessage),x=y.getResolvedSymbolConnectionPoint(),E=y.getResolvedConnectionDirection(),C=y.getOwner().getTransformedBBox(),l.setPath([x.clone(),x.clone()]),r.CM().endTransaction()):rt(x),b(),p=M=!1,o.activateCursor(St.CursorID.CREATECON),l.isInCreating=!0):T())}}};this.wk=function(){return nt()},ct.register(o,at.connectionAttaching,function(t){var n;a.isEnabled()&&I()&&(t.buttons&&!l||(n=st(t,!1),ut(t,n)))}),ct.register(o,at.connectionCreating,function(t){n(t,!1)}),ct.register(o,at.connectionGeomoryChange,function(t){if(a.isEnabled()&&I()&&m&&f){var n,i=k.moveConstraint.attachingUtil;if(i.isAttachingAccepted()){if(i.locIndicatorUtil.enabled)if(
!i.locIndicatorUtil.selectedIndicator)return;(n=L(l,x,E,O,D,!1))&&(d=n),r(),k.moveConstraint.attachingUtil.sendAttachedEvent(O),k.getSheetConfigurationData().overviewWindowData.getDisplayWindow()&&k.getViewportManager().Vk(),l&&(l.isInCreating=!1),T(),g=!0}else(n=L(l,x,E,O,D,!1))&&(d=n),r(),j()&&(R(l,St.ChangePhase.ENDED,St.ConnectionEndAttachment.NOCHANGE,St.ConnectionEndAttachment.NOCHANGE,null),k.getSheetConfigurationData().overviewWindowData.getDisplayWindow()&&k.getViewportManager().Vk()),p=M=!1,rt(O),f=!1}}),ct.register(o,at.connectionAttachingOnTouch,function(t){if(a.isEnabled()&&I()){if("touch"!==t.originalEvent.pointerType){if("mouse"===t.originalEvent.pointerType)return;if(1!==t.originalEvent.touches.length)return}var n=st(t,!0);ut(t,n)}}),ct.register(o,at.connectionCreatingOnTouch,function(t){n(t,!0)}),ct.register(o,at.connectionGeomoryChangeOnTouch,function(t){if(a.isEnabled()&&I()&&m&&f){if("touch"!==t.originalEvent.pointerType){if("mouse"===t.originalEvent.pointerType
)return;if(1!==t.originalEvent.changedTouches.length)return}var n=st(t,!0);ut(t,n),k.moveConstraint.attachingUtil.isAttachingAccepted()?(n=k.moveConstraint.attachingUtil.getAttachmentData(),O=n.attachingPoint,r(),k.moveConstraint.attachingUtil.sendAttachedEvent(O),k.getSheetConfigurationData().overviewWindowData.getDisplayWindow()&&k.getViewportManager().Vk(),l&&(l.isInCreating=!1),T(),g=!0):(O=st(t,!0),d=nt(),it(),r(),rt(O))}});function i(t,n){var i,r,s,u,h;I()?a.isEnabled()&&l&&m&&!g&&(f=!0,i=j(),M||(i&&!R(l,St.ChangePhase.STARTING,St.ConnectionEndAttachment.NOCHANGE,St.ConnectionEndAttachment.NOCHANGE,null)&&(p=!0),M=!0),p||(_=k.moveConstraint.attachingUtil.isAttachingAccepted()?(r=k.moveConstraint.attachingUtil.getAttachmentData(),O=r.attachingPoint,D=r.directionVector,r.Lk):(s=(O=st(t,n)).clone(),(u=k.moveConstraint.snap).isSnapSegmentActive()&&(u.snapPointToGrid(s),u.isSnapX&&(O.x+=u.snapX),u.isSnapY&&(O.y+=u.snapY)),D=null),F()&&X(),1<=(n=Z()).length&&e&&(s=n[n.length-1],
u=e.getGeometry(),s.x===u.getCenterX()&&s.y===u.getCenterY()||rt(s)),n.length<=1&&(!y||(h=_t.Connection.getReversedConnectionDirection(y,E,x,O))&&(E=h)),h=nt(),i&&!R(l,St.ChangePhase.DELTA,St.ConnectionEndAttachment.NOCHANGE,St.ConnectionEndAttachment.NOCHANGE,h)||(d=h,it()))):f&&(T(),g=!0)}o.bind("mousemove pointermove",function(t){var n=(t.originalEvent||t).pointerType;void 0===n||"mouse"===n?i(t,!1):"touch"===n&&i(t,!0)}),o.bind("touchmove",function(t){i(t,!0)}),this.cleanup=function(){var t=k.getSheet().getSession();t.CM().beginTransaction(Dt.messages.ModelChangeMessage),l&&(l.setUpToDate(!1),l.isInCreating=!0),k.setConnectionCreationOverlay(null),k.setCursorQuadrantIndicator(null),t.CM().endTransaction(),l&&(l.isInCreating=!1),l=void 0,T(),k.moveConstraint.attachingUtil.showCandidates(null),k.moveConstraint.attachingUtil.reset(),k.moveConstraint.attachingUtil.clearAttachingCursor()}},ht.inheritedBy(K);var nt=[];function it(){ht.call(this)}it.prototype.hook=function(s,e){
ht.prototype.hook.call(this,s,e);var o,h,f,n,u,a=this,c=!1,l=!1,v=!1,w=function(t,n){if(t)if(n){t.inCreationContext=!0;for(var i=(u=e.getChildrenAndMembersDuringCreation(t)).length,r=0;r<i;r++)u[r].inCreationContext=!0,e.highlightConnectionDuringBulkCreation(u[r],n)}else{t.inCreationContext&&delete t.inCreationContext;for(i=u?u.length:0,r=0;r<i;r++)u[r].inCreationContext&&delete u[r].inCreationContext,e.highlightConnectionDuringBulkCreation(u[r],n);u=null}},d=function(t){var n=e.getSheet();if(n){var i=n.getSession(),r=e.getSheetConfigurationData(),t=new At.ElementCreatingEventArgs(t);t.setPrioritizedAlignmentModes(r.alignmentPriority),t.sheet=n,v=!1;n=new Dt.messages.EventMessage(t,At.EventType.OnElementCreating),n=i.CM().BM(n);if(o=void 0,n&&t.isHandled()){n=t.getNewSheetElement();if(n)return w(n,!0),l=!0,e.moveConstraint.ZM(t),n}}},m=function(t,n,i){var r=e.getSheet();if(!r)return!1;var s=r.getSession().CM();n&&(s.beginTransaction(Dt.messages.ModelChangeMessage),w(n,!1),
n.setUpToDate(!1),l=!1,s.endTransaction()),v=!0;r=e.moveConstraint.alignment.generateAlignmentData(),i=new At.ElementCreatedEventArgs(t,n,i);i.setAlignmentData(r);r=new Dt.messages.EventMessage(i,At.EventType.OnElementCreated),r=s.BM(r);return v=!1,r&&i.isHandled()?i.getNewSheetElement():void 0},i=function(t,n,i){var r=e.getSheet();if(!r||!o)return!1;var s=n.getAnchorPosition(),u=n.tk();h=u.isLockX?0:t.x-s.x,f=u.isLockY?0:t.y-s.y;s=r.getSession().CM();return s&&(r=[i||new St.Matrix(1,0,0,1,h,f)],i=new At.TransformDeltaEventArgs([n],r,"translate"),n=new Dt.messages.EventMessage(i,At.EventType.OnTransformDelta),s.BM(n)&&(i.isHandled()?0<(r=i.getNewTransforms()).length&&(h=r[0].getM6(),f=r[0].getM7()):f=h=0)),!0},g=function(){var t=e.getSheet();if(t){t=t.getSession();if(t)if(t.getSheetConfigurationData().contextData.getNodeCreationContext())return!0}return!1},r=function(){var t=e.getSheet();if(t){t=t.getSession();if(t)return t.getSheetConfigurationData(
).contextData.getDragDropForCreation()}return!1},M=function(){if(o){if(1!==o.wM)return!0;o=void 0}return!1},p=function(t){var n=s.offset(),i=new St.Point;i.x=t.pageX-n.left,i.y=t.pageY-n.top;n=e.getScreenToSheetTransform();return n?n.transformPoint(i):i},b=function(t){a.isEnabled()&&g()&&(c||(n=t,c=!0,M()||(t=p(t),(o=d(t))&&o.setAnchorPosition(t.x,t.y)),c=!1))},k=function(t){a.isEnabled()&&g()&&(t.pageX===t.screenX&&t.pageY===t.screenY||c||(c=!0,M()&&o&&(t=p(t),i(t,o),(t=o.tk()).isLockX||t.isLockY?e.moveConstraint.moveDuringCreation2([o],new St.Point(h,f)):e.moveConstraint.moveDuringCreation([o],new St.Point(h,f))),c=!1))},y=function(t){var n,i,r,s,u,h;a.isEnabled()&&g()&&(c||(c=!0,o&&1===o.wM&&(o=void 0),n=p(t),o&&(n=o.getAnchorPosition()),i=o,r=!1,(s=e.moveConstraint.attachingUtil).isAttachingAccepted()?(t=s.getAttachmentData(),s.sendAttachedEvent(t.attachingPoint),l&&((h=e.getSheet().getSession().CM()).beginTransaction(Dt.messages.ModelChangeMessage),w(i,!1),i.setUpToDate(!1),l=!1,
h.endTransaction()),r=!0):((h=e.getElementsByPoint(n))&&0<h.length&&(o?(St.CommonUtil.removeDuplicateItem(h,o),0<h.length&&(u=h[h.length-1])):u=h[h.length-1]),m(n,o,u)&&(r=!0)),r&&(e.moveConstraint.p2(),e.moveConstraint.alignment.clearAlignPoints(),e.moveConstraint.attachingUtil.resetToDefaultCursor(),e.moveConstraint.attachingUtil.highlightClear(),o=void 0,nt.length=0,g()&&(o=d(n))),e.getSheetConfigurationData().overviewWindowData.getDisplayWindow()&&e.getViewportManager().Vk(),c=!1))};ct.register(s,at.elementCreating,b),ct.register(s,at.transformDelta,k),ct.register(s,at.elementCreated,y),ct.register(s,at.flip,function(t){a.isEnabled()&&(c||(c=!0,M()&&o&&(p(t),t=o.getMirrorX(),new St.Matrix(-1,0,0,1,0,0),o.setMirrorX(t=!t)),c=!1))}),ct.register(s,at.rotation,function(t){var n;a.isEnabled()&&(c||(c=!0,M()&&o&&((n=o.getRotation())<270&&o.setRotation(n+=90)),c=!1))}),ct.register(s,at.elementCreatingForDrag,function(t){r()&&(t.preventDefault(),t.stopPropagation(),b(t))}),ct.register(s,
at.transformDeltaForDrag,function(t){r()&&(t.preventDefault(),t.stopPropagation(),k(t))}),ct.register(s,at.elementCreatedForDrag,function(t){r()&&(t.preventDefault(),t.stopPropagation(),y(t))});var x,E,C,N=!1;s.bind("touchstart",function(t){var n;a.isEnabled()&&g()&&(1<(n=t.originalEvent.touches).length||(x=t.timeStamp,E=n[0].pageX,C=n[0].pageY,N=!0,t.preventDefault()))}),s.bind("touchmove",function(t){var n,i;a.isEnabled()&&g()&&(1<(i=t.originalEvent.touches).length||(n=i[0].pageX,i=i[0].pageY,E===n&&C===i||(N=!1),t.preventDefault()))}),s.bind("touchend",function(t){var n,i,r;a.isEnabled()&&g()&&(c||!1!==N&&(600<t.timeStamp-x||(1<(n=t.originalEvent.changedTouches).length||(c=!0,o&&1===o.wM&&(o=void 0),r=s.offset(),t=n[0].pageX-r.left,r=n[0].pageY-r.top,t=e.getScreenToSheetTransform().transformPoint(new St.Point(t,r)),(r=e.getElementsByPoint(t))&&0<r.length&&(o?(St.CommonUtil.removeDuplicateItem(r,o),0<r.length&&(i=r[r.length-1])):i=r[r.length-1]),m(t,o,i),N=c=!1))))}),
this.cleanup=function(){o=void 0,nt.length=0,c=v=!1,e.moveConstraint.reset(),e.moveConstraint.alignment.clearAlignPoints(),e.moveConstraint.attachingUtil.clearAttachingCursor(),e.setAttachingPortOverlays(void 0),e.setAttachingLineOverlays(void 0),e.setAlignmentSmartGuideLines(void 0),e.moveConstraint.attachmentSourceTypes=null,e.moveConstraint.attachmentTargetTypes=null,e.moveConstraint.attachmentMasters=null},this.jk=function(){return o},this.Wk=function(){this.cleanup(),n&&b(n)},this.isInElementCreatedEvent=function(){return v}};function rt(t,n){if(!n.isInElementCreatedEvent()){for(var i=!1,r=t.getMessages(),s=t.getMessageCount(),u=0;u<s;u++){var h=r[u];if(1==h.getChangeType()&&h.owner==n.jk()){i=!0;break}}i&&n.Wk()}}var st,ut,lt,vt,wt;function dt(){ht.call(this)}function mt(){ht.call(this)}function gt(){ht.call(this),this.assistantKeys=[[St.KeyCode.SHIFT],[St.KeyCode.CTRL]]}function Mt(){ht.call(this)}function pt(){ht.call(this)}function bt(){ht.call(this)}function kt(){ht.call(this
)}function yt(){ht.call(this),this.zk=null,this.diagramManager=null,this.Yk=null,this.Bk=null,this.Zk=!1,this.Uk=!1,this.Gk=!1}it.prototype.onEnabledByCommandState=function(t){"CREATENODE"===t&&this.diagramManager.Xk(this,rt)},it.prototype.onDisabledByCommandState=function(t){"CREATENODE"===t&&this.diagramManager.$k(this,rt)},ht.inheritedBy(it),dt.prototype.hook=function(n,i){ht.prototype.hook.call(this,n,i);var r,s,u=this,h=!1,e=!1,o=void 0;n.bind("mousedown",function(t){void 0===o&&(o=i.getSheetConfigurationData().assistantKeysForMultipleSelect),0===t.button&&u.isEnabled()&&u.isInputKeysMatched(o,t)&&(e=!(h=!0),r=t.pageX,s=t.pageY,n.activateCursor(St.CursorID.MULTISELECT))}),n.bind("mousemove",function(t){var n;h&&0===t.button&&u.isEnabled()&&(n=t.pageX,t=t.pageY,r===n&&s===t||(e=!0))}),n.bind("mouseup",function(t){h&&0===t.button&&u.isEnabled()&&(e||(t=i.getCursorPosAndKeyStatus(t),i.setMultiSelectedElements(t)),n.deactivateCursor(St.CursorID.MULTISELECT),e=h=!1)})},
dt.prototype.execute=function(){},ht.inheritedBy(dt),mt.prototype.hook=function(r,s){ht.prototype.hook.call(this,r,s);var u,h=!1,e=!1,i=!1,o=new St.Point(0,0),f=new St.Point(0,0),a=this,c=new St.Rect,l=void 0;r.bind("mousedown",function(t){var n,i;void 0===l&&(l=s.getSheetConfigurationData().assistantKeysForRectSelect),0===t.button&&a.isEnabled()&&!window.navigator.msMaxTouchPoints&&a.isInputKeysMatched(l,t)&&(h=!0,u=r.offset(),o.x=t.pageX-u.left,o.y=t.pageY-u.top,null!=(i=s.getScreenToSheetTransform())&&(o=i.transformPoint(o)),n=s.getHoveredElements(),t=s.getOverlayByPoint(o),i=s.getHoverHighlightedConnectionOverlay(),n&&0<n.length||t||i||(e=!0))}),r.bind("mouseup",function(t){a.isEnabled()&&(i&&(t=s.getCursorPosAndKeyStatus(t),s.setRectangleSelectedElements(c,t),c.width=0,c.height=0,s.setSelectingRect(null)),i=e=h=!1)}),r.bind("mousemove",function(t){var n;h&&a.isEnabled()&&(f.x=t.pageX-u.left,f.y=t.pageY-u.top,!e||null!=(n=s.getScreenToSheetTransform())&&(f=n.transformPoint(f),
o.equal(f)||(t=new St.Point(Math.min(o.x,f.x),Math.min(o.y,f.y)),n=new St.Point(Math.max(o.x,f.x),Math.max(o.y,f.y)),c.x=t.x,c.y=t.y,c.width=n.x-t.x,c.height=n.y-t.y,s.setSelectingRect(c),i=!0)))})},mt.prototype.execute=function(){},ht.inheritedBy(mt),gt.prototype.hook=function(t,s){ht.prototype.hook.call(this,t,s);var u=this,h=null;t.bind("mousedown",function(t){if(0===t.button&&u.isEnabled()&&u.isInputKeysMatched(u.assistantKeys,t)){h=[];var n=s.getHoveredElements();if(n&&0<n.length)for(var i=n.length,r=0;r<i;r++)n[r].isSelected()&&h.push(n[r])}}),t.bind("click",function(t){if(0===t.button&&u.isEnabled()&&u.isInputKeysMatched(u.assistantKeys,t))return h&&0<h.length&&(t=s.getCursorPosAndKeyStatus(t),s.DeselectElement(h,t)),!1})},gt.prototype.execute=function(){},ht.inheritedBy(gt),Mt.prototype.hook=function(t,n){ht.prototype.hook.call(this,t,n);var i=this;t.bind("keydown",function(t){46===t.keyCode&&i.isEnabled()&&n.removeSelectedElements()})},Mt.prototype.execute=function(){},
ht.inheritedBy(Mt),pt.prototype.hook=function(t,n){ht.prototype.hook.call(this,t,n);var i=this;t.bind("keydown",function(t){if(t.ctrlKey&&65==t.keyCode&&i.isEnabled())return n.selectAll(),!1})},pt.prototype.execute=function(){},ht.inheritedBy(pt),bt.prototype.hook=function(t,r){ht.prototype.hook.call(this,t,r);var n=St.KeyCode.ESC,s=this,u=void 0;t.bind("keydown",function(t){t.keyCode==n&&s.isEnabled()&&(t=r.getCursorPosAndKeyStatus(t),r.deselectAll(t))}),t.bind("SDF_click",function(t,n,i){void 0===u&&(u=r.getSheetConfigurationData().assistantKeysForMultipleSelect),s.isEnabled()&&!s.isInputKeysMatched(u,t)&&(i&&0!==i.length||(t=r.getCursorPosAndKeyStatus(t),r.deselectAll(t)))})},bt.prototype.execute=function(){},ht.inheritedBy(bt),kt.prototype.hook=function(n,i){ht.prototype.hook.call(this,n,i);var r=!1,s=null,u=new St.Point(0,0),h=new St.Point(0,0),e=this;n.bind("mousedown",function(t){t.ctrlKey||t.shiftKey||0!==t.button||!e.isEnabled()||(r=!0,s=n.offset(),u.x=t.pageX-s.left,
u.y=t.pageY-s.top)}),n.bind("touchstart",function(t){t=t.originalEvent;e.isEnabled()&&(r=!0,s=n.offset(),t=t.changedTouches[0],u.x=t.pageX-s.left,u.y=t.pageY-s.top)}),n.bind("mouseup",function(t){r&&e.isHooked()&&(r=!1,h.x=t.pageX-s.left,h.y=t.pageY-s.top,!h.equal(u)||(t=i.getScreenToSheetTransform())&&i.switchExpandingStatus(t.transformPoint(h)))}),n.bind("touchend",function(t){r&&e.isHooked()&&(r=!1,t=t.originalEvent.changedTouches[0],h.x=t.pageX-s.left,h.y=t.pageY-s.top,!h.equal(u)||(t=i.getScreenToSheetTransform())&&i.switchExpandingStatus(t.transformPoint(h)))})},kt.prototype.execute=function(){},ht.inheritedBy(kt);var xt=!1;yt.prototype.hook=function(t,i){ht.prototype.hook.call(this,t,i);var r=this;this.zk=t;var s=(this.diagramManager=i).getSheetConfigurationData();t.bind("dblclick",function(t){var n;!r.isEnabled()||xt||1===(n=i.getSelectedElements()).length&&n[0]instanceof _t.Annotation&&(vt=n[0],Ct(vt)&&(n=Et(i),s.inlineTextEditor?r.executeInlineEditor(n,vt,null,!0):r.execute(n
,vt,null,!0)))}),t.bind("keydown",function(t){if(r.isEnabled()&&t.keyCode===St.KeyCode.F9){t.preventDefault();t=i.getSelectedElements();if(1===t.length){if((vt=t[0])instanceof _t.Node){var n=vt.getLabel();n&&(vt=n)}else if(!(vt instanceof _t.Annotation))return;Ct(vt)&&(n=Et(i),s.inlineTextEditor?r.executeInlineEditor(n,vt,null,!0):r.execute(n,vt,null,!0))}}})};var Et=function(t){var n=t.getSheetToScreenTransform(),t=vt.getRenderingPosition();return n.transformPoint(t)};yt.prototype.transformPagePositionToCanvas=function(t,n){var i=this.zk.offset(),t=t-i.left,i=n-i.top;return new St.Point(t,i)};var Ct=function(t){var n=!1,t=Nt(t);return n=t?t.isModifiable():n},Nt=function(t){for(var n=t.getSymbols(),i=n.length,r=0;r<i;r++){var s=n[r].getSymbol();if(s instanceof _t.TextBox)return s}return null};yt.prototype.execute=function(t,n,i,r,s,u){(wt=this).Yk=n,i?this.Bk=i:n instanceof _t.Annotation?this.Bk=n.getText():this.Bk="",xt=!0;var h=this.diagramManager;ut||Wt(),Ot(h,r),zt(t,this.Bk),
ut.onblur=function(){if(wt.qk&&xt){if(h.getSheetConfigurationData().textInputUnfocusCommit)try{jt(wt.Bk,ut.textContent,h,wt.Yk,wt.Zk)}finally{wt.finishTextEditing()}else Vt(wt.Yk,ut);wt.finishTextEditing()}}},yt.prototype.getEditor=function(){return ut||Wt(),ut},yt.prototype.isEditing=function(){return xt},yt.prototype.finishTextEditing=function(){var t;xt&&(xt=!1,lt&&(st.removeChild(lt),lt=null),ut&&(st.removeChild(ut),ut=null),(t=this.zk.getInteractionCanvas()).parentNode.removeChild(st),st=null,t.focus(),this.diagramManager.getCommandManager().releaseMutex(this))};var Ot=function(t,n){t.getCommandManager().requestMutex(wt),xt=!0,wt.qk=!0,wt.Zk=n,wt.zk.getInteractionCanvas().parentNode.appendChild(st)};yt.prototype.executeInlineEditor=function(t,n,i,r,s,u){(wt=this).Yk=n;var h=!(this.Gk=!0);n instanceof _t.Annotation&&(h=!0),this.Bk=i||(h?n.getText():"");var e=this.diagramManager;lt||Wt(!0),Ot(e,r),Pt(t,this.Bk,h,u,s);var o=e.getSheetConfigurationData();lt.onblur=function(){if(
wt.qk&&xt){if(o.textInputUnfocusCommit)try{jt(wt.Bk,lt.textContent,e,wt.Yk,wt.Zk)}finally{wt.finishInlineTextEditing()}else Vt(wt.Yk,lt);wt.finishInlineTextEditing()}}},yt.prototype.getInlineEditor=function(){return lt||Wt(!0),lt},yt.prototype.finishInlineTextEditing=function(){xt&&(this.Uk&&(Ft(this.Yk,!0),this.Uk=!1),lt.style.cssText="",this.Gk=!1,this.finishTextEditing())};function Rt(t){if(xt){var n=lt&&wt.Gk?lt:ut;switch(t.keyCode){case St.KeyCode.ENTER:wt.qk=!1;try{jt(wt.Bk,n.textContent,wt.diagramManager,wt.Yk,wt.Zk)}finally{lt&&wt.Gk?wt.finishInlineTextEditing():wt.finishTextEditing(),t.preventDefault()}break;case St.KeyCode.ESC:wt.qk=!1,Vt(wt.Yk,n),lt&&wt.Gk?wt.finishInlineTextEditing():wt.finishTextEditing()}}}var Pt=function(t,n,i,r,s){var u=wt.Yk,h=lt;r&&(h.style.cssText=r),h.style.position="absolute",h.style.outline="none",h.style.left=t.x+"px",h.style.top=t.y+"px",h.focus(),h.textContent=n;var e=h.style.backgroundColor,o=h.style.border,f=h.style.display,a=h.style.padding,
c=h.style.whiteSpace,l=h.style.overflow,v=h.style.lineHeight,w=h.style.width,d=h.style.maxWidth,m=h.style.height,g=h.style.maxHeight;v||(h.style.lineHeight="normal");r=wt.diagramManager,n=r.getSheetConfigurationData(),v=null;if(e||(v=n.inlineTextEditorBackgroundColor,h.style.backgroundColor=v.toString(),v=null),o||(n.inlineTextEditorBorder?(h.style.borderStyle=n.inlineTextEditorBorderLineType,h.style.borderWidth=n.inlineTextEditorBorderWidth+"px",v=n.inlineTextEditorBorderColor,h.style.borderColor=v.toString(),v=null):h.style.border="none"),f||(n.inlineTextEditorAutoResize?h.style.display="inline-block":h.style.display="inline"),a||(h.style.padding="0px"),c||(h.style.whiteSpace="nowrap"),l||(h.style.overflow="hidden"),i){a=Nt(u);if(a){c=It(a);if(c){var l=c.getAttributes(),i=h.style.fontSize,M=n.viewData.getScaleFactor();switch(p=i?Ht(h,M):(p=l["font-size"],Lt(p,M)),h.style.fontSize=p,h.style.color||(c=c.getFillAttributes())&&(h.style.color=c.toString()),
h.style.fontFamily=l["font-family"],a.Kk()){case St.TextAlignment.LEFT:h.style.textAlign="left";break;case St.TextAlignment.CENTER:h.style.textAlign="center";break;case St.TextAlignment.RIGHT:h.style.textAlign="right";break;case St.TextAlignment.JUSTIFY:h.style.textAlign="justify"}}}Ft(u,!1),wt.Uk=!0}else{var M=n.viewData.getScaleFactor(),p=Ht(h,M);h.style.fontSize=p}p=u.getBBox(),u=r.getSheetToScreenTransform().transformRect(p),r=Math.abs(u.x+u.width-t.x),p=Math.abs(u.y+u.height-t.y);s&&void 0!==s?(u=s.width,t=s.height,u?(h.style.width=s.width+"px",h.style.maxWidth=s.width+"px"):(h.style.width=r+"px",h.style.maxWidth=r+"px"),t?(h.style.height=s.height+"px",h.style.maxHeight=s.height+"px"):(h.style.height=p+"px",h.style.maxHeight=p+"px")):(s=n.inlineTextEditorAutoResize,w||s||(h.style.width=r+"px"),d||s||(h.style.maxWidth=r+"px"),m||(h.style.height=p+"px"),g||(h.style.maxHeight=p+"px")),n.textEditAutoSelect&&document.execCommand("selectAll",!1,null)},Ht=function(t,n){
t=window.getComputedStyle(t,null).getPropertyValue("font-size");return Lt(t,n)},Lt=function(t,n){var i=parseFloat(t),r=(""+i).length;return t.length>r?i*n+t.slice(r):i*n+"px"},It=function(t){t=t.getReferencings()[0].Jk();return t instanceof _t.TextRenderingProperties?t:null},Ft=function(t,n){var i=wt.diagramManager.getSheetSession().CM();i.beginTransaction(Dt.messages.ModelChangeMessage),t.setVisibleByTransientMask(n),i.endTransaction()},Vt=function(t,n){var i,r;t&&(t instanceof _t.Annotation&&(!(r=t.getSymbols()[0])||(r=r.getSymbol())&&r.getTextString&&(i=r)),n=new x(t,i,n.textContent,St.TextChangeEventPhase.Cancel),(t=t.getSession().CM())&&(n=new Dt.messages.EventMessage(n,_.OnTextChange),t.BM(n)))},jt=function(t,n,i,r,s){var u=i.getSheetSession();if(u){var h,e=u.CM();r instanceof _t.Annotation&&(!(u=r.getSymbols()[0])||(o=u.getSymbol())&&o.getTextString&&(h=o).getTextString());var o=new x(r,h,n,St.TextChangeEventPhase.PreUpdate);if(e){var f=new Dt.messages.EventMessage(o,
_.OnTextChange);if(e.BM(f)){if(o.isCancelled())return;o.isHandled()&&(n=o.getValue())}}""===n?r instanceof _t.Annotation&&i.removeSheetElements([r]):r instanceof _t.Annotation?i.updateLabelText(r,n):s&&(s=r.getOwningSheet(),i.fastCreateAnnotation(s,n,r));o=new x(r,h,n,St.TextChangeEventPhase.PostUpdate);e&&(f=new Dt.messages.EventMessage(o,_.OnTextChange),e.BM(f))}},Wt=function(t){var n;st||(st=document.createElement("div"),St.CommonUtil.setSdfIdOnDom(st,St.Constants.DOM_PREFIX+St.Constants.DOM_TEXT_EDITOR_WRAPPER),st.style.width="100%",st.style.height="100%",st.style.position="absolute",st.style.left="0px",st.style.top="0px"),ut||t||(ut=document.createElement("div"),St.CommonUtil.setSdfIdOnDom(ut,St.Constants.DOM_PREFIX+St.Constants.DOM_TEXT_EDITOR),ut.style.position="absolute",ut.contentEditable="true",ut.style.backgroundColor="white",ut.style.border="1px solid",ut.style.padding="2px",ut.style.outline="none",ut.style.display="inline-block",Q(ut).css("-webkit-user-select","text"),Q(ut
).css("user-select","text"),n=ut),t&&!lt&&(lt=document.createElement("div"),St.CommonUtil.setSdfIdOnDom(lt,St.Constants.DOM_PREFIX+St.Constants.DOM_INLINE_TEXT_EDITOR),lt.contentEditable="true",Q(lt).css("-webkit-user-select","text"),Q(lt).css("user-select","text"),n=lt),st.appendChild(n),Q(st).on("keydown",Rt)},zt=function(t,n){ut.style.left=t.x+"px",ut.style.top=t.y+"px",ut.style.display="",ut.focus(),ut.textContent=n,wt.diagramManager.getSheetConfigurationData().textEditAutoSelect&&document.execCommand("selectAll",!1,null)};function Yt(){ht.call(this),this.Qk=null}function Bt(){ht.call(this)}function Zt(t,n,i){Y.call(this,t,n,i)}function Ut(){var n=Ut.NONE;this.addType=function(t){n|=t},this.getType=function(){return n},this.isType=function(t){return(n&t)===t},this.reset=function(){n=Ut.NONE}}function Gt(){this.canStartBend=!1,this.canEndBend=!1,this.canWholeBend=!1,this.startBendingPt=null,this.endBendingPt=null,this.reset=function(){this.canStartBend=!1,this.canEndBend=!1,
this.canWholeBend=!1,this.startBendingPt=null,this.endBendingPt=null}}function Xt(t,p){function s(){q=[],K=[],ut=st=rt=it=nt=tt=J=$=X=G=U=null,ct=at=!(ft=ot=et=ht=!(Q=[null,null])),i=p.getSheetConfigurationData(),j=i.contextData.getConnectionCreationRoutingType(),W=i.minPortExtensionDist,z=i.minNodeToEdgeDist,Y=i.minSegmentLength;var t=0;f.isSnapSegmentActive()&&(t=f.getSnapSegmentTolerance());var n=i.connectionCaptureAlignmentTolerance;B=t<n?n:t,i.selectionPreferencesData.getSelectionRadiusPixel(),i.viewData.getScaleFactor(),u=i.handleStyle.connectionEndHandler.shape,e=i.handleStyle.connectionBendingHandler.shape,Z=i.allowSimpleDrag,Mt=[],pt.type=0,pt.dragId=0}function c(t,n,i,r,s,u){var h,e,o,f=[];return{isRouted:t===St.ConnectionBendControlOption.Orthogonal&&(i&St.ConnectionEnd.END?h=n.start:i&St.ConnectionEnd.START&&(h=n.end),e=bt(null,u,r,s),!(!h||!e)&&(o=n.isHorizontal(),t=n.isVertical(),i=s.normalize(),n=new St.Vector(0,0),o?n.x=e.x>h.x?1:-1:t&&(n.y=e.y>h.y?1:-1),
s=new St.Vector(0,0),o?e.x>=h.x?e.y>=h.y?i.equal(St.Vector.PositiveY)?s.x=-1:s.y=-1:i.equal(St.Vector.NegativeY)?s.x=-1:s.y=1:e.y>=h.y?i.equal(St.Vector.PositiveY)?s.x=1:s.y=-1:i.equal(St.Vector.NegativeY)?s.x=1:s.y=1:t&&(e.x>=h.x?e.y>=h.y?i.equal(St.Vector.PositiveX)?s.y=-1:s.x=-1:i.equal(St.Vector.PositiveX)?s.y=1:s.x=-1:e.y>=h.y?i.equal(St.Vector.NegativeX)?s.y=-1:s.x=1:i.equal(St.Vector.NegativeX)?s.y=1:s.x=1),(f=(u=kt(h,n,e,s,u)).pointArray).push(r),u.isRouted)),pathArray:f}}function l(t,n){for(var i,r=t.concat(),s=n.concat(),u=t.length,h=n.length,e=u-1,o=0;0<=e&&o<h;e--,o++)t[e].equal(n[o])&&(i=r.pop(),s.shift());return i&&r.push(i.clone()),r.concat(s)}function w(t,n){var i,r,s,u,h,e,o,f,a=p.moveConstraint.attachingUtil.getSubtype();return a!==St.AttachingType.ConnectionEndAttachToNodeSide&&a!==St.AttachingType.ConnectionEndAttachToConnectionSegment||(t&St.ConnectionEnd.START?(h=U.getStart(),r=Q[1]):t&St.ConnectionEnd.END&&(h=U.getEnd(),r=Q[0]),h&&(
e=h.getSymbolConnectionLocation().getEvaluatedLocation(),o=h.getConnectionDirection(),f=h.getOwner().getBBox(),s=h.getRenderingPosition(),u=h.getEvaluatedTransform(1,1,s),a=h.getOwner().getEvaluatedTransform(1,1,new St.Point(f.x,f.y)),e=u.transformPoint(new St.Point(e.x-s.x,e.y-s.y)),f=a.transformRect(new St.Rect(0,0,f.width,f.height)),o=u.transformVector(o),h.connectionDirectionReversible&&(h=St.Vector.cross(o,n),0===St.MathUtil.doubleCompare(h,0)&&(o=n)),(f=c(j,r,t,e,o,f)).isRouted&&(t&St.ConnectionEnd.START?((i=K.concat()).shift(),f.pathArray.reverse(),i=l(f.pathArray,i)):t&St.ConnectionEnd.END&&((i=K.concat()).pop(),i=l(i,f.pathArray))))),i}function d(t,n,i,r,s){var u=p.getSheet();if(u){r=new At.GeometryChangeEventArgs(t,n,i,r,s),s=new Dt.messages.EventMessage(r,At.EventType.OnGeometryChange),s=u.getSession().CM().BM(s);if(s&&r.isCancelled())return}return 1}function a(t){var n=new St.Vector(0,0);switch(t){case St.AllowedSides.TOP:n.y=-1;break;case St.AllowedSides.RIGHT:n.x=1;break
;case St.AllowedSides.BOTTOM:n.y=1;break;case St.AllowedSides.LEFT:n.x=-1}return n}function m(t){if(!X)return null;var n=p.getSheet();if(n){X.inPreview=!1;var i=new Dt.messages.EventMessage(X,At.EventType.OnConnectionRouting);if(n.getSession().CM().BM(i)){for(var r=X.getConnectionRoutingResult(),s=X.getConnections(),u=0,h=s.length;u<h;u++){var e=s[u];e!==t&&(G=G||[]).push({connection:e,pathFromEvent:r[e.guid]})}i=r[t.guid];return 0<X.reasons.length&&X.reasons[0]==St.RoutingReason.EndPointMoved&&i.reverse(),r[t.guid]}return null}return null}function v(t,n){var i=p.moveConstraint.attachingUtil;return i.reset(St.AttachingType.EditConnection,U,t),i.retrieveCandidatesByPoint(t,n)}function r(t){for(var n=K.length,i=0;i<n;i++)if(K[i].equal(t))return i;return null}function x(t,n,i,r){var s=Et(U,St.RoutingReason.SegmentMoved,n,i,r,[],[]);if(s)return s;var u,h=[],e=J.start,n=J.end;return h.push(e),J.distanceFromPoint(t)>B&&(i=t,r=J.isHorizontal(),s=J.isVertical(),!r&&!s||ot?(Math.abs(t.x-e.x
)<B&&(i.x=e.x),Math.abs(t.y-e.y)<B&&(i.y=e.y),Math.abs(t.x-n.x)<B&&(i.x=n.x),Math.abs(t.y-n.y)<B&&(i.y=n.y),h.push(i)):(s=r?Math.abs(n.x-e.x):Math.abs(n.y-e.y),z<s&&(ht?2*z<s&&(r=bt(wt),s=bt(dt),r&&(Math.abs(t.x-r.x)<B&&(i.x=r.x),Math.abs(t.y-r.y)<B&&(i.y=r.y)),s&&(Math.abs(t.x-s.x)<B&&(i.x=s.x),Math.abs(t.y-s.y)<B&&(i.y=s.y)),r&&h.push(r),h.push(i),s&&h.push(s)):et?((u=bt(wt))&&(Math.abs(t.x-u.x)<B&&(i.x=u.x),Math.abs(t.y-u.y)<B&&(i.y=u.y),Math.abs(t.x-n.x)<B&&(i.x=n.x),Math.abs(t.y-n.y)<B&&(i.y=n.y),h.push(u)),h.push(i)):ft&&((u=bt(dt))?(Math.abs(t.x-e.x)<B&&(i.x=e.x),Math.abs(t.y-e.y)<B&&(i.y=e.y),Math.abs(t.x-u.x)<B&&(i.x=u.x),Math.abs(t.y-u.y)<B&&(i.y=u.y),h.push(i),h.push(u)):h.push(i))))),h.push(n),h}function g(t,n){var i=[],r=Q[1].start,s=Q[1].end,n=new St.Point(r.x+t,r.y+n);return Math.abs(n.x-s.x)<B&&(mt.addType(Ut.NEXT_VERTICAL),n.x=s.x),Math.abs(n.y-s.y)<B&&(mt.addType(Ut.NEXT_HORIZONTAL),n.y=s.y),i.push(n),i.push(s),i}function M(t,n){var i,r,s=[],u=Q[1].start,h=Q[1].end,
e=new St.Point(u.x+t,u.y+n);return dt&&(t=dt.getConnectionDirection().normalize(),n=new St.Vector(u.x-h.x,u.y-h.y).normalize(),n=St.Vector.cross(t,n),0===St.MathUtil.doubleCompare(n,0)&&(t.equal(new St.Vector(1,0))?(i=h.x+W,gt.endBendingPt=new St.Point(i,u.y),gt.canEndBend=!(i>u.x)):t.equal(new St.Vector(-1,0))?(i=h.x-W,gt.endBendingPt=new St.Point(i,u.y),gt.canEndBend=!(i<u.x)):t.equal(new St.Vector(0,1))?(r=h.y-W,gt.endBendingPt=new St.Point(u.x,r),gt.canEndBend=!(r<u.y)):t.equal(new St.Vector(0,-1))&&(r=h.y+W,gt.endBendingPt=new St.Point(u.x,r),gt.canEndBend=!(r>u.y)))),gt.endBendingPt?(r=gt.endBendingPt,Math.abs(e.y-r.y)<B&&(mt.addType(Ut.AFTER_BENDING_HORIZONTAL),e.y=r.y),Math.abs(e.x-r.x)<B&&(mt.addType(Ut.AFTER_BENDING_VERTICAL),e.x=r.x),s.push(e),s.push(r),gt.canEndBend||s.push(u)):(Math.abs(e.y-h.y)<B&&(mt.addType(Ut.NEXT_HORIZONTAL),e.y=h.y),Math.abs(e.x-h.x)<B&&(mt.addType(Ut.NEXT_VERTICAL),e.x=h.x),s.push(e),s.push(h)),s}function b(t,n){var i=[],r=Q[0].start,s=Q[0].end,
n=new St.Point(s.x+t,s.y+n);return Math.abs(n.x-r.x)<B&&(mt.addType(Ut.PREVIOUS_VERTICAL),n.x=r.x),Math.abs(n.y-r.y)<B&&(mt.addType(Ut.PREVIOUS_HORIZONTAL),n.y=r.y),i.push(r),i.push(n),i}function k(t,n){var i,r,s=[],u=Q[0].start,h=Q[0].end,e=new St.Point(h.x+t,h.y+n);return wt&&(t=wt.getConnectionDirection().normalize(),n=new St.Vector(h.x-u.x,h.y-u.y).normalize(),n=St.Vector.cross(t,n),0===St.MathUtil.doubleCompare(n,0)&&(t.equal(new St.Vector(1,0))?(i=u.x+W,gt.startBendingPt=new St.Point(i,h.y),gt.canStartBend=!(i>h.x)):t.equal(new St.Vector(-1,0))?(i=u.x-W,gt.startBendingPt=new St.Point(i,h.y),gt.canStartBend=!(i<h.x)):t.equal(new St.Vector(0,1))?(r=u.y-W,gt.startBendingPt=new St.Point(h.x,r),gt.canStartBend=!(r<h.y)):t.equal(new St.Vector(0,-1))&&(r=u.y+W,gt.startBendingPt=new St.Point(h.x,r),gt.canStartBend=!(r>h.y)))),gt.startBendingPt?(r=gt.startBendingPt,Math.abs(e.y-r.y)<B&&(mt.addType(Ut.BEFORE_BENDING_HORIZONTAL),e.y=r.y),Math.abs(e.x-r.x)<B&&(mt.addType(
Ut.BEFORE_BENDING_VERTICAL),e.x=r.x),gt.canStartBend||s.push(h),s.push(r)):(Math.abs(e.y-u.y)<B&&(mt.addType(Ut.PREVIOUS_HORIZONTAL),e.y=u.y),Math.abs(e.x-u.x)<B&&(mt.addType(Ut.PREVIOUS_VERTICAL),e.x=u.x),s.push(u)),s.push(e),s}function h(t,n,i,r){var s,u,h,e,o,f={},a=r?t[0]:t[1],c=r?t[1]:t[0],l=r?wt:dt;return l&&!l.connectionDirectionReversible&&(o=l.getResolvedConnectionDirection(),s=bt(l),t=r?tt:nt,l=r?it:rt,o&&s&&(o=o.normalize(),t?l?(l=r?nt:tt,r?nt=c:tt=a,a.isHorizontal()?void 0!==(u=Ct(a,n,i,r,!0)).dy&&(f.dy=u.dy):void 0!==(u=Ct(a,n,i,r,!1)).dx&&(f.dx=u.dx),r?nt=l:tt=l):(h=a.isHorizontal(),e=r?c.end:c.start,c=r?a.end:a.start,h?((o.equal(St.Vector.PositiveY)&&c.y+i<s.y||o.equal(St.Vector.NegativeY)&&c.y+i>s.y)&&(f.dy=s.y-c.y),Math.abs(e.x+n-s.x)<B&&(o.equal(St.Vector.PositiveY)&&e.y<s.y||o.equal(St.Vector.NegativeY)&&e.y>s.y)&&(f.dx=0)):((o.equal(St.Vector.PositiveX)&&c.x+n<s.x||o.equal(St.Vector.NegativeX)&&c.x+n>s.x)&&(f.dx=s.x-c.x),Math.abs(e.y+i-s.y)<B&&(o.equal(
St.Vector.PositiveX)&&e.x<s.x||o.equal(St.Vector.NegativeX)&&e.x>s.x)&&(f.dy=0))):(h=a.isHorizontal(),e=r?a.end:a.start,h?Math.abs(e.y+i-s.y)<B&&(o.equal(St.Vector.PositiveX)&&e.x+n<s.x||o.equal(St.Vector.NegativeX)&&e.x+n>s.x)&&(f.dx=s.x-e.x,f.dy=i):Math.abs(e.x+n-s.x)<B&&(o.equal(St.Vector.PositiveY)&&e.y+i<s.y||o.equal(St.Vector.NegativeY)&&e.y+i>s.y)&&(f.dx=n,f.dy=s.y-e.y)))),f}function y(t,n){var i,r,s=[],u=Q[1].start,h=Q[1].end;return vt&&(r=ct?(r=h.y>u.y?q[q.length-1].y-W:q[q.length-1].y+W,i=h.y>u.y?h.y-z:h.y+z,h.y>u.y?i<r?i:r:r<i?i:r):h.y>u.y?h.y-z:h.y+z,gt.endBendingPt=new St.Point(u.x,r),gt.canEndBend=h.y>u.y?!(r<=u.y):!(r>=u.y)),Math.abs(t)<B?(mt.addType(Ut.NEXT_VERTICAL),Math.abs(u.y+n-h.y)>B?s.push(new St.Point(u.x,u.y+n)):(mt.addType(Ut.NEXT_HORIZONTAL),s.push(new St.Point(u.x,h.y))),s.push(h)):dt?(r=new St.Point(gt.endBendingPt.x+t,gt.endBendingPt.y),Math.abs(u.y+n-r.y)>B?s.push(new St.Point(r.x,u.y+n)):mt.addType(Ut.AFTER_BENDING_HORIZONTAL),s.push(r),s.push(
new St.Point(u.x,r.y)),gt.canEndBend||s.push(u),s.push(h)):(Math.abs(u.y+n-h.y)>B?s.push(new St.Point(u.x+t,u.y+n)):(mt.addType(Ut.NEXT_HORIZONTAL),s.push(new St.Point(u.x+t,h.y))),s.push(new St.Point(h.x+t,h.y))),s}function E(t,n){var i,r,s=[],u=Q[0].start,h=Q[0].end;return lt&&(r=at?(r=u.y>h.y?q[0].y-W:q[0].y+W,i=u.y>h.y?u.y-z:u.y+z,u.y>h.y?i<r?i:r:r<i?i:r):u.y>h.y?u.y-z:u.y+z,gt.startBendingPt=new St.Point(h.x,r),gt.canStartBend=u.y>h.y?!(r<=h.y):!(r>=h.y)),Math.abs(t)<B?(mt.addType(Ut.PREVIOUS_VERTICAL),Math.abs(h.y+n-u.y)>B?(s.push(u),s.push(new St.Point(h.x,h.y+n))):(mt.addType(Ut.PREVIOUS_HORIZONTAL),s.push(u),s.push(new St.Point(h.x,u.y)))):wt?(r=new St.Point(gt.startBendingPt.x+t,gt.startBendingPt.y),s.push(u),gt.canStartBend||s.push(h),s.push(new St.Point(h.x,r.y)),s.push(r),Math.abs(h.y+n-r.y)>B?s.push(new St.Point(r.x,h.y+n)):mt.addType(Ut.BEFORE_BENDING_HORIZONTAL)):Math.abs(h.y+n-u.y)>B?(s.push(new St.Point(u.x+t,u.y)),s.push(new St.Point(h.x+t,h.y+n))):(mt.addType(
Ut.PREVIOUS_HORIZONTAL),s.push(new St.Point(u.x+t,u.y)),s.push(new St.Point(h.x+t,u.y))),s}function C(t,n){var i,r,s=[],u=Q[1].start,h=Q[1].end;return vt&&(r=ct?(r=h.x>u.x?q[q.length-1].x-W:q[q.length-1].x+W,i=h.x>u.x?h.x-z:h.x+z,h.x>u.x?i<r?i:r:r<i?i:r):h.x>u.x?h.x-z:h.x+z,gt.endBendingPt=new St.Point(r,h.y),gt.canEndBend=h.x>u.x?!(r<=u.x):!(r>=u.x)),Math.abs(n)<B?(mt.addType(Ut.NEXT_HORIZONTAL),Math.abs(u.x+t-h.x)>B?s.push(new St.Point(u.x+t,u.y)):(mt.addType(Ut.NEXT_VERTICAL),s.push(new St.Point(h.x,u.y))),s.push(h)):dt?(r=new St.Point(gt.endBendingPt.x,gt.endBendingPt.y+n),Math.abs(u.x+t-r.x)>B?s.push(new St.Point(u.x+t,r.y)):mt.addType(Ut.AFTER_BENDING_VERTICAL),s.push(r),s.push(new St.Point(r.x,h.y)),gt.canEndBend||s.push(u),s.push(h)):(Math.abs(u.x+t-h.x)>B?s.push(new St.Point(u.x+t,u.y+n)):(mt.addType(Ut.NEXT_VERTICAL),s.push(new St.Point(h.x,u.y+n))),s.push(new St.Point(h.x,h.y+n))),s}function N(t,n){var i,r,s=[],u=Q[0].start,h=Q[0].end;return lt&&(r=at?(
r=u.x>h.x?q[0].x-W:q[0].x+W,i=u.x>h.x?u.x-z:u.x+z,u.x>h.x?i<r?i:r:r<i?i:r):u.x>h.x?u.x-z:u.x+z,gt.startBendingPt=new St.Point(r,h.y),gt.canStartBend=u.x>h.x?!(r<=h.x):!(r>=h.x)),Math.abs(n)<B?(mt.addType(Ut.PREVIOUS_HORIZONTAL),Math.abs(h.x+t-u.x)>B?(s.push(u),s.push(new St.Point(h.x+t,h.y))):(mt.addType(Ut.PREVIOUS_VERTICAL),s.push(u),s.push(new St.Point(u.x,h.y)))):wt?(r=new St.Point(gt.startBendingPt.x,gt.startBendingPt.y+n),s.push(u),gt.canStartBend||s.push(h),s.push(new St.Point(r.x,u.y)),s.push(r),Math.abs(h.x+t-r.x)>B?s.push(new St.Point(h.x+t,r.y)):mt.addType(Ut.BEFORE_BENDING_VERTICAL)):Math.abs(h.x+t-u.x)>B?(s.push(new St.Point(u.x,u.y+n)),s.push(new St.Point(h.x+t,h.y+n))):(mt.addType(Ut.PREVIOUS_VERTICAL),s.push(new St.Point(u.x,u.y+n)),s.push(new St.Point(u.x,h.y+n))),s}function O(t,n){var i,r=[],s=Q[1].start,u=Q[1].end;return Math.abs(t)<B?(mt.addType(Ut.NEXT_VERTICAL),Math.abs(s.y+n-u.y)>B?r.push(new St.Point(s.x,s.y+n)):(mt.addType(Ut.NEXT_HORIZONTAL),r.push(
new St.Point(s.x,u.y))),r.push(u)):((i=new St.Point(0,0)).x=u.x+t,i.y=u.y,Math.abs(s.y+n-u.y)<B&&Math.abs(i.x-nt.end.x)<B?(mt.addType(Ut.NEXT_HORIZONTAL|Ut.AFTER_NEXT_VERTICAL),r.push(new St.Point(nt.end.x,u.y))):Math.abs(s.y+n-u.y)<B?(mt.addType(Ut.NEXT_HORIZONTAL),r.push(i)):Math.abs(i.x-nt.end.x)<B?(mt.addType(Ut.AFTER_NEXT_VERTICAL),r.push(new St.Point(nt.end.x,s.y+n))):(r.push(new St.Point(i.x,s.y+n)),r.push(i)),r.push(nt.end)),r}function D(t,n){var i,r=[],s=Q[0].start,u=Q[0].end;return Math.abs(t)<B?(mt.addType(Ut.PREVIOUS_VERTICAL),Math.abs(u.y+n-s.y)>B?(r.push(s),r.push(new St.Point(u.x,u.y+n))):(mt.addType(Ut.PREVIOUS_HORIZONTAL),r.push(s),r.push(new St.Point(u.x,s.y)))):((i=new St.Point(0,0)).x=s.x+t,i.y=s.y,Math.abs(u.y+n-s.y)<B&&Math.abs(i.x-tt.start.x)<B?(mt.addType(Ut.PREVIOUS_HORIZONTAL|Ut.BEFORE_PREVIOUS_VERTICAL),r.push(tt.start),r.push(new St.Point(tt.start.x,s.y))):Math.abs(u.y+n-s.y)<B?(mt.addType(Ut.PREVIOUS_HORIZONTAL),r.push(tt.start),r.push(i)):Math.abs(
i.x-tt.start.x)<B?(mt.addType(Ut.BEFORE_PREVIOUS_VERTICAL),r.push(tt.start),r.push(new St.Point(tt.start.x,u.y+n))):(r.push(tt.start),r.push(i),r.push(new St.Point(i.x,u.y+n)))),r}function _(t,n){var i,r=[],s=Q[1].start,u=Q[1].end;return Math.abs(n)<B?(mt.addType(Ut.NEXT_HORIZONTAL),Math.abs(s.x+t-u.x)>B?r.push(new St.Point(s.x+t,s.y)):(mt.addType(Ut.NEXT_VERTICAL),r.push(new St.Point(u.x,s.y))),r.push(u)):((i=new St.Point(0,0)).x=u.x,i.y=u.y+n,Math.abs(s.x+t-u.x)<B&&Math.abs(i.y-nt.end.y)<B?(mt.addType(Ut.NEXT_VERTICAL|Ut.AFTER_NEXT_HORIZONTAL),r.push(new St.Point(u.x,nt.end.y))):Math.abs(s.x+t-u.x)<B?(mt.addType(Ut.NEXT_VERTICAL),r.push(i)):Math.abs(i.y-nt.end.y)<B?(mt.addType(Ut.AFTER_NEXT_HORIZONTAL),r.push(new St.Point(s.x+t,nt.end.y))):(r.push(new St.Point(s.x+t,i.y)),r.push(i)),r.push(nt.end)),r}function S(t,n){var i,r=[],s=Q[0].start,u=Q[0].end;return Math.abs(n)<B?(mt.addType(Ut.PREVIOUS_HORIZONTAL),Math.abs(u.x+t-s.x)>B?(r.push(s),r.push(new St.Point(u.x+t,u.y))):(mt.addType(
Ut.PREVIOUS_VERTICAL),r.push(s),r.push(new St.Point(s.x,u.y)))):((i=new St.Point(0,0)).x=s.x,i.y=s.y+n,Math.abs(u.x+t-s.x)<B&&Math.abs(i.y-tt.start.y)<B?(mt.addType(Ut.PREVIOUS_VERTICAL|Ut.BEFORE_PREVIOUS_HORIZONTAL),r.push(tt.start),r.push(new St.Point(s.x,tt.start.y))):Math.abs(u.x+t-s.x)<B?(mt.addType(Ut.PREVIOUS_VERTICAL),r.push(tt.start),r.push(i)):Math.abs(i.y-tt.start.y)<B?(mt.addType(Ut.BEFORE_PREVIOUS_HORIZONTAL),r.push(tt.start),r.push(new St.Point(u.x+t,tt.start.y))):(r.push(tt.start),r.push(i),r.push(new St.Point(u.x+t,i.y)))),r}function T(t,n,i,r,s,u){if(y=Et(U,St.RoutingReason.SegmentMoved,r,s,u,[],[]))return y;var h,e,o,f,a,c,l,v,w,d,m,g,M,p,b,k=[],y=F(J.start,n,i);return n+=y.x,i+=y.y,j!==St.ConnectionBendControlOption.Orthogonal&&Z?k=x(t,r,s,u):ht?(v=i,M=[],p=J.start,b=J.end,lt&&(u=at?(d=p.x>b.x?q[0].x-W:q[0].x+W,w=p.x>b.x?p.x-z:p.x+z,p.x>b.x?w<d?w:d:d<w?w:d):p.x>b.x?p.x-z:p.x+z,gt.startBendingPt=new St.Point(u,p.y),gt.canStartBend=p.x>b.x?!(u<=b.x):!(u>=b.x)),vt&&(
m=ct?(d=b.x>p.x?q[q.length-1].x-W:q[q.length-1].x+W,w=b.x>p.x?b.x-z:b.x+z,b.x>p.x?w<d?w:d:d<w?w:d):b.x>p.x?b.x-z:b.x+z,gt.endBendingPt=new St.Point(m,b.y),gt.canEndBend=b.x>p.x?!(m<=p.x):!(m>=p.x)),lt&&vt&&gt.canStartBend&&gt.canEndBend&&(gt.canWholeBend=p.x>b.x?!(gt.startBendingPt.x<=gt.endBendingPt.x):!(gt.startBendingPt.x>=gt.endBendingPt.x)),wt&&dt?(gt.canWholeBend?(d=gt.startBendingPt,m=gt.endBendingPt,Math.abs(v)<B?M.push(p):(M.push(p),M.push(d),M.push(new St.Point(d.x,d.y+v)),M.push(new St.Point(m.x,m.y+v)),M.push(m))):M.push(p),M.push(b)):wt?gt.canStartBend?(g=gt.startBendingPt,Math.abs(v)<B?(M.push(p),M.push(b)):(M.push(p),M.push(g),M.push(new St.Point(g.x,g.y+v)),M.push(new St.Point(b.x,b.y+v)))):(M.push(p),M.push(b)):dt?(gt.canEndBend?(g=gt.endBendingPt,Math.abs(v)<B?M.push(p):(M.push(new St.Point(p.x,p.y+v)),M.push(new St.Point(g.x,g.y+v)),M.push(g))):M.push(p),M.push(b)):(M.push(new St.Point(p.x,p.y+v)),M.push(new St.Point(b.x,b.y+v))),k=M):et?(void(n=0)!==(e=Ct(J,n,i,!1,
!0)).dy&&(n=e.dx,i=e.dy),g=n,p=i,l=[],b=J.start,v=J.end,lt&&(c=at?(c=b.x>v.x?q[0].x-W:q[0].x+W,M=b.x>v.x?b.x-z:b.x+z,b.x>v.x?M<c?M:c:c<M?M:c):b.x>v.x?b.x-z:b.x+z,gt.startBendingPt=new St.Point(c,b.y),gt.canStartBend=b.x>v.x?!(c<=v.x):!(c>=v.x)),wt?gt.canStartBend?(c=gt.startBendingPt,Math.abs(p)<B?(l.push(b),l.push(v)):(l.push(b),Math.abs(c.y+p-nt.end.y)<B?(l.push(c),l.push(new St.Point(c.x,nt.end.y))):(l.push(c),l.push(new St.Point(c.x,c.y+p)),l.push(new St.Point(v.x,v.y+p))),l.push(nt.end))):(l.push(b),l.push(v)):(Math.abs(b.y+p-nt.end.y)<B?l.push(new St.Point(b.x+g,nt.end.y)):(l.push(new St.Point(b.x,b.y+p)),l.push(new St.Point(v.x,v.y+p))),l.push(nt.end)),k=l):ot?(l=Ct(J,0,i,!0,!0),a=Ct(J,0,i,!1,!0),void 0!==l.dy&&void 0!==a.dy?i=(Math.abs(l.dy)<Math.abs(a.dy)?l:a).dy:void 0!==l.dy?i=l.dy:void 0!==a.dy&&(i=a.dy),o=i,f=[],l=J.start,a=J.end,f.push(tt.start),Math.abs(l.y+o-tt.start.y)<B?f.push(new St.Point(a.x,tt.start.y)):Math.abs(a.y+o-nt.end.y)<B?f.push(new St.Point(l.x,nt.end.y)
):(f.push(new St.Point(l.x,l.y+o)),f.push(new St.Point(a.x,a.y+o))),f.push(nt.end),k=f):ft&&(void(n=0)!==(e=Ct(J,0,i,!0,!0)).dy&&(n=e.dx,i=e.dy),a=n,o=i,f=[],e=J.start,n=J.end,vt&&(h=ct?(h=n.x>e.x?q[q.length-1].x-W:q[q.length-1].x+W,i=n.x>e.x?n.x-z:n.x+z,n.x>e.x?i<h?i:h:h<i?i:h):n.x>e.x?n.x-z:n.x+z,gt.endBendingPt=new St.Point(h,n.y),gt.canEndBend=n.x>e.x?!(h<=e.x):!(h>=e.x)),dt?gt.canEndBend?(h=gt.endBendingPt,Math.abs(o)<B?f.push(e):(Math.abs(h.y+o-tt.start.y)<B?(f.push(tt.start),f.push(new St.Point(h.x,tt.start.y))):(f.push(tt.start),f.push(new St.Point(e.x,e.y+o)),f.push(new St.Point(h.x,h.y+o))),f.push(h)),f.push(n)):(f.push(J.start),f.push(J.end)):Math.abs(n.y+o-tt.start.y)<B?(f.push(tt.start),f.push(new St.Point(n.x+a,tt.start.y))):(f.push(tt.start),f.push(new St.Point(e.x,e.y+o)),f.push(new St.Point(n.x,n.y+o))),k=f),k}function A(t,n,i,r,s,u){if(y=Et(U,St.RoutingReason.SegmentMoved,r,s,u,[],[]))return y;var h,e,o,f,a,c,l,v,w,d,m,g,M,p,b,k=[],y=F(J.start,n,i);return n+=y.x,
i+=y.y,j!==St.ConnectionBendControlOption.Orthogonal&&Z?k=x(t,r,s,u):ht?(v=n,M=[],p=J.start,b=J.end,lt&&(u=at?(d=p.y>b.y?q[0].y-W:q[0].y+W,w=p.y>b.y?p.y-z:p.y+z,p.y>b.y?w<d?w:d:d<w?w:d):p.y>b.y?p.y-z:p.y+z,gt.startBendingPt=new St.Point(p.x,u),gt.canStartBend=p.y>b.y?!(u<=b.y):!(u>=b.y)),vt&&(m=ct?(d=b.y>p.y?q[q.length-1].y-W:q[q.length-1].y+W,w=b.y>p.y?b.y-z:b.y+z,b.y>p.y?w<d?w:d:d<w?w:d):b.y>p.y?b.y-z:b.y+z,gt.endBendingPt=new St.Point(b.x,m),gt.canEndBend=b.y>p.y?!(m<=p.y):!(m>=p.y)),lt&&vt&&gt.canStartBend&&gt.canEndBend&&(gt.canWholeBend=p.y>b.y?!(gt.startBendingPt.y<=gt.endBendingPt.y):!(gt.startBendingPt.y>=gt.endBendingPt.y)),wt&&dt?(gt.canWholeBend?(d=gt.startBendingPt,m=gt.endBendingPt,Math.abs(v)<B?M.push(p):(M.push(p),M.push(d),M.push(new St.Point(d.x+v,d.y)),M.push(new St.Point(m.x+v,m.y)),M.push(m))):M.push(p),M.push(b)):wt?gt.canStartBend?(g=gt.startBendingPt,Math.abs(v)<B?(M.push(p),M.push(b)):(M.push(p),M.push(g),M.push(new St.Point(g.x+v,g.y)),M.push(new St.Point(
b.x+v,b.y)))):(M.push(p),M.push(b)):dt?(gt.canEndBend?(g=gt.endBendingPt,Math.abs(v)<B?M.push(p):(M.push(new St.Point(p.x+v,p.y)),M.push(new St.Point(g.x+v,g.y)),M.push(g))):M.push(p),M.push(b)):(M.push(new St.Point(p.x+v,p.y)),M.push(new St.Point(b.x+v,b.y))),k=M):et?(void(i=0)!==(e=Ct(J,n,i,!1,!1)).dx&&(n=e.dx,i=e.dy),g=n,p=i,l=[],v=J.start,b=J.end,lt&&(c=at?(c=v.y>b.y?q[0].y-W:q[0].y+W,M=v.y>b.y?v.y-z:v.y+z,v.y>b.y?M<c?M:c:c<M?M:c):v.y>b.y?v.y-z:v.y+z,gt.startBendingPt=new St.Point(v.x,c),gt.canStartBend=v.y>b.y?!(c<=b.y):!(c>=b.y)),wt?gt.canStartBend?(c=gt.startBendingPt,Math.abs(g)<B?(l.push(v),l.push(b)):(l.push(v),Math.abs(c.x+g-nt.end.x)<B?(l.push(c),l.push(new St.Point(nt.end.x,c.y))):(l.push(c),l.push(new St.Point(c.x+g,c.y)),l.push(new St.Point(b.x+g,b.y))),l.push(nt.end))):(l.push(J.start),l.push(J.end)):(Math.abs(v.x+g-nt.end.x)<B?l.push(new St.Point(nt.end.x,v.y+p)):(l.push(new St.Point(v.x+g,v.y)),l.push(new St.Point(b.x+g,b.y))),l.push(nt.end)),k=l):ot?(l=Ct(J,n,0,!0,!1
),a=Ct(J,n,0,!1,!1),void 0!==l.dx&&void 0!==a.dx?n=(Math.abs(l.dx)<Math.abs(a.dx)?l:a).dx:void 0!==l.dx?n=l.dx:void 0!==a.dx&&(n=a.dx),o=n,f=[],l=J.start,a=J.end,f.push(tt.start),Math.abs(l.x+o-tt.start.x)<B?f.push(new St.Point(tt.start.x,a.y)):Math.abs(a.x+o-nt.end.x)<B?f.push(new St.Point(nt.end.x,l.y)):(f.push(new St.Point(l.x+o,l.y)),f.push(new St.Point(a.x+o,a.y))),f.push(nt.end),k=f):ft&&(void(i=0)!==(e=Ct(J,n,i,!0,!1)).dx&&(n=e.dx,i=e.dy),o=n,a=i,f=[],e=J.start,n=J.end,vt&&(h=ct?(h=n.y>e.y?q[q.length-1].y-W:q[q.length-1].y+W,i=n.y>e.y?n.y-z:n.y+z,n.y>e.y?i<h?i:h:h<i?i:h):n.y>e.y?n.y-z:n.y+z,gt.endBendingPt=new St.Point(n.x,h),gt.canEndBend=n.y>e.y?!(h<=e.y):!(h>=e.y)),dt?gt.canEndBend?(h=gt.endBendingPt,Math.abs(o)<B?f.push(e):(Math.abs(h.x+o-tt.start.x)<B?(f.push(tt.start),f.push(new St.Point(tt.start.x,h.y))):(f.push(tt.start),f.push(new St.Point(e.x+o,e.y)),f.push(new St.Point(h.x+o,h.y))),f.push(h)),f.push(n)):(f.push(J.start),f.push(J.end)):Math.abs(n.x+o-tt.start.x)<B?(
f.push(tt.start),f.push(new St.Point(tt.start.x,n.y+a))):(f.push(tt.start),f.push(new St.Point(e.x+o,e.y)),f.push(new St.Point(n.x+o,n.y))),k=f),k}function R(t,n){var i=[],r=[],s=function(t){var n=t.getLines(),i=n.length;if(i<1)return null;if(i<=2){var r=t.getEnd();var s=r?r.getProxy():null;var u=null;if(r)u=s?s.getConnectionDirection():r.getConnectionDirection();else u=new St.Vector(0,0);var h=i===1?0:1;return{endPoint:[n[h].end.x,n[h].end.y],dir:u}}else return{endPoint:[n[1].end.x,n[1].end.y],dir:new St.Vector(0,0)}}(U),u=(e=t,o=n,{startPoint:[Q[1].start.x+e,Q[1].start.y+o],dir:new St.Vector(0,0)});s&&(i=[u.startPoint[0],u.startPoint[1],s.endPoint[0],s.endPoint[1]],r=[u.dir.x,u.dir.y,s.dir.x,s.dir.y]);var h,e=[],o=!1,u=!1;if(u=1!==pt.type?v(new St.Point(Q[1].start.x+t,Q[1].start.y+n),St.ConnectionEnd.START):u){s=p.moveConstraint.attachingUtil.getAttachmentData();if(i[0]=s.attachingPoint.x,i[1]=s.attachingPoint.y,r[0]=s.directionVector.x,r[1]=s.directionVector.y,f=Et(U,
St.RoutingReason.StartPointMoved,null,null,-1,i,r,u,s.Lk))return f;u=c(j,Q[1],St.ConnectionEnd.START,s.attachingPoint,s.directionVector,s.Lk);(o=u.isRouted)?(p.moveConstraint.attachingUtil.connectionPreviewPath=u.pathArray.concat(),e=u.pathArray.reverse()):(t=s.attachingPoint.x-Q[1].start.x,n=s.attachingPoint.y-Q[1].start.y)}else{if(f=Et(U,St.RoutingReason.StartPointMoved,null,null,-1,i,r))return f;var f=F(Q[1].start,t,n);t+=f.x,n+=f.y}return e=!o?j===St.ConnectionBendControlOption.Orthogonal?Q[1].isVertical()?nt?(void 0!==(h=Ct(Q[1],t,n,!1,!1)).dx&&(t=h.dx,n=h.dy),O(t,n)):(void 0!==(h=Ct(Q[1],t,n,!1,!1)).dy&&(n=h.dy),y(t,n)):Q[1].isHorizontal()?nt?(void 0!==(h=Ct(Q[1],t,n,!1,!0)).dy&&(t=h.dx,n=h.dy),_(t,n)):(void 0!==(h=Ct(Q[1],t,n,!1,!0)).dx&&(t=h.dx),C(t,n)):(nt?g:M)(t,n):(nt?g:M)(t,n):e}function P(t,n){var i=[],r=[],s=function(t){var n=t.getLines(),i=n.length;if(i<1)return null;if(i<=2){var r=t.getStart();var s=r?r.getProxy():null;var u=null;if(r)u=s?s.getConnectionDirection(
):r.getConnectionDirection();else u=new St.Vector(0,0);return{endPoint:[n[0].start.x,n[0].start.y],dir:u}}else return{endPoint:[n[i-2].start.x,n[1].start.y],dir:new St.Vector(0,0)}}(U),u=(e=t,o=n,{startPoint:[Q[0].end.x+e,Q[0].end.y+o],dir:new St.Vector(0,0)});s&&(i=[u.startPoint[0],u.startPoint[1],s.endPoint[0],s.endPoint[1]],r=[u.dir.x,u.dir.y,s.dir.x,s.dir.y]);var h,e=[],o=!1,u=!1;if(u=1!==pt.type?v(new St.Point(Q[0].end.x+t,Q[0].end.y+n),St.ConnectionEnd.END):u){s=p.moveConstraint.attachingUtil.getAttachmentData();if(i[0]=s.attachingPoint.x,i[1]=s.attachingPoint.y,r[0]=s.directionVector.x,r[1]=s.directionVector.y,f=Et(U,St.RoutingReason.EndPointMoved,null,null,-1,i,r,u,s.Lk))return f;u=c(j,Q[0],St.ConnectionEnd.END,s.attachingPoint,s.directionVector,s.Lk);(o=u.isRouted)?(p.moveConstraint.attachingUtil.connectionPreviewPath=u.pathArray.concat(),e=u.pathArray):(t=s.attachingPoint.x-Q[0].end.x,n=s.attachingPoint.y-Q[0].end.y)}else{if(f=Et(U,St.RoutingReason.EndPointMoved,null,null,-1,
i,r))return f;var f=F(Q[0].end,t,n);t+=f.x,n+=f.y}return e=!o?j===St.ConnectionBendControlOption.Orthogonal?Q[0].isVertical()?tt?(void 0!==(h=Ct(Q[0],t,n,!0,!1)).dx&&(t=h.dx,n=h.dy),D(t,n)):(void 0!==(h=Ct(Q[0],t,n,!0,!1)).dy&&(n=h.dy),E(t,n)):Q[0].isHorizontal()?tt?(void 0!==(h=Ct(Q[0],t,n,!0,!0)).dy&&(t=h.dx,n=h.dy),S(t,n)):(void 0!==(h=Ct(Q[0],t,n,!0,!0)).dx&&(t=h.dx),N(t,n)):(tt?b:k)(t,n):(tt?b:k)(t,n):e}function H(t,n,i,r){if(u=Et(U,St.RoutingReason.BendPointMoved,i,r,-1,[],[]))return u;var s,i=[],r=[],u=F(Q[1].start,t,n);return t+=u.x,n+=u.y,(Q[0].isHorizontal()||Q[0].isVertical())&&(Q[1].isHorizontal()||Q[1].isVertical())&&(u=h(Q,t,n,!0),s=h(Q,t,n,!1),void 0!==u.dx&&void 0!==s.dx?t=(Math.abs(u.dx)<Math.abs(s.dx)?u:s).dx:void 0!==u.dx?t=u.dx:void 0!==s.dx&&(t=s.dx),void 0!==u.dy&&void 0!==s.dy?n=(Math.abs(u.dy)<Math.abs(s.dy)?u:s).dy:void 0!==u.dy?n=u.dy:void 0!==s.dy&&(n=s.dy)),j===St.ConnectionBendControlOption.Orthogonal?(r=Q[0].isHorizontal()?(i=(tt?S:N)(t,n),(
Q[1].isVertical()?nt?O:y:nt?g:M)(t,n)):Q[0].isVertical()?(i=(tt?D:E)(t,n),(Q[1].isHorizontal()?nt?_:C:nt?g:M)(t,n)):(i=(tt?b:k)(t,n),(Q[1].isHorizontal()?nt?_:C:Q[1].isVertical()?nt?O:y:nt?g:M)(t,n)),function(t,n,i,r){for(var s=Q[1].start,n=new St.Point(s.x+t,s.y+n),u=[],h=[],e=0,o=i.length;e<o;e++)u.push(i[e].clone());for(e=0,o=r.length;e<o;e++)h.push(r[e].clone());return mt.isType(Ut.BEFORE_BENDING_HORIZONTAL)&&Q[1].isHorizontal()?mt.isType(Ut.NEXT_VERTICAL)?(n.x=Q[1].end.x,n.y=gt.startBendingPt.y):(n=null,h[1].y=gt.startBendingPt.y):mt.isType(Ut.BEFORE_BENDING_VERTICAL)&&Q[1].isVertical()?mt.isType(Ut.NEXT_HORIZONTAL)?(n.x=gt.startBendingPt.x,n.y=Q[1].end.y):(n=null,h[1].x=gt.startBendingPt.x):mt.isType(Ut.AFTER_BENDING_HORIZONTAL)&&Q[0].isHorizontal()?mt.isType(Ut.PREVIOUS_VERTICAL)?(n.x=Q[0].start.x,n.y=gt.endBendingPt.y):(n=null,u[u.length-2].y=gt.endBendingPt.y):mt.isType(Ut.AFTER_BENDING_VERTICAL)&&Q[0].isVertical()?mt.isType(Ut.PREVIOUS_HORIZONTAL)?(n.x=gt.endBendingPt.x,
n.y=Q[0].start.y):(n=null,u[u.length-2].x=gt.endBendingPt.x):mt.isType(Ut.PREVIOUS_VERTICAL)&&Q[1].isVertical()?mt.isType(Ut.NEXT_HORIZONTAL)?(n.x=Q[0].start.x,n.y=Q[1].end.y):mt.isType(Ut.BEFORE_PREVIOUS_HORIZONTAL)?(n=tt.start,h[1].x=tt.start.x):(n=null,h[1].x=Q[0].start.x):mt.isType(Ut.NEXT_HORIZONTAL)&&Q[0].isHorizontal()?mt.isType(Ut.PREVIOUS_VERTICAL)?(n.x=Q[0].start.x,n.y=Q[1].end.y):mt.isType(Ut.AFTER_NEXT_VERTICAL)?(n=nt.end,u[u.length-2].y=nt.end.y):(n=null,u[u.length-2].y=Q[1].end.y):mt.isType(Ut.PREVIOUS_HORIZONTAL)&&Q[1].isHorizontal()?mt.isType(Ut.NEXT_VERTICAL)?(n.x=Q[1].end.x,n.y=Q[0].start.y):mt.isType(Ut.BEFORE_PREVIOUS_VERTICAL)?(n=tt.start,h[1].y=tt.start.y):(n=null,h[1].y=Q[0].start.y):mt.isType(Ut.NEXT_VERTICAL)&&Q[0].isVertical()?mt.isType(Ut.PREVIOUS_HORIZONTAL)?(n.x=Q[1].end.x,n.y=Q[0].start.y):mt.isType(Ut.AFTER_NEXT_HORIZONTAL)?(n=nt.end,u[u.length-2].x=nt.end.x):(n=null,u[u.length-2].x=Q[1].end.x):(mt.isType(Ut.BEFORE_BENDING_HORIZONTAL)&&(
n.y=gt.startBendingPt.y),mt.isType(Ut.BEFORE_PREVIOUS_HORIZONTAL)&&(n.y=tt.start.y),mt.isType(Ut.PREVIOUS_HORIZONTAL)&&(n.y=Q[0].start.y),mt.isType(Ut.NEXT_HORIZONTAL)&&(n.y=Q[1].end.y),mt.isType(Ut.AFTER_NEXT_HORIZONTAL)&&(n.y=nt.end.y),mt.isType(Ut.AFTER_BENDING_HORIZONTAL)&&(n.y=gt.endBendingPt.y),mt.isType(Ut.BEFORE_BENDING_VERTICAL)&&(n.x=gt.startBendingPt.x),mt.isType(Ut.BEFORE_PREVIOUS_VERTICAL)&&(n.x=tt.start.x),mt.isType(Ut.PREVIOUS_VERTICAL)&&(n.x=Q[0].start.x),mt.isType(Ut.NEXT_VERTICAL)&&(n.x=Q[1].end.x),mt.isType(Ut.AFTER_NEXT_VERTICAL)&&(n.x=nt.end.x),mt.isType(Ut.AFTER_BENDING_VERTICAL)&&(n.x=gt.endBendingPt.x)),0<u.length&&u.pop(),0<h.length&&h.shift(),null!==n&&u.push(n),u.concat(h)}(t,n,i,r)):(i=(tt?b:k)(t,n),r=(nt?g:M)(t,n),s=t,t=n,n=i,i=r,r=Q[1].start,t=new St.Point(r.x+s,r.y+t),mt.isType(Ut.BEFORE_BENDING_HORIZONTAL)&&(t.y=gt.startBendingPt.y),mt.isType(Ut.PREVIOUS_HORIZONTAL)&&(t.y=Q[0].start.y),mt.isType(Ut.NEXT_HORIZONTAL)&&(t.y=Q[1].end.y),mt.isType(
Ut.AFTER_BENDING_HORIZONTAL)&&(t.y=gt.endBendingPt.y),mt.isType(Ut.BEFORE_BENDING_VERTICAL)&&(t.x=gt.startBendingPt.x),mt.isType(Ut.PREVIOUS_VERTICAL)&&(t.x=Q[0].start.x),mt.isType(Ut.NEXT_VERTICAL)&&(t.x=Q[1].end.x),mt.isType(Ut.AFTER_BENDING_VERTICAL)&&(t.x=gt.endBendingPt.x),0<n.length&&n.pop(),0<i.length&&i.shift(),null!==t&&n.push(t),n.concat(i))}function L(t,n,i){var r=p.getSheet().getSession(),s=r.dM();if((r=r.CM()).beginTransaction(Dt.messages.ModelChangeMessage),n===St.ConnectionEndAttachment.DETACHED&&U.setStart(null,!0),i===St.ConnectionEndAttachment.DETACHED&&U.setEnd(null,!0),1===pt.type?pt.dragId===Tt.ConnectionStartDrag?wt.setAnchorPosition(t[0].x,t[0].y):dt.setAnchorPosition(t[t.length-1].x,t[t.length-1].y):function(t){var n=U.getStart();n?n===wt&&(r=q[0],t[0].x===t[1].x?(r.x=t[0].x,t.splice(0,1,r)):t[0].y===t[1].y&&(r.y=t[0].y,t.splice(0,1,r))):(i=U.getStartLocation())?i.setEvaluatedLocation(t[0].x,t[0].y):U.setStartLocation(new _t.Location(t[0].x,t[0].y),!0);var i,
r=U.getEnd();r?r===dt&&(r=q[q.length-1],t[t.length-1].x===t[t.length-2].x?(r.x=t[t.length-1].x,t.splice(t.length-1,1,r)):t[t.length-1].y===t[t.length-2].y&&(r.y=t[t.length-1].y,t.splice(t.length-1,1,r))):(i=U.getEndLocation())?i.setEvaluatedLocation(t[t.length-1].x,t[t.length-1].y):U.setEndLocation(new _t.Location(t[t.length-1].x,t[t.length-1].y),!0)}(t),U.tx(t),U.setPath(t),G)for(var u=0,h=G.length;u<h;u++){var e=G[u],o=I(e.pathFromEvent);e.connection.setPath(o),s.nx(e)}s.nx(U),r.endTransaction(Dt.messages.ModelChangeMessage)}function I(t){var n=r(t[0]),i=r(t[t.length-1]),n=null==n?[]:K.slice(0,n),i=null==i?[]:K.slice(i+1),i=n.concat(t).concat(i);return U.Fk(i),i}function F(t,n,i){var r={x:0,y:0},s=p.moveConstraint.snap;return s.isSnapSegmentActive()&&(s.snapPointToGrid(t,n,i),s.isSnapX&&(r.x=s.snapX),s.isSnapY&&(r.y=s.snapY)),r}function V(t){for(var n=t.getLines(),i=0,r=n.length;i<r;i++)if(J&&J.start.equal(n[i].start)&&J.end.equal(n[i].end))return i;return-1}var i,j,W,z,Y,B,u,e,Z,
U=null,G=null,X=null,o=null,$=null,q=[],K=[],J=null,Q=[null,null],tt=null,nt=null,it=null,rt=null,st=null,ut=null,ht=!1,et=!1,ot=!1,ft=!1,at=!0,ct=!0,lt=null,vt=null,wt=null,dt=null,mt=null,gt=null,Mt=[],pt={type:0,dragId:0},f=p.moveConstraint.snap,bt=function(t,n,i,r){var s,u,h;if(t?0<t.getConnectionDirection().length()&&(u=t.getResolvedConnectionDirection().normalize(),s=t.getResolvedSymbolConnectionPoint(),h=t.getOwner().getTransformedBBox()):n&&i&&r&&0<=r.length()&&(u=r.normalize(),s=i,h=n),s&&h&&u){var e,o,f,n=new St.Point(0,0);return u.equal(St.Vector.PositiveX)?(e=s.x+W,o=s.x+Y,f=h.x+h.width+z,n.x=Math.max(e,o,f),n.y=s.y):u.equal(St.Vector.PositiveY)?(e=s.y+W,o=s.y+Y,f=h.y+h.height+z,n.x=s.x,n.y=Math.max(e,o,f)):u.equal(St.Vector.NegativeX)?(e=s.x-W,o=s.x-Y,f=h.x-z,n.x=Math.min(e,o,f),n.y=s.y):u.equal(St.Vector.NegativeY)?(e=s.y-W,o=s.y-Y,f=h.y-z,n.x=s.x,n.y=Math.min(e,o,f)):n=null,n}return null},kt=function(t,n,i,r,s){var u,h,e,o,f,a,c=!1,l=[];return t&&i&&(c=!0,l.push(t),
n.equal(St.Vector.PositiveX)?r.equal(St.Vector.NegativeY)?(o=s.x-z,i.x>o?(h=s.y-z,e=s.y+s.height+z,t.y>h&&t.y<e?(t.x!==o&&l.push(new St.Point(o,t.y)),l.push(new St.Point(o,e)),l.push(new St.Point(i.x,e))):t.x!==i.x&&l.push(new St.Point(i.x,t.y))):t.x!==i.x&&l.push(new St.Point(i.x,t.y))):r.equal(St.Vector.PositiveY)?(o=s.x-z,i.x>o?(h=s.y-z,e=s.y+s.height+z,t.y>h&&t.y<e?(t.x!==o&&l.push(new St.Point(o,t.y)),l.push(new St.Point(o,h)),l.push(new St.Point(i.x,h))):t.x!==i.x&&l.push(new St.Point(i.x,t.y))):t.x!==i.x&&l.push(new St.Point(i.x,t.y))):r.equal(St.Vector.NegativeX)?(u=i.x-s.x+z,i.x-u!==t.x&&l.push(new St.Point(i.x-u,t.y)),l.push(new St.Point(i.x-u,i.y))):r.equal(St.Vector.PositiveX)?(u=s.x+s.width-i.x+z,i.x+u>t.x?(l.push(new St.Point(i.x+u,t.y)),l.push(new St.Point(i.x+u,i.y))):l.push(new St.Point(t.x,i.y))):c=!1:n.equal(St.Vector.NegativeX)?r.equal(St.Vector.NegativeY)?(f=s.x+s.width+z,i.x<f?(h=s.y-z,e=s.y+s.height+z,t.y>h&&t.y<e?(t.x!==f&&l.push(new St.Point(f,t.y)),l.push(
new St.Point(f,e)),l.push(new St.Point(i.x,e))):t.x!==i.x&&l.push(new St.Point(i.x,t.y))):t.x!==i.x&&l.push(new St.Point(i.x,t.y))):r.equal(St.Vector.PositiveY)?(f=s.x+s.width+z,i.x<f?(h=s.y-z,e=s.y+s.height+z,t.y>h&&t.y<e?(t.x!==f&&l.push(new St.Point(f,t.y)),l.push(new St.Point(f,h)),l.push(new St.Point(i.x,h))):t.x!==i.x&&l.push(new St.Point(i.x,t.y))):t.x!==i.x&&l.push(new St.Point(i.x,t.y))):r.equal(St.Vector.PositiveX)?(u=s.x+s.width-i.x+z,i.x+u!==t.x&&l.push(new St.Point(i.x+u,t.y)),l.push(new St.Point(i.x+u,i.y))):r.equal(St.Vector.NegativeX)?(u=i.x-s.x+z,i.x-u<t.x?(l.push(new St.Point(i.x-u,t.y)),l.push(new St.Point(i.x-u,i.y))):l.push(new St.Point(t.x,i.y))):c=!1:n.equal(St.Vector.PositiveY)?r.equal(St.Vector.NegativeX)?(h=s.y-z,i.y>h?(o=s.x-z,f=s.x+s.width+z,t.x>o&&t.x<f?(t.y!==h&&l.push(new St.Point(t.x,h)),l.push(new St.Point(f,h)),l.push(new St.Point(f,i.y))):t.y!==i.y&&l.push(new St.Point(t.x,i.y))):t.y!==i.y&&l.push(new St.Point(t.x,i.y))):r.equal(St.Vector.PositiveX)?(
h=s.y-z,i.y>h?(o=s.x-z,f=s.x+s.width+z,t.x>o&&t.x<f?(t.y!==h&&l.push(new St.Point(t.x,h)),l.push(new St.Point(o,h)),l.push(new St.Point(o,i.y))):t.y!==i.y&&l.push(new St.Point(t.x,i.y))):t.y!==i.y&&l.push(new St.Point(t.x,i.y))):r.equal(St.Vector.NegativeY)?(a=i.y-s.y+z,i.y-a!==t.y&&l.push(new St.Point(t.x,i.y-a)),l.push(new St.Point(i.x,i.y-a))):r.equal(St.Vector.PositiveY)?(a=s.y+s.height-i.y+z,i.y+a>t.y?(l.push(new St.Point(t.x,i.y+a)),l.push(new St.Point(i.x,i.y+a))):l.push(new St.Point(i.x,t.y))):c=!1:n.equal(St.Vector.NegativeY)?r.equal(St.Vector.NegativeX)?(e=s.y+s.height+z,i.y<e?(o=s.x-z,f=s.x+s.width+z,t.x>o&&t.x<f?(t.y!==e&&l.push(new St.Point(t.x,e)),l.push(new St.Point(f,e)),l.push(new St.Point(f,i.y))):t.y!==i.y&&l.push(new St.Point(t.x,i.y))):t.y!==i.y&&l.push(new St.Point(t.x,i.y))):r.equal(St.Vector.PositiveX)?(e=s.y+s.height+z,i.y<e?(o=s.x-z,f=s.x+s.width+z,t.x>o&&t.x<f?(t.y!==e&&l.push(new St.Point(t.x,e)),l.push(new St.Point(o,e)),l.push(new St.Point(o,i.y))
):t.y!==i.y&&l.push(new St.Point(t.x,i.y))):t.y!==i.y&&l.push(new St.Point(t.x,i.y))):r.equal(St.Vector.PositiveY)?(a=s.y+s.height-i.y+z,i.y+a!==t.y&&l.push(new St.Point(t.x,i.y+a)),l.push(new St.Point(i.x,i.y+a))):r.equal(St.Vector.NegativeY)?(a=i.y-s.y+z,i.y-a<t.y?(l.push(new St.Point(t.x,i.y-a)),l.push(new St.Point(i.x,i.y-a))):l.push(new St.Point(i.x,t.y))):c=!1:c=!1,l.push(i)),{isRouted:c,pointArray:l}},yt=function(t,n,i,r,s,u){var h,e,o=null,f=t.getSession().dM();return f&&(s||(h=F(i),i.x+=h.x,i.y+=h.y),(u=f.ix(t,n,i,r,s,u))&&(1===pt.type&&(pt.dragId===Tt.ConnectionStartDrag?(e=wt.rx(i),u.xk=[a(e)]):pt.dragId===Tt.ConnectionEndDrag&&(e=dt.rx(i),u.Ek=[a(e)])),o=f.fs(u))),o},xt=function(t,n){var i,r,s,u,h;t==St.RoutingReason.EndPointMoved?(Q[0].isVertical()||Q[0].isHorizontal())&&j===St.ConnectionBendControlOption.Orthogonal?(r=n[n.length-1],s=n[n.length-2],i=n[n.length-3],u=Math.abs(r.x-s.x),h=Math.abs(r.y-s.y),u<B&&h<B?n.pop():u<B?r.x=s.x:h<B&&(r.y=s.y),i&&(u=Math.abs(r.x-i.x),
h=Math.abs(r.y-i.y),u<B?(r.x=i.x,s.x=i.x):h<B&&(r.y=i.y,s.y=i.y))):(r=n[n.length-1],s=n[n.length-2],u=Math.abs(r.x-s.x),h=Math.abs(r.y-s.y),u<B&&h<B?n.pop():u<B?r.x=s.x:h<B&&(r.y=s.y)):t==St.RoutingReason.StartPointMoved&&((Q[1].isVertical()||Q[1].isHorizontal())&&j===St.ConnectionBendControlOption.Orthogonal?(r=n[0],s=n[1],i=n[2],u=Math.abs(r.x-s.x),h=Math.abs(r.y-s.y),u<B&&h<B?n.shift():u<B?r.x=s.x:h<B&&(r.y=s.y),i&&(u=Math.abs(r.x-i.x),h=Math.abs(r.y-i.y),u<B?(r.x=i.x,s.x=i.x):h<B&&(r.y=i.y,s.y=i.y))):(r=n[0],s=n[1],u=Math.abs(r.x-s.x),h=Math.abs(r.y-s.y),u<B&&h<B?n.shift():u<B?r.x=s.x:h<B&&(r.y=s.y)))},Et=function(t,n,i,r,s,u,h,e,o){if(G=null,t.isDefaultAutoRoutingOn()){if(n!=St.RoutingReason.StartPointMoved&&n!=St.RoutingReason.EndPointMoved)return null;var f=new St.Point(u[0],u[1]),a=new St.Vector(h[0],h[1]),c=yt(t,n,f,a,e,o);return xt(n,c),c}var l=p.getSheet();if(l){var v=new At.ConnectionRoutingEventArgs(!0);v.connections.push(t),v.reasons.push(n),i&&(v.clickLocation=[i.x,i.y])
,r&&(v.cursorLocation=[r.x,r.y]),v.segmentId=s,v.inputEndPoints=u,v.directions=h,X=v;s=new Dt.messages.EventMessage(v,At.EventType.OnConnectionRouting);if(l.getSession().CM().BM(s)){for(var w=v.getConnectionRoutingResult(),d=v.getConnections(),m=0,g=d.length;m<g;m++){var M=d[m];M!==t&&(G=G||[]).push({connection:M,pathFromEvent:w[M.guid]})}v=w[t.guid];return n==St.RoutingReason.EndPointMoved&&v.reverse(),v}if(n==St.RoutingReason.StartPointMoved||n==St.RoutingReason.EndPointMoved){f=new St.Point(u[0],u[1]),a=new St.Vector(h[0],h[1]),c=yt(t,n,f,a,e,o);return xt(n,c),c}}return null},Ct=function(t,n,i,r,s){var u,h,e,o=t.start,f=t.end,a={},c=r?wt:dt;return c&&!c.connectionDirectionReversible&&(h=c.getResolvedConnectionDirection(),u=bt(c),h&&u&&(h=h.normalize(),(r?st:ut)?(t=r?U.sx(st):U.ux(ut),c=r?Tt.ConnectionStartDrag:Tt.ConnectionEndDrag,t&&t.getId()===c&&(e=r?f:o,t=r?tt.start:nt.end,c=r?nt:tt,s?Math.abs(e.y+i-t.y)<B&&(h.equal(St.Vector.PositiveX)&&e.x+n<u.x||h.equal(St.Vector.NegativeX
)&&e.x+n>u.x)&&(a.dx=u.x-e.x,a.dy=c?0:i):Math.abs(e.x+n-t.x)<B&&(h.equal(St.Vector.PositiveY)&&e.y+i<u.y||h.equal(St.Vector.NegativeY)&&e.y+i>u.y)&&(a.dx=c?0:n,a.dy=u.y-e.y))):(r?tt:nt)?s?(h.equal(St.Vector.PositiveY)&&o.y+i<u.y||h.equal(St.Vector.NegativeY)&&o.y+i>u.y)&&(a.dx=n,a.dy=u.y-o.y):(h.equal(St.Vector.PositiveX)&&o.x+n<u.x||h.equal(St.Vector.NegativeX)&&o.x+n>u.x)&&(a.dx=u.x-o.x,a.dy=i):(e=r?f:o,s?Math.abs(i)<B&&(h.equal(St.Vector.PositiveX)&&e.x+n<u.x||h.equal(St.Vector.NegativeX)&&e.x+n>u.x)&&(a.dx=u.x-e.x,a.dy=i):Math.abs(n)<B&&(h.equal(St.Vector.PositiveY)&&e.y+i<u.y||h.equal(St.Vector.NegativeY)&&e.y+i>u.y)&&(a.dx=n,a.dy=u.y-e.y)))),a};this.setOverlay=function(t){if(o!==t){if(null==(o=t))return s(),void p.getSheet().setFocusedElements(null,!1);var n,i,r;s(),U=t.getOwner(),q=U.getGeometry().getPoints(),K=U.trimPathToNodes(q.concat()),$=t.getId(),Mt=K,lt=U.getStartRect(),vt=U.getEndRect(),wt=U.getStart(),dt=U.getEnd(),lt&&lt.isPointInside(q[1])&&(at=!1),
vt&&vt.isPointInside(q[q.length-2])&&(ct=!1),t instanceof Zt?function(t){var n=t.getGeometry();J=n[0].clone();n=U.sx(t);n&&(n instanceof u||n instanceof e)&&((n=U.sx(n))&&n instanceof Zt&&(i=n.getGeometry(),tt=i[0].clone(),(n=U.sx(n))&&(n instanceof u||n instanceof e)&&(st=U.sx(n))&&st instanceof Zt&&(i=st.getGeometry(),it=i[0].clone())));var i,t=U.ux(t);t&&(t instanceof u||t instanceof e)&&((t=U.ux(t))&&t instanceof Zt&&(i=t.getGeometry(),nt=i[0].clone(),(t=U.ux(t))&&(t instanceof u||t instanceof e)&&(ut=U.ux(t))&&ut instanceof Zt&&(i=ut.getGeometry(),rt=i[0].clone()))),tt&&nt?ot=!0:tt?ft=!0:nt?et=!0:ht=!0}(t):(t instanceof u||t instanceof e)&&(n=t,t=U.ux(n),n=U.sx(n),t&&t instanceof Zt&&(r=t.getGeometry(),Q[1]=r[0].clone(),(i=U.ux(t))&&(i instanceof u||i instanceof e)&&((t=U.ux(i))&&t instanceof Zt&&(r=t.getGeometry(),nt=r[0].clone(),(i=U.ux(t))&&(i instanceof u||i instanceof e)&&(ut=U.ux(i))&&ut instanceof Zt&&(r=ut.getGeometry(),rt=r[0].clone())))),n&&n instanceof Zt&&(
r=n.getGeometry(),Q[0]=r[0].clone(),(i=U.sx(n))&&(i instanceof u||i instanceof e)&&((n=U.sx(i))&&n instanceof Zt&&(r=n.getGeometry(),tt=r[0].clone(),(i=U.sx(n))&&(i instanceof u||i instanceof e)&&(st=U.sx(i))&&st instanceof Zt&&(r=st.getGeometry(),it=r[0].clone()))))),p.moveConstraint.attachingUtil.connectionSegments=Q,mt?mt.reset():mt=new Ut,gt?gt.reset():gt=new Gt}},this.previewConnection=function(t,n,i,r,s){var u=[];if(U){void 0===t.x&&(t.x=0),void 0===t.y&&(t.y=0),r=r||new St.Point(t.x-n,t.y-i),mt.reset();var h=St.ConnectionEndAttachment.NOCHANGE,e=St.ConnectionEndAttachment.NOCHANGE;switch(pt.type=s?1:0,pt.dragId=$,U.XM()&_t.HighlightFlags.Focused||p.getSheet().setFocusedElements([U],!0),$){case Tt.ConnectionStartDrag:u=R(n,i),!s&&wt&&(h=St.ConnectionEndAttachment.DETACHED);break;case Tt.ConnectionEndDrag:u=P(n,i),!s&&dt&&(e=St.ConnectionEndAttachment.DETACHED);break;case Tt.ConnectionBendingDrag:var o=Q[0].end,u=H(n,i,o,t);break;case Tt.ConnectionSegEastWestDrag:var f=V(U);u=A(
t.clone(),n,i,r,t,f);break;case Tt.ConnectionSegNorthSouthDrag:f=V(U);u=T(t.clone(),n,i,r,t,f);break;case Tt.ConnectionSegNorthEastDrag:case Tt.ConnectionSegNorthWestDrag:f=V(U);u=Z?x(t.clone(),r,t,f):function(t,n,i){var r,s=[],u=J.start.clone(),h=J.end.clone(),e=1,o=1;tt&&(s.push(tt.start),tt.isHorizontal()?o=0:tt.isVertical()&&(e=0)),nt&&(nt.isHorizontal()?o=0:nt.isVertical()&&(e=0)),0!=e||0!=o?(g=o*i,u.x+=n=e*n,u.y+=g,h.x+=n,h.y+=g):(r=(h.y-u.y)/(h.x-u.x),v=t.y-r*t.x,d=new St.Point(u.x,u.x*r+v),u=(m=new St.Line(t,d)).getIntersectedPoint(tt),h=m.getIntersectedPoint(nt));var f,a,c,l,v,w,d,m,g=F(u),t=F(h);return e?(f=g.x>t.x?t:g,u.x+=f.x,h.x+=f.x,o&&(u.y+=f.y,h.y+=f.y)):o?(f=g.y>t.y?t:g,u.y+=f.y,h.y+=f.y):(tt.isHorizontal()?g.x>t.y?(d=h).y+=t.y:(d=u).x+=g.x:g.y>t.x?(d=h).x+=t.x:(d=u).y+=g.y,v=d.y-r*d.x,g=u.x+10,g=new St.Point(g,g*r+v),u=(m=new St.Line(d,g)).getIntersectedPoint(tt),h=m.getIntersectedPoint(nt)),et&&(a=wt)&&!a.connectionDirectionReversible&&(
c=a.getResolvedConnectionDirection(),l=bt(a),c&&l&&(c=c.normalize(),tt.isHorizontal()?(c.equal(St.Vector.PositiveX)&&u.x<l.x||c.equal(St.Vector.NegativeX)&&u.x>l.x)&&(u.x=l.x,0==e&&0==o?(v=u.y-r*u.x,w=u.x+10,d=new St.Point(w,w*r+v),h=(m=new St.Line(u,d)).getIntersectedPoint(nt)):h.x=J.end.x+(u.x-J.start.x)):(c.equal(St.Vector.PositiveY)&&u.y<l.y||c.equal(St.Vector.NegativeY)&&u.y>l.y)&&(u.y=l.y,0==e&&0==o?(v=u.y-r*u.x,w=u.x+10,d=new St.Point(w,w*r+v),h=(m=new St.Line(u,d)).getIntersectedPoint(nt)):h.y=J.end.y+(u.y-J.start.y)))),ft&&(a=dt)&&!a.connectionDirectionReversible&&(c=a.getResolvedConnectionDirection(),l=bt(a),c&&l&&(c=c.normalize(),nt.isHorizontal()?(c.equal(St.Vector.PositiveX)&&h.x<l.x||c.equal(St.Vector.NegativeX)&&h.x>l.x)&&(h.x=l.x,0==e&&0==o?(v=h.y-r*h.x,w=h.x+10,d=new St.Point(w,w*r+v),u=(m=new St.Line(h,d)).getIntersectedPoint(tt)):u.x=J.start.x+(h.x-J.end.x)):(c.equal(St.Vector.PositiveY)&&h.y<l.y||c.equal(St.Vector.NegativeY)&&h.y>l.y)&&(h.y=l.y,0==e&&0==o?(
v=h.y-r*h.x,w=h.x+10,d=new St.Point(w,w*r+v),u=(m=new St.Line(h,d)).getIntersectedPoint(tt)):u.y=J.start.y+(h.y-J.end.y)))),0==e&&0==o&&(o=tt.getIntersectedPoint(nt),m.distanceFromPoint(o)<B&&(h=u=o)),s.push(u),s.push(h),nt&&s.push(nt.end),s}(t.clone(),n,i)}var a=I(u);d(U,St.ChangePhase.DELTA,h,e,a)&&(Mt=a)}return Mt},this.getAdditionalMovedConnections=function(){return G};function Nt(t,n){if(t&&n){if(t.length!=n.length)return 1;for(var i=t.length,r=0;r<i;r++)if(!t[r].equal(n[r]))return 1}else if(t!=n)return 1}function Ot(t,n,i){var r,s=p.moveConstraint.attachingUtil,u=i.position,h=i.originalPort;if(i.origConnectionEndPhase===St.ConnectionEndAttachment.ATTACHED){for(var e=s.findOriginalAttachingTargets(t,u,h),o=e.length,f=0;f<o;f++)if(s.attaching(t,e[f],null,u,n,null,null)){var a=s.getAttachmentData();if(s.sendAttachedEvent(a.attachingPoint)){r=St.ConnectionEndAttachment.ATTACHED;break}}r!==St.ConnectionEndAttachment.ATTACHED&&(r=St.ConnectionEndAttachment.DETACHED)
}else r=St.ConnectionEndAttachment.NOCHANGE;return r}this.moveConnection=function(t){if(U){var n,i,r,s,u,h=Mt.concat(),e=St.ConnectionEndAttachment.NOCHANGE,o=St.ConnectionEndAttachment.NOCHANGE,f=p.moveConstraint.attachingUtil,a=p.isDanglingConnectionAllowed(),c=p.storedAttachedData,l=!0;switch($){case Tt.ConnectionStartDrag:f.isAttachingAccepted()?(i=(n=U.getGeometry())?n.getPoints():null,r=f.getAttachmentData(),f.sendAttachedEvent(r.attachingPoint)?((v=m(U))||(s=U.getGeometry())&&(u=s.getPoints(),Nt(i,u)&&(v=u)),(v=v||w(St.ConnectionEnd.START,r.directionVector))&&0<v.length&&(h=v),e=St.ConnectionEndAttachment.ATTACHED):l=!1):t||(a?wt&&(e=St.ConnectionEndAttachment.DETACHED):(l=!1,U.getStart()||(e=Ot(U,St.ConnectionEnd.START,c))));break;case Tt.ConnectionEndDrag:f.isAttachingAccepted()?(i=(n=U.getGeometry())?n.getPoints():null,r=f.getAttachmentData(),f.sendAttachedEvent(r.attachingPoint)?((v=m(U))||(s=U.getGeometry())&&(u=s.getPoints(),Nt(i,u)&&(v=u)),(v=v||w(St.ConnectionEnd.END,
r.directionVector))&&0<v.length&&(h=v),o=St.ConnectionEndAttachment.ATTACHED):l=!1):t||(a?dt&&(o=St.ConnectionEndAttachment.DETACHED):(l=!1,U.getEnd()||(o=Ot(U,St.ConnectionEnd.END,c))));break;case Tt.ConnectionBendingDrag:case Tt.ConnectionSegEastWestDrag:case Tt.ConnectionSegNorthSouthDrag:case Tt.ConnectionSegNorthEastDrag:case Tt.ConnectionSegNorthWestDrag:var v=m(U);v&&(h=I(v).concat())}h&&0<h.length?(l&&L(h,e,o),e===St.ConnectionEndAttachment.ATTACHED||o===St.ConnectionEndAttachment.ATTACHED||d(U,St.ChangePhase.ENDED,e,o,null),p.clearStoredAttachedData()):U.remove()}}}function $t(){ht.call(this)}function qt(){ht.call(this)}function Kt(){ht.call(this)}function Jt(){ht.call(this)}function Qt(){ht.call(this)}function tn(){ht.call(this)}function nn(){ht.call(this)}function rn(){ht.call(this)}function sn(){ht.call(this)}function un(t,n,i){this.hx=null,this.Rk=null,Y.call(this,t,n,i)}function hn(t){this.ex=t,this.enabled=!1,this.selectedIndicator=null,this.ox={locations:[],directions:[
],commonSvg:null,focusSvg:null,size:null,anchorPt:null,focusOption:null,specifiedIndex:null}}ht.inheritedBy(yt),Yt.prototype.hook=function(o,f){ht.prototype.hook.call(this,o,f);function r(){if(d){var t=d.getId();if(t>=Tt.NorthwestResize&&t<=Tt.WestResize){g=!0;var n=f.getSheet().getSession();if(n){var i=n.CM();if(i){var r=[];if((m=f.getSelectedElements())&&0<m.length)for(var s=m.length,u=0;u<s;++u)m[u].getAllowedTransformations()&St.AllowedTransformations.SCALE&&n.ax&St.AllowedTransformations.SCALE&&r.push(m[u]);if(0<(s=(m=r).length)){var h=new At.TransformStartEventArgs(m,"scale",t),e=f.getSheetConfigurationData();h.setPrioritizedAlignmentModes(e.alignmentPriority);t=new Dt.messages.EventMessage(h,At.EventType.OnTransformStart);if(i.BM(t)){if(h.isCancelled())return p(!1),g=!1,0;h.isHandled()&&(m=h.getNewSheetElements())}f.startPreview(m)}}}f.getCommandManager().requestMutex(M)}a=o.cursorControl.lx(),c=!0;e=f.getSheetConfigurationData(),h=f.moveConstraint.snap
;v=e.gridPreferencesData.isSnapToGrid(),l=h.getSnapPitch();h=e.viewData.getScaleFactor(),e=e.selectionPreferencesData.getSelectionRadiusPixel();w=e/h}}var a,c,l,v,w,s=new St.Point(0,0),u=new St.Point(0,0),h=null,d=null,m=null,g=!1,M=this,p=function(t){var n=o.cursorControl.lx();t?n===St.CursorID.MOVEREJECT&&(o.deactivateCursor(n),o.activateCursor(a)):n!==St.CursorID.MOVEREJECT&&(o.deactivateCursor(n),o.activateCursor(St.CursorID.MOVEREJECT))};o.bind("mousedown",function(t){0===t.button&&M.isEnabled()&&(h=o.offset(),s.x=t.pageX-h.left,s.y=t.pageY-h.top,(t=f.getScreenToSheetTransform())&&(s=t.transformPoint(s),d=f.getOverlayByPoint(s),r()))}),o.bind("mouseup touchend pointerup",function(t){if(g&&M.isEnabled()){g=!1,f.getCommandManager().releaseMutex(M);for(var n=m.length,i=0;i<n;i++)m[i].XM()&_t.HighlightFlags.Preview&&m[i].setHighlightFlags(_t.HighlightFlags.Preview,!1);p(!0),a=null,f.resizeElements(),f.setPreviewOverlays(null),f.updateOverlay()}d=d&&(m=null)});function e(){
var t=u.x-s.x,n=u.y-s.y,i=d.getOwner().getXform();i&&(t=(r=i.invert().transformVector(new St.Vector(t,n))).x,n=r.y);var r=f.setPreviewOverlays(d,m,t,n);f.updateOverlay(),c||(r?v?(r=.75*l,Math.abs(t)>r||Math.abs(n)>r?p(!1):p(!0)):Math.abs(t)>w||Math.abs(n)>w?0!==t&&0!==n&&p(!1):p(!0):p(!0)),c=c&&!1}var b,k,y;o.bind("mousemove",function(t){g&&M.isEnabled()&&(u.x=t.pageX-h.left,u.y=t.pageY-h.top,(t=f.getScreenToSheetTransform())&&(u=t.transformPoint(u),e()))}),o.bind("touchstart pointerdown",function(t){if("mouse"!==t.originalEvent.pointerType&&M.isEnabled()){var n=t,t=t.originalEvent.touches;if(t){if(1!==t.length)return;n=t[0]}t=f.getScreenToSheetTransform();h=o.offset(),b=n.pageX-h.left,k=n.pageY-h.top,s=t.transformPoint(new St.Point(b,k));t=new Date;y=t.getTime()}}),o.bind("touchmove pointermove",function(t){var n,i;"mouse"!==t.originalEvent.pointerType&&M.isEnabled()&&(n=(i=(n=(i=t).originalEvent.touches)&&n[0]?n[0]:t).pageX-h.left,t=i.pageY-h.top,i=f.getScreenToSheetTransform(),
u=i.transformPoint(new St.Point(n,t)),g?e():(i=f.getSheetConfigurationData().touchSettings,Math.abs(b-n)<=i.jitterTolerance&&Math.abs(k-t)<=i.jitterTolerance&&(new Date).getTime()-y>i.holdTime&&(d=f.getOverlayByTouch(s),r())))})},Yt.prototype.onEnabled=function(){var t;this.diagramManager&&((t=this.diagramManager.getSheetSession()).ax=t.ax|St.AllowedTransformations.SCALE)},Yt.prototype.onDisabled=function(){var t;this.diagramManager&&((t=this.diagramManager.getSheetSession()).ax=t.ax^St.AllowedTransformations.SCALE)},ht.inheritedBy(Yt),Bt.prototype.hook=function(n,i){ht.prototype.hook.call(this,n,i);var r=!1,s=!1,u=!0,h=!1,e=new St.Point(0,0),o=new St.Point(0,0),f=new St.Rect,a=null,c=null,l=null,v=this;n.bind("keydown",function(t){t.keyCode==St.KeyCode.F6&&(u&&!h&&((l=i.getSheetConfigurationData()).viewData.setZoomMode(!l.viewData.isZoomMode()),c=i.getCommandManager(),l.viewData.isZoomMode()?(c.enableCommand("HoverHighlightCommand",!1),c.enableCommand("RectangleSelectCommand",!1),
i.setHoveredElements(null),v.setEnabled(!0),n.activateCursor(St.CursorID.RECTZOOM)):(c.enableCommand("HoverHighlightCommand",!0),c.enableCommand("RectangleSelectCommand",!0),v.setEnabled(!1),n.deactivateCursor(St.CursorID.RECTZOOM))),u=!1,t.preventDefault())}),n.bind("keyup",function(t){t.keyCode==St.KeyCode.F6&&(u=!0)}),n.bind("mousedown",function(t){h=!0,v.isEnabled()&&(l=i.getSheetConfigurationData()).viewData.isZoomMode()&&0===t.button&&(a=n.offset(),e.x=t.pageX-a.left,e.y=t.pageY-a.top,null!=(t=i.getScreenToSheetTransform())&&(e=t.transformPoint(e),r=!0))}),n.bind("mouseup",function(t){r&&v.isEnabled()&&s&&(i.fitToRectangle(f),f.width=0,f.height=0,i.setSelectingRect(null)),h=!(u=!(s=r=!1)),l=c=a=null}),n.bind("mousemove",function(t){var n;r&&v.isEnabled()&&(o.x=t.pageX-a.left,o.y=t.pageY-a.top,null!=(n=i.getScreenToSheetTransform())&&((o=n.transformPoint(o)).equal(e)||(t=new St.Point(Math.min(e.x,o.x),Math.min(e.y,o.y)),n=new St.Point(Math.max(e.x,o.x),Math.max(e.y,o.y)),f.x=t.x,
f.y=t.y,f.width=n.x-t.x,f.height=n.y-t.y,i.setSelectingRect(f),s=!0)))})},ht.inheritedBy(Bt),Zt.prototype.uk=function(t,n,i,r){for(var s=[],u=n.length,h=0;h<u;h++){var e=n[h].clone();s.push(e)}var o=this.getOwner(),f=r?new St.Point(r.x,r.y):o.getRenderingPosition();if(f)for(var a=s.length,h=0;h<a;h++)s[h].start.x=s[h].start.x-f.x,s[h].start.y=s[h].start.y-f.y,s[h].end.x=s[h].end.x-f.x,s[h].end.y=s[h].end.y-f.y;t.renderLines(s,i)},Zt.prototype.select=function(t){if(this.isSelectable()){var n=this.getGeometry();if(n&&0<n.length)for(var i=0;i<n.length;i++)if(n[i].distanceFromPoint(t.point)<t.tolerance)return t.target=this,!0}return!1},Y.inheritedBy(Zt),Ut.NONE=0,Ut.BEFORE_BENDING_HORIZONTAL=1,Ut.BEFORE_BENDING_VERTICAL=2,Ut.BEFORE_PREVIOUS_HORIZONTAL=4,Ut.BEFORE_PREVIOUS_VERTICAL=8,Ut.PREVIOUS_HORIZONTAL=16,Ut.PREVIOUS_VERTICAL=32,Ut.SELF_HORIZONTAL=64,Ut.SELF_VERTICAL=128,Ut.NEXT_HORIZONTAL=256,Ut.NEXT_VERTICAL=512,Ut.AFTER_NEXT_HORIZONTAL=1024,Ut.AFTER_NEXT_VERTICAL=2048,
Ut.AFTER_BENDING_HORIZONTAL=4096,Ut.AFTER_BENDING_VERTICAL=8192,$t.prototype.hook=function(d,m){ht.prototype.hook.call(this,d,m);function r(){var t,n;g&&g.LM&&(E=x=k=b=!1,N.setOverlay(g),t=g.getOwner(),(n=g.getId())===Tt.ConnectionStartDrag?x=!0:n===Tt.ConnectionEndDrag&&(E=!0),(x&&t.getStart()||E&&t.getEnd())&&d.activateCursor(St.CursorID.BRKLINK),(i=m.getCommandManager()).enableCommand("HoverHighlightCommand",!1),i.enableCommand("SingleSelectCommand",!1),i.enableCommand("MoveCommand",!1))}var i=null,g=null,M=new St.Point,p=new St.Point,s=null,b=!1,k=!1,y=!1,x=!1,E=!1,u=this,C=null,N=new Xt(0,m),O=function(){return m.isDanglingConnectionAllowed()};d.bind("mousedown",function(t){var n;u.isEnabled()&&(n=m.getScreenToSheetTransform(),s=d.offset(),M.x=t.pageX-s.left,M.y=t.pageY-s.top,M=n.transformPoint(M),g=m.getHoverHighlightedConnectionOverlay(),r())}),d.bind("mouseup touchend pointerup",function(t){var n;"pointerup"===t.type&&"mouse"===t.originalEvent.pointerType||g&&u.isEnabled()&&(
y?k&&!C||N.moveConnection(null!==C):(n=m.getCursorPosAndKeyStatus(t),t.ctrlKey?m.setMultiSelectedElements(n):m.setSingleSelectedElement(n)),g.getOwner().vx(null),y=!1,C=g=null,N.setOverlay(null),m.setConnectionOverlay(null),m.setHoverHighlightedConnectionOverlay(null),m.setAddtionalMovedConnectionOverlays(null),m.moveConstraint.attachingUtil.highlightClear(),m.moveConstraint.attachingUtil.reset(),(i=m.getCommandManager()).enableCommand("HoverHighlightCommand",!0),i.enableCommand("SingleSelectCommand",!0),i.enableCommand("MoveCommand",!0),d.deactivateCursor(St.CursorID.BRKLINK),d.deactivateCursor(St.CursorID.UNAVAIL),m.getSheetConfigurationData().overviewWindowData.getDisplayWindow()&&m.getViewportManager().Vk())});function h(){if(!p.equal(M)){y=!0;var t,n,i,r,s,u,h,e=g.getOwner();b||((t=m.getSheetSession().CM())&&(u=e.getStart(),h=e.getEnd(),n=m.storedAttachedData,r=!(s=i=null),(x||E)&&(s=x?St.ConnectionEnd.START:St.ConnectionEnd.END,x&&u?i=u:E&&h&&(i=h),O()||(
n.origConnectionEndPhase=St.ConnectionEndAttachment.DETACHED,i&&(n.originalPort=i,n.position=new St.Point(i.getAnchorPositionX(),i.getAnchorPositionY()),n.origConnectionEndPhase=St.ConnectionEndAttachment.ATTACHED)),i&&(f=new D(e,[i],s),o=new Dt.messages.EventMessage(f,_.OnDetaching),t.BM(o)&&f.isCancelled()&&(r=!1,i.isPinned()||i.getTransformPolicy()!==St.PortTransformPolicy.RotateOnOwnerOutline||0!==i.getSymbols().length||(C=i.getMoveStrategy())))),r?(u=x&&u?St.ConnectionEndAttachment.DETACHED:St.ConnectionEndAttachment.NOCHANGE,h=E&&h?St.ConnectionEndAttachment.DETACHED:St.ConnectionEndAttachment.NOCHANGE,f=new A(e,St.ChangePhase.STARTING,u,h,null),o=new Dt.messages.EventMessage(f,_.OnGeometryChange),t.BM(o)&&f.isCancelled()&&(k=!0)):k=!0),b=!0);var o=p.x-M.x,f=p.y-M.y;if(k)C?(a=C.getFinalTransformation(o,f),a=N.previewConnection(p,a.dx,a.dy,null,!0),g&&m.setConnectionOverlay(a,e)):d.activateCursor(St.CursorID.UNAVAIL);else{var a=N.previewConnection(p,o,f,M);if(g){
var c=N.getAdditionalMovedConnections();if(c){for(var l=[],v=0,w=c.length;v<w;v++)l.push(c[v].pathFromEvent);m.setAddtionalMovedConnectionOverlays(l)}m.setConnectionOverlay(a,e)}}}}var e,o,f;d.bind("mousemove",function(t){g&&u.isEnabled()&&(p.x=t.pageX-s.left,p.y=t.pageY-s.top,t=m.getScreenToSheetTransform(),p=t.transformPoint(p),h())}),d.bind("touchstart pointerdown",function(t){if("mouse"!==t.originalEvent.pointerType&&u.isEnabled()){var n=t,t=t.originalEvent.touches;if(t){if(1!==t.length)return;n=t[0]}t=m.getScreenToSheetTransform();s=d.offset(),e=n.pageX-s.left,o=n.pageY-s.top,M=t.transformPoint(new St.Point(e,o));t=new Date;f=t.getTime()}}),d.bind("touchmove pointermove",function(t){var n,i;"mouse"!==t.originalEvent.pointerType&&u.isEnabled()&&(n=(i=(n=(i=t).originalEvent.touches)&&n[0]?n[0]:t).pageX-s.left,t=i.pageY-s.top,i=m.getScreenToSheetTransform(),p=i.transformPoint(new St.Point(n,t)),g?h():(i=m.getSheetConfigurationData().touchSettings,Math.abs(e-n
)<i.jitterTolerance&&Math.abs(o-t)<i.jitterTolerance&&(new Date).getTime()-f>i.holdTime&&((t=m.getOverlayByTouch(M))&&t.getId&&((i=t.getId())!==Tt.ConnectionStartDrag&&i!==Tt.ConnectionEndDrag&&i!==Tt.ConnectionBendingDrag||(g=t)),r())))})},$t.prototype.execute=function(){},ht.inheritedBy($t),qt.prototype.hook=function(t,i){ht.prototype.hook.call(this,t,i),t.bind("keydown",function(t){var n=i.getSheet();if(n){n=n.getSession(),t=new w(t.keyCode,t.ctrlKey,t.altKey,t.shiftKey,i.getSelectedElements()),t=new Dt.messages.EventMessage(t,_.OnKeydown);if(n.CM().BM(t))return!0}return!1},!0)},ht.inheritedBy(qt),Kt.prototype.hook=function(e,o){ht.prototype.hook.call(this,e,o);var f=new St.Point(0,0),u=new St.Point(0,0),a=null,c=null,l=null,v=0,w=null,d=!1,m=this;e.bind("mousedown",function(t){if(0===t.button&&m.isEnabled()){a=e.offset(),f.x=t.pageX-a.left,f.y=t.pageY-a.top,d=!1,v=0,w=null;var n=o.getScreenToSheetTransform();if(n)if(f=n.transformPoint(f),c=o.getOverlayByPoint(f))if(c.getId(
)===Tt.Rotate){d=!0;var i=c.getOwner();v=i.getRotation(),w=i.getXform();var r=o.getSheet().getSession();if(r){t=r.CM();if(t){var s=[];if((l=o.getSelectedElements())&&0<l.length)for(var u=l.length,h=0;h<u;++h)l[h].getAllowedTransformations()&St.AllowedTransformations.ROTATION&&r.ax&St.AllowedTransformations.ROTATION&&s.push(l[h]);if(0<(u=(l=s).length)){n=new At.TransformStartEventArgs(l,"rotate"),i=o.getSheetConfigurationData();n.setPrioritizedAlignmentModes(i.alignmentPriority);i=new Dt.messages.EventMessage(n,At.EventType.OnTransformStart);if(t.BM(i)){if(n.isCancelled())return void(d=!1);n.isHandled()&&(l=n.getNewSheetElements())}o.startPreview(l)}}}d&&e.activateCursor(St.CursorID.ROTATECLICK),o.getCommandManager().enableCommand("HoverHighlightCommand",!1)}}}),e.bind("mouseup",function(t){if(d&&m.isEnabled()){d=!1,o.getCommandManager().enableCommand("HoverHighlightCommand",!0),o.rotateElements();for(var n=l.length,i=0;i<n;i++)l[i].XM(
)&_t.HighlightFlags.Preview&&l[i].setHighlightFlags(_t.HighlightFlags.Preview,!1);o.setPreviewOverlays(null),o.updateOverlay(),e.deactivateCursor(St.CursorID.ROTATECLICK)}}),e.bind("mousemove",function(t){var n,i,r,s;d&&m.isEnabled()&&(u.x=t.pageX-a.left,u.y=t.pageY-a.top,(n=o.getScreenToSheetTransform())&&(u=n.transformPoint(u),i=(r=c.getOwner()).getAnchorPosition(),s=Math.sqrt(Math.pow(f.x-u.x,2)+Math.pow(f.y-u.y,2)),t=Math.sqrt(Math.pow(i.x-u.x,2)+Math.pow(i.y-u.y,2)),n=Math.sqrt(Math.pow(i.x-f.x,2)+Math.pow(i.y-f.y,2)),i=180*Math.acos((t*t+n*n-s*s)/(2*t*n))/Math.PI,s=u.x-f.x,t=u.y-f.y,w&&(s=(n=w.invert().transformVector(new St.Vector(s,t))).x,t=n.y),t=0<=s?i:-i,r.getMirrorX()&&(t*=-1),r.getMirrorY()&&(t*=-1),i=(s=o.getSheetConfigurationData()).rotationSnappingAngle,r=s.rotationSnappingTolerance||0,i&&(s=v+t,(Math.abs(s%i)<=r||i-Math.abs(s%i)<=r)&&(t=Math.round(s/i)*i-v)),o.setPreviewOverlays(c,l,null,null,t),o.updateOverlay()))})},Kt.prototype.onEnabled=function(){var t
;this.diagramManager&&((t=this.diagramManager.getSheetSession()).ax=t.ax|St.AllowedTransformations.ROTATION)},Kt.prototype.onDisabled=function(){var t;this.diagramManager&&((t=this.diagramManager.getSheetSession()).ax=t.ax^St.AllowedTransformations.ROTATION)},ht.inheritedBy(Kt),Jt.prototype.hook=function(r,t){ht.prototype.hook.call(this,r,t),r.bind("SDF_click",function(t,n,i){return r.mouseEventsWrapper.sendMouseEvent(t,"sdf_click",i)},!0)},ht.inheritedBy(Jt),Qt.prototype.hook=function(r,t){ht.prototype.hook.call(this,r,t),r.bind("SDF_dblclick",function(t,n,i){return r.mouseEventsWrapper.sendMouseEvent(t,"sdf_dblclick",i)},!0)},ht.inheritedBy(Qt),tn.prototype.hook=function(r,t){ht.prototype.hook.call(this,r,t),r.bind("SDF_mousedownhold",function(t,n,i){return r.mouseEventsWrapper.sendMouseEvent(t,"sdf_mousedownhold",i)},!0),r.bind("SDF_mousedownholdup",function(t,n,i){return r.mouseEventsWrapper.sendMouseEvent(t,"sdf_mouseholdup",i)},!0)},ht.inheritedBy(tn),nn.prototype.hook=function(r
,t){ht.prototype.hook.call(this,r,t),r.bind("SDF_tap",function(t,n,i){return r.touchEventsWrapper.sendTouchEvent(t,"sdf_tap",i)},!0)},ht.inheritedBy(nn),rn.prototype.hook=function(r,t){ht.prototype.hook.call(this,r,t),r.bind("SDF_dbltap",function(t,n,i){return r.touchEventsWrapper.sendTouchEvent(t,"sdf_dbltap",i)},!0)},ht.inheritedBy(rn),sn.prototype.hook=function(r,t){ht.prototype.hook.call(this,r,t),r.bind("SDF_touchhold",function(t,n,i){return r.touchEventsWrapper.sendTouchEvent(t,"sdf_touchhold",i)},!0)},ht.inheritedBy(sn),un.prototype.ik=function(t,n){this.rk(t,n,!0)},un.prototype.uk=function(t,n,i,r,s){var u,h,n=this.hx?(u=this.hx.clone(),!(h=this.getOwner())||(h=r?new St.Point(r.x,r.y):h.getRenderingPosition())&&(u.x-=h.x,u.y-=h.y),"<svg x='"+u.x+"' y='"+u.y+"' width='"+u.width+"' height='"+u.height+"'>"+n+"</svg>"):this.IM,i=i.clone();this.Rk&&(i.transform=this.wx()),s?t.preRenderSvgContent(n,i):t.renderSvgContent(n,i)},un.prototype.wx=function(){var t=this.getOwner();if(
t&&this.Rk&&this.Rk.location){t=1/t.getSession().getSheetConfigurationData().viewData.getScaleFactor();return this.getStyle().transform.scaleAt(t,t,this.Rk.location.x,this.Rk.location.y)}},un.prototype.select=function(t){if(this.isSelectable()){var n=t.point,i=this.wx();i&&(n=i.invert().transformPoint(t.point));var r=this.hx.clone(),s=this.getOwner();if(!s||(s=s.getRenderingPosition())&&(r.x-=s.x,r.y-=s.y),r.isPointInside(n,t.tolerance/i.getM0()))return!0}return!1},Y.inheritedBy(un),hn.prototype.mx=function(t){var n=this.ex.getSheetConfigurationData().defaultLocationIndicatorSettings;this.ox.locations=t.indicatorLocations,this.ox.directions=t.indicatorDirections,this.ox.commonSvg=t.indicatorSvgStr||n.str,this.ox.focusSvg=t.indicatorFocusSvgStr||n.focusStr,this.ox.size=t.indicatorSize||n.size;n=t.indicatorAnchor||n.anchor;this.ox.anchorPt=new St.Point(this.ox.size[0]*n[0],this.ox.size[1]*n[1]),this.ox.focusOption=t.focusOption||1,this.ox.specifiedIndex=t.defaultIndicator},
hn.prototype.gx=function(t){for(var n=[],i=t.getBBox(),r=this.ox,s=0,u=r.locations.length;s<u;s++){var h=new un(r.commonSvg);h.setOwner(t),h.hx=new St.Rect(r.locations[s].x-r.anchorPt.x,r.locations[s].y-r.anchorPt.y,r.size[0],r.size[1]),h.Rk={},h.Rk.location=r.locations[s],h.Rk.direction=r.directions?r.directions[s]:new St.Vector(0,0),h.getStyle().transform=t.getEvaluatedTransform(1,1,new St.Point(i.x,i.y)),n.push(h)}return n};function en(t,n){if(t.length<=0)return null;for(var i=t[0],r=n.distanceToPoint(t[0].Rk.location),s=1,u=t.length;s<u;s++){var h=t[s],e=n.distanceToPoint(h.Rk.location);e<r&&(i=h,r=e)}return i}function on(){ht.call(this)}function fn(){ht.call(this),this.isExemptForMutex=!0,this.ex=null,this.Mx=null,this.offset=null}hn.prototype.px=function(t,n){var i;if(1===this.ox.focusOption||2===this.ox.focusOption){var r=[],s=this.ex.getSheetConfigurationData(),u=s.viewData.getScaleFactor(),h=s.defaultLocationIndicatorSettings.snapTolerance;null==h&&(
h=s.selectionPreferencesData.getSelectionRadiusPixel());for(var e,o=0,f=t.length;o<f;o++)t[o].select({point:n,tolerance:h/u})&&r.push(t[o]);0<r.length?i=en(r,n):2!==this.ox.focusOption||null!=(e=this.ox.specifiedIndex)&&0<=e&&(i=t[e])}else 3===this.ox.focusOption&&(i=en(t,n));i&&(e=(e=this.ox.focusSvg)||this.ox.commonSvg,i.setGeometry(e),this.selectedIndicator=i)},hn.prototype.clear=function(){this.selectedIndicator=null,this.ox.locations=[],this.ox.directions=[],this.ox.commonSvg=null,this.ox.focusSvg=null,this.ox.size=null,this.ox.anchorPt=null,this.ox.focusOption=null,this.ox.specifiedIndex=null},hn.prototype.getLocationIndicatorOverlays=function(t,n,i){if(this.clear(),!(t&&t.indicatorLocations&&0<t.indicatorLocations.length&&n))return[];this.mx(t);n=this.gx(n);return this.px(n,i),n},on.prototype.hook=function(r,h){ht.prototype.hook.call(this,r,h);function s(t){if("dragenter"==t.type)u=St.DragType.DragEnter;else if("dragover"==t.type)u=St.DragType.DragOver;else if("drop"==t.type
)u=St.DragType.Drop;else{if("dragleave"!=t.type)return;u=St.DragType.DragLeave}h.getSheetSession();var n=l(t),i=(i=h.getElementsByPoint(n))||[],r=[];u==St.DragType.DragOver?f&&0<f.length&&(r=St.ArrayUtil.subtract(f,i)):u==St.DragType.DragLeave?r=f.concat():f=null,h.setDropHighlightElements(r.concat(i),!1),r=new v(0,u,[n.x,n.y],[],i,r,t.originalEvent,t.altKey,t.ctrlKey,t.shiftKey),a=a||new hn(h),u===St.DragType.Drop&&a.enabled&&a.selectedIndicator&&((s=a.selectedIndicator.Rk)&&r.setLocationIndicatorInfo(s)),a.enabled=!1;var s,u=null;if(h.sendEvent(r)||c()){if(t.preventDefault(),t.stopPropagation(),r.isCancelled())return h.setLocationIndicatorOverlays(null),h.updateOverlay(),0;r.isHandled()&&(!r.getIsDropAccepted()||(s=r.getDropTarget())&&(h.setDropHighlightElements([s],!0),(t=r.getLocationIndicatorInfo())&&(r=r.getLocation(),u=a.getLocationIndicatorOverlays(t,s,new St.Point(r[0],r[1])),a.enabled=!0)))}f=i,h.setLocationIndicatorOverlays(u),h.updateOverlay()}var u,e=this,o=0,f=null,a=null
,c=function(){var t=!0,n=h.getSheetSession();return t=n?n.getSheetConfigurationData().preventBrowserDragDropDefault:t},l=function(t){if(a&&a.enabled&&a.selectedIndicator&&a.selectedIndicator__indicatorInfo)return a.selectedIndicator__indicatorInfo.location;var n=new St.Point;n.x=t.pageX-u.left,n.y=t.pageY-u.top;t=h.getScreenToSheetTransform();return t?t.transformPoint(n):n};r.bind("dragenter",function(t,n,i){e.isEnabled()&&(u=r.offset(),0==o&&s(t),o++)},!0),r.bind("dragover",function(t,n,i){e.isEnabled()&&s(t)},!0),r.bind("drop",function(t,n,i){e.isEnabled()&&(o=0,s(t))},!0),r.bind("dragleave",function(t,n,i){e.isEnabled()&&0==--o&&s(t)},!0),this.reset=function(){o=0,f=null}},ht.inheritedBy(on);var an=!1,cn=!1,ln=!1,vn=null,wn=null,dn=null;fn.prototype.hook=function(n,t){ht.prototype.hook.call(this,n,t);var i=this;i.offset=null,i.ex=t,(i.Mx=n).bind("mousedown",function(t){0===t.button&&i.isEnabled()&&i.ex.getSheetConfigurationData().viewData.isAutoPanMode()&&(i.offset=n.offset(),an=!0)
}),n.bind("mouseup",function(t){pn({data:{cmdInstance:i}})}),n.bind("mousemove",function(t){an&&i.isEnabled()&&(dn=t,Mn(i))}),n.bind("mouseleave",function(t){an&&i.isEnabled()&&(i.ex.getSheetConfigurationData().autoPanningSettings.stopIfLeaveCanvas?wn&&(window.clearInterval(wn),wn=null):(dn=t,Mn(i),bn(i)),kn(i))}),n.bind("mouseenter",function(t){an&&i.isEnabled()&&yn()})};function mn(t){an&&(vn=gn((dn=t).data.cmdInstance))}var gn=function(t){var n=null,i=dn.pageX-t.offset.left,r=dn.pageY-t.offset.top,s=t.Mx.width(),u=t.Mx.height(),h=t.ex.getSheetConfigurationData(),e=h.viewData.getScaleFactor(),o=h.autoPanningSettings.distanceToBoundary,t=h.autoPanningSettings.translateStep/e,h=h.autoPanningSettings.isDynamicStepping;return i<o?(n=new St.Vector(t,0),h&&i<0&&(n.x=t-i/e)):s-i<o&&(n=new St.Vector(-t,0),h&&s-i<0&&(n.x=(s-i)/e-t)),r<o?(n=new St.Vector(0,t),h&&r<0&&(n.y=t-r/e)):u-r<o&&(n=new St.Vector(0,-t),h&&u-r<0&&(n.y=(u-r)/e-t)),n},Mn=function(t){(vn=gn(t))?wn=wn||window.setInterval(
function(){t.ex.translateViewport(vn),t.Mx.setCurrentEventType("mousemove"),t.Mx.execRawEventHandlers(dn),t.Mx.execEventHandlers(dn)},t.ex.getSheetConfigurationData().autoPanningSettings.timeInterval):wn&&(window.clearInterval(wn),wn=null)},pn=function(t){an&&(an=!1,wn&&(window.clearInterval(wn),wn=null),yn(),t.data=null)},bn=function(t){cn||(Q(document).on("mousemove",{cmdInstance:t},mn),cn=!0)},kn=function(t){ln||(Q(document).on("mouseup",{cmdInstance:t},pn),ln=!0)},yn=function(){cn&&(Q(document).off("mousemove",mn),cn=!1),ln&&(Q(document).off("mouseup",pn),ln=!1)};ht.inheritedBy(fn);var xn={};function En(t,n){var f=new Dt.Map,a=t,h=n;this.uM=null;var i,c=new St.CommandStates;for(i in this.registerCommand=function(t,n,i,r){void 0!==xn[t]&&null!=xn[t]||Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,Dt.common.StringHelper.format("Command type {0} is not defined",t));var s=xn[t][0],u=s.__typeId__,t=f.get(u);void 0!==t&&null!=t||((t=new s).hook(a,h),
f.put(u,t)),void 0===i&&null===i||t.setShortcuts(i),null!=r&&(t.states=r)},this.registerCommandInstance=function(t){var n,i;t instanceof ht?(n=t.getType().__typeId__,(i=f.get(n))&&(i.unhook(),f.removeByKey(n)),t.hook(a,h),f.put(n,t),xn[t.getTypeName()]=[t.getType(),t.getCursor(),t.getShortcuts(),!0,t.states]):Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,Dt.common.StringHelper.format("{0} is not Command type",t.getTypeName()))},this.unregisterCommand=function(t){var n=xn[t][0].__typeId__,t=f.get(n);void 0!==t&&null!=t&&(t.unhook(),f.removeByKey(n))},this.unregisterCommandInstance=function(t){t.unhook(),f.removeByKey(t.getType().__typeId__)},this.enableCommand=function(t,n){var i=f.get(xn[t][0].__typeId__);void 0!==i&&null!=i||Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,Dt.common.StringHelper.format("Command type {0} is not registered",t)),i.setEnabled(n)},this.disableAll=function(){for(var t=f.values(),
n=0;n<t.length;++n)t[n].setEnabled(!1)},this.enableAll=function(){for(var t=f.values(),n=0;n<t.length;++n)t[n].setEnabled(!0)},this.registerAll=function(t,n){a=t;for(var i=f.values(),r=0;r<i.length;++r)i[r].hook(t,n)},this.unregisterAll=function(){for(var t=f.values(),n=0;n<t.length;++n)t[n].unhook()},this.getCommand=function(t){return void 0===xn[t]||null===xn[t]?null:f.get(xn[t][0].__typeId__)},this.clear=function(){this.unregisterAll(),f.clear()},this.getCommandStates=function(){return c},this.setCommandStates=function(t){c=t},this.resetCommandStates=function(){return c=new St.CommandStates},this.changeCommandState=function(t,n){c.changeState(t,n),a.cursorControl.bx(c.getCursorId(t),n);for(var i=!1,r=f.values(),s=r.length,u=0;u<s;++u){var h=r[u];if(h.states){for(var e=h.states.length,o=0;o<e;++o)if(t===h.states[o]){i=!0;break}i&&(n?h.onEnabledByCommandState(t):h.onDisabledByCommandState(t))}}},xn)this.registerCommand(i,xn[i][1],xn[i][2],xn[i][4]),this.enableCommand(i,xn[i][3])}
xn.CopyCommand=[t,null,[],!0,["CREATENODE","CREATECONNECTION","VIEWONLY","ZOOMMODE","PANMODE"]],xn.PasteCommand=[n,null,[],!0,["CREATENODE","CREATECONNECTION","VIEWONLY","ZOOMMODE","PANMODE"]],xn.FitCommand=[i,null,[],!0,[]],xn.PanCommand=[r,null,[],!0,["ZOOMMODE"]],xn.SingleSelectCommand=[s,null,[],!0,["CREATENODE","CREATECONNECTION","ZOOMMODE","PANMODE"]],xn.MapZoomCommand=[u,null,[],!0,[]],xn.HoverHighlightCommand=[h,null,[],!0,["CREATENODE","CREATECONNECTION","ZOOMMODE","PANMODE"]],xn.MoveCommand=[z,null,[],!0,["CREATENODE","CREATECONNECTION","VIEWONLY","ZOOMMODE","PANMODE"]],xn.CreateConnectionCommand=[K,null,[],!0,["CREATENODE","VIEWONLY","DEFAULT","ZOOMMODE","PANMODE"]],xn.CreateNodeCommand=[it,null,[],!0,["CREATECONNECTION","VIEWONLY","DEFAULT","ZOOMMODE","PANMODE"]],xn.MultiSelectCommand=[dt,null,[],!0,["CREATENODE","CREATECONNECTION","ZOOMMODE","PANMODE"]],xn.RectangleSelectCommand=[mt,null,[],!0,["CREATENODE","CREATECONNECTION","ZOOMMODE","PANMODE"]],xn.DeselectCommand=[gt,
null,[],!0,["CREATENODE","CREATECONNECTION","ZOOMMODE","PANMODE"]],xn.DeleteCommand=[Mt,null,[],!0,["CREATENODE","CREATECONNECTION","VIEWONLY","ZOOMMODE","PANMODE"]],xn.SelectAllCommand=[pt,null,[],!0,["CREATENODE","CREATECONNECTION","ZOOMMODE","PANMODE"]],xn.DeselectAllCommand=[bt,null,[],!0,["CREATENODE","CREATECONNECTION","ZOOMMODE","PANMODE"]],xn.ExpandCollapseCommand=[kt,null,[],!0,["CREATENODE","CREATECONNECTION","ZOOMMODE","PANMODE"]],xn.TextEditCommand=[yt,null,[],!0,["CREATENODE","CREATECONNECTION","VIEWONLY","ZOOMMODE","PANMODE"]],xn.ResizeCommand=[Yt,null,[],!0,["CREATENODE","CREATECONNECTION","VIEWONLY","ZOOMMODE","PANMODE"]],xn.RectangleZoomCommand=[Bt,null,[],!0,["PANMODE"]],xn.MoveConnectionCommand=[$t,null,[],!0,["CREATENODE","CREATECONNECTION","VIEWONLY","ZOOMMODE","PANMODE"]],xn.KeydownCommand=[qt,null,[],!0],xn.RotateCommand=[Kt,null,[],!0,["CREATENODE","CREATECONNECTION","VIEWONLY","ZOOMMODE","PANMODE"]],xn.MouseClickCommand=[Jt,null,[],!0],
xn.MouseDoubleClickCommand=[Qt,null,[],!0],xn.MouseDownUpCommand=[tn,null,[],!0],xn.TapCommand=[nn,null,[],!0],xn.DoubleTapCommand=[rn,null,[],!0],xn.TouchHoldCommand=[sn,null,[],!0],xn.DragDropCommand=[on,null,[],!0],xn.AutoPanCommand=[fn,null,[],!0],En.prototype.requestMutex=function(t){null!==this.uM&&void 0!==this.uM||(this.uM=t)},En.prototype.releaseMutex=function(t){this.uM===t&&(this.uM=null)};var Cn={Preview:0,Hover:1,Move:2,Resize:3,Rotate:4,ConnectionSegHover:5,ConnectionPointDrag:6,ConnectionSelect:7};function Nn(t,n,i){Y.call(this,t,n,i)}function On(t){Y.call(this,t)}function Dn(t,x){var E=x,n=t,C=n.getSheetConfigurationData().viewData;C.kx(null);var N=[],O=null,D=!1;this.yx=function(t){O=t},this.xx=function(t){N.push(t)},this.doAnimate=function(w,d,m){var g,M,t,p,b,k,y;w&&d&&(D||(g=n?n.getViewConfig().fitAnimationDuration:200,t=n?n.getViewConfig().animationNumberSteps:10,200===g&&10!=t&&(g=t/10*200),M=d.getSheetToScreenTransform(),t=new St.Rect(0,0,d.width(),d.height()),
p=St.Matrix.sheetToScreenTransform(O,t),b=O.oldViewport.clone(),y=function(t){var i;k=k||t,t&&(i=t-k);var n=1;g&&(n=Math.min(i/g,1));var r=(p.getM0()-M.getM0())*n,s=(p.getM4()-M.getM4())*n,u=(p.getM6()-M.getM6())*n,h=(p.getM7()-M.getM7())*n,e=M.clone(),o=(O.x-b.x)*n,f=(O.y-b.y)*n,a=(O.width-b.width)*n,t=(O.height-b.height)*n;e.m[0]=M.m[0]+r,e.m[4]=M.m[4]+s,e.m[6]=M.m[6]+u,e.m[7]=M.m[7]+h,d.setSheetToScreenTransform(e),C.kx(e),x.getViewportManager().Ex();var c=b.clone();c.x=b.x+o,c.y=b.y+f,c.width=b.width+a,c.height=b.height+t,d.beginAnimateRender(_(d),!0,null);var l=E.getViewFeatures();if(l&&0<l.length)for(var v=0;v<l.length;v++)m===d.Cx(l[v])&&(l[v].setViewport(c),l[v].render(d));d.endAnimateRender();d.doAnimate(w,n,g,function(){if(i<g)window.requestAnimationFrame(y);else{for(var t=N.length,n=0;n<t;n++)N[n]();C.kx(null),O=null,D=!(N=[])}})},D=!(k=null),window.requestAnimationFrame(y)))};var _=function(t){return t.getCanvas().Nx(St.CanvasOption.ViewFeatureCanvas)[0]}}function _n(t){
this.m_text=t||""}function Sn(t,n,i){this.ex=t,this.Ox=new St.Rect(0,0,n,i),this.Dx=null,this._x=null}Nn.prototype.uk=function(t,n,i,r){var s=n.clone(),n=this.getOwner();!n||(n=r?new St.Point(r.x,r.y):n.getRenderingPosition())&&(s.x=s.x-n.x,s.y=s.y-n.y),t.renderRect(s,i)},Nn.prototype.select=function(t){if(this.isSelectable()){var n=t.point,i=this.getStyle().transform;i&&(n=i.invert().transformPoint(t.point));var r=this.getGeometry();if(r){var s=this.getOwner(),i=s.getRenderingPosition();if(i&&(r.x=r.x-i.x,r.y=r.y-i.y),r.isPointInside(n,t.tolerance)){if(this.jM!==Cn.Move)return t.target=this,!0;s=s.getSelectionPolicy();if(!s)return t.target=this,!0;if(s.getSelectionRegion()===St.SelectionRegionType.InsideOutline)return t.target=this,!0;if(!r.isPointInside(n,-t.tolerance))return t.target=this,!0}}}return!1},Nn.prototype.hk=function(){var t=this.getGeometry(),n=this.getStyle();return t&&n.lineWidth?(t.inflate(n.lineWidth/2,n.lineWidth/2),t):null},Y.inheritedBy(Nn),
On.prototype.uk=function(t,n,i){t.renderLines(n,i)},Y.inheritedBy(On),_n.prototype.show=function(t,n,i,r){var s,u,h;i&&r&&(i.innerHTML=this.m_text,i.style.display="",u=r.width(),s=r.height(),u<(h=t)+(r=i.offsetWidth)&&(h=t-(t+r-u)),s<(r=n)+(u=i.offsetHeight)&&(r=n-(n+u-s)),n<0&&(r=0),i.style.left=(h=t<0?0:h)+"px",i.style.top=r+"px")},_n.hide=function(t){t&&(t.style.display="none")},_n.initialize=function(t){var n=t.getOverlayDiv();if(n){t=document.createElement("div");return St.CommonUtil.setSdfIdOnDom(t,St.Constants.DOM_PREFIX+St.Constants.DOM_TOOLTIP_PANEL),t.className=St.Constants.DOM_PREFIX+St.Constants.DOM_CLASS_TOOLTIP,t.style.position="absolute",t.style.display="none",t.style.mozUserSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",n.appendChild(t),t}},Sn.prototype.createIndexTree=function(t,n,i,r){t=t||this.Ox,i=new St.ElementIndexTree(t,n||3,i||8),r=r||St.ElementCoordinateMode.Sheet;return r===St.ElementCoordinateMode.Sheet?this.Dx||(this.Dx=i
):r===St.ElementCoordinateMode.Device&&(this._x||(this._x=i)),i};function Tn(t){for(var n=[],i=[],r=[],s=0,u=t.length;s<u;s++){var h=t[s];h.getOwner&&h.getOwner()?(h.getOwner().getSizeCoordinateMode()===St.ElementCoordinateMode.Device?i:n).push(h):r.push(h)}return{sheetItems:n,deviceItems:i,otherItems:r}}function An(f,a,t,u,e,h,i,c,o,n,r){var l=null,v=a.getDefaultSheetRect(),w=null,d=n,m=r,g=1,M=null,s=null,p={viewport:null,dirtyRect:null,oldLodType:void 0,newLodType:void 0,needFireEvent:!1,eventData:null,isFitAnimation:!1},b=function(){e&&e.BM(h)},k=function(){for(var t=i.length,n=0;n<t;++n)i[n].setViewport&&i[n].setViewport(l)},y=function(){for(var t=[],n=a.getElements(St.ElementType.UI),i=0,r=n.length;i<r;i++){var s,u=n[i];u.getLocationCoordinateMode()===St.ElementCoordinateMode.Device?u.getSizeCoordinateMode()===St.ElementCoordinateMode.Device&&((s=u.getLocation())&&s.getReference()&&s.getReference().getLocationCoordinateMode()===St.ElementCoordinateMode.Sheet?t.push(s
):u.getStartLocation&&u.getEndLocation&&((s=u.getStartLocation())&&s.getReference()&&s.getReference().getLocationCoordinateMode()===St.ElementCoordinateMode.Sheet&&t.push(s),(s=u.getEndLocation())&&s.getReference()&&s.getReference().getLocationCoordinateMode()===St.ElementCoordinateMode.Sheet&&t.push(s))):u.getSizeCoordinateMode()===St.ElementCoordinateMode.Device&&t.push(u)}var h=t.length;if(0<h){e.beginTransaction(Dt.messages.ModelChangeMessage);for(i=0;i<h;i++)t[i].setUpToDate(!1);e.endTransaction()}};this.Sx=function(t){s=t},this.Tx=function(t){t=new At.ViewportChangedEventArgs(t),t=new Dt.messages.EventMessage(t,At.EventType.OnViewportChanged);e.BM(t)};var x=function(t,n,i,r,s,u,h){p.viewport=t,p.dirtyRect=n,p.oldLodType=i,!isNaN(r)&&isFinite(r)&&r>=St.LODType.DetailLevel&&(p.newLodType=r),p.needFireEvent=s,p.eventData=u,p.isFitAnimation=h};this.Ax=function(){return p},this.Rx=function(t){var n;M&&(n=this,M.xx(function(){n.Tx(t)}))};function E(t,n,i){var r=l,s={scale:g,locX:r.x,
locY:r.y,width:r.width,height:r.height};(r=!n&&!f.isInUpdateProcess())&&(n=new At.ViewportChangingEventArgs(s),n=new Dt.messages.EventMessage(n,At.EventType.OnViewportChanging),e.BM(n)),C(l),x(l,null,h.renderData.lodType,i,r,s,t),k(),u.setViewport(l),e.beginTransaction(Dt.messages.ModelChangeMessage),c.viewData.setViewport([l.x,l.y,l.width,l.height]),y(),e.endTransaction()}var C=function(t){var n=new St.Rect(0,0,d,m),n=St.Matrix.sheetToScreenTransform(t,n);s.setSheetToScreenTransform(n)},N=function(){h.renderData.updateFlags=Dt.RenderUpdateFlags.Overview,h.renderData.dirtyRect=null,b()};this.Ex=function(){y()},this.Px=function(t,n,i){n=n||o.fitPercentage;100!==n&&t.inflate(t.width*(100/n-1)/2,t.height*(100/n-1)/2);n=void 0!==i?i:o.fitMargin;0!==n&&(i=.5*t.width*(d/(d-2*n)-1),n=.5*t.height*(m/(m-2*n)-1),t.inflate(i,n))},this.setViewport=function(t){t&&t.width&&t.height&&(l&&l.equal(t)||(w=(l=t).clone(),E(null,!0)))},this.getSheet=function(){return a},this.destroy=function(){l=w=v=null},
this.getViewport=function(){return l},this.Vk=function(){var t,n,i,r=w?w.clone():null;c.overviewWindowData.m_autoShrinkView?(t=a.getSheetBoundsOverview(),w=t):(t=a.getSheetBounds(),w?w.union(t):w=t),r?w.equal(r)||(c.overviewWindowData.m_hasMargin?this.Px(w,null,50):this.Px(w),n=a.getDefaultSheetAspectRatio(),w.width/w.height>n?(i=w.height,w.height=w.width/n,w.y=w.y+.5*(i-w.height)):w.width/w.height<n&&(i=w.width,w.width=w.height*n,w.x=w.x+.5*(i-w.width)),N()):(c.overviewWindowData.m_hasMargin?this.Px(w,null,50):this.Px(w),n=a.getDefaultSheetAspectRatio(),w.width/w.height>n?(i=w.height,w.height=w.width/n,w.y=w.y+.5*(i-w.height)):w.width/w.height<n&&(i=w.width,w.width=w.height*n,w.x=w.x+.5*(i-w.width)))},this.fit=function(t,n,i,r){if(a){var s=null,u=c.visualizationPreferencesData.getFitOption();if((u=!a.getWidth()&&!a.getHeight()?St.FitOption.FitToAllObjects:u)==St.FitOption.FitToSheet)s=new St.Rect(0,0,a.getWidth(),a.getHeight());else if(t){var h=t.length;if(h<=0)return;for(
var e=0;e<h;++e){var o=t[e].getRenderingBBox();0===e?s=o.clone():s.union(o)}}else s=a.getSheetBounds();this.Px(s,n),i&&((M=i).yx(s),l&&(s.oldViewport=l.clone(),s.fitAnimation=!0)),this.fitToRectangle(s,r)}};function O(t){var n,i,r,s;void 0!==t&&(n=d/t.width,r=m/t.height,i=c.maxZoomRatio,s=c.minZoomRatio,(g=Math.min(i,n,r))<s&&(g=s),r=c.visualizationPreferencesData.getFitViewPosition(),s=t.width,t.width=d/g,t.x=t.x+(s-t.width)*r[0],s=t.height,t.height=m/g,t.y=t.y+(s-t.height)*r[1],l?l.copyFrom(t):l=t.clone(),w=l.clone(),N())}this.fitToRectangle=function(t,n){v=t.clone(),O(t),E(t.fitAnimation,n)},this.translateViewport=function(t){return l.x-=t.x,l.y-=t.y,E(),!0},this.setCurrentZoomFactor=function(t,n,i){if(void 0===n||n<=0)return!1;var r=c.minZoomRatio<St.Constants.EPSILON?c.minZoomRatio:St.Constants.EPSILON;if(n>c.maxZoomRatio)n=c.maxZoomRatio;else if(n<c.minZoomRatio)n=c.minZoomRatio;else if(0===St.MathUtil.doubleCompare(n,g,r))return!1;var s=n/g;g=n,v.width=v.width/s,
v.height=v.height/s;var u=d,h=m;null==t&&((t=new St.Point(0,0)).x=l.getCenterX(),t.y=l.getCenterY());r=u/g,n=h/g,s=r-l.width,u=n-l.height,h=t.x-l.x,t=t.y-l.y,s=h/l.width*s,u=t/l.height*u;return l.x-=s,l.y-=u,l.width=r,l.height=n,E(null,i),!0},this.resizeViewport=function(t,n,i){var r,s,u,h,e,o;d==t&&m==n||(f.getViewConfig().keepZoomRatio?(e=c.viewData.getScaleFactor(),l.width=t/e,l.height=n/e,w.width=l.width,w.height=l.height,g=e):(o=new St.Rect(0,0,t,n),(u=St.Matrix.sheetToScreenTransform(v,o).getM0())>c.maxZoomRatio?u=c.maxZoomRatio:u<c.minZoomRatio&&(u=c.minZoomRatio),g=u,h=new St.Point(l.getCenterX(),l.getCenterY()),s=n/g,e=(r=t/g)-l.width,o=s-l.height,u=h.x-l.x,h=h.y-l.y,e=u/l.width*e,o=h/l.height*o,l.x-=e,l.y-=o,l.width=r,l.height=s),d=t,m=n,E(null,i))},this.getOverviewRect=function(){return w=w||l.clone()},this.setOverviewRect=function(t){w=t},this.initialize=function(){var t,n,i,r,s;a&&(t=c.viewData,i=!1,(l=t.getViewport())?(f.getViewConfig().keepZoomRatio?(l.width=d,l.height=m
,n=t.getScaleFactor(),i=0===St.MathUtil.doubleCompare(n,t.Hx),this.setCurrentZoomFactor(new St.Point(l.x,l.y),n,i)):(s=new St.Rect(0,0,d,m),r=St.Matrix.sheetToScreenTransform(l,s),g=r.getM0()),w=l.clone()):((!(s=a.getSheetElements())||s.length<1)&&(i=!0),r=null,r=a.getSheetBounds(),this.Px(r,o.fitPercentage,0),s=c.viewData.getScaleFactor(),r.width=r.width/s,r.height=r.height/s,O(r)),E(!1,i))},this.getVisibleElements=function(t){if(null==u)return null;t=u.Lx(t||l);return St.CommonUtil.retrieveSheetElements(t,function(t){return!(!0===t.isBackground()||t.getCollapsedOwner&&t.getCollapsedOwner())})},this.getVisibleUIElements=function(t){if(null==u)return null;t=u.Ix(t||new St.Rect(0,0,d,m));return St.CommonUtil.retrieveSheetElements(t)},this.refresh=function(t,n){var i=this.getVisibleElements();if(i){e.beginTransaction(Dt.messages.ModelChangeMessage);for(var r=i.length,s=0;s<r;++s)i[s].setUpToDate(!1);e.endTransaction(),E(null,t,n),e.SM()}}}function Rn(t){Y.call(this,t);var h=null,s=null,
n=null,e=null,i=null;this.previewManager=null,this.Fx=!1,this.Vx=!1,this.jx=null,this.Wx=function(t){t?h=t:e=h=null},this.zx=function(t,n){var i=!!this.previewManager&&this.previewManager.Yx(),r=this.Bx();if(r)for(var s=0,u=r.length;s<u;s++)i?(r[s].x+=t,r[s].y+=n):(r[s].x=t,r[s].y=n)},this.Zx=function(t,n,i){var r=!!this.previewManager&&this.previewManager.Yx(),s=this.Bx();if(s)for(var u=0,h=s.length;u<h;u++){var e=i[u].tk();r?(s[u].x+=e.isLockX?0:t,s[u].y+=e.isLockY?0:n):(s[u].x=e.isLockX?0:t,s[u].y=e.isLockY?0:n)}},this.Bx=function(){return h},this.Ux=function(t){if(null===e)return h;var n=[],i=!!this.previewManager&&this.previewManager.Yx();if(t&&i)for(var r=0,s=h.length;r<s;r++){var u=t[r].tk();n[r]={x:u.isLockX?0:h[r].x-e[r].x,y:u.isLockY?0:h[r].y-e[r].y}}else for(r=0,s=h.length;r<s;r++)n[r]={x:h[r].x-e[r].x,y:h[r].y-e[r].y};return n},this.Gx=function(){if(this.previewManager.Yx()){e=[];for(var t=0,n=h?h.length:0;t<n;t++)e[t]={x:h[t].x,y:h[t].y}}else{e=[];for(t=0,
n=h?h.length:0;t<n;t++)e[t]={x:0,y:0}}},this.Xx=function(){if(this.previewManager.Yx()){this.Fx=!0;try{this.$x();var t=this.previewManager.qx;if(t)for(var n=0,i=t.length;n<i;n++)t[n].getBBox();this.Kx()}catch(t){this.Kx()}}},this.Jx=function(t){s=t},this.Qx=function(){return s},this.tE=function(t){n=t},this.nE=function(){return n},this.QM=function(t){i=t},this.iE=function(){return i},this.rE=function(){var t=this.getGeometry();if(t&&0<t.length)for(var n=t.length,i=0;i<n;i++)if((t[i].XM()&_t.HighlightFlags.Focused)===_t.HighlightFlags.Focused)return t[i];return null},this.sE=function(){var t=this.getGeometry();if(t&&0<t.length)for(var n=t.length,i=0;i<n;i++)if((t[i].XM()&_t.HighlightFlags.Focused)===_t.HighlightFlags.Focused){var r=t[i].getTransformedBBox();return!!this.previewManager&&this.previewManager.Yx()||(r.x+=h[i].x,r.y+=h[i].y,r.width*=s[i].x,r.height*=s[i].y),r}return null}}function Pn(t){this.dataModelMgr=t,this.isSnapX=!1,this.isSnapY=!1,this.snapX=0,this.snapY=0}
Sn.prototype.insert=function(t,n){n?n.insert(t):(0<(t=Tn(t)).otherItems.length&&console.log("Some items were not indexted!!"),0<t.sheetItems.length&&(this.Dx||(this.Dx=this.createIndexTree()),this.Dx.insert(t.sheetItems)),0<t.deviceItems.length&&(this._x||(this._x=this.createIndexTree(null,null,null,St.ElementCoordinateMode.Device)),this._x.insert(t.deviceItems)))},Sn.prototype.remove=function(t,n){n?n.remove(t):(t=Tn(t),this.Dx&&0<t.sheetItems.length&&this.Dx.remove(t.sheetItems),this._x&&0<t.deviceItems.length&&this._x.remove(t.deviceItems))},Sn.prototype.MM=function(t,n){n?n.MM(t):(t=Tn(t),this.Dx&&0<t.sheetItems.length&&this.Dx.MM(t.sheetItems),this._x&&0<t.deviceItems.length&&this._x.MM(t.deviceItems))},Sn.prototype.uE=function(t,n,i){var r=[],i=i===St.ElementCoordinateMode.Device?this._x:this.Dx;return r=i?i.uE(t,n):r},Sn.prototype.hE=function(t,n){return n.getSizeCoordinateMode()===St.ElementCoordinateMode.Device?this._x.hE(t,n):(t=this.ex.getScreenToSheetTransform(
).transformRect(t),this.Dx.hE(t,n))},Sn.prototype.setViewport=function(t){this.Dx&&this.Dx.setViewport(t)},Sn.prototype.eE=function(t){return this.Dx?this.Dx.oE(t):[]},Sn.prototype.Lx=function(t){return this.Dx?this.Dx.fE(t):[]},Sn.prototype.Ix=function(t){return this._x?this._x.fE(t):[]},Sn.prototype.destroy=function(){this.Dx=null,this._x=null},Rn.prototype.aE=function(t,n,i){if(this.Vx)return!0;var r=i&&!isNaN(n.lastPreviewRotation)?n.lastPreviewRotation:n.originalRotation,s=t.getRotation();if((void 0!==s||null!==s)&&s!==r)return n.lastPreviewRotation=s,!0;s=i&&n.lastPreviewTransformedBBox?n.lastPreviewTransformedBBox:n.originalTransformedBBox;if(s){var u=t.getTransformedBBox();if(!s.equal(u))return n.lastPreviewTransformedBBox=u,!0}u=i&&n.lastPreviewPath?n.lastPreviewPath:n.originalPath;if(u&&0<u.length){t.isUpToDate()||t.cE();i=t.getGeometry(),t=i?i.getPoints():[],i=n.offset;if(i&&(i.x||i.y))return!0;if(!St.ArrayUtil.pointArrayEqual(u,t))return n.lastPreviewPath=t,!0}return!1},
Rn.prototype.$x=function(){var t=this.Bx(),n=this.Qx(),i=this.nE(),r=this.iE();this.previewManager.lE();for(var s=this.getGeometry(),u=s.length,h=0;h<u;h++){var e=null!=r?r:i[h];null==e&&(e=0),this.previewManager.vE(s[h],t[h],n[h],e)}this.previewManager.wE()},Rn.prototype.Kx=function(){this.previewManager.dE(),this.Gx(),this.previewManager.mE(),this.Fx=!1},Rn.prototype.ik=function(t,n){!this.previewManager.Yx()&&t&&t.pushOpacity(n.opacity),this.$x()},Rn.prototype.gE=function(t,n){!this.previewManager.Yx()&&t&&t.popOpacity(),this.Kx()},Rn.prototype.uk=function(n,t,i){try{if(this.ik(n,i),!this.Fx){var r=this.previewManager.qx;if(r&&r.length)for(var s=0;s<r.length;s++)r[s].ME(n);for(var u=this.previewManager.UM,h=this.previewManager.Yx(),e=this.previewManager.qx.length,s=0;s<e;s++){var o=this.previewManager.qx[s],f=this.previewManager.pE[o.guid];o&&h&&n.getRenderingMode()!==n.Cx(o)||this.aE(o,f,h)&&(h?n.updateElement(o,!0,!0,u):o.renderPreview(n,f,i))}}this.gE(n,i)}catch(t){this.gE(n,i)}}
,Y.inheritedBy(Rn),Pn.prototype.setSnapX=function(t,n){this.isSnapX=t,this.snapX=n},Pn.prototype.setSnapY=function(t,n){this.isSnapY=t,this.snapY=n},Pn.prototype.resetSnapX=function(){this.isSnapX=!1,this.snapX=0},Pn.prototype.resetSnapY=function(){this.isSnapY=!1,this.snapY=0},Pn.prototype.isSnapNodeActive=function(){var t=this.dataModelMgr.getSheetConfigurationData();return!!t.allowObjectArrangement&&!!t.gridPreferencesData.isSnapToGrid()},Pn.prototype.isSnapSegmentActive=function(){var t=this.dataModelMgr.getSheetConfigurationData();if(!t.allowObjectArrangement)return!1;t=t.gridPreferencesData;return!!t.isSnapConnectionToGrid()&&!!t.isSnapToGrid()},Pn.prototype.getSnapPitch=function(){var t=this.dataModelMgr.getSheetConfigurationData().gridPreferencesData;return t.getMajorGridSpacing()/(t.getMinorLinesPerMajor()*t.getSnapPointsPerMinor())},Pn.prototype.isSnapByAnchor=function(){return this.dataModelMgr.getSheetConfigurationData().snapToGridByAnchorPoint},
Pn.prototype.getSnapSegmentTolerance=function(){return this.dataModelMgr.getSheetConfigurationData().gridPreferencesData.getSnapConnectionToGridTolerance()||this.getSnapPitch()/2};function Hn(t,n,i){var r=t%n;return r<0&&(r+=n),t=!0,n-r<r&&(r=n-r,t=!1),n=0,{isSnapped:!(!isNaN(i)&&i<r)&&(n=t?-1*r:r,!0),snapOffset:n}}function Ln(t){this.bE=null,this.ex=t,this.canvas=null,this.pE={},this.kE=[],this.yE=[],this.qx=[],this.xE={EE:{},CE:{}},this.UM=!1,this.NE=[],this.$M=null,this.OE=null,this.snap=new Pn(t)}Pn.prototype.doSnapX=function(t,n){this.resetSnapX();var i,r,s=this.dataModelMgr.moveConstraint.getFocusElement(t);return s&&(t=this.getSnapPitch(),n=null==n?0:n,this.isSnapByAnchor()||s instanceof _t.Connection?(r=s.DE().x+n,i=Hn(r,t),this.setSnapX(i.isSnapped,i.snapOffset)):(i=(r=s.getTransformedBBox()).x+n,r=r.x+n+r.width,i=Hn(i,t),r=Hn(r,t),i.isSnapped&&r.isSnapped?(t=(Math.abs(r.snapOffset)<Math.abs(i.snapOffset)?r:i).snapOffset,this.setSnapX(!0,t)):i.isSnapped?this.setSnapX(!0,
i.snapOffset):r.isSnapped&&this.setSnapX(!0,r.snapOffset))),{isSnapX:this.isSnapX,element:s}},Pn.prototype.doSnapY=function(t,n){this.resetSnapY();var i,r,s=this.dataModelMgr.moveConstraint.getFocusElement(t);return s&&(t=this.getSnapPitch(),n=null==n?0:n,this.isSnapByAnchor()||s instanceof _t.Connection?(r=s.DE().y+n,i=Hn(r,t),this.setSnapY(i.isSnapped,i.snapOffset)):(i=(r=s.getTransformedBBox()).y+n,r=r.y+n+r.height,i=Hn(i,t),r=Hn(r,t),i.isSnapped&&r.isSnapped?(t=(Math.abs(r.snapOffset)<Math.abs(i.snapOffset)?r:i).snapOffset,this.setSnapY(!0,t)):i.isSnapped?this.setSnapY(!0,i.snapOffset):r.isSnapped&&this.setSnapY(!0,r.snapOffset))),{isSnapY:this.isSnapY,element:s}},Pn.prototype.doSnap=function(t,n,i){n=this.doSnapX(t,n),i=this.doSnapY(t,i);return{snapResult:this.isSnapX||this.isSnapY,elementX:n.element,elementY:i.element}},Pn.prototype.doSnapPointX=function(t,n){var i=t.x+(null==n?0:n),t=this.getSnapPitch(),n=this.getSnapSegmentTolerance(),n=Hn(i,t,n);return this.setSnapX(
n.isSnapped,n.snapOffset),this.isSnapX},Pn.prototype.doSnapPointY=function(t,n){var i=t.y+(null==n?0:n),t=this.getSnapPitch(),n=this.getSnapSegmentTolerance(),n=Hn(i,t,n);return this.setSnapY(n.isSnapped,n.snapOffset),this.isSnapY},Pn.prototype.snapPointToGrid=function(t,n,i){return this.doSnapPointX(t,n),this.doSnapPointY(t,i),this.isSnapX||this.isSnapY},Ln.prototype.clear=function(){this.bE=null,this.pE={},this.kE=[],this.yE=[],this.qx=[],this.xE.EE={},this.xE.CE={}},Ln.prototype.Yx=function(){return this.ex.getSheetSession().getSheetConfigurationData().transformImmediateUpdate},Ln.prototype._E=function(){return this.Yx()},Ln.prototype.SE=function(t){var n=this.pE[t.guid];return n||(n=new St.PreviewData,t.TE(n),this.pE[t.guid]=n,t.AE=n)},Ln.prototype.vE=function(t,n,i,r){var s=this.pE[t.guid];null===(s=s||this.SE(t)).cumulativeOffset?s.cumulativeOffset={x:n.x,y:n.y}:(s.cumulativeOffset.x=n.x-s.offset.x,s.cumulativeOffset.y=n.y-s.offset.y),null===s.cumulativeScale?s.cumulativeScale={
x:i.x,y:i.y}:(s.cumulativeScale.x=i.x/s.scale.x,s.cumulativeScale.y=i.y/s.scale.y),null===s.cumulativeRotation?s.cumulativeRotation=r:(void 0===s.rotation&&(s.rotation=0),s.cumulativeRotation=r-s.rotation),s.offset=n.clone(),s.scale=i.clone(),s.rotation=r},Ln.prototype.RE=function(t){var n=this.pE[t.guid];t.PE(n)},Ln.prototype.lE=function(){this.ex.getSheetSession().CM().beginSuspension()},Ln.prototype.mE=function(){this.ex.getSheetSession().CM().endSuspension()},Ln.prototype.startPreview=function(t){this.kE=t,this.xE.EE={},this.xE.CE={};for(var n={},i=this.Yx(),r=0,s=t.length;r<s;r++){var u=t[r];u.setHighlightFlags(_t.HighlightFlags.Preview,!0),this.SE(u);var h=(n[u.guid]=u).HE(t);Array.prototype.push.apply(this.yE,h);for(var e=0,o=h.length;e<o;e++){var f=h[e];this.SE(f),(n[f.guid]=f).setHighlightFlags(_t.HighlightFlags.Preview,!0);var a=f.LE(t);Array.prototype.push.apply(this.yE,a);for(var c=a.length,l=0;l<c;l++){var v=a[l];!i&&v.getElementType()===St.ElementType.UI||(this.SE(v),(
n[v.guid]=v).setHighlightFlags(_t.HighlightFlags.Preview,!0))}}var w=t[r].LE(t);Array.prototype.push.apply(this.yE,w);for(var d=w.length,m=0;m<d;m++){var g=w[m];!i&&g.getElementType()===St.ElementType.UI||(this.SE(g),(n[g.guid]=g).setHighlightFlags(_t.HighlightFlags.Preview,!0))}var M=[];this.ex.getRelatedConnectionsToMove(u,M);var p=M.filter(function(t){return t.isVisible()});this.xE.EE[u.guid]=p,this.xE.CE[u.guid]=u;for(var b=0,k=p.length;b<k;b++)this.xE.CE[p[b].guid]=u}var y,x=this.qx,E=this.pE;for(y in n){var C=n[y];E[y]&&(x.push(C),i&&C.startPreview())}St.CommonUtil.sortSheetElements(this.qx),this.ex.getSheetSession().dM().IE()},Ln.prototype.Kx=function(){var t,n=null;this.Yx()&&(n=this.FE(),(t=this.qx)&&t.forEach(function(t){t.VE()}));for(var i=this.yE,r=0,s=i.length;r<s;r++)i[r].setHighlightFlags(_t.HighlightFlags.Preview,!1);return n},Ln.prototype.jE=function(t){this.bE&&(t&&this.Yx()&&(this.bE.Vx=!0,this.ex.updateOverlay(),this.bE.Vx=!1),this.bE.setGeometry(null),this.bE.Wx(
null),this.bE.Jx(null),this.bE.tE(null)),this.kE=[],this.yE=[],this.qx=[],this.pE={},this.NE=[],this.$M=null,this.ex.getSheetSession().dM().clear()},Ln.prototype.VE=function(){var t=this.Kx();return this.jE(!1),t};function In(t,n){return t.getGeometry&&!n.getGeometry?1:-1}Ln.prototype.wE=function(){var t=this.ex.getSheetSession();this.WE=t.suppressRoutingOnConnectionChanged,this.zE=t.suppressBoundaryUpdateOnNestedNodeChanged;var n=t.getSheetConfigurationData();n.transformPreviewOption.nestedNodeParentPreviewEnabled?t.suppressBoundaryUpdateOnNestedNodeChanged=!1:t.suppressBoundaryUpdateOnNestedNodeChanged=!0,n.transformPreviewOption.connectionPreviewEnabled?t.suppressRoutingOnConnectionChanged=!1:t.suppressRoutingOnConnectionChanged=!0;var i=!1,r=this.Yx();t.dM().IE();var s=this.kE.concat();s.sort(In);for(var u=0,h=s.length;u<h;u++){var e=s[u],o=this.pE[e.guid],f=null,a=null,c=null,c=r?(f=o.cumulativeScale,a=o.cumulativeOffset,o.cumulativeRotation):(f=o.scale,a=o.offset,o.rotation);if(
i=1!=o.scale.x||1!=o.scale.y?!0:i)e.resize(f.x,f.y,a.x,a.y);else if(isNaN(c)||0===c){if(!this.ex.isReferencedLocationInArray(e,s)){var l=a.x,v=a.y;if(0!==l||0!==v){e.move(l,v);for(var w=this.xE.EE[e.guid],d=0,m=w.length;d<m;d++){var g=w[d];r?g.move(l,v):this.pE[g.guid].offset=a.clone(),t.dM().nx(g),g.setUpToDate(!0)}}}}else e.setRotation(e.getRotation()+c),0===a.x&&0===a.y||e.move(a.x,a.y)}this.YE()},Ln.prototype.BE=function(){var n=this.ex.getSheetSession(),i=n.suppressRoutingOnConnectionChanged;try{n.suppressRoutingOnConnectionChanged=!0;for(var t=[],r=this.qx,s=0,u=r.length;s<u;s++){var h=r[s],e=h.AE.originalPath;e&&0<e.length&&!this.xE.CE[h.guid]&&(this.RE(h),t.push(h))}for(s=0,u=t.length;s<u;s++)t[s].setUpToDate(!1);n.suppressRoutingOnConnectionChanged=i}catch(t){n.suppressRoutingOnConnectionChanged=i}},Ln.prototype.dE=function(){var t=this.ex.getSheetSession();t.suppressRoutingOnConnectionChanged=this.WE,t.suppressBoundaryUpdateOnNestedNodeChanged=this.zE,this.Yx()?this.BE():(
this.FE(),t.dM().clear())},Ln.prototype.FE=function(){var n=this.ex.getSheetSession(),i=n.suppressRoutingOnConnectionChanged,r=n.suppressBoundaryUpdateOnNestedNodeChanged,t=[];try{n.suppressRoutingOnConnectionChanged=!0,n.suppressBoundaryUpdateOnNestedNodeChanged=!0;for(var s=this.Yx(),u=this.qx,h=0,e=u.length;h<e;h++){var o=u[h];this.RE(o),this.bE.aE(o,this.pE[o.guid],s)&&t.push(o),o.AE=null}n.suppressRoutingOnConnectionChanged=i,n.suppressBoundaryUpdateOnNestedNodeChanged=r}catch(t){n.suppressRoutingOnConnectionChanged=i,n.suppressBoundaryUpdateOnNestedNodeChanged=r}return t},Ln.prototype.YE=function(){if(this.mE(),!this.ex.getSheetSession().dM().mM())for(var t=this.qx,n=0,i=t.length;n<i;n++){var r=t[n].AE;r&&!r.keepLastPreviewPath&&(r.lastPreviewPath=null)}this.lE()},Ln.prototype.getElementOriginalBBox=function(t){var n=this.pE[t.guid];if(n)return n.originalBBox;t=t.getBBox();return t?t.clone():void 0},Ln.prototype.getElementOriginalSegmentIdentifier=function(t){
var n=this.pE[t.guid];if(n)return n.originalRelativeLoc.segmentId;t=t.getLocation();return t&&t.getSegmentIdentifier?t.getSegmentIdentifier():void 0},Ln.prototype.ZE=function(t){var n=this.pE[t.guid];return n?n.originalAnchor:t.getAnchorPosition()},Ln.prototype.UE=function(t){var n=this.pE[t.guid];return n?n.originalMargins:t.getMargins?t.getMargins():null},Ln.prototype.GE=function(t){var n=t.getOwner(),t=this.getElementOriginalBBox(n);return{width:t?t.width:n.getWidthValue(),height:t?t.height:n.getHeightValue()}};Ln.prototype.GM=function(t,n){var i,r=[];return this.bE&&t&&(t=t.getOwner(),(i=n?(i=this.getElementOriginalBBox(t),n.transformRect(i)):this.bE.sE())&&(r=function(t,n){for(var i=t&&t.findRelatedConnections?t.findRelatedConnections():[],r=[],s=0,u=n.length;s<u;s++)n[s]!==t&&(n[s].hasOwnership(t)||0<=i.indexOf(n[s])||r.push(n[s]));return r}(t,r=this.ex.getElementsInsideAndIntersectRect(i)))),r},Ln.prototype.setPreviewOverlays=function(t,n,i,r,s,u,h,e,o,f){
var a=this.ex.getSheetConfigurationData();this.bE||(this.bE=new Rn,(G=(this.bE.previewManager=this).bE.getStyle()).opacity=a.previewOpacity,G.strokeColor=a.visualizationPreferencesData.getPreSelectionColor(),this.ex.addOverlay(this.bE));var c=!1;if(t&&t.getOwner()){var l=t.getId();this.bE.jx=l;var v=t.getOwner(),w=this.GE(t),d=w.width,m=w.height;v.XM()&_t.HighlightFlags.Focused||this.ex.getSheet().setFocusedElements([v],!0);var g=n.concat(),M=g.length;if(0<M){for(var p=[],b=0,k=0,y=1,x=1,E=0,C=0,N=0;N<M;++N){var O,D=g[N],_=this.getElementOriginalBBox(D),S=_?_.width:D.getWidthValue(),T=_?_.height:D.getHeightValue(),A=0!==d?S/d:0,R=0!==m?T/m:0,P=0,H=0,L={left:0,top:0,right:0,bottom:0};D.getResizeMinimumSize&&(P=(O=D.getResizeMinimumSize()).width,H=O.height),D.getMargins&&(L=this.UE(D));var I,F,V=null,j=S,W=T,z=P,Y=H;switch(l>=Tt.NorthwestResize&&l<=Tt.WestResize&&((I=_?new St.Point(_.x,_.y):D.getRenderingPosition())&&(null==(V=D.getResizeOption())&&(V=a.resizeAspectRatio),Z=this.ZE(D),
V&&(j=Z.x-I.x,W=Z.y-I.y,z=P*(Z.x-I.x)/S,Y=H*(Z.y-I.y)/T)),l==Tt.NorthwestResize||l==Tt.NortheastResize||l==Tt.SoutheastResize||l==Tt.SouthwestResize?V==St.Transform.RESIZE_SAME_RATIO_ON_EDGE?V=St.Transform.RESIZE_ON_ANCHOR:V==St.Transform.RESIZE_SAME_RATIO_ON_CORNER&&(V=St.Transform.RESIZE_SAME_RATIO):l!=Tt.NorthResize&&l!=Tt.EastResize&&l!=Tt.SouthResize&&l!=Tt.WestResize||(V==St.Transform.RESIZE_SAME_RATIO_ON_EDGE?V=St.Transform.RESIZE_SAME_RATIO:V==St.Transform.RESIZE_SAME_RATIO_ON_CORNER&&(V=St.Transform.RESIZE_ON_ANCHOR))),l){case Tt.Preselection:case Tt.Move:case Tt.ConnectionMove:var B=D.getMoveStrategy();B&&(B.setTarget(D),i=(B=B.getFinalTransformation(i,r)).dx,r=B.dy);b=($=D.tk()).isLockX?0:i,k=$.isLockY?0:r;break;case Tt.NorthwestResize:this.snap.isSnapNodeActive()&&I&&(this.snap.doSnapPointX(I,i),i+=this.snap.snapX,this.snap.doSnapPointY(I,r),r+=this.snap.snapY),b=0===St.MathUtil.doubleCompare(j,0)?0:Math.min(i*A,L.left,j-z),k=0===St.MathUtil.doubleCompare(W,0)?0:Math.min(
r*R,L.top,W-Y),y=0===St.MathUtil.doubleCompare(j,0)?1:(j-b)/j,x=0===St.MathUtil.doubleCompare(W,0)?1:(W-k)/W,V==St.Transform.RESIZE_SAME_RATIO&&(b=j*(1-(y=F=x<y?y:x)),k=W*(1-(x=F)));break;case Tt.NorthResize:this.snap.isSnapNodeActive()&&I&&(this.snap.doSnapPointY(I,r),r+=this.snap.snapY),k=0===St.MathUtil.doubleCompare(W,0)?0:Math.min(r*R,L.top,W-Y),x=0===St.MathUtil.doubleCompare(W,0)?1:(W-k)/W,V==St.Transform.RESIZE_SAME_RATIO&&(b=j*(1-(y=x)),k=W*(1-x));break;case Tt.NortheastResize:this.snap.isSnapNodeActive()&&I&&(this.snap.doSnapPointX(new St.Point(I.x+S,I.y),i),i+=this.snap.snapX,this.snap.doSnapPointY(new St.Point(I.x+S,I.y),r),r+=this.snap.snapY),V&&(j=S-j,z=P-z),k=0===St.MathUtil.doubleCompare(W,0)?0:Math.min(r*R,L.top,W-H),y=0===St.MathUtil.doubleCompare(j,0)?1:Math.max(j+Math.max(i*A,-L.right),z)/j,x=0===St.MathUtil.doubleCompare(W,0)?1:(W-k)/W,V&&(V==St.Transform.RESIZE_SAME_RATIO&&(k=W*(1-(x=y=F=x<y?y:x))),b=(S-j)*(1-y));break;case Tt.EastResize:
this.snap.isSnapNodeActive()&&I&&(this.snap.doSnapPointX(new St.Point(I.x+S,I.y),i),i+=this.snap.snapX),V!=St.Transform.RESIZE_ANY_DIRECTION&&(j=S-j,z=P-z),y=0===St.MathUtil.doubleCompare(j,0)?1:Math.max(j+Math.max(i*A,-L.right),z)/j,V&&(V==St.Transform.RESIZE_SAME_RATIO&&(k=W*(1-(x=y))),b=(S-j)*(1-y));break;case Tt.SoutheastResize:this.snap.isSnapNodeActive()&&I&&(this.snap.doSnapPointX(new St.Point(I.x+S,I.y+T),i),i+=this.snap.snapX,this.snap.doSnapPointY(new St.Point(I.x+S,I.y+T),r),r+=this.snap.snapY),V&&(j=S-j,W=T-W,z=P-z,Y=H-Y),y=0===St.MathUtil.doubleCompare(j,0)?1:Math.max(j+Math.max(i*A,-L.right),z)/j,x=0===St.MathUtil.doubleCompare(W,0)?1:Math.max(W+Math.max(r*R,-L.bottom),Y)/W,V&&(V==St.Transform.RESIZE_SAME_RATIO&&(x=y=F=x<y?y:x),b=(S-j)*(1-y),k=(T-W)*(1-x));break;case Tt.SouthResize:this.snap.isSnapNodeActive()&&I&&(this.snap.doSnapPointY(new St.Point(I.x+S/2,I.y+T),r),r+=this.snap.snapY),V&&(j=S-j,W=T-W,Y=H-Y),x=0===St.MathUtil.doubleCompare(W,0)?1:Math.max(W+Math.max(r*R
,-L.bottom),Y)/W,V&&(V==St.Transform.RESIZE_SAME_RATIO&&(b=(S-j)*(1-(y=x))),k=(T-W)*(1-x));break;case Tt.SouthwestResize:this.snap.isSnapNodeActive()&&I&&(this.snap.doSnapPointX(new St.Point(I.x,I.y+T),i),i+=this.snap.snapX,this.snap.doSnapPointY(new St.Point(I.x,I.y+T),r),r+=this.snap.snapY),V&&(W=T-W,Y=H-Y),b=0===St.MathUtil.doubleCompare(j,0)?0:Math.min(i*A,L.left,j-z),y=0===St.MathUtil.doubleCompare(j,0)?1:(j-b)/j,x=0===St.MathUtil.doubleCompare(W,0)||0===St.MathUtil.doubleCompare(W,0)?1:Math.max(W+Math.max(r*R,-L.bottom),Y)/W,V&&(V==St.Transform.RESIZE_SAME_RATIO&&(x=y=F=x<y?y:x,b=j*(1-y)),k=(T-W)*(1-x));break;case Tt.WestResize:this.snap.isSnapNodeActive()&&I&&(this.snap.doSnapPointX(new St.Point(I.x,I.y+T/2),i),i+=this.snap.snapX),b=0===St.MathUtil.doubleCompare(j,0)?0:Math.min(i*A,L.left,j-z),y=0===St.MathUtil.doubleCompare(j,0)?1:(j-b)/j,V&&V==St.Transform.RESIZE_SAME_RATIO&&(k=W*(1-(x=y)));break;case Tt.Rotate:x=y=Math.cos(s*Math.PI/180),C=-(E=Math.sin(s*Math.PI/180))}
var Z=new St.Matrix(y,E,C,x,b,k);p.push(Z)}var U="",G=0;l===Tt.Move||l===Tt.ConnectionMove||l===Tt.Preselection?U="translate":l>=Tt.NorthwestResize&&l<=Tt.WestResize?(U="scale",G=l):l===Tt.Rotate&&(U="rotate");w=[],n=[];"move"!=h&&"copy"!=h||(X=g.indexOf(v),w=this.GM(t,p[X]),n=St.ArrayUtil.subtract(this.NE,w),this.ex.setDropHighlightElements(n.concat(w),!1),this.NE=w,this.$M=null,"move"==h?(this.canvas.deactivateCursor(St.CursorID.DRAGMOVE),this.canvas.deactivateCursor(St.CursorID.DROPREJECT)):"copy"==h&&(this.canvas.deactivateCursor(St.CursorID.DRAGCOPY),this.canvas.deactivateCursor(St.CursorID.DROPREJECT)));var X=u?[u.x,u.y]:[];this.OE||(this.OE=new hn(this.ex)),this.OE.enabled=!1;var $,u=null,o=new At.TransformDeltaEventArgs(g,p,U,G,X,h,w,n,e,o,f);if(o.setTransformMaster(v),this.ex.sendEvent(o)){if(o.isCancelled())return;o.isHandled()&&(p=o.getNewTransforms(),o.getIsDropAccepted()?((f=o.getDropTarget())&&(this.ex.setDropHighlightElements([f],!0),this.$M=f,(
$=o.getLocationIndicatorInfo())&&(v=o.getLocation(),u=this.OE.getLocationIndicatorOverlays($,f,new St.Point(v[0],v[1])),this.OE.selectedIndicator?this.ex.moveConstraint.locationIndicatorLoc=this.OE.selectedIndicator.Rk.location:this.ex.moveConstraint.locationIndicatorLoc=null,this.ex.moveConstraint.transformMaster=o.getTransformMaster(),this.OE.enabled=!0)),this.canvas.activateCursor("move"==h?St.CursorID.DRAGMOVE:St.CursorID.DRAGCOPY)):this.canvas.activateCursor(St.CursorID.DROPREJECT))}this.ex.setLocationIndicatorOverlays(u),!V||1!==x||1!==y||b||k||(c=!0);for(var q,K=[],J=[],Q=[],N=0;N<M;++N)b=p[N].getM6(),k=p[N].getM7(),y=p[N].getM0(),x=p[N].getM4(),E=p[N].getM1(),C=p[N].getM3(),"rotate"==U&&(q=180*Math.acos(y)/Math.PI,q=0<=180*Math.asin(E)/Math.PI?q:-q,x=y=1),K.push(new St.Point(b,k)),J.push(new St.Point(y,x)),void 0!==q&&Q.push(q);this.bE.Wx(K),this.bE.Jx(J),this.bE.tE(Q)}if(this.bE.setGeometry(g),c)return c}else this.ex.getSheet().setFocusedElements(null,!1),this.bE.setGeometry(
null)};var Fn=new function(){function l(t,n){var i=St.DebugUtil.checkModel(t);0<i.status&&alert(i.message);for(var r=[],s=0;s<t.length;++s){var u=t[s].clone(n);r.push(u)}for(0<(i=St.DebugUtil.checkModel(t)).status&&alert(i.message),s=0;s<r.length;++s)r[s].XE(n);return 0<(i=St.DebugUtil.checkModel(t)).status&&alert(i.message),r}var v=[],w=new Dt.Map,d=0;this.copy=function(t){this.clear(),d=0,v=l(t,w),w.values().forEach(function(t){t.wM=-1})},this.canPaste=function(){return 0<v.length},this.paste=function(t){w.clear(),d++;var n=null,i=[];if(t){var r=t.CM();if(r){var s=new At.PasteEventArgs(v),t=new Dt.messages.EventMessage(s,At.EventType.OnPaste);if(r.BM(t)){if(s.isCancelled())return;if(s.isHandled())for(var n=[],u=v.length,h=0;h<u;h++){var e,o=s.getResults(v[h]);o&&(n.push(o.pasted),e=o.inherited,o.inherited&&Array.prototype.splice.apply(i,e))}}}}if(!n){n=l(v,w);for(var f=w.values(),a=Dt.common.ObjectHelper.rootNamespace.Models.SheetElement,c=0;c<f.length;++c)f[c]instanceof a&&i.push(
f[c])}return{pastedElements:n,pastedSheetElements:i,pastedTimes:d}},this.clear=function(){if(v&&0<v.length)for(var t=v.length,n=0;n<t;++n)v[n].remove&&v[n].remove();v=[],w.clear()}};function Vn(t,n){this.dataModelMgr=t,this.canvas=n,this.type=null,this.subtype=St.AttachingType.None,this.contextObj=null,this.cursorPt=null,this.attachingLineOverlay=null,this.attachingElement={contextSheetElement:null,targetElement:null,nodeSide:St.AllowedSides.NONE,segmentId:null,connectionEnd:St.ConnectionEnd.NONE,percentX:null,percentY:null},this.locIndicatorUtil=new hn(t),this.connectionPreviewPath=[],this.connectionSegments=[],this.highlightCandidatesForAttaching=null,this.attachableTargets=null,this.highlightElements=null,this.preHighlightElements=null,this.$E=null}Vn.prototype.isAttachingActiveDuringNodeMove=function(){var t=this.dataModelMgr.getSheetConfigurationData();if(t&&t.attachableTargets){t=t.attachableTargets.Node;if(t&&0<t.length)return!0}return!1},
Vn.prototype.setAttachingElement=function(t,n,i,r,s,u,h){this.attachingElement.contextSheetElement=t,this.attachingElement.targetElement=n,this.attachingElement.nodeSide=i,this.attachingElement.segmentId=r,this.attachingElement.connectionEnd=s,this.attachingElement.percentX=u,this.attachingElement.percentY=h},Vn.prototype.reset=function(t,n,i){this.type=t,this.subtype=St.AttachingType.None,this.contextObj=n,this.cursorPt=i,this.attachingLineOverlay=null,this.highlightElements=null,this.preHighlightElements&&0<this.preHighlightElements.length&&this.updateHighlightObjectsDisplay(),this.preHighlightElements=null,this.setAttachingElement(null,null,St.AllowedSides.NONE,null,St.ConnectionEnd.NONE,null,null)},Vn.prototype.getSubtype=function(){return this.subtype},Vn.prototype.isAttachingAccepted=function(){return!!this.subtype},Vn.prototype.getConnectionEndPoint=function(){var t
;return this.attachingElement.connectionEnd&St.ConnectionEnd.START?t=this.attachingElement.targetElement.getStartLocation().getEvaluatedLocation():this.attachingElement.connectionEnd&St.ConnectionEnd.END&&(t=this.attachingElement.targetElement.getEndLocation().getEvaluatedLocation()),t},Vn.prototype.getAttachingLineReferPoint=function(){var t=this.attachingLineOverlay.getGeometry();return new St.Point(t.start.x+(t.end.x-t.start.x)*this.attachingElement.percentX,t.start.y+(t.end.y-t.start.y)*this.attachingElement.percentY)},Vn.prototype.getNodeSideDirectionVector=function(){var t=new St.Vector(0,0);return this.attachingElement.nodeSide&St.AllowedSides.TOP?t=St.Vector.NegativeY:this.attachingElement.nodeSide&St.AllowedSides.RIGHT?t=St.Vector.PositiveX:this.attachingElement.nodeSide&St.AllowedSides.BOTTOM?t=St.Vector.PositiveY:this.attachingElement.nodeSide&St.AllowedSides.LEFT&&(t=St.Vector.NegativeX),t},Vn.prototype.setCursor=function(t){this.canvas&&this.canvas.activateCursor(t)},
Vn.prototype.clearAttachingCursor=function(){var t=this.canvas;t&&(t.deactivateCursor(St.CursorID.LINK),t.deactivateCursor(St.CursorID.ATTACH),t.deactivateCursor(St.CursorID.TEE),t.deactivateCursor(St.CursorID.CONNECTIONLINKSTART),t.deactivateCursor(St.CursorID.CONNECTIONNODESIDESTART),t.deactivateCursor(St.CursorID.CONNECTIONSEGMENTSTART))},Vn.prototype.resetToMoveCursor=function(){this.clearAttachingCursor();var t=this.canvas;t&&t.activateCursor(St.CursorID.MOVE)},Vn.prototype.resetToDefaultCursor=function(){this.clearAttachingCursor()};function jn(t){var n=[],i=t.getStart(),r=t.getEnd();return i||(i=t.getStartLocation().getEvaluatedLocation(),n.push({portPt:i,portEnd:St.ConnectionEnd.START})),r||(t=t.getEndLocation().getEvaluatedLocation(),n.push({portPt:t,portEnd:St.ConnectionEnd.END})),n}function Wn(t,n,i,r,s){if(s){if(t&&s.isVertical()&&0!==St.MathUtil.doubleCompare(i.x,s.start.x))return 1;if(n&&s.isHorizontal()&&0!==St.MathUtil.doubleCompare(i.y,s.start.y))return 1}else{if(
t&&0!==St.MathUtil.doubleCompare(i.x,r.x))return 1;if(n&&0!==St.MathUtil.doubleCompare(i.y,r.y))return 1}}function zn(t){this.dataModelMgr=t,this.alignX={isAligned:!1,offset:0,guideLines:[],alignmentData:[]},this.alignY={isAligned:!1,offset:0,guideLines:[],alignmentData:[]},this.qE,this.KE=[],this.JE=void 0,this.QE=void 0,this.alignmentMasters=null,this.alignmentTargets=null,this.alignmentSourceTypes=null,this.alignmentTargetTypes=null,this.prioritizedAlignmentModes=null,this.nk=!1,this.tC=[],this.tC[St.AlignmentType.PortToPort]={source:_t.Port,target:_t.Port},this.tC[St.AlignmentType.NodeToNode]={source:_t.Node,target:_t.Node},this.tC[St.AlignmentType.PortToSegmentEndPoint]={source:_t.Port,target:_t.Connection},this.tC[St.AlignmentType.AnnotationToAnnotation]={source:_t.Annotation,target:_t.Annotation},this.tC[St.AlignmentType.AnnotationToNode]={source:_t.Annotation,target:_t.Node},this.tC[St.AlignmentType.NodeToAnnotation]={source:_t.Node,target:_t.Annotation},
this.tC[St.AlignmentType.ConnectionToConnection]={source:_t.Connection,target:_t.Connection},this.tC[St.AlignmentType.PortToConnectionEndPoint]={source:_t.Port,target:_t.Connection},this.tC[St.AlignmentType.ConnectionEndPointToPort]={source:_t.Connection,target:_t.Port},this.tC[St.AlignmentType.ConnectionToNode]={source:_t.Connection,target:_t.Node},this.tC[St.AlignmentType.NodeToConnection]={source:_t.Node,target:_t.Connection},this.tC[St.AlignmentType.AnnotationToConnection]={source:_t.Annotation,target:_t.Connection},this.tC[St.AlignmentType.ConnectionToAnnotation]={source:_t.Connection,target:_t.Annotation},this.tC[St.AlignmentType.PortToConnectionProjected]={source:_t.Port,target:_t.Connection}}Vn.prototype.getRetrievingPoint=function(t,n,i){t=t.clone();return t.x+=n,t.y+=i,t},Vn.prototype.isOrthogonalRoutingType=function(){var t=this.dataModelMgr.getSheetConfigurationData();return!t||t.contextData.getConnectionCreationRoutingType()==St.ConnectionBendControlOption.Orthogonal},
Vn.prototype.getBendVerticalTolerance=function(){var t=1,n=this.dataModelMgr.getSheetConfigurationData();return t=n&&n.bendVerticaltolerance?n.bendVerticaltolerance:t},Vn.prototype.getSelectionTolerance=function(){var t=this.dataModelMgr.getSheetConfigurationData(),n=this.dataModelMgr.moveConstraint,i=t.selectionPreferencesData.getSelectionRadiusPixel(),r=t.viewData.getScaleFactor(),s=i/r,i=0;n.alignment.isAlignActive()&&(s=(i=t.alignmentTolerance/r)<=s?s:i);i=0;return s=n.snap.isSnapNodeActive()?(i=(t=t.gridPreferencesData).getMajorGridSpacing()/(t.getMinorLinesPerMajor()*t.getSnapPointsPerMinor())/2)<=s?s:i:s},Vn.prototype.getAttachableObjects=function(t){if(this.attachableTargets&&0<this.attachableTargets.length)return this.attachableTargets;var n=["Node","Port","Connection"];if(!t)return n;var i=this.dataModelMgr.getSheetConfigurationData();return n=i&&i.attachableTargets?i.attachableTargets[t.getTypeName()]||[]:n},Vn.prototype.getAttachingEventControlOption=function(){
var t=St.AttachingEventControlOptions.SINGLE,n=this.dataModelMgr.getSheetConfigurationData();return t=n&&n.attachingEventControlOption?n.attachingEventControlOption:t},Vn.prototype.connectionAlignToItselfByAttachingToSegment=function(t,n,i){var r=!1,s=t.clone(),u=this.getBendVerticalTolerance(),h=this.connectionPreviewPath[0],t=this.connectionPreviewPath[1];return h&&t&&(n?Math.abs(h.x-s.x)<=u&&(s.x=h.x,r=!0):i&&Math.abs(h.y-s.y)<=u&&(s.y=h.y,r=!0)),r?s:null},Vn.prototype.getSegmentAttachingData=function(t,n){if(t.vk())return{segmentId:null};for(var i=this.getSelectionTolerance(),r=t.nC(),s=r.length,u=0;u<s;u++)if(r[u].KM(null),r[u].select(n,i)){var h,e,o,f,a,c,l=this.attachingLineOverlay=r[u],v=this.attachingLineOverlay.iC(),w=this.attachingLineOverlay.rC(),d=this.attachingLineOverlay.sC();if(this.type!==St.AttachingType.CreateConnection&&this.type!==St.AttachingType.EditConnection||(h=this.attachingLineOverlay.getGeometry(),c=new St.Point(h.start.x+(h.end.x-h.start.x)*w,h.start.y+(
h.end.y-h.start.y)*d),e=h.isHorizontal(),o=h.isVertical(),(a=this.connectionAlignToItselfByAttachingToSegment(c,e,o))?e?w=(a.x-h.start.x)/(h.end.x-h.start.x):o&&(d=(a.y-h.start.y)/(h.end.y-h.start.y)):(f=c.clone(),a=[0,0],(c=this.dataModelMgr.moveConstraint.snap).isSnapSegmentActive()&&(c.snapPointToGrid(f),c.isSnapX&&(a[0]=c.snapX),c.isSnapY&&(a[1]=c.snapY)),e?(f.x+=a[0],w=(f.x-h.start.x)/(h.end.x-h.start.x)):o&&(f.y+=a[1],d=(f.y-h.start.y)/(h.end.y-h.start.y)))),!(w<0||1<w||d<0||1<d))break;v=void 0}return{segmentId:v,percentX:w,percentY:d,attachingLineOverlay:l}},Vn.prototype.connectionAlignToItselfByAttachingToNodeSide=function(t,n,i){var r=!1,s=n.clone(),u=t.getRenderingPosition(),h=t.getEvaluatedTransform(1,1,u),s=h.transformPoint(new St.Point(s.x-u.x,s.y-u.y)),e=(i=h.transformVector(i)).equal(St.Vector.PositiveY)||i.equal(St.Vector.NegativeY),o=i.equal(St.Vector.PositiveX)||i.equal(St.Vector.NegativeX),n=this.getBendVerticalTolerance(),t=this.connectionPreviewPath[0],
i=this.connectionPreviewPath[1];return t&&i&&(e?Math.abs(t.x-s.x)<=n&&(s.x=t.x,(s=h.invert().transformPoint(s)).x+=u.x,s.y+=u.y,r=!0):o&&Math.abs(t.y-s.y)<=n&&(s.y=t.y,(s=h.invert().transformPoint(s)).x+=u.x,s.y+=u.y,r=!0)),r?s:null},Vn.prototype.getNodeSideAttachingData=function(t,n,i,r){for(var s=this.getSelectionTolerance(),u=t.JM(),h=u.length,e=0;e<h;e++)if(u[e].KM(new St.Point(i,r)),u[e].select(n,s)){var o,f,a,c,l,v,w=this.attachingLineOverlay=u[e],d=this.attachingLineOverlay.iC(),m=this.attachingLineOverlay.rC(),g=this.attachingLineOverlay.sC();if(this.type===St.AttachingType.MoveNode||this.type===St.AttachingType.CreateNode?d&St.AllowedSides.TOP?g=0:d&St.AllowedSides.RIGHT?m=1:d&St.AllowedSides.BOTTOM?g=1:d&St.AllowedSides.LEFT&&(m=0):this.type!==St.AttachingType.CreateConnection&&this.type!==St.AttachingType.EditConnection||(f=o=!1,c=new St.Vector(0,0),d&St.AllowedSides.TOP?(g=0,c.y=-1,o=!0):d&St.AllowedSides.RIGHT?(c.x=m=1,f=!0):d&St.AllowedSides.BOTTOM?(c.y=g=1,o=!0
):d&St.AllowedSides.LEFT&&(m=0,c.x=-1,f=!0),a=this.attachingLineOverlay.getGeometry(),v=new St.Point(a.start.x+(a.end.x-a.start.x)*m,a.start.y+(a.end.y-a.start.y)*g),(l=this.connectionAlignToItselfByAttachingToNodeSide(t,v,c))?o?m=(l.x-a.start.x)/(a.end.x-a.start.x):f&&(g=(l.y-a.start.y)/(a.end.y-a.start.y)):(c=v.clone(),l=[0,0],(v=this.dataModelMgr.moveConstraint.snap).isSnapSegmentActive()&&(v.snapPointToGrid(c),v.isSnapX&&(l[0]=v.snapX),v.isSnapY&&(l[1]=v.snapY)),o?(c.x+=l[0],m=(c.x-a.start.x)/(a.end.x-a.start.x)):f&&(c.y+=l[1],g=(c.y-a.start.y)/(a.end.y-a.start.y)))),!(m<0||1<m||g<0||1<g))break;d=void 0}return{nodeSide:d,percentX:m,percentY:g,attachingLineOverlay:w}},Vn.prototype.uC=function(t,n,i){if(t===n)return!0;if(n.hasOwnership(t))return!0;if(!i&&t.hasOwnership(n))return!0;for(var r=n.getOuterNode();r;){if(r===t)return!0;r=r.getOuterNode()}return!1},Vn.prototype.filterAttachingCandidates=function(t,n){var i=[],r=this.getAttachableObjects(t);if(n&&0<n.length){var s=null;if(
this.$E&&0<this.$E.length)for(var s={},u=0,h=this.$E.length;u<h;u++)s[this.$E[u].guid]=!0;for(var e=t&&t.askLinkedConnections?t.askLinkedConnections():[],o=!!t&&t instanceof _t.Connection,u=(h=n.length)-1;0<=u;u--){if(s){if(s[n[u].guid])continue;if(this.dataModelMgr.isReferencedLocationInArray(n[u],this.$E))continue}Dt.common.ObjectHelper.isTypeIncluded(n[u].getType(),r)&&(t&&this.uC(t,n[u],o)||0<=e.indexOf(n[u])||i.push(n[u]))}}return i},Vn.prototype.updateNodeSideOverlay=function(){if(this.attachingLineOverlay){var t=this.attachingLineOverlay.iC(),n=this.attachingLineOverlay.getOwner();if(n.JM)for(var i=n.JM(),r=0,s=i.length;r<s;r++)if(i[r].iC()===t){this.attachingLineOverlay=i[r];break}}},Vn.prototype.sendAttachingEvent=function(t,n,i,r,s,u,h){var e=!1,o=this.dataModelMgr.getSheetSession();return o&&(this.locIndicatorUtil.enabled=!1,s=new At.AttachingEventArgs(t,n,i,r,s,u,h),u=new Dt.messages.EventMessage(s,At.EventType.OnAttaching),o.CM().BM(u)?s.isHandled()?(e=!0,(
h=s.getLocationIndicatorInfo())?(o=s.getTargetElement(),u=s.getLocation(),u=this.locIndicatorUtil.getLocationIndicatorOverlays(h,o,new St.Point(u[0],u[1])),this.dataModelMgr.setLocationIndicatorOverlays(u),this.locIndicatorUtil.enabled=!0):this.dataModelMgr.setLocationIndicatorOverlays(null),this.highlightElements=s.getHighlightElements()):s.isCancelled()&&this.dataModelMgr.setLocationIndicatorOverlays(null):(n instanceof _t.Port&&i instanceof _t.Connection||(!n||n instanceof _t.Connection)&&i instanceof _t.Port)&&(e=!0)),e},Vn.prototype.sendAttachedEvent=function(t){var n,i,r,s,u,h=!1,e=this.dataModelMgr.getSheetSession();return e&&(n=this.attachingElement,i=e.CM(),e=new f(t,n.contextSheetElement,n.targetElement,n.nodeSide,n.segmentId,n.connectionEnd,[n.percentX,n.percentY]),t=new Dt.messages.EventMessage(e,_.OnAttached),this.locIndicatorUtil.enabled&&this.locIndicatorUtil.selectedIndicator&&((r=this.locIndicatorUtil.selectedIndicator.Rk)&&e.setLocationIndicatorInfo(r)),(
r=n.contextSheetElement).hC=!0,t=i.BM(t),delete r.hC,t?h=!!e.isHandled()&&(this.dataModelMgr.setLocationIndicatorOverlays(null),this.dataModelMgr.setCursorQuadrantIndicator(null),!0):(n.contextSheetElement instanceof _t.Port&&n.targetElement instanceof _t.Connection?(s=n.contextSheetElement,u=n.targetElement):n.contextSheetElement instanceof _t.Connection&&n.targetElement instanceof _t.Port&&(s=n.targetElement,u=n.contextSheetElement),s&&u&&(i.beginTransaction(Dt.messages.ModelChangeMessage),n.connectionEnd&St.ConnectionEnd.START?u.setStart(s,!0):n.connectionEnd&St.ConnectionEnd.END&&u.setEnd(s,!0),i.endTransaction(),h=!0))),h},Vn.prototype.showCandidates=function(t,n,i){this.dataModelMgr.getSheet();var r=this.getAttachableObjects(t),s=[];if(t)if(t instanceof _t.Node){if(Dt.common.ObjectHelper.isTypeIncluded(_t.Port,r)){for(var u,h=[],e=[],o=t.getPorts(),f=o.length,a=0;a<f;a++)0===o[a].getSymbols().length?((u=o[a].eC()).KM(new St.Point(n,i)),e.push(u)):h.push(o[a]);s=h,
this.dataModelMgr.setAttachingPortOverlays(e)}else s=[],this.dataModelMgr.setAttachingPortOverlays(null);this.dataModelMgr.setAttachingLineOverlays(null)}else t instanceof _t.Port&&Dt.common.ObjectHelper.isTypeIncluded(_t.Port,r)&&0===t.getSymbols().length&&((u=t.eC()).KM(new St.Point(n,i)),u.oC(!1),this.dataModelMgr.setAttachingPortOverlays([u]));else s=[],this.dataModelMgr.setAttachingPortOverlays(null),this.dataModelMgr.setAttachingLineOverlays(null);var c=this.highlightCandidatesForAttaching,l=!1;if(c&&s&&c.length===s.length){for(a=0,f=c.length;a<f;a++)if(c[a]!==s[a]){l=!0;break}}else l=!0;l?this.updateAttachingCandidatesDisplay(s):this.dataModelMgr.updateOverlay()},Vn.prototype.fC=function(t,n){var i=this.attachingElement.targetElement.nC(),r=i.length,r=this.attachingElement.connectionEnd&St.ConnectionEnd.START?i[0]:i[r-1];this.dataModelMgr.setAttachingLineOverlays(r);r=this.attachingElement.contextSheetElement.eC();r.KM(new St.Point(t,n));n=r.getPort();0===n.getSymbols().length?(
r.oC(!0),this.dataModelMgr.setAttachingPortOverlays([r]),this.dataModelMgr.updateOverlay()):this.updateAttachingCandidatesDisplay([n]),this.setCursor(St.CursorID.LINK)},Vn.prototype.aC=function(t,n){this.attachingLineOverlay.KM(new St.Point(t,n)),this.dataModelMgr.setAttachingLineOverlays(this.attachingLineOverlay),this.dataModelMgr.updateOverlay(),this.setCursor(St.CursorID.ATTACH)},Vn.prototype.cC=function(t,n){this.attachingLineOverlay.KM(null),this.dataModelMgr.setAttachingLineOverlays(this.attachingLineOverlay),this.dataModelMgr.updateOverlay(),this.setCursor(St.CursorID.LINK)},Vn.prototype.lC=function(t,n){},Vn.prototype.vC=function(t,n){this.type!==St.AttachingType.CreateNode&&!this.dataModelMgr.previewManager._E()||this.updateNodeSideOverlay();var i=this.attachingElement.targetElement.nC(),r=i.length,r=this.attachingElement.connectionEnd&St.ConnectionEnd.START?i[0]:i[r-1];this.attachingLineOverlay.KM(new St.Point(t,n)),this.dataModelMgr.setAttachingLineOverlays([
this.attachingLineOverlay,r]),this.dataModelMgr.updateOverlay(),this.setCursor(St.CursorID.ATTACH)},Vn.prototype.wC=function(t,n){var i,r=this.attachingElement.targetElement;0===r.getSymbols().length?((i=r.eC()).KM(new St.Point(t,n)),i.oC(!0),this.dataModelMgr.setAttachingPortOverlays([i]),this.dataModelMgr.updateOverlay()):this.updateAttachingCandidatesDisplay([r]),this.contextObj?this.setCursor(St.CursorID.LINK):this.setCursor(St.CursorID.CONNECTIONLINKSTART)},Vn.prototype.dC=function(t,n){this.attachingLineOverlay.KM(new St.Point(t,n)),this.dataModelMgr.setAttachingLineOverlays(this.attachingLineOverlay),this.dataModelMgr.updateOverlay(),this.contextObj?this.setCursor(St.CursorID.ATTACH):this.setCursor(St.CursorID.CONNECTIONNODESIDESTART)},Vn.prototype.mC=function(t,n){this.updateAttachingCandidatesDisplay([this.attachingElement.targetElement]),this.contextObj?this.setCursor(St.CursorID.LINK):this.setCursor(St.CursorID.CONNECTIONLINKSTART)},Vn.prototype.gC=function(t,n){
this.attachingLineOverlay.KM(new St.Point(t,n)),this.dataModelMgr.setAttachingLineOverlays(this.attachingLineOverlay),this.dataModelMgr.updateOverlay(),this.contextObj?this.setCursor(St.CursorID.TEE):this.setCursor(St.CursorID.CONNECTIONSEGMENTSTART)},Vn.prototype.MC=function(t,n){var i,r=this.attachingElement.targetElement;0===r.getSymbols().length?((i=r.eC()).KM(new St.Point(0,0)),i.oC(!0),this.dataModelMgr.setAttachingPortOverlays([i]),this.dataModelMgr.updateOverlay()):this.updateAttachingCandidatesDisplay([r]),this.contextObj?this.setCursor(St.CursorID.LINK):this.setCursor(St.CursorID.CONNECTIONLINKSTART)},Vn.prototype.highlightClear=function(){this.dataModelMgr.setAttachingPortOverlays(null),this.dataModelMgr.setAttachingLineOverlays(null),this.highlightElements=null,this.highlightCandidatesForAttaching?(this.preHighlightElements&&(this.highlightCandidatesForAttaching=this.highlightCandidatesForAttaching.concat(this.preHighlightElements),this.preHighlightElements=null),
this.updateAttachingCandidatesDisplay(null)):this.dataModelMgr.updateOverlay(),this.highlightCandidatesForAttaching=null,this.preHighlightElements&&0<this.preHighlightElements.length&&(this.updateHighlightObjectsDisplay(),this.preHighlightElements=null),this.resetToDefaultCursor()},Vn.prototype.updateAttachingCandidatesDisplay=function(t){var n,i=null,r=null;this.highlightCandidatesForAttaching&&(i=this.highlightCandidatesForAttaching.concat()),(r=t?t.concat():r)||i?(n=this.dataModelMgr.getSheetSession())&&((n=n.CM()).beginTransaction(Dt.messages.ModelChangeMessage),r&&r.forEach(function(t){t.setHighlightFlags(_t.HighlightFlags.SecondaryHover,!0)}),i&&i.forEach(function(t){t.setHighlightFlags(_t.HighlightFlags.SecondaryHover,!1)}),n.endTransaction()):this.dataModelMgr.updateOverlay(),this.highlightCandidatesForAttaching=t},Vn.prototype.updateHighlightObjectsDisplay=function(){var t,n,i;this.preHighlightElements!=this.highlightElements&&(t=this.preHighlightElements,
n=this.highlightElements,this.highlightElements=null,!n&&!t||(i=this.dataModelMgr.getSheetSession())&&((i=i.CM()).beginTransaction(Dt.messages.ModelChangeMessage),t&&t.forEach(function(t){t.setHighlightFlags(_t.HighlightFlags.SecondaryHover,!1)}),n&&n.forEach(function(t){t.setHighlightFlags(_t.HighlightFlags.SecondaryHover,!0)}),i.endTransaction()),this.preHighlightElements=n)},Vn.prototype.highlightCandidates=function(t,n){(this.highlightElements||this.preHighlightElements)&&this.updateHighlightObjectsDisplay(),this.subtype===St.AttachingType.PortAttachToConnectionEnd?this.fC(t,n):this.subtype===St.AttachingType.PortAttachToNodeSide?this.aC(t,n):this.subtype===St.AttachingType.NodeAttachToConnectionSegment?this.cC(t,n):this.subtype===St.AttachingType.NodeAttachToConnectionEnd?this.lC(t,n):this.subtype===St.AttachingType.NodeSideAttachToConnectionEnd?this.vC(t,n):this.subtype===St.AttachingType.ConnectionEndAttachToPort?this.wC(t,n
):this.subtype===St.AttachingType.ConnectionEndAttachToNodeSide?this.dC(t,n):this.subtype===St.AttachingType.ConnectionEndAttachToNode?this.mC(t,n):this.subtype===St.AttachingType.ConnectionEndAttachToConnectionSegment?this.gC(t,n):this.subtype===St.AttachingType.PortAttachToPort?this.MC(t,n):this.highlightClear()},Vn.prototype.pC=function(){return{attachingPoint:this.getConnectionEndPoint(),basePoint:this.attachingElement.contextSheetElement.getResolvedSymbolConnectionPoint()}},Vn.prototype.bC=function(){return{attachingPoint:this.getAttachingLineReferPoint(),basePoint:this.attachingElement.contextSheetElement.getAnchorPosition()}},Vn.prototype.kC=function(){var t=this.getConnectionEndPoint(),n=this.getAttachingLineReferPoint(),i=this.attachingElement.contextSheetElement.getRenderingPosition();return{attachingPoint:t,basePoint:n=this.attachingElement.contextSheetElement.getEvaluatedTransform(1,1,i).transformPoint(new St.Point(n.x-i.x,n.y-i.y))}},Vn.prototype.yC=function(){return{
attachingPoint:this.getAttachingLineReferPoint(),basePoint:this.attachingElement.contextSheetElement.getAnchorPosition()}},Vn.prototype.xC=function(){return{attachingPoint:this.getConnectionEndPoint(),basePoint:this.attachingElement.contextSheetElement.getAnchorPosition()}},Vn.prototype.EC=function(){var t=this.attachingElement.targetElement.getSymbolConnectionLocation().getEvaluatedLocation(),n=this.attachingElement.targetElement.getResolvedConnectionDirection(),i=this.attachingElement.targetElement.getOwner().getBBox(),r=this.attachingElement.targetElement.getRenderingPosition(),s=this.attachingElement.targetElement.getEvaluatedTransform(1,1,r),u=this.attachingElement.targetElement.getOwner().getEvaluatedTransform(1,1,new St.Point(i.x,i.y));return{attachingPoint:t=s.transformPoint(new St.Point(t.x-r.x,t.y-r.y)),directionVector:n,endRect:i=u.transformRect(new St.Rect(0,0,i.width,i.height))}},Vn.prototype.CC=function(){var t=this.attachingElement.targetElement.getBBox(),
n=this.getNodeSideDirectionVector(),i=this.getAttachingLineReferPoint(),r=this.attachingElement.targetElement.getEvaluatedTransform(1,1,new St.Point(t.x,t.y)),i=r.transformPoint(new St.Point(i.x-t.x,i.y-t.y)),t=r.transformRect(new St.Rect(0,0,t.width,t.height));return{attachingPoint:i,directionVector:n=function(t){t=t.clone();return 0===St.MathUtil.doubleCompare(t.x,0)&&0!==t.x&&(t.x=0),0===St.MathUtil.doubleCompare(t.y,0)&&0!==t.y&&(t.y=0),t}(n=r.transformVector(n)),endRect:t}},Vn.prototype.NC=function(){var t=this.attachingElement.targetElement.getBBox(),n=this.cursorPt,i=new St.Vector(0,0);this.locIndicatorUtil.enabled&&this.locIndicatorUtil.selectedIndicator&&(this.locIndicatorUtil.selectedIndicator.Rk.location&&(n=this.locIndicatorUtil.selectedIndicator.Rk.location),this.locIndicatorUtil.selectedIndicator.Rk.direction&&(i=this.locIndicatorUtil.selectedIndicator.Rk.direction));var r=this.attachingElement.targetElement.getEvaluatedTransform(1,1,new St.Point(t.x,t.y));return{
attachingPoint:n=r.transformPoint(new St.Point(n.x-t.x,n.y-t.y)),directionVector:i,endRect:t=r.transformRect(new St.Rect(0,0,t.width,t.height))}},Vn.prototype.OC=function(){var t,n,i=this.getAttachingLineReferPoint(),r=new St.Rect(i.x,i.y,0,0),s=new St.Vector(0,0),u=this.attachingLineOverlay.getGeometry();return this.type===St.AttachingType.CreateConnection?this.attachingElement.connectionEnd&St.ConnectionEnd.START?u.isHorizontal()?s=St.Vector.PositiveY:u.isVertical()&&(s=St.Vector.PositiveX):this.attachingElement.connectionEnd&St.ConnectionEnd.END&&(n=(t=function(t){t=t.getGeometry(),t=t?t.getPoints():[];return 2===t.length&&0===St.MathUtil.doubleCompare(t[0].x,t[1].x)&&0===St.MathUtil.doubleCompare(t[0].y,t[1].y)&&t.pop(),t}(this.attachingElement.contextSheetElement))[t.length-1],t=t.length<=1&&2<=this.connectionPreviewPath.length,u.isHorizontal()?this.isOrthogonalRoutingType()&&(t&&0===St.MathUtil.doubleCompare(n.y,u.start.y)&&(
n=this.connectionPreviewPath[this.connectionPreviewPath.length-2]),s.y=n.y>=i.y?1:-1):u.isVertical()&&this.isOrthogonalRoutingType()&&(t&&0===St.MathUtil.doubleCompare(n.x,u.start.x)&&(n=this.connectionPreviewPath[this.connectionPreviewPath.length-2]),s.x=n.x>=i.x?1:-1)):this.type===St.AttachingType.EditConnection&&(t=this.attachingElement.connectionEnd&St.ConnectionEnd.START?this.connectionSegments[1]:this.connectionSegments[0],n=this.attachingElement.connectionEnd&St.ConnectionEnd.START?t.end:t.start,u.isHorizontal()?(t.isVertical()||t.isHorizontal())&&(s.y=n.y>=i.y?1:-1):u.isVertical()&&(t.isVertical()||t.isHorizontal())&&(s.x=n.x>=i.x?1:-1)),{attachingPoint:i,directionVector:s,endRect:r}},Vn.prototype.DC=function(){var t=this.attachingElement.targetElement.getSymbolConnectionLocation(),t=t.getLocationRule()?t.getEvaluatedLocation():t.getResolvedEvaluatedLocation();return{attachingPoint:t,basePoint:this.attachingElement.contextSheetElement.getAnchorPosition()}},
Vn.prototype.getAttachmentData=function(){var t;return this.subtype===St.AttachingType.PortAttachToConnectionEnd?t=this.pC():this.subtype===St.AttachingType.PortAttachToNodeSide?t=this.bC():this.subtype===St.AttachingType.NodeSideAttachToConnectionEnd?t=this.kC():this.subtype===St.AttachingType.NodeAttachToConnectionSegment?t=this.yC():this.subtype===St.AttachingType.NodeAttachToConnectionEnd?t=this.xC():this.subtype===St.AttachingType.ConnectionEndAttachToPort?t=this.EC():this.subtype===St.AttachingType.ConnectionEndAttachToNodeSide?t=this.CC():this.subtype===St.AttachingType.ConnectionEndAttachToNode?t=this.NC():this.subtype===St.AttachingType.ConnectionEndAttachToConnectionSegment?t=this.OC():this.subtype===St.AttachingType.PortAttachToPort&&(t=this.DC()),t},Vn.prototype.attachingPort2Connection=function(t,n,i,r,s){for(var u=jn(n),h=this.getSelectionTolerance(),e=0,o=u.length;e<o;e++)if(i.isPointInside(u[e].portPt,h)){var f=t.getOwner().tk();if(f.isLockX||f.isLockY){
var a=t.getResolvedSymbolConnectionPoint(),a=this.getRetrievingPoint(a,r,s);if(Wn(f.isLockX,f.isLockY,u[e].portPt,a))continue}if(!(f=t.tk()).isLockX&&!f.isLockY||!Wn(f.isLockX,f.isLockY,u[e].portPt,a))if(this.sendAttachingEvent(u[e].portPt,t,n,St.AllowedSides.NONE,null,u[e].portEnd,null))return this.setAttachingElement(t,n,St.AllowedSides.NONE,null,u[e].portEnd,null,null),this.subtype=St.AttachingType.PortAttachToConnectionEnd,!0}return!1},Vn.prototype.attachingNode2Connection=function(t,n,i,r,s){var u=t.getAnchorPosition(),h=this.getRetrievingPoint(u,r,s),e=this.getSegmentAttachingData(n,h),u=e.segmentId,o=t.tk();if(null!=u){if(o.isLockX||o.isLockY){var f=e.attachingLineOverlay.getGeometry();if(Wn(o.isLockX,o.isLockY,h,null,f))return!1}var a=e.percentX,c=e.percentY;if(m=this.sendAttachingEvent(h,t,n,St.AllowedSides.NONE,u,St.ConnectionEnd.NONE,[a,c]))return this.setAttachingElement(t,n,St.AllowedSides.NONE,u,St.ConnectionEnd.NONE,a,c),
this.subtype=St.AttachingType.NodeAttachToConnectionSegment,!0}else for(var l=jn(n),v=this.getSelectionTolerance(),w=0,d=l.length;w<d;w++)if(i.isPointInside(l[w].portPt,v)){var m=void 0;if(m=void 0===(m=(o.isLockX||o.isLockY)&&Wn(o.isLockX,o.isLockY,h,l[w].portPt)?!1:m)?this.sendAttachingEvent(l[w].portPt,t,n,St.AllowedSides.NONE,null,l[w].portEnd,null):m)return this.setAttachingElement(t,n,St.AllowedSides.NONE,null,l[w].portEnd,null,null),this.subtype=St.AttachingType.NodeAttachToConnectionEnd,!0;var g=l[w].portPt,M=r,p=s;this.type===St.AttachingType.CreateNode&&(g=this.getRetrievingPoint(l[w].portPt,-r,-s),p=M=0);M=this.getNodeSideAttachingData(t,g,M,p),p=M.nodeSide;if(p){if(o.isLockX||o.isLockY){f=M.attachingLineOverlay.getGeometry();if(Wn(o.isLockX,o.isLockY,l[w].portPt,null,f))continue}a=M.percentX,c=M.percentY;if(m=this.sendAttachingEvent(l[w].portPt,t,n,p,null,l[w].portEnd,[a,c]))return this.setAttachingElement(t,n,p,null,l[w].portEnd,a,c),
this.subtype=St.AttachingType.NodeSideAttachToConnectionEnd,!0}}return!1},Vn.prototype.attachingPort2Node=function(t,n,i,r){var s=t.getAnchorPosition(),u=this.getRetrievingPoint(s,i,r),s=this.getNodeSideAttachingData(n,u,0,0),i=s.nodeSide;if(i){r=t.tk();if(r.isLockX||r.isLockY){var h=s.attachingLineOverlay.getGeometry();if(Wn(r.isLockX,r.isLockY,u,null,h))return!1}h=s.percentX,s=s.percentY;if(this.sendAttachingEvent(u,t,n,i,null,null,[h,s]))return this.setAttachingElement(t,n,i,null,null,h,s),this.subtype=St.AttachingType.PortAttachToNodeSide,!0}return!1},Vn.prototype.attachingConnection2Node=function(t,n,i,r){if(this.sendAttachingEvent(i,t,n,St.AllowedSides.NONE,null,r,null))return this.setAttachingElement(t,n,St.AllowedSides.NONE,null,r,null,null),this.subtype=St.AttachingType.ConnectionEndAttachToNode,!0;var s=this.getNodeSideAttachingData(n,i,0,0),u=s.nodeSide;if(u){var h=s.percentX,s=s.percentY;if(this.sendAttachingEvent(i,t,n,u,null,r,[h,s]))return this.setAttachingElement(t,n,u,
null,r,h,s),this.subtype=St.AttachingType.ConnectionEndAttachToNodeSide,!0}return!1},Vn.prototype.attachingConnection2Connection=function(t,n,i,r){var s=this.getSegmentAttachingData(n,i),u=s.segmentId;if(null!=u){var h=s.percentX,s=s.percentY;if(this.sendAttachingEvent(i,t,n,St.AllowedSides.NONE,u,r,[h,s]))return this.setAttachingElement(t,n,St.AllowedSides.NONE,u,r,h,s),this.subtype=St.AttachingType.ConnectionEndAttachToConnectionSegment,!0}return!1},Vn.prototype.attachingConnection2Port=function(t,n,i,r){return!!this.sendAttachingEvent(i,t,n,St.AllowedSides.NONE,null,r,null)&&(this.setAttachingElement(t,n,St.AllowedSides.NONE,null,r,null,null),this.subtype=St.AttachingType.ConnectionEndAttachToPort,!0)},Vn.prototype.attachingPort2Port=function(t,n,i,r){var s=t.getAnchorPosition(),i=this.getRetrievingPoint(s,i,r),r=t.getOwner().tk();return(!r.isLockX&&!r.isLockY||!Wn(r.isLockX,r.isLockY,i,n.getResolvedSymbolConnectionPoint()))&&((!(r=t.tk()).isLockX&&!r.isLockY||!Wn(r.isLockX,
r.isLockY,i,n.getResolvedSymbolConnectionPoint()))&&(!!this.sendAttachingEvent(i,t,n,null,null,null,null)&&(this.setAttachingElement(t,n,null,null,null,0,0),this.subtype=St.AttachingType.PortAttachToPort,!0)))},Vn.prototype.attaching=function(t,n,i,r,s,u,h){var e=!1;return t instanceof _t.Port&&n instanceof _t.Connection&&this.contextObj!==t?e=this.attachingPort2Connection(t,n,i,u,h):t instanceof _t.Node&&n instanceof _t.Connection?e=this.attachingNode2Connection(t,n,i,u,h):t instanceof _t.Port&&n instanceof _t.Node?e=this.attachingPort2Node(t,n,u,h):(!t||t instanceof _t.Connection)&&n instanceof _t.Node?e=this.attachingConnection2Node(t,n,r,s):(!t||t instanceof _t.Connection)&&n instanceof _t.Connection?e=this.attachingConnection2Connection(t,n,r,s):(!t||t instanceof _t.Connection)&&n instanceof _t.Port?e=this.attachingConnection2Port(t,n,r,s):(!t||t instanceof _t.Port)&&n instanceof _t.Port&&(e=this.attachingPort2Port(t,n,u,h)),e},
Vn.prototype.retrieveConnectionByAttachedPort=function(t,n){var i=!1;if(this.contextObj.qM)for(var r=this.contextObj.qM(),s=0,u=r.length;s<u;s++){r[s].KM(new St.Point(t,n));for(var h=r[s].getPort(),e=r[s].getRenderingBBox(),o=this.dataModelMgr.getElementsInsideAndIntersectRect(e),f=this.filterAttachingCandidates(h,o),a=[],c=0,l=f.length;c<l;c++)f[c]instanceof _t.Connection&&a.push(f[c]);o=this.getAttachingEventControlOption();if(o===St.AttachingEventControlOptions.SINGLE?i=this.attaching(h,a[0],e,null,null,t,n):St.AttachingEventControlOptions.MULTIPLE,i)break}return i},Vn.prototype.retrieveCandidatesByBoundary=function(t,n,i){var r=!1,s=t.clone(),u=this.contextObj.getAnchorPosition(),h=this.getSelectionTolerance(),h=new St.Rect(u.x+n-h,u.y+i-h,2*h,2*h);s.union(h);s=this.dataModelMgr.getElementsInsideAndIntersectRect(s),s=this.filterAttachingCandidates(this.contextObj,s);return 0<s.length?(this.showCandidates(this.contextObj,n,i),this.getAttachingEventControlOption(
)===St.AttachingEventControlOptions.SINGLE?r=this.attaching(this.contextObj,s[0],t,null,null,n,i):St.AttachingEventControlOptions.MULTIPLE,r||(this.showCandidates(null),this.type===St.AttachingType.MoveNode?this.resetToMoveCursor():this.resetToDefaultCursor())):(this.showCandidates(null),this.type===St.AttachingType.MoveNode?this.resetToMoveCursor():this.resetToDefaultCursor()),r},Vn.prototype.bulkSourcesAttaching=function(t,n,i,r,s){for(var u=!1,h=0,e=t.length;h<e;h++){var o=t[h],f=n||o.getOwner(),a=o instanceof _t.Port&&f instanceof _t.Node;this.reset(i,a?f:o);f=o.getRenderingBBox();if(this.retrieveCandidates(o,f,r,s)){u=!0;break}}return u||(this.showCandidates(null),i===St.AttachingType.MoveNode?this.resetToMoveCursor():this.resetToDefaultCursor()),u},Vn.prototype.bulkSourcesAttaching2=function(t,n,i,r,s){for(var u={isAttaching:!1,idx:-1},h=0,e=t.length;h<e;h++){var o=t[h],f=r.indexOf(o),a=n||o.getOwner();f<0&&(f=r.indexOf(a));var c=o instanceof _t.Port&&a instanceof _t.Node
;this.reset(i,c?a:o);a=o.getRenderingBBox();if(this.retrieveCandidates(o,a,s[f].x,s[f].y)){u.isAttaching=!0,u.idx=f;break}}return u.isAttaching||(this.showCandidates(null),i===St.AttachingType.MoveNode?this.resetToMoveCursor():this.resetToDefaultCursor()),u},Vn.prototype.retrieveCandidates=function(t,n,i,r){var s=!1,u=this.getSelectionTolerance(),n=new St.Rect(n.x+i-u,n.y+r-u,n.width+2*u,n.height+2*u),u=this.dataModelMgr.getElementsInsideAndIntersectRect(n),h=this.filterAttachingCandidates(t,u),e=h.length;if(t instanceof _t.Port)for(var o=0;o<e;o++){var f=h[o];if(!(f instanceof _t.Port&&t.getOwner()==f.getOwner()))break;h.splice(o,1),--e,o--}return 0<e&&(this.showCandidates(t,i,r),this.getAttachingEventControlOption()===St.AttachingEventControlOptions.SINGLE?s=this.attaching(t,h[0],n,null,null,i,r):St.AttachingEventControlOptions.MULTIPLE),s},Vn.prototype.retrieveCandidatesByPoint=function(t,n){var i=!1,r=this.dataModelMgr.getElementsByPoint(t),r=this.filterAttachingCandidates(
this.contextObj,r);return 0<r.length?(this.getAttachingEventControlOption()===St.AttachingEventControlOptions.SINGLE?(this.showCandidates(r[0],0,0),i=this.attaching(this.contextObj,r[0],null,t,n)):St.AttachingEventControlOptions.MULTIPLE,i?this.highlightCandidates(0,0):(this.dataModelMgr.setLocationIndicatorOverlays(null),this.showCandidates(null),this.resetToDefaultCursor())):(this.dataModelMgr.setLocationIndicatorOverlays(null),this.showCandidates(null),this.resetToDefaultCursor()),i},Vn.prototype.findOriginalAttachingTargets=function(t,n,i){var n=this.dataModelMgr.getElementsByPoint(n),r=this.filterAttachingCandidates(t,n),s=r.length,u=!1;if(0<s)for(var h=0;h<s;h++){if(r[h]===i){u=!0;break}u=!1}return 0<s&&!u?r:u?[i]:[]},zn.prototype._C=function(t){this.alignmentMasters=t.getAlignmentMasters(),this.alignmentSourceTypes=t.getAllowedAlignSourceTypes(),this.alignmentTargetTypes=t.getAllowedAlignTargetTypes(),this.alignmentTargets=t.getAlignmentTargets(),
this.prioritizedAlignmentModes=t.getPrioritizedAlignmentModes()},zn.prototype.SC=function(){this.alignmentMasters=null,this.alignmentSourceTypes=null,this.alignmentTargetTypes=null,this.alignmentTargets=null,this.prioritizedAlignmentModes=null},zn.prototype.setAlignX=function(t,n,i,r){this.alignX.isAligned=t,this.alignX.offset=n,this.alignX.guideLines=i,this.alignX.alignmentData=r},zn.prototype.setAlignY=function(t,n,i,r){this.alignY.isAligned=t,this.alignY.offset=n,this.alignY.guideLines=i,this.alignY.alignmentData=r},zn.prototype.resetAlignX=function(){this.alignX.isAligned=!1,this.alignX.offset=0,this.alignX.guideLines=[],this.alignX.alignmentData=[],this.JE=void 0,this.qE=void 0},zn.prototype.resetAlignY=function(){this.alignY.isAligned=!1,this.alignY.offset=0,this.alignY.guideLines=[],this.alignY.alignmentData=[],this.QE=void 0,this.qE=void 0},zn.prototype.getGuideLines=function(){var t=[],n=[];return this.alignX.isAligned&&(t=this.alignX.guideLines),this.alignY.isAligned&&(
n=this.alignY.guideLines),t.concat(n)},zn.prototype.isAlignActive=function(){var t=this.dataModelMgr.getSheetConfigurationData();return t.allowObjectArrangement&&t.autoAlignmentEnabled},zn.prototype.getAlignTolerance=function(){var t=this.dataModelMgr.getSheetConfigurationData(),n=t.enableScaleBasedAlignment;if(this.nk)return 0;var i=t.viewData.getScaleFactor(),r=t.alignmentTolerance/i;if(!n)return r;var s,u,h=0,e=t.scaleBasedAlignmentTolerances;for(u in e)if(Object.prototype.hasOwnProperty.call(e,u)&&(s=e[u],i<=parseFloat(u))){r=e[u],h++;break}return r=!h?s:r},zn.prototype.getAlignableTypes=function(){return this.dataModelMgr.getSheetConfigurationData().alignableObjectTypes},zn.prototype.getAlignalbeClassTypes=function(){var t=this.getAlignableTypes();if(this.qE)return this.qE;this.qE=[];for(var n=0,i=t.length;n<i;n++){var r=t[n];this.qE.push(r)}return this.qE},zn.prototype.isObjectAlignable=function(t){for(var n=this.getAlignalbeClassTypes(),i=0,r=n.length;i<r;i++)if(
Dt.common.ObjectHelper.isDerivedFrom(t.getType(),n[i]))return!0;return!1},zn.prototype.getAlignPriority=function(){var t=this.prioritizedAlignmentModes;if(t&&0<t.length)return t;if(null==t){t=this.dataModelMgr.getSheetConfigurationData();if(t&&t.alignmentPriority)return t.alignmentPriority}return[]},zn.prototype.isExceedingMaxCount=function(t){var n=this.dataModelMgr.getSheetConfigurationData();return!!(n&&n.maxAlignmentSourceCount&&t.length>=n.maxAlignmentSourceCount)};function Yn(t){for(var n=t[0].x,i=t[0].x,r=t[0].y,s=t[0].y,u=1,h=t.length;u<h;u++)St.MathUtil.doubleCompare(t[u].x,n)<0&&(n=t[u].x),0<St.MathUtil.doubleCompare(t[u].x,i)&&(i=t[u].x),St.MathUtil.doubleCompare(t[u].y,r)<0&&(r=t[u].y),0<St.MathUtil.doubleCompare(t[u].y,s)&&(s=t[u].y);return new St.Rect(n,r,i-n,s-r)}function Bn(t,n){var i,r=!1;return r=(i=t&&n?(t=t.getLocation())?t.getReference():null:i)?i===n||Bn(i,n):r}zn.prototype.TC=function(t,n){var i,r,s,u,h=this.alignmentTargetTypes,e=!1;h&&0<h.length&&(
i=0<=h.indexOf("Node"),r=0<=h.indexOf("Port"),s=0<=h.indexOf("Connection"),u=0<=h.indexOf("Annotation"),e=!0);for(var o=[],f=0,a=t.length;f<a;f++){if(e){if(!i&&t[f]instanceof _t.Node)continue;if(!r&&t[f]instanceof _t.Port)continue;if(!s&&t[f]instanceof _t.Connection)continue;if(!u&&t[f]instanceof _t.Annotation)continue}else if(!this.isObjectAlignable(t[f]))continue;if(!t[f].inCreationContext){for(var c=!0,l=0,v=n.length;l<v;l++){if(t[f]===n[l]){c=!1;break}if(t[f]instanceof _t.Connection&&t[f].XM()&_t.HighlightFlags.Preview){var w=t[f].getStart(),d=t[f].getEnd();if((!w||w.getOwner()!==n[l]&&w!==n[l])&&(!d||d.getOwner()!==n[l]&&d!==n[l])){c=!1;break}}else if(n[l]&&Bn(t[f],n[l])){c=!1;break}}c&&o.push(t[f])}}return o};function Zn(t,n){for(var i,r=[],s=0,u=n.length;s<u;s++){for(var h=0,e=t.length;h<e;h++){for(var o=!1,f=0,a=t[h].length;f<a;f++){for(var c=0,l=t[h][f].length;c<l;c++)if(t[h][f][c].type===n[s]){o=!0;break}if(o)break}o&&r.push(t[h])}if(0<r.length){i=s;break}}for(s=0,
u=r.length;s<u;s++)for(h=0,e=r[s].length;h<e;h++)!function(t,n,i){for(var r,s=i.length-1;s>=0;s--){var u=n.indexOf(i[s].type);if(u!==t)i.splice(s,1)}}(i,n,r[s][h]);return r}function Un(t){var n=t[0]&&0<t[0].length,i=t[1]&&0<t[1].length,r=t[2]&&0<t[2].length,s=[];return n&&s.push(Math.abs(t[0][0].offsetToTarget)),i&&s.push(Math.abs(t[1][0].offsetToTarget)),r&&s.push(Math.abs(t[2][0].offsetToTarget)),s=Math.min.apply(null,s),n=!(!n||0!==St.MathUtil.doubleCompare(Math.abs(t[0][0].offsetToTarget),s)),i=!(!i||0!==St.MathUtil.doubleCompare(Math.abs(t[1][0].offsetToTarget),s)),s=!(!r||0!==St.MathUtil.doubleCompare(Math.abs(t[2][0].offsetToTarget),s)),n&&i&&s?function(t,n,i){for(var r=[],s=t.length,u=0;u<s;u++)Xn(t[u].target,n)&&Xn(t[u].target,i)&&r.push(t[u].target);for(var u=0,h=r.length;u<h;u++)$n(r[u],n);var e=[];return e[0]=0!==t.length,e[1]=0!==n.length,e[2]=0!==i.length,e}(t[0],t[1],t[2]):[n,i,s]}function Gn(t){for(var n=0,i=t.length;n<i;n++)for(var r=0,s=t[n].length;r<s;r++){for(
var u=[],h=0,e=t[n][r].length;h<e;h++)u.push(Math.abs(t[n][r][h].offsetToTarget));!function(t,n){for(var i=n.length-1;0<=i;i--)0<St.MathUtil.doubleCompare(Math.abs(n[i].offsetToTarget),t)&&n.splice(i,1)}(o=Math.min.apply(null,u),t[n][r])}for(n=0,i=t.length;n<i;n++){for(var o,u=[],r=0,s=t[n].length;r<s;r++)t[n][r][0]&&u.push(Math.abs(t[n][r][0].offsetToTarget));!function(t,n){for(var i=n.length-1;0<=i;i--)n[i][0]&&0<St.MathUtil.doubleCompare(Math.abs(n[i][0].offsetToTarget),t)&&n.splice(i,1)}(o=Math.min.apply(null,u),t[n])}for(u=[],n=0,i=t.length;n<i;n++)t[n][0][0]&&u.push(Math.abs(t[n][0][0].offsetToTarget)),o=Math.min.apply(null,u);return function(t,n){for(var i=n.length-1;0<=i;i--)n[i][0][0]&&0<St.MathUtil.doubleCompare(Math.abs(n[i][0][0].offsetToTarget),t)&&n.splice(i,1)}(o,t),t}var Xn=function(t,n){for(var i=0,r=n.length;i<r;i++)if(n[i].target===t)return!0;return!1},$n=function(t,n){for(var i=n.length-1;0<=i;i--)n[i].target===t&&n.splice(i,1)}
;zn.prototype.setObjectsAlignPoints=function(t){for(var n=0,i=t.length;n<i;n++)t[n].AC||(t[n].AC=t[n].RC(),this.KE.push(t[n]))},zn.prototype.clearAlignPoints=function(){for(var t=this.KE,n=0,i=t.length;n<i;n++)t[n].AC&&delete t[n].AC;this.KE=[]},zn.prototype.getAllAlignPoints=function(t){var n=t.AC||t.RC();if(0<=this.getAlignableTypes().indexOf("Port")&&t.getPorts)for(var i=t.getPorts(),r=0,s=i.length;r<s;r++)var u=i[r].AC||i[r].RC(),n=n.concat(u);return n},zn.prototype.PC=function(t,n,i,r,s,u,h){if(!h&&this.isExceedingMaxCount(u))return!0;if((n&&t instanceof _t.Node||i&&t instanceof _t.Port||r&&t instanceof _t.Connection||s&&t instanceof _t.Annotation)&&u.indexOf(t)<0&&u.push(t),i&&t.getPorts)for(var e=t.getPorts(),o=0,f=e.length;o<f;o++)if(u.indexOf(e[o])<0){if(!h&&this.isExceedingMaxCount(u))return!0;u.push(e[o])}return!(h||!this.isExceedingMaxCount(u))||(s&&t.getLabel&&((t=t.getLabel())&&u.indexOf(t)<0&&u.push(t)),!1)},zn.prototype.HC=function(t,n){var i=[],r=t.length;if(0<r)for(
var s=n||this.getAlignPriority(),u=!1,h=0,e=s.length;h<e;h++){var o=s[h],f=this.tC[o];if(f){for(var a=0;a<r;a++)if(t[a]instanceof f.source&&i.indexOf(t[a])<0){if(this.isExceedingMaxCount(i)){u=!0;break}i.push(t[a])}if(u)break}}return i},zn.prototype.LC=function(t,n){var i=[],r=t.length;if(0<r)for(var s=n||this.getAlignPriority(),u=0,h=s.length;u<h;u++){var e=s[u],o=this.tC[e];if(o)for(var f=0;f<r;f++)t[f]instanceof o.target&&i.indexOf(t[f])<0&&i.push(t[f])}return i},zn.prototype.IC=function(t){var n=this.alignmentMasters;if(n&&0<n.length)return n;var i=[],r=this.alignmentSourceTypes;if(r&&0<r.length){for(var s=0<=r.indexOf("Node"),u=0<=r.indexOf("Port"),h=0<=r.indexOf("Connection"),e=0<=r.indexOf("Annotation"),o=0,f=t.length;o<f;o++){if(this.PC(t[o],s,u,h,e,i,!0))break;for(var a=[],c=0,l=(a=t[o].getAllMembers?t[o].getAllMembers():a).length;c<l&&!this.PC(a[c],s,u,h,e,i,!0);c++);}return i}var v=[],n=this.dataModelMgr.moveConstraint.getFocusElement(t);if(n&&this.isObjectAlignable(n)){
v.push(n);r=this.getAlignableTypes();if(n.getPorts&&0<=r.indexOf("Port"))for(var w=n.getPorts(),o=0,f=w.length;o<f;o++)v.push(w[o])}return v},zn.prototype.FC=function(t,n,i){var r=this.alignmentMasters,s=void 0;if(r&&0<r.length){var u=r.length,h=this.alignmentTargets;if(h&&0<h.length){for(var s=[],e=0;e<u;e++)if(r[e]===t){if(!h[e])return this.TC(n,i);-1<n.indexOf(h[e])&&s.push(h[e])}return s}}return s},zn.prototype.VC=function(t,n,i){for(var r=t.RC(),s=0,u=r.length;s<u;s++)r[s].y+=i;var h,e,o,f=[];0<r.length&&(h=Yn(r),e=this.getAlignTolerance(),o=this.dataModelMgr.getViewport(),h.x=o.x,h.y-=e,h.width=o.width,h.height+=2*e,f=this.dataModelMgr.getElementsInsideAndIntersectRect(h,!0));t=this.FC(t,f,n);return t||this.TC(f,n)},zn.prototype.jC=function(t,n,i){for(var r=t.RC(),s=0,u=r.length;s<u;s++)r[s].x+=i;var h,e,o,f=[];0<r.length&&(h=Yn(r),e=this.getAlignTolerance(),o=this.dataModelMgr.getViewport(),h.x-=e,h.y=o.y,h.width+=2*e,h.height=o.height,
f=this.dataModelMgr.getElementsInsideAndIntersectRect(h,!0));t=this.FC(t,f,n);return t||this.TC(f,n)};function qn(t,n,i,r,s,u,h){i=function(t,n,i,r){St.AlignResultType.NONE;return t===St.AlignmentType.PortToPort?St.AlignResultType.PortConnectingPoint:t===St.AlignmentType.PortToSegmentEndPoint?St.AlignResultType.PortToSegmentEndPoint:t===St.AlignmentType.PortToConnectionEndPoint?St.AlignResultType.PortToConnectionEndPoint:t===St.AlignmentType.ConnectionEndPointToPort?St.AlignResultType.ConnectionEndPointToPort:{H:[[St.AlignResultType.TopToTop,St.AlignResultType.NONE,St.AlignResultType.TopToBottom],[St.AlignResultType.NONE,St.AlignResultType.HorizontalCenterLine,St.AlignResultType.NONE],[St.AlignResultType.BottomToTop,St.AlignResultType.NONE,St.AlignResultType.BottomToBottom]],V:[[St.AlignResultType.LeftToLeft,St.AlignResultType.NONE,St.AlignResultType.LeftToRight],[St.AlignResultType.NONE,St.AlignResultType.VerticalCenterLine,St.AlignResultType.NONE],[St.AlignResultType.RightToLeft,
St.AlignResultType.NONE,St.AlignResultType.RightToRight]]}[n][i][r]}(s,u,i,r),0<=(r=function(t,n){for(var i=0,r=n.length;i<r;i++)if(n[i].source===t)return i;return-1}(t,h))?h[r].targetsData.push({targetElement:n,type:i}):h.push({source:t,targetsData:[{targetElement:n,type:i}]})}zn.prototype.WC=function(t,n){var i=t.length;if(0<i){for(var r=[],s=[],u=0;u<i;u++)for(var h=t[u],e=Un(h),o=0,f=e.length;o<f;o++)if(e[o]){for(var a=h[o],c=a[0].offsetToTarget,l=a[0].targetLoc.y,v=a[0].sourceLoc.x,w=a[0].sourceLoc.x,d=0,m=a.length;d<m;d++)if(qn(a[d].source,a[d].target,o,a[d].targetAlignSide,a[d].type,"H",s),St.MathUtil.doubleCompare(a[d].targetLoc.x,v)<0&&(v=a[d].targetLoc.x),0<St.MathUtil.doubleCompare(a[d].targetLoc.x,w)&&(w=a[d].targetLoc.x),a[d].type!==St.AlignmentType.PortToConnectionProjected){for(var g=a[d].target.AC||a[d].target.RC(),M=a[d].source.RC(n),p=g.length,b=M.length,k=0;k<p;k++)St.MathUtil.doubleCompare(g[k].x,v)<0&&(v=g[k].x),0<St.MathUtil.doubleCompare(g[k].x,w)&&(w=g[k].x)
;for(k=0;k<b;k++)St.MathUtil.doubleCompare(M[k].x,v)<0&&(v=M[k].x),0<St.MathUtil.doubleCompare(M[k].x,w)&&(w=M[k].x)}r.push(new St.Line(new St.Point(v,l),new St.Point(w,l)))}!function(t){for(var n=0,i=t.length;n<i;n++){for(var r=t[n],s=r.start.y,u=[r.start.x],h=[r.end.x],e=i-1;n<e;e--)0===St.MathUtil.doubleCompare(s,t[e].start.y)&&(u.push(t[e].start.x),h.push(t[e].end.x),t.splice(e,1),i--);r.start.x=Math.min.apply(null,u),r.end.x=Math.max.apply(null,h)}}(r),this.setAlignX(!0,c,r,s)}},zn.prototype.zC=function(t,n){var i=t.length;if(0<i){for(var r=[],s=[],u=0;u<i;u++)for(var h=t[u],e=Un(h),o=0,f=e.length;o<f;o++)if(e[o]){for(var a=h[o],c=a[0].offsetToTarget,l=a[0].targetLoc.x,v=a[0].sourceLoc.y,w=a[0].sourceLoc.y,d=0,m=a.length;d<m;d++)if(qn(a[d].source,a[d].target,o,a[d].targetAlignSide,a[d].type,"V",s),St.MathUtil.doubleCompare(a[d].targetLoc.y,v)<0&&(v=a[d].targetLoc.y),0<St.MathUtil.doubleCompare(a[d].targetLoc.y,w)&&(w=a[d].targetLoc.y),
a[d].type!==St.AlignmentType.PortToConnectionProjected){for(var g=a[d].target.AC||a[d].target.RC(),M=a[d].source.RC(n),p=g.length,b=M.length,k=0;k<p;k++)St.MathUtil.doubleCompare(g[k].y,v)<0&&(v=g[k].y),0<St.MathUtil.doubleCompare(g[k].y,w)&&(w=g[k].y);for(k=0;k<b;k++)St.MathUtil.doubleCompare(M[k].y,v)<0&&(v=M[k].y),0<St.MathUtil.doubleCompare(M[k].y,w)&&(w=M[k].y)}r.push(new St.Line(new St.Point(l,v),new St.Point(l,w)))}!function(t){for(var n=0,i=t.length;n<i;n++){for(var r=t[n],s=r.start.x,u=[r.start.y],h=[r.end.y],e=i-1;n<e;e--)0===St.MathUtil.doubleCompare(s,t[e].start.x)&&(u.push(t[e].start.y),h.push(t[e].end.y),t.splice(e,1),i--);r.start.y=Math.min.apply(null,u),r.end.y=Math.max.apply(null,h)}}(r),this.setAlignY(!0,c,r,s)}},zn.prototype.YC=function(){return this.dataModelMgr.getSheetConfigurationData().separateGridSnapAndAlignment};function Kn(t){for(var n=[_t.Node,_t.Annotation,_t.Connection,_t.Port],i=0,r=n.length;i<r;i++)if(t instanceof n[i])return i;return 0}
zn.prototype.BC=function(t,n,i,r,s){this.setObjectsAlignPoints(n);for(var u=t.ZC(n,i,r,this.getAlignTolerance(),s||this.getAlignPriority()),h=0,e=u.length;h<e;h++)for(var o=0,f=u[h].length;o<f;o++)for(var a=0,c=u[h][o].length;a<c;a++)u[h][o][a].type||(u[h][o][a].type=function(t,n){t=Kn(t),n=Kn(n);return[[St.AlignmentType.NodeToNode,St.AlignmentType.NodeToAnnotation,St.AlignmentType.NodeToConnection,St.AlignmentType.NONE],[St.AlignmentType.AnnotationToNode,St.AlignmentType.AnnotationToAnnotation,St.AlignmentType.AnnotationToConnection,St.AlignmentType.NONE],[St.AlignmentType.ConnectionToNode,St.AlignmentType.ConnectionToAnnotation,St.AlignmentType.ConnectionToConnection,St.AlignmentType.NONE],[St.AlignmentType.NONE,St.AlignmentType.NONE,St.AlignmentType.NONE,St.AlignmentType.PortToPort]][t][n]}(u[h][o][a].source,u[h][o][a].target));return u},zn.prototype.UC=function(t,n){var i=this.YC(),n=Zn(t,i?this.getAlignPriority():n);return Gn(n)},zn.prototype.doAlignX=function(t,n,i){
this.resetAlignX();for(var r=[],s=this.IC(t),u=0,h=(s=this.HC(s,i)).length;u<h;u++)var e=s[u],o=this.VC(e,t,n.y),o=this.LC(o,i),o=this.BC(e,o,n,1,i),r=r.concat(o);var f=this.UC(r,i);return this.WC(f,n),this.alignX.isAligned},zn.prototype.doAlignY=function(t,n,i){this.resetAlignY();for(var r=[],s=this.IC(t),u=0,h=(s=this.HC(s,i)).length;u<h;u++)var e=s[u],o=this.jC(e,t,n.x),o=this.LC(o,i),o=this.BC(e,o,n,0,i),r=r.concat(o);var f=this.UC(r,i);return this.zC(f,n),this.alignY.isAligned},zn.prototype.doAlign=function(t,n,i){var r=this.doAlignX(t,n,i),i=this.doAlignY(t,n,i);return r||i},zn.prototype.doAlignX2=function(t,n,i){this.resetAlignX();for(var r=[],s=this.IC(t),u=0,h=(s=this.HC(s,i)).length;u<h;u++){var e=s[u],o=e.tk(t),f={x:n.x,y:n.y};o.isLockX&&(f.x=0),o.isLockY&&(f.y=0);o=this.VC(e,t,f.y),o=this.LC(o,i),f=this.BC(e,o,f,1,i),r=r.concat(f)}var a=this.UC(r,i);this.WC(a,n);for(t=[],u=0;u<this.alignX.alignmentData.length;u++)t.indexOf(this.alignX.alignmentData[u].source)<0&&t.push(
this.alignX.alignmentData[u].source);return{alignX:this.alignX.isAligned,elements:t}},zn.prototype.doAlignY2=function(t,n,i){this.resetAlignY();for(var r=[],s=this.IC(t),u=0,h=(s=this.HC(s,i)).length;u<h;u++){var e=s[u],o=e.tk(t),f={x:n.x,y:n.y};o.isLockX&&(f.x=0),o.isLockY&&(f.y=0);o=this.jC(e,t,f.x),o=this.LC(o,i),f=this.BC(e,o,f,0,i),r=r.concat(f)}var a=this.UC(r,i);this.zC(a,n);for(t=[],u=0;u<this.alignY.alignmentData.length;u++)t.indexOf(this.alignY.alignmentData[u].source)<0&&t.push(this.alignY.alignmentData[u].source);return{alignY:this.alignY.isAligned,elements:t}},zn.prototype.doAlign2=function(t,n,i){var r=this.doAlignX2(t,n,i),s=r.alignX,n=this.doAlignY2(t,n,i),i=n.alignY;return{alignResult:s||i,elementsX:r.elements,elementsY:n.elements}},zn.prototype.rectifyGuideLinesX=function(t,n,i){if(this.QE===i){for(var r=[],s=this.IC(t),u=0,h=s.length;u<h;u++)r=r.concat(this.getAllAlignPoints(s[u]));for(var e=this.alignX.guideLines,u=(h=e.length)-1;0<=u;u--){for(var o=!1,f=0,
a=r.length;f<a;f++)if(0===St.MathUtil.doubleCompare(e[u].start.y,r[f].y+i)){o=!0;break}o||(e.splice(u,1),this.alignX.targets=[])}}else this.doAlignX(t,new St.Point(n,i),this.getAlignPriority()),0!=St.MathUtil.doubleCompare(this.alignX.offset,0)&&(this.alignX.guideLines=[],this.alignX.alignmentData=[])},zn.prototype.rectifyGuideLinesY=function(t,n,i){if(this.JE===n){for(var r=[],s=this.IC(t),u=0,h=s.length;u<h;u++)r=r.concat(this.getAllAlignPoints(s[u]));for(var e=this.alignY.guideLines,u=(h=e.length)-1;0<=u;u--){for(var o=!1,f=0,a=r.length;f<a;f++)if(0===St.MathUtil.doubleCompare(e[u].start.x,r[f].x+n)){o=!0;break}o||(e.splice(u,1),this.alignY.targets=[])}}else this.doAlignY(t,new St.Point(n,i),this.getAlignPriority()),0!=St.MathUtil.doubleCompare(this.alignY.offset,0)&&(this.alignY.guideLines=[],this.alignY.alignmentData=[])},zn.prototype.rectifyGuideLines=function(t,n,i){this.rectifyGuideLinesX(t,n,i),this.rectifyGuideLinesY(t,n,i)},zn.prototype.rectifyGuideLinesX2=function(t,n,i,r){
if(this.QE===i){for(var s=[],u=this.alignX.alignmentData,h=0,e=u.length;h<e;h++){for(var o=u[h].source,f=this.getAllAlignPoints(o),a=0;a<f.length;a++)f[a].GC=o;s=s.concat(f);for(var c=u[h].targetsData,a=0,l=c.length;a<l;a++)var v=c[a].targetElement,f=this.getAllAlignPoints(v),s=s.concat(f)}for(var w=this.alignX.guideLines,d=w.length-1;0<=d;d--){for(var m=!1,g=[w[d].start.x,w[d].end.x],a=0,M=s.length;a<M;a++){var p=i,b=n,k=s[a].GC;k?((k=k.tk(t)).isLockY&&(p=0),k.isLockX&&(b=0)):b=p=0,0===St.MathUtil.doubleCompare(w[d].start.y,s[a].y+p)&&(m=!0,g.push(s[a].x+b))}m?(w[d].end.x=Math.max.apply(null,g),w[d].start.x=Math.min.apply(null,g)):(w.splice(d,1),this.alignX.targets=[])}}else this.doAlignX2(t,new St.Point(r.x,r.y),this.getAlignPriority()),0!=St.MathUtil.doubleCompare(this.alignX.offset,0)&&(this.alignX.guideLines=[],this.alignX.alignmentData=[])},zn.prototype.rectifyGuideLinesY2=function(t,n,i,r){if(this.JE===n){for(var s=[],u=this.alignY.alignmentData,h=0,e=u.length;h<e;h++){for(
var o=u[h].source,f=this.getAllAlignPoints(o),a=0;a<f.length;a++)f[a].GC=o;s=s.concat(f);for(var c=u[h].targetsData,a=0,l=c.length;a<l;a++)var v=c[a].targetElement,f=this.getAllAlignPoints(v),s=s.concat(f)}for(var w=this.alignY.guideLines,d=w.length-1;0<=d;d--){for(var m=!1,g=[w[d].start.y,w[d].end.y],a=0,M=s.length;a<M;a++){var p=n,b=i,k=s[a].GC;k?((k=k.tk(t)).isLockX&&(p=0),k.isLockY&&(b=0)):b=p=0,0===St.MathUtil.doubleCompare(w[d].start.x,s[a].x+p)&&(m=!0,g.push(s[a].y+b))}m?(w[d].end.y=Math.max.apply(null,g),w[d].start.y=Math.min.apply(null,g)):(w.splice(d,1),this.alignY.targets=[])}}else this.doAlignY2(t,new St.Point(r.x,r.y),this.getAlignPriority()),0!=St.MathUtil.doubleCompare(this.alignY.offset,0)&&(this.alignY.guideLines=[],this.alignY.alignmentData=[])},zn.prototype.rectifyGuideLines2=function(t,n,i,r){this.rectifyGuideLinesX2(t,n,i,r),this.rectifyGuideLinesY2(t,n,i,r)},zn.prototype.generateAlignmentData=function(){for(var t=[],n=[],i=[],r=this.alignX.alignmentData,
s=this.alignY.alignmentData,u=0,h=r.length;u<h;u++)for(var e=r[u].source,o=0,f=(a=r[u].targetsData).length;o<f;o++)t.push(e),n.push(a[o].targetElement),i.push(a[o].type);for(u=0,h=s.length;u<h;u++)for(var a,e=s[u].source,o=0,f=(a=s[u].targetsData).length;o<f;o++)t.push(e),n.push(a[o].targetElement),i.push(a[o].type);return{alignmentSources:t,alignmentTargets:n,alignmentTypes:i}};zn.prototype.alignObjects=function(t,n){for(var i=[],r=0,s=t.length;r<s;r++)this.isObjectAlignable(t[r])&&i.push(t[r]);if(!(i.length<=1))for(var u=function(t){if(0<t.length){var n=t[0].getTransformedBBox(),i=1;for(t.length;i<t.length;++i){var r=t[i].getTransformedBBox();n.union(r)}}return n}(i),h=0,e=0,o=0,r=0,s=i.length;r<s;++r){var f=i[r],a=f.getTransformedBBox(),c=!0;n===St.ManualAlignmentSide.LEFT?(h=u.x,e=a.x,o=h):n===St.ManualAlignmentSide.CENTER?(h=u.getCenterX(),e=a.getCenterX(),o=h-a.width/2):n===St.ManualAlignmentSide.RIGHT?(h=u.x+u.width,e=a.x+a.width,o=h-a.width):n===St.ManualAlignmentSide.TOP?(
h=u.y,e=a.y,o=h,c=!1):n===St.ManualAlignmentSide.MIDDLE?(h=u.getCenterY(),e=a.getCenterY(),o=h-a.height/2,c=!1):n===St.ManualAlignmentSide.BOTTOM&&(h=u.y+u.height,e=a.y+a.height,o=h-a.height,c=!1),0!==St.MathUtil.doubleCompare(h,e)&&(a=f.tk(),c&&!1===a.isLockX?f.setRenderingPosition&&f.setRenderingPosition(o,void 0):c||!1!==a.isLockY||f.setRenderingPosition&&f.setRenderingPosition(void 0,o))}},zn.prototype.multipleObjectsAlignment=function(t,n,i){for(var r=this.dataModelMgr.getSheetSession().CM(),s=t,n=n,u=[],h=s.length,e=[],o=[],f=0;f<h;f++)this.dataModelMgr.isReferencedLocationInArray(s[f],s)||u.push(s[f]);if(1<(h=(u=this.XC(u)).length)){for(var a=u[0].getTransformedBBox(),f=1;f<h;f++){var c=u[f].getTransformedBBox();a.union(c)}switch(r.beginTransaction(Dt.messages.ModelChangeMessage),n){case St.ManualAlignmentSide.LEFT:if(i){for(var l=u[0].getAnchorPosition().x,v=0,w=0;w<h;w++)(b=u[w].getAnchorPosition().x)<l&&(v=w,l=b);i===St.MultipleObjectAlignmentType.AnchorAlt&&(v=Jn(!0,l,u)),
ti(u,i,v,o,e)}else for(var d=a.x,m={dx:0,dy:0},f=0;f<h;f++){var g=u[f].tk();c=u[f].getTransformedBBox(),m.dx=g.isLockX?0:d-c.x,(m.dy=0)!==(H=ii(void 0,u[f],m)).dx||0!==H.dy?(u[f].move(H.dx,H.dy),o.push(u[f]),e.push(new St.Matrix(1,0,0,1,H.dx,H.dy))):(o.unshift(u[f]),e.unshift(new St.Matrix(1,0,0,1,H.dx,H.dy)))}break;case St.ManualAlignmentSide.TOP:if(i){for(var M=u[0].getAnchorPosition().y,v=0,w=0;w<h;w++)(y=u[w].getAnchorPosition().y)<M&&(v=w,M=y);i===St.MultipleObjectAlignmentType.AnchorAlt&&(v=Jn(!1,M,u)),ni(u,i,v,o,e)}else for(var p=a.y,m={dx:0,dy:0},f=0;f<h;f++){g=u[f].tk();c=u[f].getTransformedBBox(),m.dx=0,m.dy=g.isLockY?0:p-c.y,0!==(H=ii(void 0,u[f],m)).dx||0!==H.dy?(u[f].move(H.dx,H.dy),o.push(u[f]),e.push(new St.Matrix(1,0,0,1,H.dx,H.dy))):(o.unshift(u[f]),e.unshift(new St.Matrix(1,0,0,1,H.dx,H.dy)))}break;case St.ManualAlignmentSide.RIGHT:if(i){for(var b,l=u[0].getAnchorPosition().x,v=0,w=0;w<h;w++)l<(b=u[w].getAnchorPosition().x)&&(v=w,l=b)
;i===St.MultipleObjectAlignmentType.AnchorAlt&&(v=Jn(!0,l,u)),ti(u,i,v,o,e)}else for(var k=a.x+a.width,m={dx:0,dy:0},f=0;f<h;f++){g=u[f].tk();c=u[f].getTransformedBBox(),m.dx=g.isLockX?0:k-(c.x+c.width),(m.dy=0)!==(H=ii(void 0,u[f],m)).dx||0!==H.dy?(u[f].move(H.dx,H.dy),o.push(u[f]),e.push(new St.Matrix(1,0,0,1,H.dx,H.dy))):(o.unshift(u[f]),e.unshift(new St.Matrix(1,0,0,1,H.dx,H.dy)))}break;case St.ManualAlignmentSide.BOTTOM:if(i){for(var y,M=u[0].getAnchorPosition().y,v=0,w=0;w<h;w++)M<(y=u[w].getAnchorPosition().y)&&(v=w,M=y);i===St.MultipleObjectAlignmentType.AnchorAlt&&(v=Jn(!1,M,u)),ni(u,i,v,o,e)}else for(var x=a.y+a.height,m={dx:0,dy:0},f=0;f<h;f++){g=u[f].tk();c=u[f].getTransformedBBox(),m.dx=0,m.dy=g.isLockY?0:x-(c.y+c.height),0!==(H=ii(void 0,u[f],m)).dx||0!==H.dy?(u[f].move(H.dx,H.dy),o.push(u[f]),e.push(new St.Matrix(1,0,0,1,H.dx,H.dy))):(o.unshift(u[f]),e.unshift(new St.Matrix(1,0,0,1,H.dx,H.dy)))}break;case St.ManualAlignmentSide.MIDDLE:if(i){for(var E=a.y+a.height/2,C=[],
v=0;v<h;v++)_=u[v].getAnchorPosition().y,S=Math.abs(E-_),C.push(S);for(var N=0,O=C[0],f=1;f<h;f++)C[f]<O&&(O=C[f],N=f);for(var D=(A=u[N]).getAnchorPosition(),m={dx:0,dy:0},w=0;w<h;w++){g=(R=u[w]).tk();P=R.getAnchorPosition(),m.dx=0,m.dy=g.isLockY?0:D.y-P.y,0===(H=ii(A,u[w],m)).dx&&0===H.dy||u[w].move(H.dx,H.dy),w!=N?(o.push(u[w]),e.push(new St.Matrix(1,0,0,1,H.dx,H.dy))):(o.unshift(u[w]),e.unshift(new St.Matrix(1,0,0,1,H.dx,H.dy)))}}else for(var E=a.y+a.height/2,m={dx:0,dy:0},f=0;f<h;f++){var g=u[f].tk();c=u[f].getTransformedBBox(),m.dx=0,m.dy=g.isLockY?0:E-(c.y+c.height/2),0!==(H=ii(void 0,u[f],m)).dx||0!==H.dy?(u[f].move(H.dx,H.dy),o.push(u[f]),e.push(new St.Matrix(1,0,0,1,H.dx,H.dy))):(o.unshift(u[f]),e.unshift(new St.Matrix(1,0,0,1,H.dx,H.dy)))}break;case St.ManualAlignmentSide.CENTER:if(i){for(var _,S,T=a.x+a.width/2,C=[],v=0;v<h;v++)_=u[v].getAnchorPosition().x,S=Math.abs(T-_),C.push(S);for(N=0,O=C[0],f=1;f<h;f++)C[f]<O&&(O=C[f],N=f);for(var A,R,P,D=(A=u[N]).getAnchorPosition(),
m={dx:0,dy:0},w=0;w<h;w++){g=(R=u[w]).tk();P=R.getAnchorPosition(),m.dx=g.isLockX?0:D.x-P.x,(m.dy=0)===(H=ii(A,u[w],m)).dx&&0===H.dy||u[w].move(H.dx,H.dy),w!=N?(o.push(u[w]),e.push(new St.Matrix(1,0,0,1,H.dx,H.dy))):(o.unshift(u[w]),e.unshift(new St.Matrix(1,0,0,1,H.dx,H.dy)))}}else for(var H,T=a.x+a.width/2,m={dx:0,dy:0},f=0;f<h;f++){g=u[f].tk();c=u[f].getTransformedBBox(),m.dx=g.isLockX?0:T-(c.x+c.width/2),(m.dy=0)!==(H=ii(void 0,u[f],m)).dx||0!==H.dy?(u[f].move(H.dx,H.dy),o.push(u[f]),e.push(new St.Matrix(1,0,0,1,H.dx,H.dy))):(o.unshift(u[f]),e.unshift(new St.Matrix(1,0,0,1,H.dx,H.dy)))}}Qn(r,o,e),r.endTransaction()}},zn.prototype.XC=function(t){for(var n=t.length,i=[],r=[],s=[],u=0;u<n;u++)t[u]instanceof _t.Port&&s.push(u);var h=s.length,e=!1;if(0<h)if(0<n-h)for(var o=h-1;0<=o;o--)for(var f=0;f<n;f++)f===s[o]&&t.splice(s[o],1);else{for(var a,e=!0,c=this.dataModelMgr.getSheetConfigurationData().alignmentPriority,l=0;l<c.length;l++)if(c[l]===St.AlignmentType.PortToPort){a=!0;break}
if(!a)return[]}if(n=t.length,!e){for(u=0;u<n;u++)t[u]instanceof _t.Node&&i.push(u),t[u]instanceof _t.Connection&&r.push(u);var e=r.length,v=i.length;if(0<e){for(var w,d,m=[],o=e-1;0<=o;o--){if(w=t[r[o]].getStart(),d=t[r[o]].getEnd(),w)for(var g=w.getOwner(),M=0;M<v;M++)if(g===t[i[M]]){m.push(r[o]);break}if(d)for(var p=d.getOwner(),M=0;M<v;M++)if(p===t[i[M]]){m.push(r[o]);break}}m.sort();for(var b,k=(m=m.filter(function(t,n){return m.indexOf(t)===n})).length,y=n-1;0<=y;y--)for(M=k;0<=M;M--)b=t[m[M]],t[y]===b&&t.splice(y,1)}}return t};var Jn=function(t,n,i){for(var r,s=i.length,u=[],h=0;h<s;h++)(r=t?i[h].getAnchorPosition().x:i[h].getAnchorPosition().y)===n&&u.push(h);for(var e=t?i[u[0]].getAnchorPosition().y:i[u[0]].getAnchorPosition().x,o=u[0],h=0;h<u.length;h++)(r=t?i[u[h]].getAnchorPosition().y:i[u[h]].getAnchorPosition().x)<e&&(o=u[h],e=r);return o},Qn=function(t,n,i){i=new At.TransformEndEventArgs(n,i);i.setQuickAlignElements(n);i=new Dt.messages.EventMessage(i,
At.EventType.OnTransformEnd);t.BM(i)},ti=function(t,n,i,r,s){for(var u,h,e,o=t.length,f=t[i].getAnchorPosition().x,a=t[i].getAnchorPosition().y,c=0;c<o;c++)c!==i?(u=(e=t[c]).tk(),h=e.getAnchorPosition(),e={dx:0,dy:0},n===St.MultipleObjectAlignmentType.Anchor?(e.dx=u.isLockX?0:f-h.x,e.dy=0):(e.dx=0,e.dy=u.isLockY?0:a-h.y),0===(e=ii(t[i],t[c],e)).dx&&0===e.dy||t[c].move(e.dx,e.dy),r.push(t[c]),s.push(new St.Matrix(1,0,0,1,e.dx,e.dy))):(r.unshift(t[i]),s.unshift(new St.Matrix(1,0,0,1,0,0)))},ni=function(t,n,i,r,s){for(var u,h,e,o=t.length,f=t[i].getAnchorPosition().x,a=t[i].getAnchorPosition().y,c=0;c<o;c++)c!==i?(u=(e=t[c]).tk(),h=e.getAnchorPosition(),e={dx:0,dy:0},n===St.MultipleObjectAlignmentType.Anchor?(e.dx=0,e.dy=u.isLockY?0:a-h.y):(e.dx=u.isLockX?0:f-h.x,e.dy=0),0===(e=ii(t[i],t[c],e)).dx&&0===e.dy||t[c].move(e.dx,e.dy),r.push(t[c]),s.push(new St.Matrix(1,0,0,1,e.dx,e.dy))):(r.unshift(t[i]),s.unshift(new St.Matrix(1,0,0,1,0,0)))},ii=function(t,n,i){var r,s={dx:0,dy:0}
;return s=n.isTranslateAllowed()?(r=n.getMoveStrategy())?n instanceof _t.Port?ri(n,i.dx,i.dy,r):r.getFinalTransformation(i.dx,i.dy):n instanceof _t.Connection&&(n.getStart()||n.getEnd())?{dx:0,dy:0}:i:s},ri=function(t,n,i,r){for(var s,u={dx:0,dy:0},h=t.getAnchorPosition(),e=t.getOwner(),t=e.getBBox().clone(),e=e.getEvaluatedTransform(1,1,new St.Point(t.x,t.y)),o=e.transformPoint(new St.Point(h.x-t.x,h.y-t.y)),t=e.transformRect(new St.Rect(0,0,t.width,t.height)),f=[new St.Line(new St.Point(t.x,t.y),new St.Point(t.x+t.width,t.y)),new St.Line(new St.Point(t.x+t.width,t.y),new St.Point(t.x+t.width,t.y+t.height)),new St.Line(new St.Point(t.x,t.y+t.height),new St.Point(t.x+t.width,t.y+t.height)),new St.Line(new St.Point(t.x,t.y),new St.Point(t.x,t.y+t.height))],a=0;a<4;a++)if(f[a].isPointOnLine(o)){s=f[a];break}t=new St.Point(o.x+n,o.y+i),t=new St.Line(o,t);return u=s.isParallelWithLine(t)?r.getFinalTransformation(n,i):u};function si(t,n,i){this.dataModelMgr=t,this.previewManager=n,
this.alignment=new zn(t),this.snap=new Pn(t),this.attachingUtil=new Vn(t,i),this.focusElement=null,this.disableMoveStrategy=!1,this.locationIndicatorLoc=null,this.transformMaster=null,this.attachmentSourceTypes=null,this.attachmentTargetTypes=null,this.attachmentMasters=null}function ui(v){var w=null,E=null,C=v.CM(),d=null,l=null,m=new Dt.messages.RedrawMessage(null),r=null,s=null,g=[],n=null,i=null,M=null,N=null;this.previewManager=new Ln(this);var u=null,p=null,b=null,h=null,e=null,k=null,y=null,x=null,O=null,o=null,D=new J;v.$C(D);var _=[],S=v.getSheetConfigurationData(),T=v.getViewConfig(),f=null;this.moveConstraint=null;var a=!1,A=null;C&&C.register(Dt.messages.ModelChangeMessage,this,function(t){t=t.qC();L(t)&&H(),I(t)});function R(t,n,i){var r,s=!1;return(t&&0<t.length||n&&0<n.length)&&(r=new tt(t,n,i.altKey,i.ctrlKey,i.shiftKey,i.cursorPos),i=new Dt.messages.EventMessage(r,At.EventType.OnSelectionChanging),C.BM(i)&&(r.isCancelled()?s=!0:(t=r.getAddedElements(),
n=r.getRemovedElements()))),{isRejected:s,addedElements:t,removedElements:n}}function P(t,n,i){(t&&0<t.length||n&&0<n.length)&&(i=new At.SelectionChangedEventArgs(t,n,i.altKey,i.ctrlKey,i.shiftKey,i.cursorPos),i=new Dt.messages.EventMessage(i,At.EventType.OnSelectionChanged),C.BM(i))}function c(t,n,i,r){var s,u,h;return t.getSymbol()instanceof _t.Arrow&&(s=(u=t.getLocation()).KC,u=u.JC,(0===St.MathUtil.doubleCompare(n.x,s)&&0===St.MathUtil.doubleCompare(n.y,u)||0===St.MathUtil.doubleCompare(i.x,s)&&0===St.MathUtil.doubleCompare(i.y,u))&&(h=t.getSymbol().getSvgContent(),(h=new un("<svg width='"+(t=t.QC.clone()).width+"' height='"+t.height+"'>"+h+"</svg>")).FM=t,h.setOwner(r))),h}var H=function(){C&&C.BM(m)},L=function(t){return t!==Dt.RenderUpdateFlags.None&&((m.renderData.updateFlags=t)&Dt.RenderUpdateFlags.Viewport&&(n=E.Ax(),m.renderData.dirtyRect=n.dirtyRect,m.renderData.viewport=n.viewport,m.renderData.lodType=n.newLodType,t=n.isFitAnimation,m.renderData.fitAnimation=t,(
m.renderData.isAnimation=t)&&n.needFireEvent&&E.Rx(n.eventData)),!0);var n},I=function(t){t&Dt.RenderUpdateFlags.Viewport&&(!(t=E.Ax()).isFitAnimation&&t.needFireEvent&&E.Tx(t.eventData),m.renderData.lodType=t.oldLodType,m.renderData.dirtyRect=null,m.renderData.fitAnimation=!1,m.renderData.isAnimation=!1)};this.getAnimation=function(){return f=f||new Dn(v,this)},this.Xk=function(t,n){C&&C.register(Dt.messages.ModelChangeMessage,t,n)},this.$k=function(t,n){C&&C.tN(Dt.messages.ModelChangeMessage,t,n)},this.getSheetConfigurationData=function(){return S},this.beginTransaction=function(){v.makeWorkSession(),C.beginTransaction(Dt.messages.ModelChangeMessage)},this.endTransaction=function(){C.endTransaction()},this.isDanglingConnectionAllowed=function(){return S.danglingConnectionAllowed},this.updateOverlay=function(){m.renderData.updateFlags=Dt.RenderUpdateFlags.Overlays,m.renderData.dirtyRect=null,H()},this.getRelatedConnectionsToMove=function(t,n){if((
t instanceof _t.Node&&t.isGroupingAllowed()||t instanceof _t.Node&&t.getIsContainer())&&t.nN()){for(var i=t.getConnectionsToChildren(),r=i.length,s=0;s<r;s++)n.push(i[s]);for(var u=t.getAllMembers(),r=u.length,s=0;s<r;s++){var h=u[s];h instanceof _t.Connection&&St.CommonUtil.pushItemIfNotExist(n,h)}}},this.highlightConnectionDuringBulkCreation=function(t,n){t instanceof _t.Connection&&t.setHighlightFlags(_t.HighlightFlags.EntireConnectionHover,n)},this.updateSheetFeatures=function(t){Dt.common.ExceptionHelper.throwIfInvalidArray(t);var n=t.length,i=!1;if(!(n<1)){for(var r=0;r<n;r++){var s=t[r];if(d.containsFeature(s)){i=!0;break}}i&&(m.renderData.updateFlags=Dt.RenderUpdateFlags.Features,H())}},this.isReferencedLocationInArray=function(t,n){if(!t.getLocation()||!t.getLocation().getReference())return!1;var i=t.getLocation().getReference();if(0<=n.indexOf(i))return!0;if(i instanceof _t.Connection){var r=i.getStart(),t=i.getEnd(),r=r?r.getOwner():null,t=t?t.getOwner():null;if(
r&&0<=n.indexOf(r))return!0;if(t&&0<=n.indexOf(t))return!0;if(r&&this.isReferencedLocationInArray(r,n))return!0;if(t&&this.isReferencedLocationInArray(t,n))return!0}return this.isReferencedLocationInArray(i,n)},this.initialize=function(t,n,i,r){d!=t&&(d&&d.remove(),d=t),t.attachSession(v);(w=new Sn(this,n,i)).createIndexTree(d.getDefaultSheetRect(),3,8),v.iN=w,D.sM=w;var s=d.getAllIndexedElements().allIndexedElements,u=v.getPerformanceCounter();u.preIndexing(),w.insert(s),u.postIndexing({Added:s.length,Updated:0,Removed:0}),(E=new An(v,d,0,w,C,m,_,S,T,n,i)).Sx(this);for(var h=S.viewData,e=!1,o=0,f=h.rN.length;o<f;o++)h.rN[o]instanceof An&&(h.rN[o]=E,e=!0);if(e||h.rN.push(E),this.updateSheetFeatures(t.getFeatures()),d.isAllowJumpers())for(var a=d.getVisibleElements(_t.Connection),c=a.length,l=1;l<c;l++)a[l].sN=null,a[l].kM();this.previewManager.canvas=r,E.initialize()},this.initializeMoveConstraint=function(t){this.moveConstraint=new si(this,this.previewManager,t)},
this.getViewportManager=function(){return E},this.getCommandManager=function(t){return null===l&&(l=new En(t,this),v.uN=l),l},this.hN=function(t){this.moveConstraint&&(this.moveConstraint.attachingUtil.canvas=t),this.moveConstraint&&(this.previewManager.canvas=t),l&&l.registerAll(t,this)},this.eN=function(t){if(t)for(var n=0,i=t.length;n<i;n++)this.getBaseDatasByType(t[n]).forEach(function(t){t.clear()});else this.getAllBaseObjectsByType("BaseData").forEach(function(t){t.clear()})},this.clear=function(){g=[],N=i=n=null,this.previewManager.clear(),O=x=y=k=b=p=u=null,M.currentSelected=null;new Dt.messages.RedrawMessage(null)},this.destroy=function(){d&&(this.deleteAll(d),d.remove()),v.iN=null,w&&(w.destroy(),w=null);var t=S.viewData,n=t.rN.indexOf(E);t.rN.splice(n,1),E.destroy(),this.moveConstraint.destroy(),this.clear()},this.getIndexManager=function(){return w},this.getSheet=function(){return d},this.getSheetSession=function(){return v},this.setSelectionStrategy=function(t){M=t},
this.getElementsByPoint2=function(t,h,e){function n(t){var n=!0;if(null!=h){var i=t.getElementType();if(Dt.common.ArrayHelper.isArrayType(h)){for(var r=!1,s=0,u=h.length;s<u;s++)if(i===h[s]){r=!0;break}n=r}else n=i===h}return n=n&&e?e():n}var i=[],r=S.selectionPreferencesData.getSelectionRadiusPixel();M&&(i=M.getObjectsByPoint(t,r,n));for(var s=v.fN().oN(),u={},o=0,f=s.length;o<f;o++){var a,c=s[o].aN;c&&!u[c.guid]&&((a=c.getObjectsByPoint(t,r,n))&&0<a.length&&(i=i.concat(a)),u[c.guid]=!0)}return i},this.getElementByPoint2=function(t,n,i){n=this.getElementsByPoint2(t,n,i);if(n){i=n.length;if(0<i)return n[i-1]}return null},this.getElementsByPoint=function(t){if(M){var n=S.selectionPreferencesData.getSelectionRadiusPixel(),i=S.contextData.getSheetFeatureEditMode();return M.getObjectsByPoint(t,n,function(t){return!t.isBackground()||i})}return null},this.getElementByPoint=function(t){var n=this.getElementsByPoint(t);if(n){t=n.length;if(0<t)return n[t-1]}return null};function F(t){for(
var n=[Nn,Zt,et,S.handleStyle.resizeHandler.shape,S.handleStyle.rotateHandler.shape,S.handleStyle.connectionEndHandler.shape,S.handleStyle.connectionBendingHandler.shape],i=0,r=n.length;i<r;i++)if(t.target instanceof n[i]){this.overlay=t.target;break}}this.getOverlayByPoint2=function(t,h){for(var n={},i=null,r=function(t){var n=!0;if(null!=h)if(t){var i=t.getElementType();if(Dt.common.ArrayHelper.isArrayType(h)){for(var r=!1,s=0,u=h.length;s<u;s++)if(i===h[s]){r=!0;break}n=r}else n=i===h}else n=!1;return n},s=S.selectionPreferencesData.getSelectionRadiusPixel(),u=v.fN().oN(),e={},o=u.length-1;0<=o;o--){var f=u[o].aN;if(f&&!e[f.guid]){if(f.getObjectByPoint(t,s,F.bind(n)),n.overlay)if(r(n.overlay.getOwner())){i=n.overlay;break}e[f.guid]=!0}}return!i&&M&&(M.getObjectByPoint(t,s,F.bind(n)),n.overlay&&r(n.overlay.getOwner())&&(i=n.overlay)),i},this.getOverlayByPoint=function(t){var n,i={};return M&&(n=S.selectionPreferencesData.getSelectionRadiusPixel(),M.getObjectByPoint(t,n,F.bind(i))),
i.overlay},this.getOverlayByTouch=function(t){var n=null;if(M){var i=S.touchSettings.selectionRadius,r=M.getObjectsByPoint(t,i,function(t){return!(!0===t.isBackground()||t.getCollapsedOwner&&t.getCollapsedOwner())}),s=r.length;if(0<s)for(var u=M.ensureContext(t,i),h=s-1;0<=h;h--){var e=r[h].cN(u);if(e){var o=e.getId();if(o>=Tt.NorthwestResize&&o<=Tt.WestResize||o===Tt.Rotate||o===Tt.ConnectionStartDrag||o===Tt.ConnectionEndDrag||o===Tt.ConnectionBendingDrag){n=e;break}}}}return n},this.getSymbolOccurrenceByPoint=function(t,n){var i,r,s=null;return M&&(i=S.selectionPreferencesData.getSelectionRadiusPixel(),n?((r=M.ensureContext(t,i)).parent=n,s=n.selectSymbolOccurrence(r)):M.getObjectByPoint(t,i,function(t){t.parent instanceof _t.SheetElement&&(t.parent.getCollapsedOwner&&t.parent.getCollapsedOwner()||(s=t.parent.selectSymbolOccurrence(t)))})),s},this.getElementsInsideRect=function(t){if(w){var e=w.eE(t);return St.CommonUtil.retrieveSheetElements(e,function(t){var n,i=z(t);if(i&&(n=!0,
t instanceof _t.Connection))for(var r=t.vM().indexedElements,s=r.length,u=0;u<s;u++){var h=r[u];if(e.indexOf(h)<0){n=!1;break}}return n&&!(t.getCollapsedOwner&&t.getCollapsedOwner())})}return null},this.getElementsInsideAndIntersectRect=function(t,n){if(w){t=w.Lx(t);return St.CommonUtil.retrieveSheetElements(t,function(t){return z(t)},n)}return null},this.getPeerElementsInsideAndIntersectRect=function(t,n,i){if(w){for(var t=w.Lx(t),r=[],s=St.CommonUtil.retrieveSheetElements(t,function(t){return t instanceof _t.Connection&&r.push(t),t instanceof _t.Node&&t.lN().owningElement===n&&-1===i.indexOf(t)}),u=0;u<r.length;u++){var h,e=r[u].getStart();e&&(h=e.getOwner()).lN().owningElement===n&&-1===s.indexOf(h)&&s.push(h);var o,e=r[u].getEnd();e&&(o=e.getOwner()).lN().owningElement===n&&-1===s.indexOf(o)&&s.push(o)}return s.sort(St.CommonUtil.compareElementsByZDepth),s}return null};function V(t,n){return t.getZDepth()-n.getZDepth()}function j(t){for(var n=t[0].lN().owningElement,
i=1;i<t.length;i++)if(t[i].lN().owningElement!==n)return;return 1}this.bringNodeFront=function(t){var n=t.bringFront();return{data:[{currentNode:t,previousNode:n.previousNode}],frontNode:n.frontNode,result:n.result}},this.bringNodesFront=function(t){var n={data:[],frontNode:null,result:St.ChangeRenderOrderResult.NoChange};if(!j(t))return n.result=St.ChangeRenderOrderResult.UnexpectedInput,n;t.sort(V);for(var i=t[0].getBBox().clone(),r=t[0].lN().owningElement,s=1;s<t.length;s++)i.union(t[s].getBBox());r=this.getPeerElementsInsideAndIntersectRect(i,r,t);if(0<r.length){var u=r[r.length-1],h=u.getZDepth();if(t[0].getZDepth()<h)for(var e=0;e<t.length;e++){var o={previousNode:null,currentNode:t[e]};t[e].setZDepth(++h),n.result=St.ChangeRenderOrderResult.Success,n.frontNode=t[t.length-1],o.previousNode=0===e?u:t[e-1],n.data.push(o)}else n.result=St.ChangeRenderOrderResult.NoChange,n.frontNode=t[t.length-1]}else n.result=St.ChangeRenderOrderResult.NoChange,n.frontNode=t[t.length-1];return n},
this.bringNodeForward=function(t){var n=t.bringForward();return{data:[{currentNode:t,previousNode:n.previousNode}],frontNode:n.frontNode,result:n.result}},this.bringNodesForward=function(t){var n={data:[],frontNode:null,result:St.ChangeRenderOrderResult.NoChange};if(!j(t))return n.result=St.ChangeRenderOrderResult.UnexpectedInput,n;t.sort(V);for(var i=t[0].lN().owningElement,r=t.length-1;0<=r;r--){var s={previousNode:null,currentNode:t[r]},u=t.concat();u.splice(r,1);var h=t[r].getBBox().clone(),e=this.getPeerElementsInsideAndIntersectRect(h,i,u);if(0<e.length){var h=e.indexOf(t[r]),o=e[h+1];if(o){u=o.getZDepth(),h=t[r].getZDepth();t[r].setZDepth(u),o.setZDepth(h),r===t.length-1&&(n.frontNode=o===e[e.length-1]?t[r]:e[e.length-1]),n.result=St.ChangeRenderOrderResult.Success;for(var f=0,a=n.data.length;f<a;f++)n.data[f].previousNode==o&&(n.data[f].previousNode=t[r]);s.previousNode=o}else r===t.length-1&&(n.frontNode=t[r])}else r===t.length-1&&(n.frontNode=t[r]);n.data.push(s)}return n},
this.sendNodeBack=function(t){var n=t.sendBack();return{data:[{currentNode:t,nextNode:n.nextNode}],backNode:n.backNode,result:n.result}},this.sendNodesBack=function(t){var n={data:[],backNode:null,result:St.ChangeRenderOrderResult.NoChange};if(!j(t))return n.result=St.ChangeRenderOrderResult.UnexpectedInput,n;t.sort(V);for(var i=t[0].lN().owningElement,r=t[0].getBBox().clone(),s=1;s<t.length;s++)r.union(t[s].getBBox());i=this.getPeerElementsInsideAndIntersectRect(r,i,t);if(0<i.length){var u=i[0],h=u.getZDepth();if(h<t[t.length-1].getZDepth()){for(var e=t.length-1;0<=e;e--){var o={nextNode:null,currentNode:t[e]};t[e].setZDepth(--h),o.nextNode=e===t.length-1?u:t[e+1],n.data.push(o)}n.result=St.ChangeRenderOrderResult.Success,n.backNode=t[0]}else n.result=St.ChangeRenderOrderResult.NoChange,n.backNode=t[0]}else n.result=St.ChangeRenderOrderResult.NoChange,n.backNode=t[0];return n},this.sendNodeBackward=function(t){var n=t.sendBackward();return{data:[{currentNode:t,nextNode:n.nextNode}],
backNode:n.backNode,result:n.result}},this.sendNodesBackward=function(t){var n={data:[],backNode:null,result:St.ChangeRenderOrderResult.NoChange};if(!j(t))return n.result=St.ChangeRenderOrderResult.UnexpectedInput,n;t.sort(V);for(var i=t[0].lN().owningElement,r=0;r<t.length;r++){var s={nextNode:null,currentNode:null},u=t.concat();u.splice(r,1);var h=t[r].getBBox().clone(),e=this.getPeerElementsInsideAndIntersectRect(h,i,u);if(0<e.length){var h=e.indexOf(t[r]),o=e[h-1];if(o){u=o.getZDepth(),h=t[r].getZDepth();t[r].setZDepth(u),o.setZDepth(h),0===r&&(n.backNode=o===e[0]?t[r]:e[0]),n.result=St.ChangeRenderOrderResult.Success,s.currentNode=t[r];for(var f=0,a=n.data.length;f<a;f++)n.data[f].nextNode==o&&(n.data[f].nextNode=t[r]);s.nextNode=o}else 0===r&&(n.backNode=t[r])}else n.backNode=t[r];n.data.push(s)}return n},this.setViewFeatures=function(t){_=t},this.getVisibleViewFeatures=function(){for(var t=[],n=_.length,i=0;i<n;++i)_[i].isVisible()&&t.push(_[i]);return t},
this.getViewFeatures=function(){return _},this.getVisibleSheetFeatures=function(){var t=[],n=d.getFeatures();if(null!==n&&0<n.length)for(var i=n.length,r=0;r<i;r++){var s=n[r];null!==s&&s.isVisible()&&t.push(s)}return t},this.setHoveredElements=function(t,n){C.beginTransaction(Dt.messages.ModelChangeMessage),d.setHoveredElements(t,n),C.endTransaction()},this.getHoveredElements=function(){return d.getHoveredElements()},this.fireHoverChangedEvent=function(t,n,i){i=new At.HoverChangedEventArgs(t,n,i),i=new Dt.messages.EventMessage(i,At.EventType.OnHoverChanged);C.BM(i)},this.setSelectedElements=function(t,n,i,r){var s=[],u=[],h=d.getSelectedElements();if(r=r||this.getCursorPosAndKeyStatus(),i||(f=new At.PreselectionFilterEventArgs(t,!1,r.altKey,r.ctrlKey,r.shiftKey,r.cursorPos),a=new Dt.messages.EventMessage(f,At.EventType.OnPreselectionFilter),C.BM(a)&&(t=f.isCancelled()?[]:f.getSheetElements())),t&&0<t.length){for(var e=0,o=t.length;e<o;++e)h.indexOf(t[e])<0&&s.push(t[e]);for(e=0,
o=h.length;e<o;++e)t.indexOf(h[e])<0&&u.push(h[e])}else u=h;var f,a=!1;i||(a=(f=R(s,u,r)).isRejected,s=f.addedElements,u=f.removedElements),a||(C.beginTransaction(Dt.messages.ModelChangeMessage),d.addToSelectedElements(s),d.removeFromSelectedElements(u),C.endTransaction(),i||P(s,u,r))},this.getSelectedElements=function(){return d.getSelectedElements()},this.isSelected=function(t){return void 0!==t&&(t.XM()&_t.HighlightFlags.Selected)==_t.HighlightFlags.Selected},this.getElementsByType=function(t,n){var i=_t[t];if(Dt.common.ObjectHelper.isSubTypeOf(i,_t.SheetElement)){for(var r=[],s=d.getAllElements(),u=s.length,h=0;h<u;h++){var e=s[h];i&&e instanceof i&&(n&&!n(e)||r.push(e))}return r}return v.getElementsByType(i)},this.getBaseDatasByType=function(t){t=_t[t];return v.getElementsByType(t)},this.getAllBaseObjectsByType=function(t){var n,i,r=[],s=_t[t];if(!s)return[];for(n in _t)Object.prototype.hasOwnProperty.call(_t,n)&&(i=_t[n],Dt.common.ObjectHelper.isSubTypeOf(i,s
)&&Array.prototype.push.apply(r,v.getElementsByType(i)));return r},this.selectAllByType=function(t){C.beginTransaction(Dt.messages.ModelChangeMessage);t=d.getVisibleElements(_t[t]);d.setSelectedElements(t,!0),C.endTransaction()},this.setFocusedElements=function(t,n){C.beginTransaction(Dt.messages.ModelChangeMessage),d.setFocusedElements(t,n),C.endTransaction()},this.getFocusedElements=function(){return d.getFocusedElements()},this.setHoverHighlightedConnectionOverlay=function(t){var n,i,r=null;this.setSegmentSvgOverlay(null),t&&((i=t.getId())!==Tt.ConnectionStartDrag&&i!==Tt.ConnectionEndDrag&&i!==Tt.ConnectionBendingDrag&&i!==Tt.ConnectionSegEastWestDrag&&i!==Tt.ConnectionSegNorthSouthDrag&&i!==Tt.ConnectionSegNorthEastDrag&&i!==Tt.ConnectionSegNorthWestDrag||(n=t.getOwner(),(i=this.vN(n,t))&&0<i.length&&this.setSegmentSvgOverlay(i),n.vx(t),r=t)),h!==r&&(h=r,this.updateOverlay())},this.vN=function(t,n){if(n instanceof Zt){var i=t.getStartArrow(),r=t.getEndArrow(),s=n.getGeometry(),
u=s[0].start,n=s[0].end,s=[];return!i||(i=c(i,u,n,t))&&s.push(i),!r||(t=c(r,u,n,t))&&s.push(t),s}},this.getHoverHighlightedConnectionOverlay=function(){return h},this.setHoverHighlightedTableOverlay=function(t){var n,i=null;t&&(n=t.getOwner(),Object.prototype.hasOwnProperty.call(n,"hoveredTableElementOverlay")&&(i=n.hoveredTableElementOverlay=t)),e!==i&&(e=i,this.updateOverlay())},this.getHoverHighlightedTableOverlay=function(){return e},this.getHighlightedElements=function(){return d.getHighlightedElements()},this.getChildrenAndMembersDuringCreation=function(t){var n=[];if(t instanceof _t.Node)if(t.getIsContainer()||t.isGroupingAllowed()){var i=t.wN(),r=[],s=t.getAllMembers();Array.prototype.push.apply(r,s);var u=[];if(0<(e=r.length))for(var h=0;h<e;h++)s=r[h].wN(),Array.prototype.push.apply(u,s);Array.prototype.push.apply(r,u),Array.prototype.push.apply(i,r);for(var e=i.length,h=0;h<e;h++)St.CommonUtil.pushItemIfNotExist(n,i[h])}else n=t.wN();else n=t.wN();return n};var W=function(t,
n){t=t.getOwner();return t instanceof _t.SheetElement&&(!!n[t.guid]||W(t,n))},z=function(t){if(!S.contextData.getSheetFeatureEditMode()&&t.isBackground())return!1;t=t.getLayer();return!t||!1!==t.isSelectable()};this.hideTooltip=function(){var t,n,i;_n.hide(v.dN),this.tooltipEventSettings.settingsFlag&&(t=this.tooltipEventSettings.sheetEl,i=this.tooltipEventSettings.tooltipOption,n=St.TooltipState.DOWN,i===St.TooltipEventOptions.SENDDOWN&&(i=new At.QueryTooltipEventArgs(t,"",v.getMousePositionOnScreen(),null,n,i),C&&(i=new Dt.messages.EventMessage(i,At.EventType.OnQueryTooltip),C.BM(i))),this.tooltipEventSettings.sheetEl=null,this.tooltipEventSettings.tooltipTimer=null,this.tooltipEventSettings.tooltipOption=null,this.tooltipEventSettings.settingsFlag=!1)},this.showTooltip=function(t){var n=this.getHoveredElements();if(n&&0<n.length){var i=n[n.length-1];if(0<=Dt.common.ObjectHelper.isTypeIncluded(i.getType(),S.tooltipObjects)){var r="",s=i.getLabel();s&&(r=s.getText())
;var u=this.getSheetConfigurationData().tooltipStayTime,n=St.TooltipState.UP,s=St.TooltipEventOptions.NONE,n=new At.QueryTooltipEventArgs(i,"",v.getMousePositionOnScreen(),u,n,s);if(C){s=new Dt.messages.EventMessage(n,At.EventType.OnQueryTooltip);if(C.BM(s)){if(n.isCancelled())return!1;var r=n.getTooltip(),s=n.getSheetElement(),h=n.getTooltipStayTime(),e=n.getTooltipOption();this.tooltipEventSettings.sheetEl=s,this.tooltipEventSettings.tooltipTimer=h,this.tooltipEventSettings.tooltipOption=e,this.tooltipEventSettings.settingsFlag=!0}}if(r){var o,h=v.getMousePosition(),e=S.tooltipLocationXYOffset,e=e?(o=e[0],e[1]):o=e=S.tooltipLocationOffset;return new _n(r).show(h.x+o,h.y+e,v.dN,t),!0}}}return _n.hide(v.dN),this.tooltipEventSettings.settingsFlag},this.tooltipEventSettings={sheetEl:void 0,tooltipTimer:void 0,tooltipOption:void 0,settingsFlag:!1},this.removeSheetElements=function(t,n){if(t&&0<t.length){var i=null;n||(i=new At.ElementsDeletingEventArgs(t),n=new Dt.messages.EventMessage(i,
At.EventType.OnElementsDeleting),C.BM(n)&&(t=i.isCancelled()?[]:i.getDeletingElements()));for(var r=t.length,s=[],u=[],h=0;h<r;h++)u[(e=t[h]).guid]=e;for(h=0;h<r;h++){var e=t[h];W(e,u)||s.push(e)}for(C.beginTransaction(Dt.messages.ModelChangeMessage);s.length;)s.pop().remove();C.endTransaction(),i&&i.setDeletingElements([])}},this.removeSelectedElements=function(){this.removeSheetElements(d.getSelectedElements())},this.deleteAll=function(t){t=t.getAllElements();this.removeSheetElements(t)},this.selectAll=function(){this.setSelectedElements(d.getVisibleElements(null,function(t){return!(!0===t.isBackground()||t.isInternal()||t.getCollapsedOwner&&t.getCollapsedOwner())}),!0)},this.deselectAll=function(t){var n=[],i=d.getSelectedElements();t=t||this.getCursorPosAndKeyStatus();var r=R(n,i,t),s=r.isRejected,n=r.addedElements,i=r.removedElements;s||(C.beginTransaction(Dt.messages.ModelChangeMessage),d.addToSelectedElements(n),d.removeFromSelectedElements(i),C.endTransaction(),P(n,i,t))},
this.renderExportElements=function(t,n,i){var r=m.renderData.lodType;m.renderData.lodType=i<=0||!i?St.LODType.DetailLevel:i;t=t?Dt.RenderUpdateFlags.ExportStart:Dt.RenderUpdateFlags.ExportEnd;n&&(t|=Dt.RenderUpdateFlags.AllElements),m.renderData.updateFlags=t,H(),m.renderData.lodType=r},this.applyPreSelectionFilter=function(t,n,i){var r=this.getHoveredElements(),s=this.getElementByPoint2(t,[St.ElementType.UI,St.ElementType.OVERLAY]);if(s){var u=!0;return{oldElements:r,newElements:[s],isPreselectionFilterHandled:!1,isHoverChanged:u=1===r.length&&r[0]===s?!1:u}}var s=i?null:this.getElementsByPoint(t),h=[],i=!1;n=n||this.getCursorPosAndKeyStatus(),s&&0<s.length&&(t=new At.PreselectionFilterEventArgs(s,!0,n.altKey,n.ctrlKey,n.shiftKey,n.cursorPos),n=new Dt.messages.EventMessage(t,At.EventType.OnPreselectionFilter),i=C.BM(n)?!t.isCancelled()&&(h=t.getSheetElements(),!0):!(h=[s[s.length-1]]));u=!1;if(r&&h&&r.length===h.length){for(var e=0,o=r.length;e<o;e++)if(r[e]!==h[e]){u=!0;break}
}else u=!0;return{oldElements:r,newElements:h,isPreselectionFilterHandled:a=i,isHoverChanged:u}},this.setHoverHighlightedElement=function(t,n,i){var i=this.applyPreSelectionFilter(t,n,i),r=(i.oldElements,i.newElements);if(i.isHoverChanged){if(C.beginTransaction(Dt.messages.ModelChangeMessage),d.setHoveredElements(r,!0),a&&r){var s=r.length;if(1<s)for(var u=0;u<s;u++){var h=r[u];h instanceof _t.Connection&&h._M()&St.ConnectionHandleOption.SEGMENTS&&h.setHighlightFlags(_t.HighlightFlags.EntireConnectionHover,!0)}}C.endTransaction()}},this.setSingleSelectedElement=function(t){var n=[],i=[],r=d.getSelectedElements();t=t||this.getCursorPosAndKeyStatus();var s=d.getHoveredElements();if(s&&0<s.length)if(a){for(var u=0,h=s.length;u<h;u++)(s[u].XM()&_t.HighlightFlags.Selected)!==_t.HighlightFlags.Selected&&n.push(s[u]);for(u=0,h=r.length;u<h;u++)s.indexOf(r[u])<0&&i.push(r[u])}else i=((s[0].XM()&_t.HighlightFlags.Selected)===_t.HighlightFlags.Selected&&0<=(o=r.indexOf(s[0]))&&r.splice(o,1),r),
n=[s[0]];else i=r;var e=R(n,i,t),o=e.isRejected;n=e.addedElements,i=e.removedElements,o||(C.beginTransaction(Dt.messages.ModelChangeMessage),d.addToSelectedElements(n),d.removeFromSelectedElements(i),C.endTransaction(),P(n,i,t))},this.setMultiSelectedElements=function(t){var n=[],i=[];t=t||this.getCursorPosAndKeyStatus();var r=d.getHoveredElements();if(r&&0<r.length)for(var s=r.length,u=0;u<s;u++)(r[u].XM()&_t.HighlightFlags.Selected)!==_t.HighlightFlags.Selected&&n.push(r[u]);var h=R(n,i,t),e=h.isRejected,n=h.addedElements,i=h.removedElements;e||(C.beginTransaction(Dt.messages.ModelChangeMessage),d.addToSelectedElements(n),d.removeFromSelectedElements(i),C.endTransaction(),P(n,i,t))},this.setRectangleSelectedElements=function(t,n){var i=[],r=[],s=d.getSelectedElements(),u=(n=n||this.getCursorPosAndKeyStatus()).ctrlKey;if(t&&0<t.width&&0<t.height){var h=[],e=this.getElementsInsideRect(t),o=this.getElementsInsideAndIntersectRect(t),f=this.getVisibleElements(),
t=S.selectionPreferencesData.getMultiSelectSelectionRule();if(t===St.SelectionRule.INSIDE?h=e:t===St.SelectionRule.OUTSIDE?h=St.ArrayUtil.subtract(f,o):t===St.SelectionRule.CROSSING?h=St.ArrayUtil.subtract(o,e):t===St.SelectionRule.INSIDECROSSING?h=o:t===St.SelectionRule.OUTSIDECROSSING&&(h=St.ArrayUtil.subtract(f,e)),h&&0<h.length){var a=new At.PreselectionFilterEventArgs(h,!1,n.altKey,n.ctrlKey,n.shiftKey,n.cursorPos),e=new Dt.messages.EventMessage(a,At.EventType.OnPreselectionFilter);if(C.BM(e)&&(h=a.isCancelled()?[]:a.getSheetElements()),u)for(var c=h.length,l=0;l<c;l++)(h[l].XM()&_t.HighlightFlags.Selected)!==_t.HighlightFlags.Selected&&i.push(h[l]);else{for(c=h.length,l=0;l<c;l++)(h[l].XM()&_t.HighlightFlags.Selected)!==_t.HighlightFlags.Selected&&i.push(h[l]);c=s.length;for(l=0;l<c;l++)h.indexOf(s[l])<0&&r.push(s[l])}}else u||(r=s)}else u||(r=s);a=R(i,r,n),u=a.isRejected,i=a.addedElements,r=a.removedElements;u||(C.beginTransaction(Dt.messages.ModelChangeMessage),
d.addToSelectedElements(i),d.removeFromSelectedElements(r),C.endTransaction(),P(i,r,n))},this.getMoveElements=function(){var t=d.getSelectedElements(),n=d.getHoveredElements(),i=!0,r=n.length;r<1&&(i=!1);for(var s=0;s<r;++s){var u=n[s];if(t.indexOf(u)<0){i=!1;break}}return i?t:n},this.DeselectElement=function(t,n){var i=[],r=[];if(n=n||this.getCursorPosAndKeyStatus(),t)r=t;else{var s=d.getHoveredElements();if(s&&0<s.length)for(var u=s.length,h=0;h<u;h++)(s[h].XM()&_t.HighlightFlags.Selected)===_t.HighlightFlags.Selected&&r.push(s[h])}var e=R(i,r,n),t=e.isRejected,i=e.addedElements,r=e.removedElements;t||(C.beginTransaction(Dt.messages.ModelChangeMessage),d.addToSelectedElements(i),d.removeFromSelectedElements(r),C.endTransaction(),P(i,r,n))},this.switchExpandingStatus=function(t){C.beginTransaction(Dt.messages.ModelChangeMessage);var n,i,r=this.getHoveredElements();r&&0<r.length&&r[0].isGroupingAllowed&&r[0].isGroupingAllowed()&&((n=r[0].getXform())&&(t=n.invert().transformPoint(t)),(
i=this.getSymbolOccurrenceByPoint(t))&&i.getSymbolType&&(i.getSymbolType()!=St.NestedNodeSymbolType.ExpandButton&&i.getSymbolType()!=St.NestedNodeSymbolType.CollapseButton||(t=(n=r[0].isExpanded())?At.EventType.OnCollapseNode:At.EventType.OnExpandNode,i=new(n?At.CollapseNodeEventArgs:At.ExpandNodeEventArgs)(r[0]),t=new Dt.messages.EventMessage(i,t),C.BM(t)&&i.isCancelled()||r[0].setExpanded(!n)))),C.endTransaction()};function Y(t,n){if(t.askLinkedConnections)for(var i=t.askLinkedConnections(),r=i.length,s=0;s<r;s++){var u=i[s];n.indexOf(u)<0&&u.tx()}}this.getMoveElementsInfo=function(t,n,i){var r=[],s=[],u=[],h=[],e=t.length;if(t&&0<t.length)for(var o=0;o<e;o++)if(!this.isReferencedLocationInArray(t[o],t))if(t[o]instanceof _t.Connection)s.indexOf(t[o])<0&&(s.push(t[o]),i?h.push(n):h.push(n[o]));else{var f=s.length;this.getRelatedConnectionsToMove(t[o],s);for(var a=s.length-f,c=0;c<a;c++)i?h.push(n):h.push(n[o]);r.push(t[o]),i?u.push(n):u.push(n[o])}var l={};return l.nodeArray=r,
l.connectionArray=s,l.nodeOffsetArray=u,l.connectionOffsetArray=h,l},this.bulkMoveElements=function(t,n,i,r,s){for(var u=t.length,h=0;h<u;h++)0===n[h].x&&0===n[h].y||Y(t[h],i),t[h].move(n[h].x,n[h].y);for(var e,o,f,a=i.length,h=0;h<a;h++)s&&((e=i[h].getStart())&&!this.isReferencedLocationInArray(e,t)&&(i[h].setStart(null,!0),o=e.getSymbolConnectionLocation().getEvaluatedLocation(),(f=i[h].getStartLocation())?f.setEvaluatedLocation(o.x,o.y):i[h].setStartLocation(new _t.Location(o.x,o.y),!0)),(f=i[h].getEnd())&&!this.isReferencedLocationInArray(f,t)&&(i[h].setEnd(null,!0),o=f.getSymbolConnectionLocation().getEvaluatedLocation(),(f=i[h].getEndLocation())?f.setEvaluatedLocation(o.x,o.y):i[h].setEndLocation(new _t.Location(o.x,o.y),!0))),i[h].move(r[h].x,r[h].y)},this.moveElements=function(t,n,i,r,s,u,h,e){if(N){var o=N.getGeometry(),f=N.Bx(),a=this.previewManager.Kx();if(o&&0<o.length){var t=t?[t.x,t.y]:[],c=[],l=f.length,v=!1,w=!1,d=N.nE();d&&0<d.length&&(v=!0,1==d.length&&(w=!0));for(
var m,g=0;g<l;g++)c.push(new St.Matrix(1,0,0,1,f[g].x,f[g].y)),v&&(w?0!==d[0]&&(m=d[g]*Math.PI/180,c.push(new St.Matrix(Math.cos(m),Math.sin(m),-Math.sin(m),Math.cos(m),0,0))):0!==d[g]&&(m=d[g]*Math.PI/180,c.push(new St.Matrix(Math.cos(m),Math.sin(m),-Math.sin(m),Math.cos(m),0,0))));if("move"==n||"copy"==n){var M=i;i.AM&&(M=i.AM);for(var p=[],g=0;g<l;g++)o[g].AM&&p.push(o[g].AM);0===p.length&&(p=o),(x=new At.PreTransformEndEventArgs(p,c,"translate",void 0,t,n,s,u,h,e)).setTransformMaster(M),x.setOverlappedElements(r);var b=new Dt.messages.EventMessage(x,At.EventType.OnPreTransformEnd),k=C.BM(b);if(k&&x.isCancelled())return void this.previewManager.jE(!0)}this.previewManager.jE(!1);n=this.getMoveElementsInfo(o,f,!1),s=n.nodeArray,M=n.connectionArray,k=n.nodeOffsetArray,n=n.connectionOffsetArray;if(C.beginTransaction(Dt.messages.ModelChangeMessage),this.bulkMoveElements(s,k,M,n,!0),v)for(g=0;g<o.length;g++){var y=w?d[0]:d[g];0!==y&&(Y(o[g],o),o[g].setRotation(o[g].getRotation()+y))}if(a
)for(g=0,l=a.length;g<l;g++)a[g].isUpToDate()&&a[g].setUpToDate(!1);C.endTransaction();var x,n=this.moveConstraint.alignment.generateAlignmentData();(x=new At.TransformEndEventArgs(o,c,"translate",void 0,t,u,h,e)).setAlignmentData(n),x.setOverlappedElements(r);b=new Dt.messages.EventMessage(x,At.EventType.OnTransformEnd);C.BM(b)}}E.Vk()},this.resizeElements=function(){if(N){var t=N.getGeometry(),n=N.Bx(),i=N.Qx(),r=N.jx,s=this.previewManager.VE();if(t&&0<t.length){C.beginTransaction(Dt.messages.ModelChangeMessage);for(var u=[],h=t.length,e=0;e<h;e++)Y(t[e],t),t[e].resize(i[e].x,i[e].y,n[e].x,n[e].y),u.push(new St.Matrix(i[e].x,0,0,i[e].y,n[e].x,n[e].y));if(s)for(e=0,h=s.length;e<h;e++)s[e].isUpToDate()&&s[e].setUpToDate(!1);C.endTransaction();r=new At.TransformEndEventArgs(t,u,"scale",r),r=new Dt.messages.EventMessage(r,At.EventType.OnTransformEnd);C.BM(r)}}E.Vk()},this.rotateElements=function(){if(N){var t=N.getGeometry(),n=N.nE(),i=this.previewManager.VE();if(t&&0<t.length){
C.beginTransaction(Dt.messages.ModelChangeMessage);for(var r=[],s=t.length,u=0;u<s;u++){Y(t[u],t),t[u].setRotation(t[u].getRotation()+n[u]);var h=n[u]*Math.PI/180;r.push(new St.Matrix(Math.cos(h),Math.sin(h),-Math.sin(h),Math.cos(h),0,0))}if(i)for(u=0,s=i.length;u<s;u++)i[u].isUpToDate()&&i[u].setUpToDate(!1);C.endTransaction();var e=new At.TransformEndEventArgs(t,r,"rotate"),e=new Dt.messages.EventMessage(e,At.EventType.OnTransformEnd);C.BM(e)}}E.Vk()},this.cloneDummy=function(t){var n=[];C.beginTransaction(Dt.messages.ModelChangeMessage);for(var i=0,r=t.length;i<r;i++){var s=t[i].clone();n.push(s)}return C.endTransaction(),n},this.copy=function(t){Fn.copy(t)},this.paste=function(t){var n,i,r,s,u;Fn.canPaste()&&(i=[],r=[],u=d.getSelectedElements(),(n=Fn.paste(v)).pastedElements,n.pastedSheetElements,i=n.pastedSheetElements,r=u,t=t||this.getCursorPosAndKeyStatus(),u=(s=R(i,r,t)).isRejected,i=s.addedElements,r=s.removedElements,u||(C.beginTransaction(Dt.messages.ModelChangeMessage),
d.addElements(n.pastedSheetElements),d.addToSelectedElements(i),d.removeFromSelectedElements(r),C.endTransaction(),P(i,r,t)))},this.removeFromSheet=function(t){},this.getVisibleElements=function(t){return E.getVisibleElements(t)},this.getVisibleUIElements=function(t){return E.getVisibleUIElements(t)},this.getTopVisibleElements=function(t){if(null===w)return null;t=w.Lx(t||E.getViewport());return St.CommonUtil.retrieveSheetElements(t,function(t){return t.getOwner&&!(t.getOwner()instanceof _t.Sheet)&&z(t)})},this.getLayoutCandidates=function(){for(var t=[],n=d.getAllElements(),i=n.length,r=0;r<i;++r)!0!==n[r].isBackground()&&(!n[r].getOwner||n[r].getOwner()instanceof _t.Sheet)&&t.push(n[r]);return t},this.getViewport=function(){return E.getViewport()},this.getSheetToScreenTransform=function(){return r},this.getScreenToSheetTransform=function(){return s},this.setSheetToScreenTransform=function(t){s=(r=t).invert();var n=r.getM0();C.beginTransaction(Dt.messages.ModelChangeMessage)
;var i=S.viewData;i.setScaleFactor(n),i.Hx=n,i.setSheetToViewXform(t.clone()),C.endTransaction()},this.getOverviewScreenToSheetTransform=function(){return o},this.setOverviewSheetToScreenTransform=function(t){o=t.invert()},this.fit=function(t,n,i){var r;E&&(T.fitAnimation?(r=new Dn(v,this),f=r,E.fit(t,n,f,i)):E.fit(t,n,null,i))},this.fitToRectangle=function(t,n){E.fitToRectangle(t,n)},this.translateViewport=function(t){return E.translateViewport(t)},this.setCurrentZoomFactor=function(t,n,i){return E.setCurrentZoomFactor(t,n,i)},this.setAlignmentSmartGuideLines=function(t){var n;i||((n=(i=new On).getStyle()).strokeColor=S.alignmentStrokeColor,n.lineWidth=S.alignmentLineWidth,n.lineDashArray=S.alignmentLineDashArray,g.push(i)),i.setGeometry(t)},this.setSelectingRect=function(t){n||(n=new Nn,g.push(n)),n.setGeometry(t),n.getStyle().vectorEffect=!0,this.updateOverlay()},this.setDropHighlightElements=function(t,n){C.beginTransaction(Dt.messages.ModelChangeMessage);for(var i=0,
r=t.length;i<r;i++){var s=t[i].XM()&_t.HighlightFlags.DropHighlight;n?s||t[i].setHighlightFlags(_t.HighlightFlags.DropHighlight,!0):s&&t[i].setHighlightFlags(_t.HighlightFlags.DropHighlight,!1)}C.endTransaction()},this.startPreview=function(t){this.previewManager.startPreview(t)},this.setPreviewOverlays=function(t,n,i,r,s,u,h,e,o,f){f=this.previewManager.setPreviewOverlays(t,n,i,r,s,u,h,e,o,f);return N=this.previewManager.bE,f},this.getPreviewOverlays=function(){return N},this.setConnectionOverlay=function(t,n){var i;this.setSegmentSvgOverlay(null),u||((i=(u=new et).getStyle()).strokeColor=S.connectionEditPreviewStyle.strokeColor,i.lineWidth=S.connectionEditPreviewStyle.lineWidth,i.lineDashArray=S.connectionEditPreviewStyle.lineDashArray,g.push(u)),u.setGeometry(t),n&&u.setOwner(n),this.updateOverlay()},this.setAddtionalMovedConnectionOverlays=function(t){if(null!==t){p=[];for(var n=0,i=t.length;n<i;n++){var r=new et,s=r.getStyle();s.strokeColor=S.connectionEditPreviewStyle.strokeColor
,s.lineWidth=S.connectionEditPreviewStyle.lineWidth,s.lineDashArray=S.connectionEditPreviewStyle.lineDashArray,r.setGeometry(t[n]),p.push(r)}}else p=null},this.setConnectionCreationOverlay=function(t){b=t},this.setAttachingPortOverlays=function(t){k=t},this.setSegmentSvgOverlay=function(t){x=t},this.setAttachingLineOverlays=function(t){y=t};this.storedAttachedData={origConnectionEndPhase:null,position:null,originalPort:null},this.clearStoredAttachedData=function(){this.storedAttachedData.origConnectionEndPhase=null,this.storedAttachedData.position=null,this.storedAttachedData.originalPort=null},this.setCursorQuadrantIndicator=function(t){O=t},this.setLocationIndicatorOverlays=function(t){A=t},this.removePreviewRelatedOverlays=function(){this.setPreviewOverlays(null),this.setAttachingPortOverlays(null),this.setAttachingLineOverlays(null),this.setLocationIndicatorOverlays(null)},this.getOverlays=function(t){for(var n=[],i=this.getHighlightedElements(),r=i.length,s=d.isMultipleSelection()
,u=0;u<r;++u){var h=i[u].getOverlays(s,t);if(h)for(var e=h.length,o=0;o<e;++o){var f=h[o];f&&f.isVisible()&&function(t){var n=!0;if(null===l)return!1;switch(t.jM){case Cn.Move:n=l.getCommand("MoveCommand").isEnabled();break;case Cn.Rotate:n=l.getCommand("RotateCommand").isEnabled();break;case Cn.Resize:n=l.getCommand("ResizeCommand").isEnabled();break;case Cn.ConnectionPointDrag:n=l.getCommand("MoveConnectionCommand").isEnabled();break;case Cn.Hover:case Cn.ConnectionSegHover:n=l.getCommand("HoverHighlightCommand").isEnabled()}return n}(f)&&n.push(f)}}if(k&&(n=n.concat(k)),y&&(n=n.concat(y)),b&&(n=n.concat(b)),O&&(n=n.concat(O)),p&&(n=n.concat(p)),x&&0<x.length){var a=this.getHoverHighlightedConnectionOverlay();if(a)for(u=0;u<x.length;u++)x[u].setVisible(!0),x[u].setId(a.getId()),x[u].setSelectable(a.isSelectable()),x[u].getStyle().vectorEffect=a.getStyle().vectorEffect,x[u].getStyle().strokeColor=a.getStyle().strokeColor,x[u].getStyle().fillColor=a.getStyle().strokeColor,
x[u].getStyle().lineWidth=a.getStyle().lineWidth,x[u].jM=a.jM;n=n.concat(x)}var c=n.concat(g);return c=A?c.concat(A):c},this.addOverlay=function(t){g.push(t)},this.resizeViewport=function(t,n,i){E.resizeViewport(t,n,i)},this.updateLabelText=function(t,n){C.beginTransaction(Dt.messages.ModelChangeMessage),t.setText(n),C.endTransaction()},this.fastCreateAnnotation=function(t,n,i){C.beginTransaction(Dt.messages.ModelChangeMessage),_t.Annotation.fastCreation(t,n,i),C.endTransaction()},this.getOverviewRect=function(){return E.getOverviewRect()},this.setOverviewRect=function(t){E.setOverviewRect(t)},this.setTempCellRangeSizeInTable=function(t,n,i,r){C.beginTransaction(Dt.messages.ModelChangeMessage),t.setTempCellRangeSize(n,i,r),C.endTransaction()},this.setCellRangeSizeInTable=function(t,n,i,r){C.beginTransaction(Dt.messages.ModelChangeMessage),t&&n&&t.setCellRangeSize(n,i,r),C.endTransaction()},this.setSelectedElementsInTable=function(t,n,i){C.beginTransaction(Dt.messages.ModelChangeMessage
),i?t.setSelectedTempElementsList(n):t.setSelectedElementsList(n),C.endTransaction(),this.updateOverlay()},this.refresh=function(t){E.refresh(t)},this.switchGroupViewMode=function(t){var n=this.getElementsByType("Node"),i=n.length;if(0<i){C.beginTransaction(Dt.messages.ModelChangeMessage);for(var r=0;r<i;r++)n[r].switchViewMode(t);C.endTransaction()}d.setGroupViewMode(t)},this.setCursor=function(t,n,i){var r=v.getCursorConfiguration();t===St.CursorID.IMMEDIATE&&i.activateCursor(t),r[t]=n},this.sendEvent=function(t){t=new Dt.messages.EventMessage(t,t.getType());return v.CM().BM(t)},this.panElementInView=function(t,n,i){if(t&&0<t.length){for(var r=t[0].getRenderingBBox(),s=t.length,u=1;u<s;++u)r.union(t[u].getRenderingBBox());var h,e=this.getViewportManager().getViewport(),o=0,f=0;switch(null==n&&(n=St.PanOptionForElementPan.Center),null==i&&(i=St.ZoomOptionForElementPan.False),n){case St.PanOptionForElementPan.Auto:r.isInsideRect(e)||(f=(
o=r.x<e.x||r.x+r.width>e.x+e.width?r.x<e.x?e.x-r.x:e.x+e.width-(r.x+r.width):0,r.y<e.y||r.y+r.height>e.y+e.height?r.y<e.y?e.y-r.y:e.y+e.height-(r.y+r.height):0));break;case St.PanOptionForElementPan.Center:(h=new St.Point(0,0)).x=e.getCenterX(),h.y=e.getCenterY();var a=r.getCenterX(),c=r.getCenterY(),o=h.x-a,f=h.y-c;break;case St.PanOptionForElementPan.Top:(h=new St.Point(0,0)).x=e.getCenterX(),h.y=e.y+r.height/2;a=r.getCenterX(),c=r.getCenterY();o=h.x-a,f=h.y-c;break;case St.PanOptionForElementPan.Bottom:(h=new St.Point(0,0)).x=e.getCenterX(),h.y=e.y+e.height-r.height/2;a=r.getCenterX(),c=r.getCenterY();o=h.x-a,f=h.y-c;break;case St.PanOptionForElementPan.Left:(h=new St.Point(0,0)).x=e.x+r.width/2,h.y=e.getCenterY();a=r.getCenterX(),c=r.getCenterY();o=h.x-a,f=h.y-c;break;case St.PanOptionForElementPan.Right:(h=new St.Point(0,0)).x=e.x+e.width-r.width/2,h.y=e.getCenterY();a=r.getCenterX(),c=r.getCenterY();o=h.x-a,f=h.y-c}n=new St.Vector(o,f);switch(this.translateViewport(n),i){
case St.ZoomOptionForElementPan.False:break;case St.ZoomOptionForElementPan.True:this.fit(t,null,!0);break;case St.ZoomOptionForElementPan.Auto:(r.width>e.width||r.height>e.height)&&this.fit(t,null,!0)}}},this.getCursorPosAndKeyStatus=function(t){if(t){var n=this.getSheetSession().getMousePosition();return{altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,cursorPos:[n.x,n.y]}}return{altKey:!1,ctrlKey:!1,shiftKey:!1,cursorPos:null}};var t,B,Z,U,G=document.getElementsByTagName("usercursor"),X=G.length;0<X&&(Z=!1,U=-1,"Microsoft Internet Explorer"==navigator.appName?(B=navigator.userAgent,null!==new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(B)&&(U=parseFloat(RegExp.$1))):"Netscape"==navigator.appName&&(B=navigator.userAgent,null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(B)&&(U=parseFloat(RegExp.$1))),t=Z=-1!==U||Z);for(var $=0;$<X;$++){var q=G[$],K=q.id,q=t?q.getAttribute("valueMS"):q.getAttribute("value");this.setCursor(K,q)}}si.prototype.reset=function(){
this.alignment.resetAlignX(),this.alignment.resetAlignY(),this.snap.resetSnapX(),this.snap.resetSnapY(),this.attachingUtil.reset()},si.prototype.destroy=function(){this.alignment=null,this.snap=null,this.attachingUtil=null,this.focusElement=null,this.locationIndicatorLoc=null,this.transformMaster=null},si.prototype.ZM=function(t){this.alignment._C(t),this.attachmentSourceTypes=t.getAttachmentSourceTypes(),this.attachmentTargetTypes=t.getAttachmentTargetTypes(),this.attachmentMasters=t.getAttachmentMasters()},si.prototype.p2=function(){this.alignment.SC(),this.attachmentSourceTypes=null,this.attachmentTargetTypes=null,this.attachmentMasters=null},si.prototype.getMovePriority=function(){return this.dataModelMgr.getSheetConfigurationData().movePriority},si.prototype.getHighPriorityAlignmentTypes=function(t,n){return n<0?t:t.slice(0,n)},si.prototype.getLowPriorityAlignmentTypes=function(t,n){return n<0?[]:t.slice(n+1)},si.prototype.getFocusElement=function(t){var n=this.focusElement;if(n
)return n;var i=t.length;if(1===i)return t[0];for(var r=0;r<i;r++)if(t[r].XM()&_t.HighlightFlags.Focused)return t[r];return null},si.prototype.doAlign=function(t,n,i){var r={x:0,y:0},s=this.alignment,u=this.snap;return s.isAlignActive()&&((s.alignY.isAligned||u.isSnapX)&&(s.alignX.isAligned||u.isSnapY)||(s.alignY.isAligned||u.isSnapX?(s.doAlignX(t,n,i),r.y=s.alignX.offset,s.QE=r.y+n.y):s.alignX.isAligned||u.isSnapY?(s.doAlignY(t,n,i),r.x=s.alignY.offset,s.JE=r.x+n.x):(s.doAlign(t,n,i),r.x=s.alignY.offset,r.y=s.alignX.offset,s.JE=r.x+n.x,s.QE=r.y+n.y))),r},si.prototype.doAlign2=function(t,n,i){var r,s={x:0,y:0,elementsX:null,elementsY:null},u=this.alignment,h=this.snap;return u.isAlignActive()&&((u.alignY.isAligned||h.isSnapX)&&(u.alignX.isAligned||h.isSnapY)||(u.alignY.isAligned||h.isSnapX?(r=u.doAlignX2(t,n,i),s.elementsX=r.elements,s.y=u.alignX.offset,u.QE=s.y+n.y):u.alignX.isAligned||h.isSnapY?(r=u.doAlignY2(t,n,i),s.elementsY=r.elements,s.x=u.alignY.offset,u.JE=s.x+n.x):(
r=u.doAlign2(t,n,i),s.elementsX=r.elementsX,s.elementsY=r.elementsY,s.x=u.alignY.offset,s.y=u.alignX.offset,u.JE=s.x+n.x,u.QE=s.y+n.y))),s},si.prototype.doSnap=function(t,n){var i={x:0,y:0},r=this.alignment,s=this.snap;return s.isSnapNodeActive()&&(r.alignX.isAligned&&r.alignY.isAligned||(r.alignY.isAligned?(s.doSnapY(t,n.y),i.y=s.snapY):r.alignX.isAligned?(s.doSnapX(t,n.x),i.x=s.snapX):(s.doSnap(t,n.x,n.y),i.x=s.snapX,i.y=s.snapY))),i},si.prototype.doSnap2=function(t,n){var i,r={x:0,y:0,elementX:null,elementY:null},s=this.alignment,u=this.snap;return u.isSnapNodeActive()&&(s.alignX.isAligned&&s.alignY.isAligned||(s.alignY.isAligned?(i=u.doSnapY(t,n.y),r.elementY=i.element,r.y=u.snapY):s.alignX.isAligned?(i=u.doSnapX(t,n.x),r.elementX=i.element,r.x=u.snapX):(i=u.doSnap(t,n.x,n.y),r.elementX=i.elementX,r.elementY=i.elementY,r.x=u.snapX,r.y=u.snapY))),r},si.prototype.askSplitAlignAndSnap=function(){return this.dataModelMgr.getSheetConfigurationData().separateGridSnapAndAlignment},
si.prototype.doAlignAndSnap=function(t,n){var i={x:0,y:0};if(this.askSplitAlignAndSnap())for(var r=this.getMovePriority(),s=0,u=r.length;s<u;s++)r[s]===St.MoveConstraintType.Alignment?a=this.doAlign(t,n):r[s]===St.MoveConstraintType.Snap&&(a=this.doSnap(t,n)),i.x+=a.x,i.y+=a.y;else for(var h=this.alignment.getAlignPriority(),e=h.indexOf(St.AlignmentType.SnapToGrid),o=this.getHighPriorityAlignmentTypes(h,e),f=this.getLowPriorityAlignmentTypes(h,e),s=0;s<3;s++){var a={x:0,y:0};0===s&&o&&0<o.length?a=this.doAlign(t,n,o):1===s?a=this.doSnap(t,n):2===s&&f&&0<f.length&&(a=this.doAlign(t,n,f)),i.x+=a.x,i.y+=a.y}return i},si.prototype.doAlignAndSnap2=function(t,n){var i={x:0,y:0,alignElementsX:[],alignElementsY:[],snapElementX:null,snapElementY:null};if(this.askSplitAlignAndSnap())for(var r=this.getMovePriority(),s=0,u=r.length;s<u;s++)r[s]===St.MoveConstraintType.Alignment?(a=this.doAlign2(t,n),i.alignElementsX=a.elementsX,i.alignElementsY=a.elementsY):r[s]===St.MoveConstraintType.Snap&&(
a=this.doSnap2(t,n),i.snapElementX=a.elementX,i.snapElementY=a.elementY),i.x+=a.x,i.y+=a.y;else for(var h=this.alignment.getAlignPriority(),e=h.indexOf(St.AlignmentType.SnapToGrid),o=this.getHighPriorityAlignmentTypes(h,e),f=this.getLowPriorityAlignmentTypes(h,e),s=0;s<3;s++){var a={x:0,y:0};0===s&&o&&0<o.length?(a=this.doAlign2(t,n,o),i.alignElementsX=a.elementsX,i.alignElementsY=a.elementsY):1===s?(a=this.doSnap2(t,n),i.snapElementX=a.elementX,i.snapElementY=a.elementY):2===s&&f&&0<f.length&&(a=this.doAlign2(t,n,f),i.alignElementsX=a.elementsX,i.alignElementsY=a.elementsY),i.x+=a.x,i.y+=a.y}return i},si.prototype.doMoveStrategy=function(t,n){if(this.disableMoveStrategy)return null;var i=null,r=!1,s=1<t.length;if(s)for(var u=0,h=t.length;u<h;u++)if((e=t[u].getMoveStrategy())&&e.getStopMove()){r=!0;break}for(var e,o,f,u=0,h=t.length;u<h;u++)(e=t[u].getMoveStrategy())&&(e.setStopMove(s&&r),e.previewManger=this.previewManager,e.setTarget(t[u]),void 0!==(o=e.getFinalTransformation(n.x,n.y
)).angle&&(f=o.angle),i={x:o.dx,y:o.dy,angle:f},s&&e.getStopMove()&&(r=!0));return i},si.prototype.doLocationIndicator=function(t){var n,i,r=t;return this.locationIndicatorLoc&&((n=this.transformMaster)&&(i=(i=!(i=this.previewManager.getElementOriginalBBox(n))?(t=n.getBBox())?t.clone():void 0:i)?new St.Point(i.x,i.y):n.getRenderingPosition(),i=n.translateRenderingToAnchorPosition(i),r.x=this.locationIndicatorLoc.x-i.x,r.y=this.locationIndicatorLoc.y-i.y,this.transformMaster=null),this.locationIndicatorLoc=null),r},si.prototype.attachingDuringMove=function(t){var n,i=!1;if(this.attachmentTargetTypes&&0<this.attachmentTargetTypes.length&&(this.attachmentSourceTypes&&0<this.attachmentSourceTypes.length||this.attachmentMasters&&0<this.attachmentMasters.length)){if(!(n=this.dataModelMgr.getPreviewOverlays()))return i;var r=[],s=this.attachmentSourceTypes;if(this.attachmentMasters&&0<this.attachmentMasters.length)r=this.attachmentMasters;else if(
this.attachmentSourceTypes&&0<this.attachmentSourceTypes.length)for(var u=0<=s.indexOf("Port"),h=0,e=t.length;h<e;h++){var o=t[h],f=o.getTypeName();0<=s.indexOf(f)&&r.push(o),u&&o instanceof _t.Node&&(0<(o=o.getPorts()).length&&(r=r.concat(o)))}if(0<r.length&&(n.Xx(),v=(l=n.Ux())[0].x,w=l[0].y,this.attachingUtil.attachableTargets=this.attachmentTargetTypes,this.attachingUtil.$E=t,i=this.attachingUtil.bulkSourcesAttaching(r,null,St.AttachingType.MoveNode,v,w),this.attachingUtil.attachableTargets=null,this.attachingUtil.$E=null),i)return i}if(!this.attachingUtil.isAttachingActiveDuringNodeMove())return i;if(n=this.dataModelMgr.getPreviewOverlays()){var a=n.getGeometry();if(!a)return i;var c=this.getFocusElement(a);if(!c)return i;if(!(c instanceof _t.Node))return i;n.Xx();a=n.sE();if(!a)return i;var l,v=(l=n.Ux())[0].x,w=l[0].y;this.attachingUtil.reset(St.AttachingType.MoveNode,c),i=(i=this.attachingUtil.retrieveConnectionByAttachedPort(v,w)
)||this.attachingUtil.retrieveCandidatesByBoundary(a,v,w)}return i},si.prototype.attachingDuringMove2=function(t){var n={isAttaching:!1,idx:-1};if(this.attachmentTargetTypes&&0<this.attachmentTargetTypes.length&&(this.attachmentSourceTypes&&0<this.attachmentSourceTypes.length||this.attachmentMasters&&0<this.attachmentMasters.length)){if(!(v=this.dataModelMgr.getPreviewOverlays()))return n;var i=[],r=this.attachmentSourceTypes;if(this.attachmentMasters&&0<this.attachmentMasters.length)i=this.attachmentMasters;else if(this.attachmentSourceTypes&&0<this.attachmentSourceTypes.length)for(var s=0<=r.indexOf("Port"),u=0,h=t.length;u<h;u++){var e=t[u],o=e.getTypeName();0<=r.indexOf(o)&&i.push(e),s&&e instanceof _t.Node&&(0<(e=e.getPorts()).length&&(i=i.concat(e)))}if(0<i.length&&(l=v.Ux(t),this.attachingUtil.attachableTargets=this.attachmentTargetTypes,this.attachingUtil.$E=t,c=this.attachingUtil.bulkSourcesAttaching2(i,null,St.AttachingType.MoveNode,t,l),n.isAttaching=c.isAttaching,
n.idx=c.idx,this.attachingUtil.attachableTargets=null,this.attachingUtil.$E=null),n.isAttaching)return n}if(!this.attachingUtil.isAttachingActiveDuringNodeMove())return n;if(v=this.dataModelMgr.getPreviewOverlays()){var f=v.getGeometry();if(!f)return n;var a=this.getFocusElement(f);if(!a)return n;if(!(a instanceof _t.Node))return n;v.Xx();var c=v.sE();if(!c)return n;var l=v.Ux(t),f=t.indexOf(a),v=l[f].x,l=l[f].y;this.attachingUtil.reset(St.AttachingType.MoveNode,a),n.isAttaching=this.attachingUtil.retrieveConnectionByAttachedPort(v,l),n.idx=f,n.isAttaching||(n.isAttaching=this.attachingUtil.retrieveCandidatesByBoundary(c,v,l))}return n},si.prototype.attachingDuringCreation=function(t,n){var i=t.getOwner();i&&i instanceof _t.Node&&(t.setOwner(null),t.setTransformUpdate(!0));var r=!1;if(this.attachmentTargetTypes&&0<this.attachmentTargetTypes.length&&(this.attachmentSourceTypes&&0<this.attachmentSourceTypes.length||this.attachmentMasters&&0<this.attachmentMasters.length)){var s,u=[],
h=this.attachmentSourceTypes;if(this.attachmentMasters&&0<this.attachmentMasters.length?u=this.attachmentMasters:this.attachmentSourceTypes&&0<this.attachmentSourceTypes.length&&(i=t.getTypeName(),0<=h.indexOf(i)&&u.push(t),0<=h.indexOf("Port")&&t instanceof _t.Node&&(0<(s=t.getPorts()).length&&(u=u.concat(s)))),0<u.length&&(s=n.x,e=n.y,this.attachingUtil.attachableTargets=this.attachmentTargetTypes,this.attachingUtil.$E=[t],r=this.attachingUtil.bulkSourcesAttaching(u,t,St.AttachingType.CreateNode,s,e),this.attachingUtil.attachableTargets=null,this.attachingUtil.$E=null),r)return r}var e=t.getRenderingBBox();return e.x+=n.x,e.y+=n.y,this.attachingUtil.reset(St.AttachingType.CreateNode,t),r=(r=this.attachingUtil.retrieveConnectionByAttachedPort(n.x,n.y))||this.attachingUtil.retrieveCandidatesByBoundary(e,n.x,n.y),this.attachingUtil.getSubtype()===St.AttachingType.PortAttachToNodeSide&&(t.setOwner(this.attachingUtil.attachingElement.targetElement),t.setTransformUpdate(!0)),r},
si.prototype.attachingDuringCreation2=function(t,n){var i=t.getOwner();i&&i instanceof _t.Node&&(t.setOwner(null),t.setTransformUpdate(!0));var r={isAttaching:!1,idx:-1};if(this.attachmentTargetTypes&&0<this.attachmentTargetTypes.length&&(this.attachmentSourceTypes&&0<this.attachmentSourceTypes.length||this.attachmentMasters&&0<this.attachmentMasters.length)){var s=[],u=this.attachmentSourceTypes;if(this.attachmentMasters&&0<this.attachmentMasters.length?s=this.attachmentMasters:this.attachmentSourceTypes&&0<this.attachmentSourceTypes.length&&(i=t.getTypeName(),0<=u.indexOf(i)&&s.push(t),0<=u.indexOf("Port")&&t instanceof _t.Node&&(0<(u=t.getPorts()).length&&(s=s.concat(u)))),0<s.length&&(this.attachingUtil.attachableTargets=this.attachmentTargetTypes,this.attachingUtil.$E=[t],h=this.attachingUtil.bulkSourcesAttaching(s,t,St.AttachingType.CreateNode,[t],[n]),r.isAttaching=h.isAttaching,r.idx=h.idx,this.attachingUtil.attachableTargets=null,this.attachingUtil.$E=null),r.isAttaching
)return r}var h=t.getRenderingBBox();return h.x+=n.x,h.y+=n.y,this.attachingUtil.reset(St.AttachingType.CreateNode,t),r.isAttaching=this.attachingUtil.retrieveConnectionByAttachedPort(n.x,n.y),r.idx=0,r.isAttaching||(r.isAttaching=this.attachingUtil.retrieveCandidatesByBoundary(h,n.x,n.y)),this.attachingUtil.getSubtype()===St.AttachingType.PortAttachToNodeSide&&(t.setOwner(this.attachingUtil.attachingElement.targetElement),t.setTransformUpdate(!0)),r},si.prototype.mN=function(t,n){var i=this.attachingUtil.getAttachmentData(),r=i.attachingPoint,s=i.basePoint,i=r.x-s.x,s=r.y-s.y;n.zx(i,s),n.Xx();n=n.Ux();n&&(i=n[0].x,s=n[0].y),this.attachingUtil.showCandidates(this.getFocusElement(t),i,s),this.attachingUtil.highlightCandidates(i,s),this.alignment.isAlignActive()&&this.alignment.rectifyGuideLines(t,i,s)},si.prototype.gN=function(t,n,i,r){var s=this.attachingUtil.getAttachmentData(),u=s.attachingPoint,h=s.basePoint,s=u.x-h.x,u=u.y-h.y;n.Zx(s,u,t),n.Xx();h=n.Ux(t);h&&(s=h[i].x,u=h[i].y),
this.attachingUtil.showCandidates(t[i],s,u),this.attachingUtil.highlightCandidates(s,u),this.alignment.isAlignActive()&&(n=this.previewManager.Yx(),this.alignment.rectifyGuideLines2(t,s,u,n?h[i]:r))},si.prototype.MN=function(t){var n=t.getAnchorPosition(),i=this.attachingUtil.getAttachmentData(),r=i.attachingPoint,i=i.basePoint,s=r.x-i.x,u=r.y-i.y,h=this.dataModelMgr.getSheet().getSession(),r=h.CM(),i=[];return this.dataModelMgr.getRelatedConnectionsToMove(t,i),r.beginTransaction(Dt.messages.ModelChangeMessage),t.setAnchorPosition(n.x+s,n.y+u),i.forEach(function(t){t.move(s,u),h.dM().nx(t),t.setUpToDate(!0)}),this.attachingUtil.showCandidates(t,0,0),this.attachingUtil.highlightCandidates(0,0),r.endTransaction(),{dx:s,dy:u}},si.prototype.pN=function(t){var n=this.MN(t);this.alignment.isAlignActive()&&this.alignment.rectifyGuideLines([t],n.dx,n.dy)},si.prototype.bN=function(t){var n,i=this.MN(t);this.alignment.isAlignActive()&&(n={x:i.dx,y:i.dy},this.alignment.rectifyGuideLines2([t],i.dx
,i.dy,n))},si.prototype.move=function(t,n,i,r,s){this.reset();var u,i=i.clone(),r=r.clone(),h=new St.Point(0,0),n=this.doAlignAndSnap(t,n);r.x+=n.x,r.y+=n.y,h.x=r.x-i.x,h.y=r.y-i.y;i=this.doMoveStrategy(t,h);i&&(h.x=i.x,h.y=i.y,void 0!==i.angle&&(u=i.angle));for(var h=this.doLocationIndicator(h),i=this.dataModelMgr.getPreviewOverlays(),e=i.Bx(),o=0,f=e.length;o<f;o++)e[o]=h.clone();void 0!==u&&i.tE([u]),!s&&this.attachingDuringMove(t)?this.mN(t,i):(i=i.Ux())&&this.alignment.isAlignActive()&&(this.alignment.resetAlignX(),this.alignment.resetAlignY(),this.alignment.rectifyGuideLines(t,i[0].x,i[0].y)),this.dataModelMgr.setAlignmentSmartGuideLines(this.alignment.getGuideLines()),this.dataModelMgr.updateOverlay()},si.prototype.move2=function(t,n,i,r,s){this.reset();for(var u,i=i.clone(),r=r.clone(),h=new St.Point(0,0),e=[],o=0;o<t.length;o++)e.push(h.clone());n=this.doAlignAndSnap2(t,n);r.x+=n.x,r.y+=n.y;for(var f=n.alignElementsX||(n.snapElementX?[n.snapElementX]:[]),a=n.alignElementsY||(
n.snapElementY?[n.snapElementY]:[]),c=[],o=0;o<f.length;o++){var l=f[o];c[o]=l.findLocationReference(t),c[o]<0&&Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.InvalidAlignElement.id,"Fail to find the main align element by finding reference")}for(var v=[],o=0;o<a.length;o++){l=a[o];v[o]=l.findLocationReference(t),v[o]<0&&Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.InvalidAlignElement.id,"Fail to find the main align element by finding reference")}h.x=r.x-i.x,h.y=r.y-i.y;i=this.doMoveStrategy(t,h);i&&(h.x=i.x,h.y=i.y,void 0!==i.angle&&(u=i.angle));for(var w=(h=this.doLocationIndicator(h)).clone(),d=0;d<t.length;d++)(M=t[d].tk()).isLockX?e[d].x=0:e[d].x=w.x,M.isLockY?e[d].y=0:e[d].y=w.y;for(var i=this.dataModelMgr.getPreviewOverlays(),m=i.Bx(),o=0,g=m.length;o<g;o++)m[o]=e[o].clone();void 0!==u&&i.tE([u]);var M=this.attachingDuringMove2(t);if(!s&&M.isAttaching)this.gN(t,i,M.idx,w);else{var p=i.Ux(t);if(p&&this.alignment.isAlignActive()){for(
var b=this.previewManager.Yx(),o=0;o<c.length;o++)this.alignment.rectifyGuideLinesX2(t,p[c[o]].x,p[c[o]].y,b?p[c[o]]:w);for(o=0;o<v.length;o++)this.alignment.rectifyGuideLinesY2(t,p[v[o]].x,p[v[o]].y,b?p[v[o]]:w)}}this.dataModelMgr.setAlignmentSmartGuideLines(this.alignment.getGuideLines()),this.dataModelMgr.updateOverlay()},si.prototype.moveDuringCreation=function(t,n){this.reset();var i,r,s,u=new St.Point(n.x,n.y),h=this.doAlignAndSnap(t,n);u.x+=h.x,u.y+=h.y,this.attachingDuringCreation(t[0],u)?this.pN(t[0]):(r=(s=(i=this.dataModelMgr).getMoveElementsInfo(t,u,!0)).nodeArray,n=s.connectionArray,h=s.nodeOffsetArray,u=s.connectionOffsetArray,(s=this.dataModelMgr.getSheet().getSession().CM()).beginTransaction(Dt.messages.ModelChangeMessage),i.bulkMoveElements(r,h,n,u,!1),s.endTransaction(),this.alignment.isAlignActive()&&this.alignment.rectifyGuideLines(t,0,0)),this.dataModelMgr.setAlignmentSmartGuideLines(this.alignment.getGuideLines()),this.dataModelMgr.updateOverlay()},
si.prototype.moveDuringCreation2=function(t,n){this.reset();var i=new St.Point(n.x,n.y),r=this.doAlignAndSnap2(t,n);i.x+=r.x,i.y+=r.y;var s,u,h=t[0].tk();h.isLockX&&(i.x=0),h.isLockY&&(i.y=0),(h=this.attachingDuringCreation2(t[0],i)).isAttaching?this.bN(t[0]):(n=(u=(s=this.dataModelMgr).getMoveElementsInfo(t,i,!0)).nodeArray,r=u.connectionArray,h=u.nodeOffsetArray,i=u.connectionOffsetArray,(u=this.dataModelMgr.getSheet().getSession().CM()).beginTransaction(Dt.messages.ModelChangeMessage),s.bulkMoveElements(n,h,r,i,!1),u.endTransaction(),this.alignment.isAlignActive()&&this.alignment.rectifyGuideLines2(t,0,0,{x:0,y:0})),this.dataModelMgr.setAlignmentSmartGuideLines(this.alignment.getGuideLines()),this.dataModelMgr.updateOverlay()},si.prototype.getAlignment=function(){return this.alignment},si.prototype.checkMovingDanglingConnection=function(t,n){var i,r,s,u,h,e,o=[],f=t.length,a=!0,c=[];if(0<f){for(var l=0;l<f;l++)t[l]instanceof _t.Connection&&o.push(t[l]);var v=o.length;if(
n instanceof _t.Connection){for(var w=!0,d=0;d<v;d++)if(n===o[d]){w=!1;break}w&&o.push(n)}if(0<(v=o.length)){for(var m=0;m<v;m++)if(s=o[m].getStart(),u=o[m].getEnd(),h=s?s.getOwner():null,e=u?u.getOwner():null,h||e){for(l=0;l<f;l++)if(t[l]===h){i=t[l];break}for(l=0;l<f;l++)if(t[l]===e){r=t[l];break}i&&r?c.push(!0):c.push(!1),r=i=null}else c.push(!1);var g=c.length;if(1<g){for(var M=0;M<g;M++)if(!1===c[M]){a=!1;break}}else a=c[0]}else a=!0}return a},si.prototype.filterMoveElements=function(t){var n=this.dataModelMgr.getSheetSession();if(n){var i=[],r=t.length;if(0<r)for(var s=0;s<r;++s)t[s].getAllowedTransformations()&St.AllowedTransformations.TRANSLATION&&n.ax&St.AllowedTransformations.TRANSLATION&&i.push(t[s])}return i},si.prototype.moveOffset=function(t){var n=this.previewManager.bE;n.Xx();var i=n.getGeometry(),r=n.Bx(),s=n.Ux(i),u=null,h=null;if(t){if(i){var e=i.length;if(0<e)for(var o=0;o<e;o++)if(i[o]===t){u={x:r[o].x,y:r[o].y},h=s[o];break}}}else h=u={x:0,y:0};n={}
;return n.offsetForAlign=h,n.offsetX=u?u.x:0,n.offsetY=u?u.y:0,n},si.prototype.replacePrimaryMoveElement=function(t,n){for(var i=n,r=this.snap.getSnapPitch(),s=n instanceof _t.Connection,u=s?n.getStart():null,h=s?n.getEnd():null,e=u?u.getOwner():null,o=h?h.getOwner():null,f=!1,a=(this.dataModelMgr.getSheet(),t.length),c=[],l=[],v=0;v<a;v++)if(d=!!t[v].kN,(w=t[v]instanceof _t.Connection)&&(c.push(t[v]),t[v]===n&&s&&(f=!0)),!d&&!w){var w=(d=t[v].DE()).x%r,d=d.y%r;if(0==w&&0==d){i=t[v];break}e===t[v]?i=e:o===t[v]?i=o:l.push(t[v])}return i===n&&!f&&s&&(h=l.length,i=0<c.length&&0===h?this.yN(c,r):0<h?this.yN(l,r):t[0]),i},si.prototype.yN=function(t,n){for(var i,r,s=t.length,u=[],h=0;h<s;h++)i=(r=t[h].DE()).x%n,r=r.y%n,r=Math.pow(i,2)+Math.pow(r,2),u.push(r);for(var e,o=0,f=u[0],h=1;h<s;h++)(e=u[h])<f&&(f=e,o=h);return t[o]},si.prototype.checkMoveElementsChained=function(t){var n,i,r,s,u,h,e=!1,o=0,f=0,a=t.length;if(0<a){for(var c=[],l=[],o=0;o<a;o++)t[o]instanceof _t.Connection&&c.push(t[o]
);var v=c.length;if(0<v){for(f=0;f<v;f++)if(n=c[f].getStart(),i=c[f].getEnd(),r=n?n.getOwner():null,s=i?i.getOwner():null,n||i||l.push(!0),r||s){for(o=0;o<a;o++)if(r===t[o]){u=!0;break}for(o=0;o<a;o++)if(s===t[o]){h=!0;break}u&&n||h&&i?l.push(!0):l.push(!1),h=u=null}var w=l.length;if(0<w)for(var e=!0,d=0;d<w;d++)if(!1===l[d]){e=!1;break}}else e=!0}return e};var hi=["mouseenter","mousedown","mousemove","mouseup","mousewheel","mouseleave","click","dblclick","keydown","keyup","selectstart","touchstart","touchmove","touchend","pointerdown","pointermove","pointerup","dragenter","drop","dragover","dragleave","DOMMouseScroll","wheel"];function ei(){this.transform=null,this.width=0,this.height=0,this.path=[]}function oi(t){Dt.common.ObjectBase.call(this),this.from=new ei,this.to=new ei,this.renderer=null,this.xN=t}function fi(t){oi.call(this,t),this.EN=function(t,n,i,r){var s=n.x-t.x,n=n.y-t.y,s=t.x+i*s,n=t.y+i*n;r.push(new St.Point(s,n))}}function ai(t){oi.call(this,t)}function ci(){
this.CN={}}function li(t){this.NN=t,this.iM=[],this.rM=[],this.nM=[]}function vi(n){this.renderer=n;var h=0,i={createdList:[],modifiedList:[],overlayList:[]},e=[];this.ON=function(t){h=t},this.DN=function(t){e=e.concat(t)},this._N=function(){e.forEach(function(t){t.setRender(n)})},this.SN=function(t){var n=this;t&&(t.createdList&&t.createdList.forEach(function(t){i.createdList.push({candidate:t.candidate,inScreen:t.inScreen}),n.DN(t.candidate.TN(n))}),t.modifiedList&&t.modifiedList.forEach(function(t){i.modifiedList.push({candidate:t.candidate,inScreen:t.inScreen}),n.DN(t.candidate.TN(n))}),t.overlayList&&t.overlayList.forEach(function(t){i.overlayList.push({candidate:t.candidate}),n.DN(n.renderer.TN(t.candidate))})),n._N()},this.AN=function(r,t){t.length&&t.forEach(function(t){var n=t.candidate.getSymbols?t.candidate.getSymbols():null;if(n&&n.length)for(var i=0;i<n.length;i++)r.removeSymbol(n[i])})},this.RN=function(){n.PN={},e=[],i={createdList:[],modifiedList:[],overlayList:[]}},
this.HN=function(t,n,i){var r=this;n.LN(),this.IN(function(){n.FN(),r.RN(),n.VN(),i&&i()})},this.preRender=function(){},this.jN=function(t){this.WN();var n=this.zN(i);this.renderer.YN(n),this.BN()},this.BN=function(){i.createdList.forEach(function(t){i.modifiedList.push({candidate:t.candidate,inScreen:t.inScreen})}),i.createdList=[],i.overlayList=[]},this.WN=function(){var t=this.renderer.getManager().getOverlays(n.PN),t=this.ZN(t);return i.overlayList=[],t.forEach(function(t){i.overlayList.push({candidate:t})}),i},this.IN=function(r){var s=null,u=this;window.requestAnimationFrame(function t(n){var n=n-(s=s||n),i=Math.min(n/h,1);e.forEach(function(t){t.animate(i)}),u.jN(n),n<h?window.requestAnimationFrame(t):r()})},this.createConnectionAnimator=function(t){return new fi(t)},this.createSymbolAnimator=function(t){return new ai(t)}}function wi(t){oi.call(this,t)}function di(t,n,i){Dt.common.IdentifiableObject.call(this),i.UN=this;var r=i,s=null;this.PN={},this.GN={},this.XN=null,
this.$N=null,this.getContext=function(){return r},this.qN=function(t){r=t},this.setVisitor=function(t){s=t},this.getVisitor=function(){return s},this.getCanvas=function(){return this.getContext().getCanvas()},this.getManager=function(){return t},this.getSession=function(){return n}}function mi(t,n,i){di.call(this,t,n,i),this.renderingMode=St.RenderingMode.Canvas,this.KN=n,this.JN=[],this.QN=null}oi.prototype.tO=function(t,n,i,r){this.updateRenderStyle(t,n,i,r)},oi.prototype.initializeAnimationStyle=function(t){t.nO=new ei},oi.prototype.setRender=function(t){this.renderer=t},Dt.common.ObjectBase.inheritedBy(oi),fi.prototype.updateRenderStyle=function(t,n,i){var r=this.xN;r.Fk&&r.Fk(i),r.QC.path=i},fi.prototype.updatePath=function(t){var n=[],i=this.to.path,r=this.from.path,s=r.length,u=i.length;if(s<u&&0!=s)for(var h=r[s-1].x,e=r[s-1].y,o=u-s,f=0;f<o;f++)r.push(new St.Point(h,e));for(f=0;f<u;f++)null==r[f]&&r.push(new St.Point(0,0)),this.EN(r[f],i[f],t,n);if(u<s)for(o=s-u,f=0;f<o;f++
)this.EN(r[f+u],i[u-1],t,n);return n},fi.prototype.setFromRenderStyle=function(t){this.from.path=t.path},fi.prototype.animate=function(t){t=this.updatePath(t);this.tO(null,null,t)},oi.inheritedBy(fi),ai.prototype.updateRenderStyle=function(t,n){var i=this.xN;i.QC.transform=t,i.QC.width=n.targetWidth,i.QC.height=n.targetHeight},ai.prototype.updateTransform=function(t){var n=this.to,i=n.transform.clone(),r=this.from,s=null;r.transform?s=r.transform.clone():(s=n.transform.clone(),(r=this.xN.getOwner().getOwningSheet().getSelectedElements())[0]&&r[0]!==this.xN&&(u=r[0].getRenderingPosition(),s.m[6]=u.x,s.m[7]=u.y),this.from.transform=s);var u=(i.m[6]-s.m[6])*t,t=(i.m[7]-s.m[7])*t,n=n.transform.clone();return n.m[6]=s.m[6]+u,n.m[7]=s.m[7]+t,n},ai.prototype.updateSize=function(t){var n=this.to.width-this.from.width,i=this.to.height-this.from.height;return{targetWidth:this.from.width+n*t,targetHeight:this.from.height+i*t}},ai.prototype.setFromRenderStyle=function(t){this.from.height=t.height,
this.from.width=t.width,this.from.transform=t.transform},ai.prototype.animate=function(t){var n=this.updateTransform(t),t=this.updateSize(t);this.tO(n,t)},oi.inheritedBy(ai),ci.prototype.iO=function(t,n,i){var r=this.rO(n);switch(i){case"add":r.iM.push(t);break;case"remove":r.rM.push(t);break;case"update":r.nM.push(t);break;default:Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,"Invalid change type: "+i)}return r},ci.prototype.rO=function(t){var n=this.CN,i=n[t.guid];return i||(i=new li(t),n[t.guid]=i),i},ci.prototype.sO=function(){return this.CN},ci.prototype.uO=function(){var t,n,i=this.CN,r={};for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&(n=i[t],r[t]={tarCanvas:n.NN,createdList:n.iM,modifiedList:n.nM});return r},ci.prototype.hO=function(){var t,n,i=new ci,r=i.CN,s=this.CN;for(t in s)Object.prototype.hasOwnProperty.call(s,t)&&(n=s[t],r[t]={NN:n.NN,iM:n.iM.slice(0),rM:n.rM.slice(0),nM:n.nM.slice(0)});return i},vi.prototype.zN=function(t){
for(var n=t.createdList,i=[{list:t.modifiedList,changeType:"update"},{list:n,changeType:"add"},{list:t.overlayList,changeType:"add"}],r=this.renderer.getCanvas(),s=new ci,u=0,h=i.length;u<h;u++)for(var e=i[u],o=e.list,f=e.changeType,a=0,c=o.length;a<c;a++){var l=o[a],v=r.eO(l.candidate);s.iO(l,v,f)}return s.uO()},vi.prototype.ZN=function(t){for(var n=this.renderer,i=n.getSession(),r={},s=0,u=t.length;s<u;s++){var h=t[s],e=h.getRenderCanvas(i);r[e.guid]||(r[e.guid]={rcCanvas:e,objList:[]}),r[e.guid].objList.push(h)}var o,f,a=[];for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&((f=r[o]).objList=n.oO(f.objList,f.rcCanvas),n.fO(f.rcCanvas,f.objList),a=a.concat(f.objList));return a},wi.prototype.updateRenderStyle=function(t,n,i,r){var s=this.xN;this.renderer.PN[s.guid]=r.clone()},wi.prototype.updateRect=function(t){var n=this.to.clone(),i=this.from,r=n.x-i.x,s=n.y-i.y,u=n.width-i.width,h=n.height-i.height,n=this.to.clone();return n.x=i.x+r*t,n.y=i.y+s*t,n.width=i.width+u*t,
n.height=i.height+h*t,n},wi.prototype.setFromBBox=function(t){this.from.x=t.x,this.from.y=t.y,this.from.width=t.width,this.from.height=t.height},wi.prototype.animate=function(t){t=this.updateRect(t);this.tO(null,null,null,t)},oi.inheritedBy(wi),di.prototype.clear=function(){var t=this.getContext();t&&t.clear()},di.prototype.destroy=function(){this.clear();var t=this.getContext();t&&(t.destroy(),this.qN(null))},di.prototype.renderElements=function(t,n){for(var i=[St.CanvasOption.ElementCanvas,St.CanvasOption.SheetFeatureCanvas],r=0,s=i.length;r<s;r++){var u,h=this.aO(i[r]);for(u in h)if(Object.prototype.hasOwnProperty.call(h,u)){var e=h[u],o=e.rcCanvas,e=e.objList;if(!n||n(o))for(var f=this.fO(o,e),a=0,c=f.length;a<c;a++){var l=f[a];l.cO()||this.renderElementsOnCanvas(t,l)}}}},di.prototype.renderPreviewOverlayForImmediateUpdate=function(){var t,n=this.getManager();!this.getSession().getSheetConfigurationData().transformImmediateUpdate||(t=n.getPreviewOverlays())&&(n=this.getContext(),
t.render(n))},di.prototype.renderOverlays=function(t){this.renderPreviewOverlayForImmediateUpdate();var n,i=this.aO(St.CanvasOption.OverlayCanvas);for(n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var r=i[n],s=r.rcCanvas,r=r.objList;if(!this.lO(s,r))for(var u=this.fO(s,r),h=0,e=u.length;h<e;h++){var o=u[h];o.cO()||this.renderOverlaysOnCanvas(t,o)}}},di.prototype.renderOverlaysOnCanvas=function(t,h){var e=this.getContext(),o=(this.getManager(),this.getSession()),f=this;St.CommonUtil.waitUntil(function(){return!0!==e.isRendering()},function(){var t,n=h.vO(),i={createdList:[],modifiedList:[],overlayList:[]};if(n){for(var r=n.length,s=0;s<r;s++){var u=n[s];u.isHiddenByLod(o)||i.overlayList.push({candidate:u})}f.wO(e,i,o,h)}!o||(t=o.getPerformanceCounter())&&t.postRendering()})},di.prototype.TN=function(t){var n=[],i=this.GN[t.guid];return i&&((n=new wi(t)).setFromBBox(i),n.to=this.PN[t.guid]),n},di.prototype.dO=function(t){for(var n=this.getManager().getHighlightedElements(),
i=n.length,r=0;r<i;++r){var s=n[r].getBBox();s&&(t[n[r].guid]=s.clone())}},di.prototype.wO=function(t,n,i,r){i.mO()?this.gO():(n=n.overlayList,this.MO(n,r))},di.prototype.gO=function(){var t=this.getManager();this.dO(this.PN);for(var n=[],i=t.getHighlightedElements(),r=i.length,s=0;s<r;++s)n.push({candidate:i[s]});t={overlayList:n};this.pO().SN(t)},di.prototype.ik=function(){},di.prototype.MO=function(t,n){var i=this,r=this.getContext();r.beginRender(n,!0,null),t.length&&t.forEach(function(t){t.candidate.render(r,i.PN)}),r.endRender()},di.prototype.gE=function(){this.GN={},this.dO(this.GN),this.getContext().bO()},di.prototype.pO=function(){var t=this.XN;t||(this.XN=new vi(this),t=this.XN);var n=this.getSession().mO();return n&&t.ON(n),t},di.prototype.kO=function(t,n){for(var i in n){var r;Object.prototype.hasOwnProperty.call(n,i)&&((i=(r=n[i]).NN).getCanvasOption()!==St.CanvasOption.ElementCanvas&&i.getCanvasOption()!==St.CanvasOption.SheetFeatureCanvas||i.cO()||this.yO(t,r))}},
di.prototype.renderViewFeatures=function(t){var n,i=this.aO(St.CanvasOption.ViewFeatureCanvas);for(n in i)if(Object.prototype.hasOwnProperty.call(i,n))for(var r=i[n],s=r.rcCanvas,r=r.objList,u=this.fO(s,r),h=0,e=u.length;h<e;h++){var o=u[h];o.cO()||this.renderViewFeaturesOnCanvas(t,o)}},di.prototype.fO=function(t,n){var i=this.getCanvas();return i.xO(t),this.EO(n,t),i.CO(t)},di.prototype.render=function(t){},di.prototype.setSize=function(t,n){this.getContext().setSize(t,n)},di.prototype.fN=function(){return this.getSession().fN()},di.prototype.Cx=function(t){return this.getContext().Cx(t)},di.prototype.NO=function(t){var n,i=this.getCanvas(),r=new ci,s=!1;for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)){for(var u=t[n],h=u.NN,e=u.nM,o=0,f=(e=this.oO(e,h)).length;o<f;o++){var a=e[o],c=i.eO(a);r.iO(a,c,"update"),s=!0}for(var l=u.rM,o=0,f=l.length;o<f;o++){var v,a=l[o];(c=i.OO(a))||(v=i.CO(h))&&0<v.length&&(c=v[0]),c&&(r.iO(a,c,"remove"),s=!0)}var w=u.iM,w=this.oO(w,h);this.EO(w,h)
;for(o=0,f=w.length;o<f;o++){a=w[o],c=i.eO(a);r.iO(a,c,"add"),s=!0}}return s?r.sO():null},di.prototype.EO=function(t,n){if(!(t.length<1)){var i=this.getCanvas(),n=i.CO(n);1!==n.length&&Dt.DebugFlags.CheckRendering&&window.console&&window.console.error("There should be only one plot-canvas here.");for(var r=n[0],s=0,u=t.length;s<u;s++){var h=t[s],e=i.eO(h);e&&(i.OO(h,e),Dt.DebugFlags.CheckRendering&&window.console&&window.console.log("obj has already allocated plot canvas.")),i.DO(h,r)}}},di.prototype.aO=function(t){for(var n={},i=this.fN().oN(t),r=0,s=i.length;r<s;r++){var u=i[r],h=u._O(),h=this.oO(h,u);n[u.guid]={rcCanvas:u,objList:h}}return n},di.prototype.SO=function(t){this.$N=t},di.prototype.oO=function(t,n){return this.$N?this.$N(t,n,this):t},di.prototype.TO=function(){var t=this.getManager().getSheetToScreenTransform();this.getContext().setSheetToScreenTransform(t)},di.prototype.AO=function(t){var n=t.updateFlags,i=0<(n&Dt.RenderUpdateFlags.Viewport),r=0<(
n&Dt.RenderUpdateFlags.ExportStart)||0<(n&Dt.RenderUpdateFlags.ExportEnd);return{RO:i&&!t.isAnimation,PO:i||r,HO:(i||0<(n&Dt.RenderUpdateFlags.Features))&&!t.isAnimation,LO:!0}},di.prototype.lO=function(t,n){return!(0!==n.length||!this.getCanvas().IO(t))},di.prototype.FO=function(t,n,i,r,s){if(i&&s.ek(r,t))return!1;return s.iN.hE(n,t)},di.VO=function(t,n){t=t.getSession();di.updateLodStatus(t,n.lodType)},di.updateLodStatus=function(t,n){n=t.jO(n);return t.WO(n.currentLod),t.zO(n),n},di.prototype.YO=function(t){var n=this.getContext();switch(t.action){case"add":n.BO(t.targetRcCanvas,t.preRcCanvas),t.targetRcCanvas.ZO===St.ElementCoordinateMode.Device&&(t.targetRcCanvas.aN=this.UO());break;case"remove":n.GO(t.targetRcCanvas);break;case"hide":n.XO(t.targetRcCanvas);break;case"show":n.$O(t.targetRcCanvas,t.preRcCanvas);break;case"reorder":n.qO(t.targetRcCanvas,t.preRcCanvas);break;default:Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,
"Invalid Action type: "+t.action)}},di.hookCanvasEvents=function(t,n){t.diagramManager=n,t.hookDfRawEvents();for(var i=hi.length,r=0;r<i;r++){var s=hi[r];t.KO(s,function(t,n){return function(){if(n)return n.apply(t,arguments)}}(t,t["__"+s]))}},Dt.common.IdentifiableObject.inheritedBy(di),mi.prototype.JO=function(){return this.renderingMode},mi.prototype.preRenderElements=function(t){if(t)for(var n=this.getContext(),i=t.length,r=0;r<i;r++){var s=t[r];s.isVisible()&&(!1===n.isRenderStyleUpToDate()&&s.ME(n),s.ik(n))}},mi.prototype.QO=function(t){for(var n=this.getSession(),i=this.getContext(),r=n.ok(),s=!(r.currentLod===St.LODType.None),u=new St.Rect(0,0,i.width(),i.height()),h=t.length,e=0;e<h;e++){var o=t[e],f=this.FO(o,u,s,r,n);o.isVisible()&&f&&o.render(i)}},mi.prototype.getVisibleElementsInViewport=function(){var t=this.getManager().getVisibleElements(null),i=[];return{labels:t.filter(function(t){var n=t.kN;return n||i.push(t),n}),otherElements:i}},
mi.prototype.renderElementsOnCanvas=function(t,n){var i=this.getContext(),r=n.vO();i.beginRender(n,!1,null),this.preRenderElements(r),this.JN.push({NN:n,t5:r})},mi.prototype.renderPreviewOverlayForImmediateUpdate=function(){var t=this.getManager();if(this.getSession().getSheetConfigurationData().transformImmediateUpdate){var t=t.getPreviewOverlays(),n=t?t.previewManager.qx:null,i=n?n.length:0;if(!(i<1)){for(var r,s,u=this.getContext(),h=this.getCanvas(),e={},o=0;o<i;o++){var f,a=n[o];(f=h.eO(a))&&(e[f.guid]=f)}for(r in t.ik(),e)Object.prototype.hasOwnProperty.call(e,r)&&(s=(f=e[r]).vO(),u.beginRender(f,!1,null),this.preRenderElements(s),this.JN.push({NN:f,t5:s}));t.gE()}}},mi.prototype.renderViewFeaturesOnCanvas=function(t,n){var i=n.vO();this.JN.push({NN:n,t5:i})},mi.prototype.renderOverlaysOnCanvas=function(t,n){var i,r=this.getContext(),s=this.getManager();this.getSession().getSheetConfigurationData().transformImmediateUpdate||(u=(i=s.getPreviewOverlays())?i.previewManager.qx:null
)&&i.getGeometry()&&(i.ik(),this.preRenderElements(u),i.gE());var u=n.vO();r.beginRender(n,!1,null),this.preRenderOverlays(u,i),this.getSession().mO()?this.gO():this.JN.push({NN:n,t5:u})},mi.prototype.preRenderOverlays=function(t,n){if(t&&!(t.length<1))for(var i=this.getContext(),r=t.length,s=0;s<r;s++){var u=t[s];u!==n&&u.ik(i,this.PN)}},mi.prototype.yO=function(t,n){var i=this.getContext(),r=n.NN,n=r.vO();St.CommonUtil.sortSheetElements(n),i.beginRender(r,!1,null),this.preRenderElements(n),this.getSession().mO()?this.n5(n):this.JN.push({NN:r,t5:n})},mi.prototype.n5=function(t){for(var n=[],i=0,r=t.length;i<r;i++){var s=t[i];n.push({candidate:s})}var u={createdList:n};this.pO().SN(u)},mi.prototype.render=function(t){var n=this.getVisitor().i5();this.clearVisitor(),this.renderRun(t,n)},mi.prototype.renderRun=function(t,n){var i=this.KN,r=this.getContext(),s=this.AO(t);s.RO&&this.TO(),t.isAnimation&&t.fitAnimation&&this.getManager().getAnimation().doAnimate([],r,this.renderingMode),
t.updateFlags&Dt.RenderUpdateFlags.Viewport&&(r.isStyleUpToDate=!0,i.getSymbolCache().clearRenderingSymbolCacheCanvas());n=this.NO(n);n&&(r.isStyleUpToDate=!1,this.kO(t,n)),s.HO&&this.renderViewFeatures(t),s.PO&&(r.isStyleUpToDate=!1,this.renderElements(t)),s.LO&&this.renderOverlays(t),i.mO()?(t=this.gE.bind(this),this.pO().HN(r,i,t)):!0!==r.isRendering()&&this.processCanvasPool()},mi.prototype.clearVisitor=function(){this.getVisitor().clear()},mi.prototype.processCanvasPool=function(){var t=this.getContext();if(t){for(var n,i=this.KN,r=this.JN,s=0,u=r.length;s<u;s++){var h=r[s],e=h.NN,o=h.t5;switch(e.getCanvasOption()){case St.CanvasOption.ViewFeatureCanvas:t.beginRender(e,!0,null);var f=o;if(f&&0<f.length)for(var a=0,c=f.length;a<c;a++)f[a].render(t);t.endRender();break;case St.CanvasOption.ElementCanvas:case St.CanvasOption.SheetFeatureCanvas:t.beginRender(e,!0,null),this.QO(o,e),t.endRender();break;case St.CanvasOption.OverlayCanvas:t.beginRender(e,!0,null);var l=o;if(l)for(
var v=l.length,a=0;a<v;a++){var w=l[a];w.isHiddenByLod(i)||w.render(t,this.PN)}t.endRender()}}this.JN.length=0,t.isStyleUpToDate=!1,i.mO()||this.gE(),this.QN&&(this.QN(),this.QN=null),!i||(n=i.getPerformanceCounter())&&n.postRendering()}},mi.prototype.EO=function(t,n){n.r5()?this.s5(t,n):di.prototype.EO.call(this,t,n)},mi.prototype.s5=function(t,n){if(!(t.length<1)){var i=this.getCanvas();t.sort(St.CommonUtil.compareElementsByCachedZDepth);for(var r=0,s=t.length;r<s;r++){var u=t[r],h=i.eO(u);h&&(i.OO(u,h),Dt.DebugFlags.CheckRendering&&window.console&&window.console.log("obj has already allocated plot canvas."));h=gi(u),h=h?i.eO(h):null;h?i.DO(u,h):(h=(h=this.u5(n))||i.h5(n),i.DO(u,h))}}},mi.prototype.u5=function(t){for(var n=this.getCanvas().CO(t),i=this.KN.e5,r=null,s=n.length,u=s-1;0<=u;--u){var h=n[u],e=h.o5();if(0<e){r=e<i?h:u+1<=s-1?n[u+1]:null;break}r=h}return r};var gi=function(t){var n=t.getOwner();return n&&n instanceof _t.SheetElement?gi(n
)||n.isGroupingAllowed&&n.isGroupingAllowed()&&n||null:t};function Mi(){this.f5=[{id:St.CursorID.PAN,active:!1},{id:St.CursorID.BUSY,active:!1},{id:St.CursorID.HELP,active:!1},{id:St.CursorID.VIEWONLY,active:!1},{id:St.CursorID.UNAVAIL,active:!1},{id:St.CursorID.ERESIZE,active:!1},{id:St.CursorID.NERESIZE,active:!1},{id:St.CursorID.NWRESIZE,active:!1},{id:St.CursorID.NRESIZE,active:!1},{id:St.CursorID.SWRESIZE,active:!1},{id:St.CursorID.SERESIZE,active:!1},{id:St.CursorID.SRESIZE,active:!1},{id:St.CursorID.WRESIZE,active:!1},{id:St.CursorID.ROTATECLICK,active:!1},{id:St.CursorID.ROTATEHOV,active:!1},{id:St.CursorID.MOVEHSEG,active:!1},{id:St.CursorID.MOVEVSEG,active:!1},{id:St.CursorID.MOVENWSEG,active:!1},{id:St.CursorID.MOVENESEG,active:!1},{id:St.CursorID.MOVECEND,active:!1},{id:St.CursorID.IMMEDIATE,active:!1},{id:St.CursorID.CONNECTIONLINKSTART,active:!1},{id:St.CursorID.CONNECTIONNODESIDESTART,active:!1},{id:St.CursorID.CONNECTIONSEGMENTSTART,active:!1},{id:St.CursorID.LINK,
active:!1},{id:St.CursorID.ATTACH,active:!1},{id:St.CursorID.TEE,active:!1},{id:St.CursorID.BRKLINK,active:!1},{id:St.CursorID.CREATECON,active:!1},{id:St.CursorID.EAC,active:!1},{id:St.CursorID.TEXTEDIT,active:!1},{id:St.CursorID.DRAGMOVE,active:!1},{id:St.CursorID.DRAGCOPY,active:!1},{id:St.CursorID.DROPREJECT,active:!1},{id:St.CursorID.MOVEREJECT,active:!1},{id:St.CursorID.MOVE,active:!1},{id:St.CursorID.SINGLESELECT,active:!1},{id:St.CursorID.SELECT,active:!1},{id:St.CursorID.PRESELECT,active:!1},{id:St.CursorID.PREMULTISELECT,active:!1},{id:St.CursorID.MULTISELECT,active:!1},{id:St.CursorID.RECTZOOM,active:!1},{id:St.CursorID.ZOOM,active:!1},{id:St.CursorID.CREATENODE,active:!1},{id:St.CursorID.RECTSELECT,active:!1},{id:St.CursorID.DEFAULT,active:!0}],this.initialize()}function pi(t,n,i,r,s,u,h,e,o){Dt.EventArgs.call(this),this.TM(u,h,e);var f=t,a=n,c=i,l=r,v=s,w=!1===o?!1:!0;this.getButton=function(){return f},this.getScreenLoc=function(){return a},this.getRelativeLoc=function(){
return c},this.getSegmentId=function(){return v},this.getSheetElement=function(){return l},this.getIsHold=function(){return w}}function bi(t,n,i,r,s,u,h,e){Dt.EventArgs.call(this),this.TM(u,h,e);var o=t,f=n,a=i,c=r,l=s;this.getButton=function(){return o},this.getScreenLoc=function(){return f},this.getRelativeLoc=function(){return a},this.getSegmentId=function(){return l},this.getSheetElement=function(){return c}}function ki(t,n,i,r,s,u){Dt.EventArgs.call(this),this.TM(i,r,s);var h=t,e=n,o=!1===u?!1:!0;this.getButton=function(){return h},this.getScreenLoc=function(){return e},this.getIsHold=function(){return o}}function yi(){var m=!1,g=!1,M=!1,p=0,b=0,k=0,y=0,x=0,E=-1,C=null,N=null,O=null,D=!1;this.bindMouseEvent=function(t,n){N=(C=t).diagramManager;var i=t.getInteractionCanvas(),r=window.PointerEvent?"pointerdown":"mousedown",s=window.PointerEvent?"pointerup":"mouseup",c=function(t){var n=t.originalEvent;return"touch"===(n||t).pointerType},l=function(){return!N.getSheet().getSession(
).a5},v=function(t){var n;!N||(n=N.getSheetSession())&&(n.c5.ctrlKey=t.ctrlKey,n.c5.shiftKey=t.shiftKey,n.c5.altKey=t.altKey)},w=!1,d=function(t){t.preventDefault(),document.removeEventListener("contextmenu",d),w=!1};Q(i).on(r,n,function(t){var n,i;!c(t)&&l()&&(M=D=!1,i=t.originalEvent,b=(i||t).pageX,k=(i||t).pageY,O=N.getSheetConfigurationData(),n=N.getHoveredElements(),i=O.clickSpeed,m=setTimeout(function(){v(t),M=!0,C.setCurrentEventType("SDF_mousedownhold"),C.setCurrentHoveredElements(n),C.execRawEventHandlers(t)||C.execEventHandlers(t),C.changePreferredCursor()},i),w||(document.addEventListener("contextmenu",d),w=!0))}),Q(i).on("click contextmenu",n,function(t){var n,i,r,s,u,h,e,o,f,a;!c(t)&&l()&&(w&&(document.removeEventListener("contextmenu",d),w=!1),O=N.getSheetConfigurationData(),(D||O.preventBrowserContextMenuDefault)&&(t.preventDefault(),D=!1),clearTimeout(m),n=(new Date).getTime()-p,e=N.getSheetSession(),i=O.clickTolerance,r=s=O.doubleClickSpeed,s=0<s?s:300,u=t.pageX,
a=t.pageY,v(t),h=e.getMousePositionOnScreen(),t.screenX==h.x&&t.screenY==h.y||(o=C.offset(),h=new St.Point(u-o.left,a-o.top),o=new St.Point(t.screenX,t.screenY),e.setMousePostion(h,o),(e=N.getScreenToSheetTransform())&&(o=N.getCursorPosAndKeyStatus(t),N.setHoverHighlightedElement(e.transformPoint(h),o))),f=N.getHoveredElements(),M?M=!1:n<s&&Math.abs(u-y)<i&&Math.abs(a-x)<i&&t.button===E?(clearTimeout(g),C.setCurrentEventType("SDF_dblclick"),C.setCurrentHoveredElements(f),C.execRawEventHandlers(t)||C.execEventHandlers(t)):(Math.abs(u-b)<i&&Math.abs(a-k)<i&&(r<=0?(C.setCurrentEventType("SDF_click"),C.setCurrentHoveredElements(f),C.execRawEventHandlers(t)||C.execEventHandlers(t)):g=setTimeout(function(){C.setCurrentEventType("SDF_click"),C.setCurrentHoveredElements(f),C.execRawEventHandlers(t)||C.execEventHandlers(t)},r)),y=u,x=a,a=new Date,p=a.getTime(),E=t.button))}),Q(i).on(s,n,function(t){!c(t)&&l()&&M&&(v(t),C.setCurrentEventType("SDF_mousedownholdup"),C.execRawEventHandlers(t
)||C.execEventHandlers(t),C.changePreferredCursor())});function u(t){v(t),C.setCurrentEventType("mouseup"),C.execRawEventHandlers(t),C.execEventHandlers(t)}var h=!1;Q(i).on("mousedown",n,function(t){l()&&(h||(document.addEventListener("mouseup",u),h=!0))});var e=function(){var t=document.activeElement;if(t){var n=t.tagName;if("INPUT"===n||"TEXTAREA"===n||"SELECT"===n)return!0;if(t.getAttribute("contentEditable"))return!0}return!1};Q(i).on("focusin focusout",n,function(t){N&&(N.beginTransaction(),N.getSheetConfigurationData().contextData.setTextEditMode(e()),N.endTransaction())}),t.bind("mouseup",function(t){h&&(document.removeEventListener("mouseup",u),h=!1)})},this.sendMouseEvent=function(t,n,i){var r=t.button,s=N.getSheet();if(s){var u=s.getSession(),h=(u.CM(),t.pageX),e=t.pageY,o=new St.Point(t.screenX,t.screenY),s=C.offset(),f=new St.Point(h-s.left,e-s.top),h=null,a=-1,e=f=N.getScreenToSheetTransform().transformPoint(f);if(h=i&&1<=i.length?i[i.length-1]:h){s=h.getRenderingPosition(
);if(h.nC)if(h.vk()){i=h.getRenderingBBox();s=new St.Point(i.x,i.y)}else{for(var c=h.nC(),l=null,v=0;v<c.length;v++)if(c[v].select(f,5)){l=c[a=v];break}-1<a&&(s=l.getGeometry().start)}s&&(e.x=f.x-s.x,e.y=f.y-s.y,(d=h.getXform())&&!d.isIdentity()&&(e=d.invert().transformPoint(e)))}var w,d=null,o=[o.x,o.y],e=[e.x,e.y];"sdf_click"===n?(w=new S(r,o,e,h,a,t.altKey,t.ctrlKey,t.shiftKey),d=new Dt.messages.EventMessage(w,_.OnMouseClick)):"sdf_dblclick"===n?(w=new bi(r,o,e,h,a,t.altKey,t.ctrlKey,t.shiftKey),d=new Dt.messages.EventMessage(w,_.OnMouseDoubleClick)):"sdf_mousedownhold"===n?(w=new pi(r,o,e,h,a,t.altKey,t.ctrlKey,t.shiftKey),d=new Dt.messages.EventMessage(w,_.OnMouseDown)):"sdf_mouseholdup"===n&&(w=new ki(r,o,t.altKey,t.ctrlKey,t.shiftKey),d=new Dt.messages.EventMessage(w,_.OnMouseUp));d=u.CM().BM(d);if(d)return t&&t.preventDefault(),"sdf_mouseholdup"!==n&&"sdf_mousedownhold"!==n||(D=d),!0}}}function xi(t,n,i,r){Dt.EventArgs.call(this);var s=t||[],u=n||[],h=i,e=r
;this.getScreenLoc=function(){return s},this.getRelativeLoc=function(){return u},this.getSegmentId=function(){return e},this.getSheetElement=function(){return h}}function Ei(){var f=null,a=null,c=!1,l=0,v=0,w=0,d=0,m=0,g=0,M=0,p=0,b=null,k=null,y=null,x=!0;this.bindTouchEvent=function(t,n){k=(b=t).diagramManager,y=k.getSheetConfigurationData();var i=t.getInteractionCanvas(),e=0,o=!1;Q(i).on("touchstart pointerdown",n,function(n){if("mouse"!==n.originalEvent.pointerType&&!o){x=!(c=!1);var t=new Date;l=t.getTime();var i=b.offset();if("touch"===n.originalEvent.pointerType){if(1!==++e)return void(f&&clearTimeout(f));v=n.pageX-i.left,w=n.pageY-i.top}else{t=n.originalEvent.touches;if(1!==t.length)return;v=t[0].pageX-i.left,w=t[0].pageY-i.top}var i=y.touchSettings.holdTime,r=k.getHoveredElements();f=setTimeout(function(){var t;x&&(t=k.getScreenToSheetTransform().transformPoint(new St.Point(v,w)),k.getOverlayByTouch(t)||(c=!0,b.setCurrentEventType("SDF_touchhold"),b.setCurrentHoveredElements(r
),b.execRawEventHandlers(n)||b.execEventHandlers(n)))},i),o=!0}}),Q(i).on("touchmove pointermove",n,function(t){var n,i;"mouse"!==t.originalEvent.pointerType&&(i=b.offset(),t=(n="touch"===t.originalEvent.pointerType?t:t.originalEvent.touches[0]).pageX-i.left,n=n.pageY-i.top,i=y.touchSettings,x=Math.abs(v-t)<=i.jitterTolerance&&Math.abs(w-n)<=i.jitterTolerance)}),Q(i).on("touchend pointerup",n,function(t){if(o&&(o=!1,"mouse"!==t.originalEvent.pointerType)){var n=(new Date).getTime(),i=n-p,r=b.offset();if("touch"===t.originalEvent.pointerType){if(0!==--e)return void(e=0);d=t.pageX-r.left,m=t.pageY-r.top}else{var s=t.originalEvent.changedTouches;if(1!==s.length)return;d=s[0].pageX-r.left,m=s[0].pageY-r.top}var u,h=y.touchSettings;x&&n-l<=h.holdTime&&(f&&clearTimeout(f),s=h.jitterTolerance,h=r=h.doubleTapSpeed,r=0<r?r:300,u=k.getHoveredElements(),c?c=!1:i<r&&Math.abs(d-g)<s&&Math.abs(m-M)<s?(clearTimeout(a),b.setCurrentEventType("SDF_dbltap"),b.setCurrentHoveredElements(u),
b.execRawEventHandlers(t)||b.execEventHandlers(t)):(Math.abs(d-v)<s&&Math.abs(m-w)<s&&(h<=0?(b.setCurrentEventType("SDF_tap"),b.setCurrentHoveredElements(u),b.execRawEventHandlers(t)||b.execEventHandlers(t)):a=setTimeout(function(){b.setCurrentEventType("SDF_tap"),b.setCurrentHoveredElements(u),b.execRawEventHandlers(t)||b.execEventHandlers(t)},h)),g=d,M=m,p=n))}});function r(t){b.setCurrentEventType("touchend"),b.execRawEventHandlers(t),b.execEventHandlers(t)}var s=!1;Q(i).on("touchstart",n,function(t){s||(document.addEventListener("touchend",r),s=!0)}),t.bind("touchend",function(t){s&&(document.removeEventListener("touchend",r),s=!1)})},this.sendTouchEvent=function(t,n,i){var r=k.getSheet();if(r){var s=r.getSession(),u=(s.CM(),"touch"===t.originalEvent.pointerType?t:t.originalEvent.changedTouches[0]),h=u.pageX,e=u.pageY,o=u.screenX,r=u.screenY,u=b.offset(),f=new St.Point(h-u.left,e-u.top),f=k.getScreenToSheetTransform().transformPoint(f),u=null;i&&1<=i.length&&(u=i[i.length-1])
;var a=-1,i=f.clone(),c=y.touchSettings;if(u){var l=u.getRenderingPosition();if(u.nC){for(var v=u.nC(),w=null,d=0;d<v.length;d++)if(v[d].select(f,c.selectionRadius)){w=v[a=d];break}0<=a&&(l=w.getGeometry().start)}l&&(i.x=f.x-l.x,i.y=f.y-l.y)}var m,l=null,r=[o,r],i=[i.x,i.y];if("sdf_tap"===n?(m=new H(r,i,u,a),l=new Dt.messages.EventMessage(m,_.OnTap)):"sdf_dbltap"===n?(m=new xi(r,i,u,a),l=new Dt.messages.EventMessage(m,_.OnDoubleTap)):"sdf_touchhold"===n&&(m=new L(r,i,u,a),l=new Dt.messages.EventMessage(m,_.OnTouchHold)),s.CM().BM(l))return t&&t.preventDefault(),!0}}}mi.prototype.l5=function(t){this.KN.getSymbolCache().clearRenderingSymbolCache();for(var n=this.getContext(),i=this.getCanvas(),r=i.Nx(St.CanvasOption.SheetFeatureCanvas),s=(s=i.Nx(St.CanvasOption.ElementCanvas)).concat(r),u=0;u<s.length;++u){var h=s[u],e=h.vO();this.JN.push({NN:h,t5:e}),n.isStyleUpToDate=h.v5()!==St.ElementCoordinateMode.Device,n.beginRender(h,!1,null),this.preRenderElements(e)}this.renderOverlays(),
this.QN=t,!0!==n.isRendering()&&this.processCanvasPool()},mi.prototype.YN=function(t){var n,i,r,s=this.getContext();for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r=(i=t[n].tarCanvas).vO(),this.JN.push({NN:i,t5:r}));!0!==s.isRendering()&&this.processCanvasPool()},mi.prototype.gE=function(){this.getSession().getSymbolCache().clearRenderingSvgContentCache(),di.prototype.gE.call(this)},di.inheritedBy(mi),Mi.prototype.initialize=function(){},Mi.prototype.activateCursor=function(t){this.bx(t,!0)},Mi.prototype.deactivateCursor=function(t){this.bx(t,!1)},Mi.prototype.bx=function(t,n){for(var i=this.f5,r=0,s=i.length;r<s;r++){var u=i[r];if(u.id===t){u.active=n;break}}},Mi.prototype.reset=function(){for(var t=this.f5,n=0,i=t.length;n<i;n++)t[n].active=!1},Mi.prototype.setOneCursorBeforeAnother=function(t,n){if(t!==n)for(var i,r,s=this.f5,u=0,h=s.length;u<h;u++){var e=s[u];if(e.id===t?i=u:e.id===n&&(r=u),void 0!==i&&void 0!==r){e=s[i];r<i?(s.splice(r,0,e),s.splice(i+1,1)):(s.splice(r,0,e
),s.splice(i,1));break}}},Mi.prototype.setOneCursorAfterAnother=function(t,n){if(t!==n)for(var i,r,s=this.f5,u=0,h=s.length;u<h;u++){var e=s[u];if(e.id===t?i=u:e.id===n&&(r=u),void 0!==i&&void 0!==r){e=s[i];r+1<i?(s.splice(r+1,0,e),s.splice(i+1,1)):(s.splice(r+1,0,e),s.splice(i,1));break}}},Mi.prototype.lx=function(){for(var t=this.f5,n=0,i=t.length;n<i;n++){var r=t[n];if(r.active)return r.id}return St.CursorID.DEFAULT},pi.prototype.getType=function(){return _.OnMouseDown},Dt.EventArgs.inheritedBy(pi),bi.prototype.getType=function(){return _.OnMouseDoubleClick},Dt.EventArgs.inheritedBy(bi),ki.prototype.getType=function(){return _.OnMouseUp},Dt.EventArgs.inheritedBy(ki),xi.prototype.getType=function(){return _.OnDoubleTap},Dt.EventArgs.inheritedBy(xi);var Ci=["SDF_mousedownhold","SDF_mousedownholdup","SDF_click","SDF_dblclick","SDF_tap","SDF_dbltap","SDF_touchhold"];function Ni(t){Dt.common.IdentifiableObject.call(this),this.eventListeners={},this.rawEventLinsteners={},
this.diagramManager=null,this.offsetToPage=null,this.currentEventType=null,this.currentHoveredElements=null,this.mouseEventsWrapper=null,this.touchEventsWrapper=null,this.cursorControl=new Mi;for(var n=hi.length,i=0;i<n;i++){var r=hi[i];Ni.prototype["__"+r]=function(t){var n=t.originalEvent;n&&(void 0===t.pageX&&(t.pageX=n.pageX,t.pageY=n.pageY),void 0===t.button&&(t.button=n.button),void 0===t.pointerType&&(t.pointerId=n.pointerId,t.pointerType=n.pointerType));n=this.diagramManager;return!n||(n=n.getSheetSession())&&(n.c5.ctrlKey=t.ctrlKey,n.c5.shiftKey=t.shiftKey,n.c5.altKey=t.altKey),this.w5.apply(this,arguments)}}this.getInteractionCanvas=function(){Dt.common.ExceptionHelper.throwNotImplemented()},this.KO=function(t,n,i){Q(this.getInteractionCanvas()).on(t,i,n)},this.d5=function(t,n,i){Q(this.getInteractionCanvas()).off(t,i,n)},this.setCursor=function(t){var n=this.getInteractionCanvas();n.style.cursor!=t&&(n.style.cursor=t)},this.resetCursor=function(){this.cursorControl.reset()
;var t=this.diagramManager.getSheetSession().getCursorConfiguration();this.setCursor(t[St.CursorID.DEFAULT])},this.offset=function(){var t,n,i,r,s,u=0,h=0,e=this.getInteractionCanvas();h=e.getBoundingClientRect?(t=e.getBoundingClientRect(),null==(n=window.pageXOffset)&&(i="number"==typeof document.body.scrollLeft?document.body.scrollLeft:0,r="number"==typeof document.documentElement.scrollLeft?document.documentElement.scrollLeft:0,n=Math.max(i,r)),null==(s=window.pageYOffset)&&(i="number"==typeof document.body.scrollTop?document.body.scrollTop:0,r="number"==typeof document.documentElement.scrollTop?document.documentElement.scrollTop:0,s=Math.max(i,r)),u=t.left+n,t.top+s):(u=(e=Q(e).offset()).left,e.top);h={left:u,top:h};return this.offsetToPage=h}}function Oi(t,n){Ni.call(this,t),this.m5=n,this.g5=800,this.M5=600,this.p5={},this.b5=[]}function Di(t,n){Dt.common.IdentifiableObject.call(this),this.k5=t,this.y5=n,this.x5=new Dt.Map,this.E5=null,this.C5=1}function _i(t){function n(){
return t.stopPropagation(),t.preventDefault(),t.returnValue=!1}var i=Q(this),r=this.scrollTop,s=this.scrollHeight,u=i.height(),h="DOMMouseScroll"==t.type?-40*t.originalEvent.detail:t.originalEvent.wheelDelta,e=0<h;return!e&&s-u-r<-h?(i.scrollTop(s),n()):e&&r<h?(i.scrollTop(0),n()):void 0}function Si(t,n){Oi.call(this,t,n);var i=null,r=null,s=null;t&&(r=document.createElement("div"),St.CommonUtil.setSdfIdOnDom(r,St.Constants.DOM_PREFIX+St.Constants.DOM_CANVAS_WRAPPER),r.style.background="transparent",r.style.overflow="hidden",r.style.position="absolute",r.style.top="0px",r.style.left="0px",r.style.outline="none",(i=document.createElement("div"))&&(St.CommonUtil.setSdfIdOnDom(i,St.Constants.DOM_PREFIX+"canvas_"+St.Constants.DOM_IMAGE_DIV),i.style.position="absolute",i.style.left="-30000px",i.style.top="-20000px",r.appendChild(i)),s=document.createElement("div"),St.CommonUtil.setSdfIdOnDom(s,St.Constants.DOM_PREFIX+"canvas_"+St.Constants.DOM_OVERLAY_DIV),s.style.position="absolute",
r.appendChild(s),t.appendChild(r)),this.getLabelCanvas=function(){return this.N5()},this.getOverlayDiv=function(){return s},this.getSvgImageDiv=function(){return i},this.getInteractionCanvas=function(){return r},this.getWrapper=function(){return r},this.O5()}function Ti(t){Dt.common.IdentifiableObject.call(this),this.renderCallbacks=[],this.D5=!1,this.isStyleUpToDate=!1,this.getCanvas=function(){return t},this.getZoomRatio=function(){Dt.common.ExceptionHelper.throwNotImplemented()},this.getVisualContext=function(){return this.getVisualContextInternal()},this.width=function(){return t.width()},this.height=function(){return t.height()}}function Ai(n,c){Ti.call(this,n);var t=n.getMainCanvas();n.getSvgImageDiv();this._5=0;var s=null,C=null,e=null,o=St.Matrix.identity,u=this;this.isImmediateRender=!0,this.getRenderingMode=function(){return St.RenderingMode.Canvas};function h(t,n,i,r,s){var u=o,h=i.transform,i=S();f(n,r,s),t.transform(h.getM0(),h.getM1(),h.getM3(),h.getM4(),h.getM6(),
h.getM7()),t.drawImage(n.canvas,0,0,r/i,s/i),e.S5(u)}function l(t,n,i){var r;_(n)&&(r=v(n),i.call(u,r[0],r[1]),n.transform&&D(),(r=r[2])&&(C.font=r))}function N(t,n,i){i/=S();var r=[],s=t.x,u=t.y,h=n.x,e=n.y;if(0==St.MathUtil.doubleCompare(s,h)&&0==St.MathUtil.doubleCompare(u,e)){var o=new St.Line(t,n);r.push(o)}else if(0==St.MathUtil.doubleCompare(s,h)){for(var f=u<e?1:-1,a=u+(i=i*f),c=t;(a+i)*f<e*f;){var l=new St.Point(s,a),o=new St.Line(c,l);r.push(o),a+=i,c=new St.Point(s,a),a+=i}o=new St.Line(c,n);r.push(o)}else if(0==St.MathUtil.doubleCompare(u,e)){for(var v=s<h?1:-1,w=s+(i=i*v),c=t;(w+i)*v<h*v;){l=new St.Point(w,u),o=new St.Line(c,l);r.push(o),w+=i,c=new St.Point(w,u),w+=i}o=new St.Line(c,n);r.push(o)}else{for(var d=Math.sqrt((h-s)*(h-s)+(e-u)*(e-u)),m=s<h?1:-1,g=i/d*(h-s),M=i/d*(e-u),w=s+g,a=u+M,c=t;(w+g)*m<h*m;){l=new St.Point(w,a),o=new St.Line(c,l);r.push(o),w+=g,a+=M,c=new St.Point(w,a),w+=g,a+=M}o=new St.Line(c,n);r.push(o)}return r}var f=function(t,n,i){var r,s
;t.canvas||(s=(r=document.createElement("canvas")).getContext("2d"),t.canvas=r,t.canvas.width=n,t.canvas.height=i,s.drawImage(t.image,0,0,n,i))},O=function(t){C.save(),C.transform(t.getM0(),t.getM1(),t.getM3(),t.getM4(),t.getM6(),t.getM7())},D=function(){C.restore()},_=function(t){return!0===t.T5||void 0===t.T5},r=function(t,n){switch(n.horizontalAlign){case St.TextAlignment.START:t.textAlign="start";break;case St.TextAlignment.Right:case St.TextAlignment.End:t.textAlign="end";break;case St.TextAlignment.CENTER:case St.TextAlignment.MIDDLE:t.textAlign="center"}},a=function(t,n){var i=n.fontsize,r=n.fontFamily,s=n.fontStyle;if(i||r||s){var u=t.font,h="normal",n=(s&St.TextStyleType.Bold)===St.TextStyleType.Bold;(s&St.TextStyleType.Italic)===St.TextStyleType.Italic&&(h="italic"),n&&(h+=" bold");i=i?isNaN(i)?i:i+"px":"12px";return t.font=h+" "+i+" "+(r||"Arial"),u}},S=function(){return e.C5},v=function(t){t.transform&&O(t.transform);var n=!1;t.strokeColor&&(
C.strokeStyle=t.strokeColor.toString(),n=!0),t.lineWidth&&(C.lineWidth=t.lineWidth/S());var i=!1;return t.fillColor&&"none"!==t.fillColor&&(C.fillStyle=t.fillColor.toString(),i=!0),r(C,t),[n,i,a(C,t)]};this.clearElement=function(t){},this.getCanvasOption=function(){return e.getCanvasOption()},this.getMainCanvas=function(){return t},this.isRendering=function(){return 0!=this._5},this.setSheetToScreenTransform=function(t){o=t;t=n.Nx();this.A5(t,o)},this.getSheetToScreenTransform=function(){return o},this.width=function(){return n.width()},this.height=function(){return n.height()},this.clear=function(){for(var t=this.getCanvas().Nx(),n=0,i=t.length;n<i;n++){var r=t[n].E5,s=r.getContext("2d");s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,r.width,r.height)}Ti.prototype.clear.call(this)},this.beginRender=function(t,n,i){var r;Ti.prototype.beginRender.call(this,t),s=(r=t).E5,C=s.getContext("2d"),e=r,C.save(),t.S5(o),n&&(i?C.clearRect(i.x,i.y,i.width,i.height):(C.save(),C.setTransform(1,0,0,1,0,
0),C.clearRect(0,0,s.width,s.height),C.restore()))},this.renderElement=function(t){t.render(this)},this.renderSymbol=function(t,n){t.render(this,n)},this.renderMarker=function(t,n){for(var i=0;i<n.length;++i){var r=n[i];t.render(this,r)}},this.createSymbolRenderStyle=function(t){v(t)},this.updateSymbolRenderStyle=function(t){v(t)},this.renderSymbolGeometry=function(t,n,i){_(n)&&t.render(this,n,i)},this.updateRenderSymbolGeometry=function(t,n,i){_(n)&&t.updateRender(this,n,i)},this.renderOverlaySymbol=function(t,n){t.render(this,n)},this.removeSymbol=function(t){},this.renderRect=function(f,t){var a=0;t.lineDashArray&&0<t.lineDashArray.length&&(a=parseFloat(t.lineDashArray[0])),l(0,t,function(t,n){if(n&&C.fillRect(f.x,f.y,f.width,f.height),t)if(a){C.beginPath();var i=[],r=new St.Point(f.x,f.y),s=new St.Point(f.x+f.width,f.y),n=new St.Point(f.x+f.width,f.y+f.height),t=new St.Point(f.x,f.y+f.height);i.push(r),i.push(s),i.push(n),i.push(t),i.push(r);for(var u=0;u<4;u++)for(var h=N(i[u],
i[u+1],a),e=h.length,o=0;o<e;o++)C.moveTo(h[o].start.x,h[o].start.y),C.lineTo(h[o].end.x,h[o].end.y);C.closePath(),C.stroke()}else C.strokeRect(f.x,f.y,f.width,f.height)})},this.renderRoundedRect=function(i,r,s,t){l(0,t,function(t,n){C.beginPath(),C.moveTo(i.x,i.y+s),C.quadraticCurveTo(i.x,i.y,i.x+r,i.y),C.lineTo(i.x+i.width-r,i.y),C.quadraticCurveTo(i.x+i.width,i.y,i.x+i.width,i.y+s),C.lineTo(i.x+i.width,i.y+i.height-s),C.quadraticCurveTo(i.x+i.width,i.y+i.height,i.x+i.width-r,i.y+i.height),C.lineTo(i.x+r,i.y+i.height),C.quadraticCurveTo(i.x,i.y+i.height,i.x,i.y+i.height-s),C.lineTo(i.x,i.y+s),C.closePath(),t&&C.stroke(),n&&C.fill()})},this.renderTriangle=function(i,t){l(0,t,function(t,n){3==i.length&&(C.beginPath(),C.moveTo(i[0].x,i[0].y),C.lineTo(i[1].x,i[1].y),C.lineTo(i[2].x,i[2].y),C.closePath(),n&&C.stroke(),t&&C.fill())})},this.renderEllipse=function(o,t){St.CommonUtil.isNumberClose(o.width,o.height)?l(0,t,function(t,n){C.beginPath(),C.arc(o.x+.5*o.width,o.y+.5*o.width,
.5*o.width,0,2*Math.PI),t&&C.stroke(),n&&C.fill()}):l(0,t,function(t,n){var i=o.width/2*.5522848,r=o.height/2*.5522848,s=o.x+o.width,u=o.y+o.height,h=o.x+o.width/2,e=o.y+o.height/2;C.beginPath(),C.moveTo(o.x,e),C.bezierCurveTo(o.x,e-r,h-i,o.y,h,o.y),C.bezierCurveTo(h+i,o.y,s,e-r,s,e),C.bezierCurveTo(s,e+r,h+i,u,h,u),C.bezierCurveTo(h-i,u,o.x,e+r,o.x,e),C.closePath(),t&&C.stroke(),n&&C.fill()})},this.renderEllipses=function(t,n){for(var i=0;i<t.length;++i)this.renderEllipse(t[i],n)},this.renderArc=function(t,n,i,r,s){var u={};u.center=t,u.radius=n,u.start=i,u.end=r,l(0,s,function(t,n){C.beginPath(),C.arc(u.center.x,u.center.y,u.radius,u.start,u.end),t&&C.stroke(),n&&C.fill()})};function w(t,n,i){var r=St.RenderUtil.calculateTextAbscissa(i),s=St.RenderUtil.calculateTextOrdinate(i),u=(u=t.replace(/\{textboxRef.xPos}/g,""+r)).replace(/\{textboxRef.dy}/g,""+s);(o=St.RenderUtil.extractIndentInfo(u)).indent&&(u=o.text.replace(/\{textboxRef_indent.xPos}/g,""+r+o.indent));var h=S(),e=Math.ceil(
i.width*h),s=Math.ceil(i.height*h),r=-1!==u.indexOf("data-df-fill"),o=m(i,r),r="";return i.fillColor&&(r="<style type='text/css'>.splm_df_fill{fill:"+i.fillColor.toString()+"}</style>"),[n.guid+"_"+o+"_"+e+"_"+s+r+t,e,s,h,u,o]}this.preRenderSvgText=function(t,n,i){var r,s,u;!1!==i.T5&&(t=(r=w(t,n,i))[0],(s=c.getRenderingSymbolCanvas(t))||((s={}).symbol=n,c.addRenderingSymbolCanvas(t,s)),(i=s.image)||(i=new Image,n=r[3],t=r[4],1!==n&&(t="<g transform='scale("+n.toString()+")'>"+t+"</g>"),t='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style=\''+r[5]+"' width='"+r[1]+"' height='"+r[2]+"'>"+t+"</svg>",i.src="data:image/svg+xml,"+Ri(t),u=this,s.image=i,Pi(s.image,function(){s.isImageLoaded=!0,u._5--,!0!==u.isRendering()&&u.UN.processCanvasPool()}),u._5++,i.style.display="none"))},this.renderSvgText=function(t,n,i){!1!==i.T5&&(t=w(t,n,i),(n=c.getRenderingSymbolCanvas(t[0]))&&n.image&&n.isImageLoaded?h(C,n,i,t[1],t[2]
):Dt.DebugFlags.CheckRendering&&window.console&&window.console.log("Canvas image is not cached when starting rendering."))},this.renderText=function(s,u){l(0,u,function(t,n){var i=St.RenderUtil.calculateTextAbscissa(u),r=St.RenderUtil.calculateTextOrdinate(u);n&&C.fillText(s,i,r),t&&C.strokeText(s,i,r)})},this.renderTextWithinRect=function(i,r,t){l(0,t,function(t,n){n&&C.fillText(i,r.getCenterX(),r.getCenterY()),t&&C.strokeText(i,r.getCenterX(),r.getCenterY())})},this.renderPolyline=function(i,t){l(0,t,function(t){C.beginPath(),C.moveTo(i[0].x,i[0].y);for(var n=1;n<i.length;n++)C.lineTo(i[n].x,i[n].y);C.stroke()})},this.renderLines=function(h,t){var e=0;t.lineDashArray&&0<t.lineDashArray.length&&(e=parseFloat(t.lineDashArray[0])),l(0,t,function(t,n){C.beginPath();for(var i=0;i<h.length;i++)if(e)for(var r=N(h[i].start,h[i].end,e),s=r.length,u=0;u<s;u++)C.moveTo(r[u].start.x,r[u].start.y),C.lineTo(r[u].end.x,r[u].end.y);else C.moveTo(h[i].start.x,h[i].start.y),C.lineTo(h[i].end.x,
h[i].end.y);C.stroke()})},this.renderCombinedConnectionPath=function(t,n,i){},this.updateRenderCombinedConnectionPath=function(t,n,i){},this.renderConnectionPath=function(t,n,i){if(!1!==n.T5){var r,s=i.jumperShape,u=t.length,h=.5*i.jumperWidth,e=[],i=!!_(i=n)&&(i.transform&&O(i.transform),i.strokeColor&&(C.strokeStyle=i.strokeColor.toString()),i.lineWidth&&(C.lineWidth=i.lineWidth/S()),C.lineCap="square",C.lineJoin="square",i.fillColor&&"none"!==i.fillColor&&(C.fillStyle=i.fillColor),C.beginPath(),!0),o=0;if(n.lineDashArray){n.lineDashArray.length;for(var f=0;f<n.lineDashArray.length;f++)n.lineDashArray[f],o=parseFloat(n.lineDashArray[f])}if(i){for(var a=0;a<u-1;a++){var c=t[a];if(c.skip)switch(s){case St.JumperShapeType.GAP:break;case St.JumperShapeType.ARC:var l={},v=c,w=t[a+1];l.x=(w.x-v.x)/2+v.x,l.y=(w.y-v.y)/2+v.y;var d=Math.atan2(l.y-v.y,l.x-v.x),m=Math.atan2(l.y-w.y,l.x-w.x);if(o)for(var g=0,g=v.x<w.x||v.y>w.y?m:d,M=Math.sqrt((v.x-w.x)*(v.x-w.x)+(v.y-w.y)*(v.y-w.y)),
M=Math.PI*M/2,p=(p=parseInt(M/o*S()))%2==0?p+1:p,b=Math.PI/p,k=0;k<(p+1)/2;k++)this.renderArc(l,h,g,g+b,n),g+=2*b;else v.x<w.x||v.y>w.y?this.renderArc(l,h,m,d,n):this.renderArc(l,h,d,m,n)}else if(o)for(var y=N(c,t[a+1],o),x=y.length,E=0;E<x;E++)e.push(y[E]);else r=new St.Line(c,t[a+1]),e.push(r)}for(a=0;a<e.length;a++)C.moveTo(e[a].start.x,e[a].start.y),C.lineTo(e[a].end.x,e[a].end.y);i=n,C.stroke(),C.closePath(),i.transform&&D()}}},this.updateRenderConnectionPath=function(t,n,i){this.renderConnectionPath(t,n,i)};function d(t){for(var n,i=[],r=0;r<t.length-1;r++)n=new St.Line(t[r],t[r+1]),i.push(n);return i}this.renderPath=function(t,n,i){this.renderLines(d(t),n)},this.updateRenderPath=function(t,n,i){this.renderLines(d(t),n)},this.renderArrowhead=function(t,n){this.renderSvg(t,n)};var m=function(t,n){var i="";return t.strokeColor?i+="stroke:"+t.strokeColor.toString()+";":i+="stroke:transparent;",t.fillColor&&!n?i+="fill:"+t.fillColor.toString()+";":i+="fill:transparent;",
t.lineWidth&&(i+="stroke-width:"+t.lineWidth+";"),t.lineDashArray&&(i+="stroke-dasharray:"+t.lineDashArray+";"),i};this.preRenderSvg=function(t,n){var i,r,s,u,h,e,o,f,a;!1!==n.T5&&(i=S(),r=Math.ceil(n.width*i),s=Math.ceil(n.height*i),f=!!(o=t.getSvgContent())&&-1!==o.indexOf("data-df-fill"),u=m(n,f),h="",n.fillColor&&(h="<style type='text/css'>.splm_df_fill{fill:"+n.fillColor.toString()+"}</style>"),f=t.guid+"_"+u+"_"+r+"_"+s+h,(e=c.getRenderingSymbolCanvas(f))||((e={}).symbol=t,c.addRenderingSymbolCanvas(f,e)),(f=e.image)||(o="<svg xmlns='http://www.w3.org/2000/svg' width='"+r+"' height='"+s+"'><g transform='scale("+i+")'><svg style='"+u+"' width='"+n.width+"' height='"+n.height+"' xmlns='http://www.w3.org/2000/svg'>"+h+o+"</svg></g></svg>",(f=new Image).src="data:image/svg+xml,"+encodeURIComponent(o),a=this,e.image=f,Pi(e.image,function(){e.isImageLoaded=!0,a._5--,!0!==a.isRendering()&&a.UN.processCanvasPool()}),a._5++,f.style.display="none"))},this.renderSvg=function(t,n){var i,r,s,
u;!1!==n.T5&&(s=S(),i=Math.ceil(n.width*s),r=Math.ceil(n.height*s),u=-1!==t.getSvgContent().indexOf("data-df-fill"),s=m(n,u),u="",n.fillColor&&(u="<style type='text/css'>.splm_df_fill{fill:"+n.fillColor.toString()+"}</style>"),u=t.guid+"_"+s+"_"+i+"_"+r+u,(u=c.getRenderingSymbolCanvas(u))&&u.image&&u.isImageLoaded?h(C,u,n,i,r):Dt.DebugFlags.CheckRendering&&window.console&&window.console.log("Canvas image is not cached when starting rendering."))},this.renderSvgPreview=function(t,n,i){this.renderSvg(t,n)},this.preRenderBitmap=function(t,n){var i,r,s,u;!1!==n.T5&&t&&(s="",n.strokeColor?s+="stroke:"+n.strokeColor.toString()+";":s+="stroke:transparent;",n.fillColor?s+="fill:"+n.fillColor.toString()+";":s+="fill:transparent;",n.lineWidth&&(s+="stroke-width:"+n.lineWidth+";"),n.lineDashArray&&(s+="stroke-dasharray:"+n.lineDashArray+";"),i=S(),Math.ceil(n.width*i),Math.ceil(n.height*i),s=t.guid+"_"+s,(r=c.getRenderingSymbolCanvas(s))||((r={}).symbol=t,c.addRenderingSymbolCanvas(s,r)),
r&&r.symbol&&((s=r.image)||(t=t.getContent(),(s=new Image).src=t,r.image=s,(u=this)._5++,Pi(s,function(){r.isImageLoaded=!0,u._5--,!0!==u.isRendering()&&u.UN.processCanvasPool()}),s.style.visibility="hidden")))},this.renderBitmap=function(t,n){var i,r,s;t&&n&&(s="",n.strokeColor?s+="stroke:"+n.strokeColor.toString()+";":s+="stroke:transparent;",n.fillColor?s+="fill:"+n.fillColor.toString()+";":s+="fill:transparent;",n.lineWidth&&(s+="stroke-width:"+n.lineWidth+";"),n.lineDashArray&&(s+="stroke-dasharray:"+n.lineDashArray+";"),r=S(),i=Math.ceil(n.width*r),r=Math.ceil(n.height*r),s=t.guid+"_"+s,(s=c.getRenderingSymbolCanvas(s))&&s.image&&s.isImageLoaded?h(C,s,n,i,r):Dt.DebugFlags.CheckRendering&&window.console&&window.console.log("Canvas image is not cached when starting rendering."))},this.preRenderSvgContent=function(t,n){var i,n=t=this.R5(t,n),r=c.getRenderingSvgContentCache(n);r||(r={},c.addRenderingSvgContentCache(n,r)),r&&((n=r.image)||((n=new Image
).src="data:image/svg+xml,"+encodeURIComponent(t),r.image=n,(i=this)._5++,Pi(n,function(){r.isImageLoaded=!0,i._5--,!0!==i.isRendering()&&i.UN.processCanvasPool()}),n.style.visibility="hidden"))},this.renderSvgContent=function(t,n){var i=t=this.R5(t,n),r=c.getRenderingSvgContentCache(i);r&&r.image&&r.isImageLoaded?(t=S(),i=Math.ceil(n.width*t),t=Math.ceil(n.height*t),h(C,r,n,i,t)):Dt.DebugFlags.CheckRendering&&window.console&&window.console.log("Canvas image is not cached when starting rendering.")},this.R5=function(t,n){var i=-1!==t.indexOf("data-df-fill"),i=m(n,i);return"<svg width='"+n.width+"' height='"+n.height+"' xmlns='http://www.w3.org/2000/svg' style='"+i+"'>"+t+"</svg>"};function g(t,n){var i="rgba("+n.red+","+n.green+","+n.blue+",1)";t.strokeStyle=i,n.alpha<1&&(t.globalAlpha=n.alpha)}this.drawGridLines=function(t,n){C.save();var i=1/n.getM0(),r=1/n.getM0();C.lineWidth=r,C.setTransform(n.getM0(),n.getM1(),n.getM3(),n.getM4(),n.getM6(),n.getM7()),C.beginPath();var s=null,
u=null,h=null,e=null,o=null,f=t.getMajorGridSpacing(),a=t.getGridWidth(),c=t.getGridHeight(),l=t.P5(),v=t.H5();if(t.isShowMajorLines()){for(g(C,t.L5()),s=Math.floor(a/f),u=Math.floor(c/f),h=1;h<=s;h++)C.moveTo((e=h*f)+l,v),C.lineTo(e+l,c+v);for(h=1;h<=u;h++)C.moveTo(l,(o=h*f)+v),C.lineTo(a+l,o+v);C.stroke()}if(t.isShowMinorLines){var w=t.getMinorLinesPerMajor();if(g(C,t.I5()),C.beginPath(),1<w&&i<w){for(var d=f/w,s=Math.floor(a/d),u=Math.floor(c/d),h=1;h<=s;h++)h%w!=0&&(C.moveTo((e=h*d)+l,v),C.lineTo(e+l,c+v));for(h=1;h<=u;h++)h%w!=0&&(C.moveTo(l,(o=h*d)+v),C.lineTo(a+l,o+v));C.stroke()}}C.closePath(),C.restore()},this.renderGrid=function(t,n,i,r){var s;n.isVisible()&&(n.V5(this),s=n.j5(),this.getCanvas().W5(s),this.drawGridLines(n,t.transform))},this.beginAnimateRender=function(t,n,i){this.beginRender(t,!0,i)},this.endAnimateRender=function(){this.endRender()},this.adjustStrokeWidthWithZoomRatio=function(t){},this.clearSymbolByLod=function(t){},this.pushOpacity=function(t){for(
var n=this.getCanvas().Nx(St.CanvasOption.OverlayCanvas),i=0,r=n.length;i<r;i++){var s=n[i].E5.getContext("2d");s.save(),s.globalAlpha=t}},this.popOpacity=function(){for(var t=this.getCanvas().Nx(St.CanvasOption.OverlayCanvas),n=0,i=t.length;n<i;n++)t[n].E5.getContext("2d").restore()},this.getVisualContextInternal=function(){return C}}Ni.prototype.destroy=function(){var t=this.getWrapper();t&&Q(t).remove()},Ni.prototype.z5=function(t){var n=this.offset(),i=t;i.originalEvent&&i.originalEvent.touches&&(i=i.originalEvent.touches[0]||i.originalEvent.changedTouches[0]);t=new St.Point;t.x=i.pageX-n.left,t.y=i.pageY-n.top;n=this.diagramManager.getScreenToSheetTransform();return n?n.transformPoint(t):null},Ni.prototype.bind=function(t,n,i){for(var r=t.split(" "),s=r.length,u=i?this.rawEventLinsteners:this.eventListeners,h=0;h<s;++h){var e=r[h];0<=hi.indexOf(e)||0<=Ci.indexOf(e)?(u[e]||(u[e]=[]),u[e].push(n)):this.getInteractionCanvas().addEventListener(e,n)}},Ni.prototype.unbind=function(t,n,i
){for(var r=t.split(" "),s=r.length,u=i?this.rawEventLinsteners:this.eventListeners,h=0;h<s;++h){var e=r[h];u[e]||(u[e]=[]);var o=u[e].indexOf(n);u[e].splice(o,1)}},Ni.prototype.w5=function(t){var n,i=this.diagramManager;if(i){var r=i.getSheetSession();if(r&&r.a5)return}if(this.currentEventType=t.type,n=this.execRawEventHandlers.apply(this,arguments))return this.changePreferredCursor(),!0;i=this.z5(t);if(i){r=this.diagramManager.getElementByPoint(i);if(r){if(r[t.type]&&r[t.type](t),r.eventListeners)if(s=r.eventListeners[t.type])for(u=s.length,h=0;h<u;h++)s[h].apply(this,arguments);var s,u,h,r=this.diagramManager.getSymbolOccurrenceByPoint(i,r);if(r)if(r[t.type]&&r[t.type](t),r.eventListeners)if(s=r.eventListeners[t.type])for(u=s.length,h=0;h<u;h++)s[h].apply(this,arguments)}}return n=this.execEventHandlers.apply(this,arguments),this.changePreferredCursor(),n},Ni.prototype.setCurrentEventType=function(t){this.currentEventType=t},Ni.prototype.setCurrentHoveredElements=function(t){
this.currentHoveredElements=t},Ni.prototype.execRawEventHandlers=function(t){var n,i,r=this.rawEventLinsteners[this.currentEventType],s=Array.prototype.slice.apply(arguments);if(s.push(this.offsetToPage),s.push(this.currentHoveredElements),r)for(n=r.length,i=0;i<n;i++)if(r[i].apply(this,s))return!0},Ni.prototype.execEventHandlers=function(t){var n,i,r,s=this.eventListeners[this.currentEventType];if(s){var u=Array.prototype.slice.apply(arguments);for(u.push(this.offsetToPage),u.push(this.currentHoveredElements),i=s.length,r=0;r<i;r++){var h=s[r].apply(this,u);void 0!==h&&(n=h)}return this.currentHoveredElements=[],n}},Ni.prototype.hookDfRawEvents=function(){var t=new yi;t.bindMouseEvent(this),this.mouseEventsWrapper=t;t=new Ei;t.bindTouchEvent(this),this.touchEventsWrapper=t},Ni.prototype.changePreferredCursor=function(){var t=this.diagramManager.getSheetSession().getCursorConfiguration();this.setCursor(t[this.cursorControl.lx()])},Ni.prototype.activateCursor=function(t){
this.cursorControl.activateCursor(t)},Ni.prototype.deactivateCursor=function(t){this.cursorControl.deactivateCursor(t)},Ni.prototype.deactivateAllCursors=function(){this.cursorControl.reset()},Dt.common.IdentifiableObject.inheritedBy(Ni),Oi.prototype.Oa=function(){for(var t=this.Nx(),n=0,i=t.length;n<i;n++)t[n].Oa()},Oi.prototype.Y5=function(){for(var t=this.Nx(),n=0,i=t.length;n<i;n++)t[n].Y5();this.p5={},this.b5=[],Ni.prototype.destroy.call(this)},Oi.prototype.width=function(){return this.g5},Oi.prototype.height=function(){return this.M5},Oi.prototype.setSize=function(t,n){this.g5=t,this.M5=n},Oi.prototype.getViewFeatureCanvas=function(){var t=this.m5,t=t.lk(t.B5);return this.CO(t)[0].E5},Oi.prototype.getSheetFeatureCanvas=function(){var t=this.m5,t=t.lk(t.Z5);return this.CO(t)[0].E5},Oi.prototype.getMainCanvas=function(){var t=this.m5,t=t.lk(t.U5);return this.CO(t)[0].E5},Oi.prototype.getOverlayCanvas=function(){var t=this.m5,t=t.lk(t.G5);return this.CO(t)[0].E5},
Oi.prototype.W5=function(t){var n=this.m5;t?n.X5(n.B5,n.q5):n.X5(n.B5,null)},Oi.prototype.K5=function(t){for(var n=[],i=this.CO(t),r=0,s=i.length;r<s;r++)var u=i[r].vO(),n=n.concat(u);return n},Oi.prototype.IO=function(t){for(var n=this.CO(t),i=0,r=n.length;i<r;i++)if(0<n[i].o5())return!1;return!0},Oi.prototype.J5=function(t){t=this.p5[t.guid];return null!=t},Oi.prototype.CO=function(t){return this.p5[t.guid]},Oi.prototype.Nx=function(t){var n=null;if(void 0===t)n=this.b5;else for(var n=[],i=this.b5,r=0,s=i.length;r<s;r++){var u=i[r];u.getCanvasOption()===t&&n.push(u)}return n},Oi.prototype.Q5=function(){var t,n,i=[],r=this.p5;for(t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n=r[t],i=i.concat(n));return i.sort(function(t,n){return t.nD().tD-n.nD().tD}),this.b5=i},Oi.prototype.eO=function(t){for(var n=null,i=this.m5.iD(),r=t.getRenderCanvas(i),s=this.CO(r),u=s?s.length:0,h=0;h<u;h++)if((e=s[h]).rD(t)){n=e;break}if(!n)for(i=r.getCanvasOption(),h=0,u=(s=this.Nx(i)).length;h<u;h++){
var e=s[h];if(e.nD()!==r&&e.rD(t)){n=e;break}}return n},Oi.prototype.DO=function(t,n){n.sD(t)},Oi.prototype.uD=function(t){t=this.eO(t);return t?t.nD():null},Oi.prototype.hD=function(t){var n=this.p5[t.guid];if(n)for(var i=0,r=n.length;i<r;i++){var s=n[i];this.eD(s)}return n},Oi.prototype.oD=function(t,n){return this.fD(t,n)},Oi.prototype.aD=function(t,n){return this.fD(t,n)},Oi.prototype.cD=function(t){var n=this.p5[t.guid];delete this.p5[t.guid],this.Q5();for(var i=0,r=n.length;i<r;i++){var s=n[i];this.eD(s),s.lD()||(s.E5=null)}return n},Oi.prototype.h5=function(t){var n=this.vD(t),i=this.p5[t.guid];i.push(n),this.Q5();var r=i.indexOf(n),s=0===r?"":"_"+(r+1),t=t.wD()+s,s=n.getCanvasOption();return n.E5=this.dD(s,t),1<i.length&&(n.cO()||this.mD(n,i[r-1])),n},Oi.prototype.OO=function(t,n){return(n=n||this.eO(t))&&n.gD(t),n},Oi.prototype.xO=function(t){for(var n=this.CO(t),i=0,r=n.length;i<r;i++)n[i].MD();return n},Oi.prototype.O5=function(){for(var t=this.m5.oN(),n=0,i=t.length;n<i;n++
){var r=t[n],r=this.m5.pD(r);this.bD(t[n],r)}},Oi.prototype.bD=function(t,n){return this.J5(t)&&Dt.DebugFlags.CheckRendering&&window.console&&window.console.error("render canvas has been rendered."),this.kD(t),this.fD(t,n)},Oi.prototype.fD=function(t,n){this.Q5();var i=this.CO(t);if(i){var r=null;n&&(r=(n=this.CO(n))[n.length-1]);for(var s=0,u=i.length;s<u;s++){var h=i[s];this.mD(h,r),r=h}}return i},Oi.prototype.mD=function(t,n){n=n?n.E5:this.yD();Oi.xD(t.E5,n)},Oi.prototype.eD=function(t){t=t.E5;t.parentNode.removeChild(t)},Oi.prototype.kD=function(t){return this.p5[t.guid]||(this.p5[t.guid]=[]),this.h5(t),this.CO(t)},Oi.xD=function(t,n){var i;n.nextSibling!==t&&(t.parentNode&&t.parentNode.removeChild(t),(i=n.parentNode).lastChild===n?i.appendChild(t):i.insertBefore(t,n.nextSibling))},Ni.inheritedBy(Oi),Di.prototype.Oa=function(){this.MD()},Di.prototype.Y5=function(){this.Oa(),this.E5=null},Di.prototype.getRenderingMode=function(){return this.y5},Di.prototype.getCanvasOption=function(
){return this.k5.getCanvasOption()},Di.prototype.nD=function(){return this.k5},Di.prototype.v5=function(){return this.k5.ZO},Di.prototype.vO=function(){return this.x5.values()},Di.prototype.o5=function(){return this.x5.size()},Di.prototype.rD=function(t){return this.x5.containsKey(t.guid)},Di.prototype.sD=function(t){this.x5.put(t.guid,t)},Di.prototype.gD=function(t){this.x5.removeByKey(t.guid)},Di.prototype.MD=function(){this.x5.clear()},Di.prototype.cO=function(){return this.k5.cO()},Di.prototype.lD=function(){return this.k5.lD()},Di.prototype.S5=function(t){var n,i;this.getCanvasOption()!==St.CanvasOption.ViewFeatureCanvas&&(n=this.k5.ZO===St.ElementCoordinateMode.Device?St.Matrix.identity:t,this.C5=n.getM0(),i=this.E5,(t=this.y5)===St.RenderingMode.Svg?i.setAttribute("transform",n.toSvgString()):t===St.RenderingMode.Canvas&&i.getContext("2d").setTransform(n.getM0(),n.getM1(),n.getM3(),n.getM4(),n.getM6(),n.getM7()))},Dt.common.IdentifiableObject.inheritedBy(Di),
Si.prototype.setSize=function(t,n){Oi.prototype.setSize.call(this,t,n);var i=this.getWrapper();i.style.width=t+"px",i.style.height=n+"px";i=this.getSvgImageDiv();i.style.width=t+"px",i.style.height=n+"px";for(var r=this.Nx(),s=0,u=r.length;s<u;s++){var h=r[s].E5;h.width=t,h.height=n}},Si.prototype.getRenderingMode=function(){return St.RenderingMode.Canvas},Si.prototype.yD=function(){return this.getSvgImageDiv()},Si.prototype.vD=function(t){return new Di(t,this.getRenderingMode())},Si.prototype.dD=function(t,n){var i=document.createElement("canvas");switch(t){case St.CanvasOption.ViewFeatureCanvas:case St.CanvasOption.SheetFeatureCanvas:St.CommonUtil.setSdfIdOnDom(i,St.Constants.DOM_PREFIX+"canvas_"+n),i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.outline="none";break;case St.CanvasOption.ElementCanvas:St.CommonUtil.setSdfIdOnDom(i,St.Constants.DOM_PREFIX+"canvas_"+n),i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.outline="none",Q(i
).on("mousewheel DOMMouseScroll wheel",_i);break;case St.CanvasOption.OverlayCanvas:St.CommonUtil.setSdfIdOnDom(i,St.Constants.DOM_PREFIX+"canvas_"+n),i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.outline="none",i.tabIndex="0";break;default:Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,"Invalid Canvas Option: "+t)}return i.width=this.width(),i.height=this.height(),i},Oi.inheritedBy(Si),Ti.prototype.clear=function(){this.getCanvas().Oa()},Ti.prototype.destroy=function(){this.clear(),this.getCanvas().Y5()},Ti.prototype.isRenderStyleUpToDate=function(){return this.isStyleUpToDate},Ti.prototype.pushRenderCallback=function(t,n,i){var r={width:i.width,height:i.height,renderReason:i.renderReason},i=this.getVisualContextInternal();this.renderCallbacks.push({element:t,symbol:n,style:r,visual:i})},Ti.prototype.beginRender=function(t){t.getCanvasOption()===St.CanvasOption.ElementCanvas&&(this.D5=!0)},Ti.prototype.endRender=function(
){},Ti.prototype.bO=function(){if(this.D5){if(0<this.renderCallbacks.length){for(var t,n=new At.RenderCallbackEventArgs(this);this.renderCallbacks.length;){var i=this.renderCallbacks.pop(),r=i.element,s=i.symbol;r&&s&&n.addRenderTarget(r,s,i.style,i.visual)}r&&(t=new Dt.messages.EventMessage(n,n.getType()),r.getSession().CM().BM(t)),n.clear()}}else this.renderCallbacks.length=0;this.D5=!1},Ti.prototype.doAnimate=function(t,n,i,r){this.UN.l5(r)},Ti.prototype.setSize=function(t,n){this.getCanvas().setSize(t,n)},Ti.prototype.A5=function(t,n){for(var i=0,r=t.length;i<r;i++)t[i].S5(n)},Ti.prototype.Cx=function(t){t=this.getCanvas().eO(t);return t?t.getRenderingMode():null},Ti.prototype.BO=function(t,n){return this.getCanvas().bD(t,n)},Ti.prototype.GO=function(t){this.getCanvas().cD(t)},Ti.prototype.$O=function(t,n){this.getCanvas().oD(t,n)},Ti.prototype.XO=function(t){this.getCanvas().hD(t)},Ti.prototype.qO=function(t,n){this.getCanvas().aD(t,n)},Dt.common.IdentifiableObject.inheritedBy(Ti)
,Ai.prototype.endRender=function(){var t=this.getVisualContextInternal();t&&0===this._5&&t.restore(),Ti.prototype.endRender.call(this)};var Ri=function(t){t=t.replace(/(&nbsp;)/g," ");return encodeURIComponent(t)},Pi=function(t,n){t.onload=n,t.onerror=function(t){Dt.DebugFlags.CheckRendering&&window.console&&window.console.log("The image load has error.")}};function Hi(){this.point=null,this.target=null,this.parent=null,this.tolerance=null,this.clear=function(){this.point=null,this.target=null,this.parent=null,this.tolerance=St.MathUtil.doubleTolerance}}function Li(t){var i=null;Dt.common.IdentifiableObject.call(this),this.ex=t,this.ZO=St.ElementCoordinateMode.Sheet,this.ensureContext=function(t,n){return(i=i||new Hi).clear(),i.point=t,i.tolerance=n,i.candidate=null,i}}function Ii(){}function Fi(t){Li.call(this,t),this.currentSelected=null,this.preciseSelectionTester=null}function Vi(t){d.call(this),this.ED=t,this.CD={},this.ND=new ci}function ji(t){Vi.call(this,t)}function Wi(t,n,i){
i=Wi.createContext(n,i);mi.call(this,t,n,i);i=new ji(i.getCanvas());this.setVisitor(i),n.$C(i);i=new Fi(t);t.setSelectionStrategy(i);i=this.fN();this.OD=null,i.DD()&&(this.OD=this.UO(),i._D(this.OD)),i.SD(this),di.hookCanvasEvents(this.getCanvas(),t)}function zi(t,n,i){di.call(this,t,n,i),this.renderingMode=St.RenderingMode.Svg}function Yi(t,n,i){Dt.common.IdentifiableObject.call(this),this.TD=t,this.AD=n,this.ED=i}function Bi(t,n,i){Oi.call(this,t,i);var r=null,s=null,u=null,h=null,e=null,o=null;t&&(h=document.createElement("div"),St.CommonUtil.setSdfIdOnDom(h,St.Constants.DOM_PREFIX+St.Constants.DOM_CANVAS_WRAPPER),h.style.background="transparent",h.style.overflow="hidden",h.style.position="absolute",h.style.top="0px",h.style.left="0px",h.style.outline="none",h.tabIndex="0",Q(h),e=document.createElement("div"),St.CommonUtil.setSdfIdOnDom(e,St.Constants.DOM_PREFIX+St.Constants.DOM_OVERLAY_DIV),e.style.position="absolute",h.appendChild(e),t.appendChild(h),(r=Zi("svg",
St.Constants.DOM_SVG_ROOT)).style.overflow="hidden",r.style.display="block",h.appendChild(r),s=document.createElement("div"),St.CommonUtil.setSdfIdOnDom(s,St.Constants.DOM_PREFIX+"svg_"+St.Constants.DOM_IMAGE_DIV),s.style.visibility="hidden",s.style.position="absolute",s.style.left="-30000px",s.style.top="-20000px",h.appendChild(s),o=n.RD||Zi("defs",St.Constants.DOM_SVG_SHEET_DEFS),r.appendChild(o),Q(r).css("-moz-user-select","none"),Q(r).css("user-select","none"),Q(r).css("-ms-user-select","none"),Q(r).css("-khtml-user-select","none"),Q(r).css("-webkit-user-select","none"),Q(r).css("-ms-touch-action","none"),Q(r).css("touch-action","none"),Q(r).on("dragstart",function(t){t.preventDefault()})),this.getSymbolDefs=function(){return o},this.containLabelCanvas=function(){return null!==u},this.getLabelCanvas=function(){var t;return u||(u=Zi("g"),(t=this.Nx(St.CanvasOption.ElementCanvas))[t.length-1].E5.appendChild(u)),u},this.getSvgImageDiv=function(){return s},this.getOverlayDiv=function(
){return e},this.getSvgRoot=function(){return r},Bi.prototype.PD=function(t){r=t},this.getInteractionCanvas=function(){return h},this.getWrapper=function(){return h},this.HD=function(t){h=t},this.O5()}function Zi(t,n){t=document.createElementNS("http://www.w3.org/2000/svg",t);return void 0!==n&&St.CommonUtil.setSdfIdOnDom(t,St.Constants.DOM_PREFIX+n),t}function Ui(o,f){Ti.call(this,o);var a=o.getMainCanvas(),c=o.getSvgImageDiv(),n=o.getOverlayDiv(),l=o.getSymbolDefs();f.RD=l;var s=St.Matrix.identity,v=null,i=null,r=1,w=!0,u=o.getSvgRoot(),d={},m={};this.getRenderingMode=function(){return St.RenderingMode.Svg},this.setInExporting=function(t,n){m.start=t,m.end=n},this.getCurrentCanvas=function(){return v},this.setCurrentCanvas=function(t){v=t};var g=function(t,n,i){t=document.createElementNS("http://www.w3.org/2000/svg",t);return null!=n&&void 0!==n&&(t.id=St.Constants.DOM_PREFIX+n),null!=i&&t.setAttribute(St.Constants.DOM_SDF_DATA_APP_ID,i),t},M=function(t){if(t)return t.toSvgString()}
;this.createSvgElement=g,this.toSvgMatrix=M;function h(t){for(var n=t.length,i="",r=0;r<n;r++){var s=t[r];i+=s.x+","+s.y,r!=n-1&&(i+=" ")}return i}function p(t){var n;return m.start&&(t.LD()?n="visible":t.ID()&&(n="hidden")),n=void 0===n?t.isVisible()?"visible":"hidden":n}function b(t,n,i,r,s){null!=n&&i.getAttribute(t)!==n&&i.setAttribute(t,n)}function k(t,n,i){var r=t.firstChild;_(r,n),i&&i.call(this,r||t)}var e=function(t,n){n.transform&&O(t,n),n.styleClass&&t.setAttribute("class",n.styleClass),n.strokeColor&&t.setAttribute("stroke",n.strokeColor.toString()),n.fillColor?t.setAttribute("fill",n.fillColor.toString()):t.setAttribute("fill","transparent"),n.fontFamily&&t.setAttribute("font-family",n.fontFamily),n.lineWidth&&t.setAttribute("stroke-width",n.lineWidth),n.lineDashArray&&t.setAttribute("stroke-dasharray",n.lineDashArray),n.vectorEffect&&t.setAttribute("vector-effect","non-scaling-stroke"),!0===n.T5||void 0===n.T5?t.setAttribute("visibility","visible"):t.setAttribute(
"visibility","hidden");var i=n.renderGradient;i&&i.gradientAttr&&(x(n),i.target&&t.setAttribute(i.target,"url(#"+i.id+")"))},y=function(t,n,i){"radial"===n?(null===i.cx||isNaN(i.cx)||t.setAttribute("cx",i.cx),null===i.cy||isNaN(i.cy)||t.setAttribute("cy",i.cy),null===i.r||isNaN(i.r)||t.setAttribute("r",i.r),null===i.fx||isNaN(i.fx)||t.setAttribute("fx",i.fx),null===i.fy||isNaN(i.fy)||t.setAttribute("fy",i.fy),null===i.fr||isNaN(i.fr)||t.setAttribute("fr",i.fr)):(null===i.x1||isNaN(i.x1)||t.setAttribute("x1",i.x1),null===i.y1||isNaN(i.y1)||t.setAttribute("y1",i.y1),null===i.x2||isNaN(i.x2)||t.setAttribute("x2",i.x2),null===i.y2||isNaN(i.y2)||t.setAttribute("y2",i.y2))},x=function(t){if(Object.prototype.hasOwnProperty.call(d,t.renderGradient.id)){var n=t.renderGradient.gradientAttr;if(d[t.renderGradient.id]!=JSON.stringify(n)){var i=l.childNodes;if(i)for(var r=0;r<i.length;r++)i[r].id===t.renderGradient.id&&l.removeChild(i[r]);E(t)}}else E(t)},E=function(t){
var n=t.renderGradient.gradientAttr,i=JSON.stringify(n),r=t.renderGradient.gradientAttr.type,s=g("radial"===r?"radialGradient":"linearGradient");l.appendChild(s),s.setAttribute("id",t.renderGradient.id);var u=n.location;y(s,r,u);var h=n.stopOffsets,e=n.stopColors;if(h&&0<h.length&&e&&0<e.length&&h.length===e.length)for(var o=0;o<h.length;o++)(f=g("stop")).setAttribute("offset",h[o]),f.setAttribute("stop-color",e[o]),s.appendChild(f);else{var f=g("stop");s.appendChild(f)}d[t.renderGradient.id]=i},C=function(t,n,i,r){t=r?t:g(t);e(t,n),!r&&v&&v.appendChild(t),i&&i.call(this,t)},N=function(t,n,i){null!=n&&i.getAttribute(t)!==n&&i.setAttribute(t,n)},O=function(t,n){t.setAttribute("transform",M(n.transform))},D=function(t,n){t.setAttribute("width",n.width),t.setAttribute("height",n.height)},_=function(t,n){var i=[],r=n.strokeColor?n.strokeColor.toString():null,s=n.fillColor?n.fillColor.toString():"transparent",u=n.T5?"visible":"hidden",h=n.vectorEffect?"non-scaling-stroke":"";i.push([
"transform",M(n.transform)]),i.push(["class",n.styleClass]),i.push(["vector-effect",h]),r?i.push(["stroke",r]):t.removeAttribute("stroke"),i.push(["fill",s]),i.push(["visibility",u]),i.push(["font-family",n.fontFamily]),i.push(["stroke-width",n.lineWidth]),n.lineDashArray?i.push(["stroke-dasharray",n.lineDashArray]):t.removeAttribute("stroke-dasharray");u=n.renderGradient;u&&u.gradientAttr&&(x(n),u.target&&i.push([u.target,"url(#"+u.id+")"]));for(var e=i.length,o=0;o<e;o++)N(i[o][0],i[o][1],t)},S=function(t){var n=t.childNodes;if(n)for(var i=n.length,r=0;r<i;++r){var s=n[r];if(s.FD){if(s.FD instanceof _t.SheetElement)continue;s.FD.E5=null,s.FD=null}else s.DF_SVG_Object&&(s.DF_SVG_Object=null);S(s)}};this.selectCanvas=function(t){v=t.E5,i=t},this.clearSvgElement=function(t,n){if(null==n)for(;t.firstChild;)t.removeChild(t.firstChild)},this.getCanvasOption=function(){return i.getCanvasOption()},this.isRendering=function(){return!1},this.setSheetToScreenTransform=function(t){r=t.getM0(),
s=t;t=o.Nx();this.A5(t,s),n.setAttribute("transform",M(s))},this.getSheetToScreenTransform=function(){return s},this.setStylePreference=function(t){t=t.getSheetConfigurationData();w=t.svgOverflowVisible},this.getZoomRatio=function(){return r},this.getVisualContextInternal=function(){return v},this.clear=function(){for(var t=o.Nx(),n=0,i=t.length;n<i;n++){var r=t[n];S(r.E5),this.clearSvgElement(r.E5)}Ti.prototype.clear.call(this)},this.beginRender=function(t,n,i,r){Ti.prototype.beginRender.call(this,t),this.selectCanvas(t),n&&this.clearSvgElement(v,i),r&&this.setInExporting(r.start,r.end),this.A5([t],s),t.getCanvasOption()==St.CanvasOption.OverlayCanvas&&(t=g("g"),v.appendChild(t),v=t)},this.renderElement=function(t,n){var i,r=t.E5;r||(i=t.guid,s=t.getId(),r=g("g",i,s),(t.E5=r).FD=t),r.setAttribute("visibility",p(t));var s=v;v=r,t.render(this),v=s,n&&this.appendObject(t)},this.clearElement=function(t){var n=t.E5;if(n){for(var i=n.childNodes,r=[],s=0;s<i.length;s++)i[s].FD||r.push(i[s])
;for(var u=0;u<r.length;u++)n.removeChild(r[u])}};function T(t){var n,i,r,s={dom:void 0,isHidden:void 0},u=t.lN();return u.isSheet?(i=(n=R(t)).E5,n.cO()?s.isHidden=!0:s.isHidden=!1):u.isLabel?i=o.getLabelCanvas():(r=u.owningElement&&u.owningElement.getRenderCanvas?R(u.owningElement):r)!==(t=R(t))?(i=t.E5,t.cO()?s.isHidden=!0:s.isHidden=!1):i=u.owningElement.E5,s.dom=i,s}function A(t,n){for(var i=t.FD,r=null,s=n.lastChild;null!=s;s=s.previousSibling){var u=s.FD;if(u!==i&&(!o.containLabelCanvas()||o.getLabelCanvas()!==s)){if(!u||!u.VD){if(St.CommonUtil.isDomTransient(s))continue;break}if(!(St.CommonUtil.compareElementsByCachedZDepth(i,u)<0))break;r=s}}r?n.insertBefore(t,r):P(n,t)}var R=function(t){return o.eO(t)},P=function(t,n){t===a&&o.containLabelCanvas()?t.insertBefore(n,o.getLabelCanvas()):t.appendChild(n)};this.updateElement=function(t,n,i,r){var s,u,h,e=t.E5;n?(void 0===e&&(s=t.guid,u=t.getId(),e=g("g",s,u),(t.E5=e).FD=t,this.appendObject(t)),(i||t.jD||m.start||m.end)&&(
this.updateDom(t,e),t.jD=!1),(u=(s=T(t)).dom)&&s.isHidden||(e.setAttribute("visibility",p(t)),u&&u.parentNode||(u=v),r?o.containLabelCanvas()?a.appendChild(o.getLabelCanvas()):a.appendChild(e):(h=e.parentNode)?u!==h?(h.removeChild(e),A(e,u),t.WD=!1):t.WD&&(A(e,u),t.WD=!1):(A(e,u),t.WD=!1))):((h=e.parentNode)&&h.removeChild(e),i&&(t.jD=!0))},this.removeElement=function(t){var n=t.E5;n&&(S(n),n.FD&&(n.FD=null),t.E5=null,(t=n.parentNode)&&t.removeChild(n))},this.updateDom=function(t,n){var i=v;v=n,t.updateRender(this),v=i},this.appendObject=function(t){var n=T(t).dom;n&&!function(t){var n=t.parentNode;if(!n)return!0;for(var i=a.parentNode;n;){if(!n)return!0;if(n===i)return!1;n=n.parentNode}return!1}(n)||(n=v),t.WD?A(t.E5,n):P(n,t.E5),t.WD=!1},this.removeSymbol=function(t){var n=t.E5;n&&(n.FD&&(n.FD=null),t.E5=null,Q(n).remove())},this.renderMarker=function(t,n){for(var i=0;i<n.length;++i){var r=n[i],s=g("g",t.guid);v.appendChild(s);var u=v;v=s,t.renderLineMarker(this,r),v=u}},
this.renderSymbol=function(t,n){var i,r=t.E5;r?this.updateRenderSymbol(t,n):(r=g("g",t.guid),(t.E5=r).FD=t,v.appendChild(r),i=v,v=r,t.render(this,n),v=i)},this.updateRenderSymbol=function(t,n){var i,r=t.E5;!r||t.zD?(t.zD&&(this.clearSymbol(t),t.E5=null),this.renderSymbol(t,n),t.zD=!1):(i=v,v=r,t.updateRender(this,n),v=i)},this.createSymbolRenderStyle=function(t){e(v,t)},this.updateSymbolRenderStyle=function(t){_(v,t)};function H(t,n){var i;return m.start&&(!t||(t=t.getOwner())&&(i=n.clone(),t.LD()?i.T5=!0:t.ID()&&(i.T5=!1))),i||n}this.renderSymbolGeometry=function(t,n,i){n=H(i,n);t.render(this,n,i)},this.updateRenderSymbolGeometry=function(t,n,i){n=H(i,n);t.updateRender(this,n,i)},this.renderOverlaySymbol=function(t,n){var i=t.guid,r=Q(v).find("#"+St.Constants.DOM_PREFIX+i).get(0);r?this.clearSvgElement(r):(r=g("g",i),v.appendChild(r));i=v;v=r,t.renderPreview(this,n),v=i},this.renderRect=function(n,t){C("rect",t,function(t){t.setAttribute("x",n.x),t.setAttribute("y",n.y),
t.setAttribute("width",n.width),t.setAttribute("height",n.height)})},this.updateRenderRect=function(n,t,i){k(i.E5,t,function(t){N("x",n.x,t),N("y",n.y,t),N("width",n.width,t),N("height",n.height,t)})},this.renderRoundedRect=function(n,i,r,t){C("rect",t,function(t){t.setAttribute("x",n.x),t.setAttribute("y",n.y),t.setAttribute("width",n.width),t.setAttribute("height",n.height),t.setAttribute("rx",i),t.setAttribute("ry",r)})},this.updateRenderRoundedRect=function(n,i,r,t,s){k(s.E5,t,function(t){N("width",n.width,t),N("height",n.height,t),N("rx",i,t),N("ry",r,t)})},this.renderTriangle=function(n,t){C("polygon",t,function(t){t.setAttribute("points",h(n))})},this.updateRenderTriangle=function(n,t,i){k(i.E5,t,function(t){N("points",h(n),t)})},this.renderCircle=function(n,t){C("circle",t,function(t){t.setAttribute("cx",n.x+n.width/2),t.setAttribute("cy",n.y+n.height/2),t.setAttribute("r",n.height/2)})},this.renderEllipse=function(n,t){C("ellipse",t,function(t){t.setAttribute("cx",
n.x+n.width/2),t.setAttribute("cy",n.y+n.height/2),t.setAttribute("rx",n.width/2),t.setAttribute("ry",n.height/2)})},this.updateRenderEllipse=function(n,t,i){k(i.E5,t,function(t){N("cx",n.x+n.width/2,t),N("cy",n.y+n.height/2,t),N("rx",n.width/2,t),N("ry",n.height/2,t)})},this.renderArc=function(u,h,e,o,t,n){C("path",t,function(t){var n=u.x+h*Math.cos(e),i=u.y+h*Math.sin(e),r=u.x+h*Math.cos(o),s=u.y+h*Math.sin(o);t.setAttribute("d","M"+n+","+i+" A"+h+","+h+" 0 0,0 "+r+","+s)})};function L(t){var n,i,r=0,s=t.indexOf("INDENT");return-1!==s&&(n=t.indexOf("'",s),i=t.indexOf("'",s+10),s=t.slice(s,i+1),r=parseInt(t.slice(n+1,i)),t=t.replace(new RegExp(s,"g"),"")),{text:t,indent:r}}function I(){var t,n;"function"==typeof window.webkitConvertPointFromNodeToPage&&(t=document.head,n=document.createElement("style"),t.appendChild(n),t.removeChild(n))}this.renderText=function(t,n){var i=St.RenderUtil.calculateTextAbscissa(n),r=St.RenderUtil.calculateTextOrdinate(n),s=(s=t.replace(
/\{textboxRef.xPos}/g,""+i)).replace(/\{textboxRef.dy}/g,""+r),u=L(s);u.indent&&(s=n.horizontalAlign===St.TextAlignment.START?u.text.replace(/\{textboxRef_indent.xPos}/g,""+i+u.indent):u.text.replace(/\{textboxRef_indent.xPos}/g,""+i)),c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+(s=""===s?"<text></text>":s)+"</svg>";s=c.firstChild.firstChild;for(s.realText=t,C(s,n,void 0,!0),s.setAttribute("x",i),s.setAttribute("y",r),v.appendChild(s),I();c.firstChild;)c.removeChild(c.firstChild)},this.updateRenderText=function(t,n,i){var r=i.E5.firstChild,s=St.RenderUtil.calculateTextAbscissa(n),u=St.RenderUtil.calculateTextOrdinate(n);if("null"===r.realText||r.realText!==t||!r){r&&i.E5.removeChild(r);var h=(h=t.replace(/\{textboxRef.xPos}/g,""+s)).replace(/\{textboxRef.dy}/g,""+1.1*u),e=L(h);for(e.indent&&(h=n.horizontalAlign===St.TextAlignment.START?e.text.replace(/\{textboxRef_indent.xPos}/g,""+s+e.indent):e.text.replace(
/\{textboxRef_indent.xPos}/g,""+s)),c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+(h=""===h?"<text></text>":h)+"</svg>",(r=c.firstChild.firstChild).realText=t,i.E5.appendChild(r);c.firstChild;)c.removeChild(c.firstChild)}r.setAttribute("x",s),r.setAttribute("y",u),k(i.E5,n,void 0),I()},this.renderTextWithinRect=function(n,i,t){C("text",t,function(t){t.setAttribute("x",i.getCenterX()),t.setAttribute("y",i.getCenterY()),t.textContent=n})};function F(t){for(var n="",i=t.length,r=0;r<i;r++)n=n+t[r].x+","+t[r].y+" ";return n}this.renderPolyline=function(t,n){var i=F(t);C("polyline",n,function(t){t.setAttribute("points",i)})},this.updateRenderPolyline=function(t,n,i){var r=F(t);k(i.E5,n,function(t){N("points",r,t)})},this.renderLines=function(u,t){var h=u.length;0<h&&C("g",t,function(t){for(var n=0;n<h;n++){var i=u[n],r=i.start,s=i.end,i=g("line");i.setAttribute("x1",r.x),i.setAttribute("y1",r.y),i.setAttribute("x2",s.x),i.setAttribute("y2"
,s.y),t.appendChild(i)}})},this.updateRenderLine=function(t,n,i){var r=t.start,s=t.end;k(i.E5,n,function(t){N("x1",r.x,t),N("y1",r.y,t),N("x2",s.x,t),N("y2",s.y,t)})},this.YD=function(t,n,i){var r="";return r=t&&0<t.length?(i===St.LineDisplayOption.CubicCurve?W:i===St.LineDisplayOption.QuadraticCurve?j:V)(t,n):r};var V=function(t,n){var i=n.jumperShape,r=t.length,s=.5*n.jumperWidth,u="";n.BD?(u="M "+n.BD.x+" "+n.BD.y,u+=" L "+t[0].x+" "+t[0].y):u="M "+t[0].x+" "+t[0].y;for(var h,e,o,f,a=1;a<r;++a)t[a].skip?(i==St.JumperShapeType.ARC?(h=t[a].x,e=t[a].y,o=t[a+1].x,f=t[a+1].y,u+=h<o||f<e?" L "+h+" "+e+" A "+s+" "+s+" 0 0 1 "+o+" "+f:" L "+h+" "+e+" A "+s+" "+s+" 0 0 0 "+o+" "+f):u+=" L "+t[a].x+" "+t[a].y+"M "+t[a+1].x+" "+t[a+1].y,++a):u+=" L "+t[a].x+" "+t[a].y;return n.ZD&&(u+=" L "+n.ZD.x+" "+n.ZD.y),u},j=function(t,n){var i="",r=t.length;n.BD?(i="M "+n.BD.x+" "+n.BD.y,i+=" L "+t[0].x+" "+t[0].y):i="M "+t[0].x+" "+t[0].y;for(var s=1;s<r;s++){if(2===r)return i+=" L "+t[s].x+" "+t[s].y,
n.ZD&&(i+=" L "+n.ZD.x+" "+n.ZD.y),i;1===s?(i+=" Q "+t[s].x+" "+t[s].y+" ",s++):i+=" T ",i+=s!==r-1?(t[s-1].x+t[s].x)/2+" "+(t[s-1].y+t[s].y)/2+" ":t[s].x+" "+t[s].y+" "}return n.ZD&&(i+=" L "+n.ZD.x+" "+n.ZD.y),i},W=function(t,n){var i="",r=t.length;if(r<=3)return j(t,n);n.BD?(i="M "+n.BD.x+" "+n.BD.y,i+=" L "+t[0].x+" "+t[0].y):i="M "+t[0].x+" "+t[0].y;for(var s=1;s<r;s++)1===s?(i+=" C "+t[s].x+" "+t[s].y+" ",s++):s===r-1?(i+=" Q ",s--):i+=" S ",i+=t[s].x+" "+t[s].y+" ",i+=(s=r<=++s?r-1:s)!==r-1?(t[s-1].x+t[s].x)/2+" "+(t[s-1].y+t[s].y)/2+" ":t[s].x+" "+t[s].y+" ";return n.ZD&&(i+=" L "+n.ZD.x+" "+n.ZD.y),i};this.UD=function(t,n){var i="";if(!t||t.length<=0)return i;var r=t.length,s=t[0];s&&0<s.length&&(n.BD?(i="M "+n.BD.x+" "+n.BD.y,i+=" L "+s[0].x+" "+s[0].y):i="M "+s[0].x+" "+s[0].y);for(var u=0;u<r;u++){var h=t[u].length;2===h?i+=" L ":3===h?i+=" Q ":4===h&&(i+=" C ");for(var e=1;e<h;e++)i+=t[u][e].x+" "+t[u][e].y+" "}return n.ZD&&(i+=" L "+n.ZD.x+" "+n.ZD.y),i},
this.renderCombinedConnectionPath=function(t,n,i){var r=i.E5;if(r)for(var s=r.childNodes,u=0,h=s.length;u<h;++u)r.removeChild(s[u]);else r=g("g",null),(i.E5=r).FD=i,v.appendChild(r);var e=v;v=r;var o=this.UD(t,i);C("path",n,function(t){t.setAttribute("d",o)}),v=e},this.updateRenderCombinedConnectionPath=function(t,n,i){var r,s;i&&(r=i.E5,s=this.UD(t,i),r?k(r,n,function(t){b("d",s,t)}):this.renderCombinedConnectionPath(t,n,i))},this.renderConnectionPath=function(t,n,i,r){var s=i.E5;if(s)for(var u=s.childNodes,h=0,e=u.length;h<e;++h)s.removeChild(u[h]);else s=g("g",null),(i.E5=s).FD=i,v.appendChild(s);var o=v;v=s;var f=this.YD(t,i,r);C("path",n,function(t){b("d",f,t)}),v=o},this.updateRenderConnectionPath=function(t,n,i,r){var s,u;i&&(s=i.E5,u=this.YD(t,i,r),s?k(s,n,function(t){b("d",u,t)}):this.renderConnectionPath(t,n,i,r))},this.GD=function(t,n){var i="";if(t&&0<t.length)if(n===St.LineDisplayOption.CubicCurve)i=W(t,{});else if(n===St.LineDisplayOption.QuadraticCurve)i=j(t,{}
);else for(var i="M "+t[0].x+" "+t[0].y,r=1;r<t.length;r++)i+=" L "+t[r].x+" "+t[r].y;return i},this.renderPath=function(t,i,r,n){var s;!r||(s=r.E5)&&(r.E5=null,s.FD=null,s.parentNode.removeChild(s));var u=this.GD(t,n);C("g",i,function(t){var n=g("path");n.setAttribute("d",u),i.vectorEffect&&n.setAttribute("vector-effect","non-scaling-stroke"),t.appendChild(n),r&&((r.E5=t).FD=r)})},this.updateRenderPath=function(t,n,i,r){var s,u;i&&(s=i.E5,u=this.GD(t,r),s?k(s,n,function(t){b("d",u,t)}):this.renderPath(t,n,i,r))};var z=function(t,n){var i=f.getRenderingSymbolSvg(t);return i||((i={}).symbol=n,f.addRenderingSymbolSvg(t,i)),i};this.updateSymbolCache=function(t,n){n.XD&&(n.XD=!1,f.removeRenderingSymbol(t),(t=document.getElementById(t))&&t.parentNode===l&&l.removeChild(t))},this.renderArrowhead=function(r,s){if(r&&s){var u=r.guid;this.updateSymbolCache(u,r);var h=z(u,r);if(h&&h.symbol&&!h.dom){c.innerHTML=r.getSvgContent();for(var t=g("g",u),n=c.children[0];n.firstChild;)t.appendChild(
n.firstChild);l.appendChild(t),h.dom=t}C("svg",s,function(t){if(D(t,s),r.isCached()){var n=g("use");n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+St.Constants.DOM_PREFIX+u),t.removeAttribute("transform"),O(t.parentNode,s),t.appendChild(n)}else{t.removeAttribute("transform"),O(t.parentNode,s);for(var i=h.dom.cloneNode(!0);i.firstChild;)t.appendChild(i.firstChild)}})}};var Y=function(t){function n(t){return t=1===(t=t.toString(16)).length?"0"+t:t}var i=t.red*t.alpha,r=t.green*t.alpha,t=t.blue*t.alpha;return n(i)+n(r)+n(t)},B=function(t,n){Q(t).find(".splm_df_fill").css("fill",n.toString())},Z=function(t,n,i,r){var s=n.guid,u=s,h=z(s,n);h.dom||(h.dom={});s=n.getSvgContent();i&&r&&(u=u+"_"+Y(r));n=h.dom[u];if(!n){c.innerHTML="<svg xmlns='http://www.w3.org/2000/svg'>"+s+"</svg>";for(var e=g("g",u),o=c.children[0];o.firstChild;){var f=o.firstChild;f.style&&(w&&!f.style.overflow?f.style.overflow="visible":!w&&f.style.overflow&&(f.style.overflow="")),e.appendChild(f)}
i&&r&&B(e,r),l.appendChild(e),h.dom[u]=n=e}return{defsID:u,svgDom:n}};this.renderSvg=function(r,s){if(r&&s){var u,h,t=r.guid;if(!(!r.getSVGTemplate()&&!r.$D)){var n=r.getEvaluatedSvgContent();if(r.qD)if("g"===v.tagName&&O(v,s),"string"==typeof n){for(c.innerHTML=n;c.firstChild;){var i=c.firstChild;if("svg"===i.tagName)for(;i.firstChild;)i.firstChild.DF_SVG_Object=r,v.appendChild(i.firstChild);c.removeChild(c.firstChild)}r.XD=!1}else n.parentNode||(n.DF_SVG_Object=r,v.appendChild(n)),r.XD=!1;else{var e=g("svg");if(D(e,s),e.style.overflow=w?"visible":"","g"===v.tagName&&O(v,s),"string"==typeof n){for(c.innerHTML=n;c.firstChild;)c.firstChild.DF_SVG_Object=r,e.appendChild(c.firstChild);v.appendChild(e),r.XD=!1}else n.DF_SVG_Object=r,e.appendChild(n),v.appendChild(e),r.XD=!1}}else this.updateSymbolCache(t,r),(n=r.getSvgContent())?(u=-1!==n.indexOf("data-df-fill"),h=Z(f,r,u,s.fillColor),C("svg",s,function(t){D(t,s),t.style.overflow=w?"visible":"",u&&t.setAttribute("fill","transparent")
;var n=t.parentNode;if("g"===n.tagName&&(t.removeAttribute("transform"),O(n,s)),r.isCached()){n=g("use");n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+St.Constants.DOM_PREFIX+h.defsID),n.setAttribute("pointer-events","none"),n.DF_SVG_Object=r,t.appendChild(n)}else for(var i=h.svgDom.cloneNode(!0);i.firstChild;)i.firstChild.DF_SVG_Object=r,t.appendChild(i.firstChild)})):r.XD=!0}},this.clearSymbol=function(t){if(t){var n=t.E5;if(n){for(S(n);n.firstChild;)n.removeChild(n.firstChild);return n}}};function U(t,n,i,r){(t=-1!==t.indexOf("data-df-fill"))&&(n.isCached()?(t=Z(f,n,t,i.fillColor),r.setAttribute("fill","transparent"),r.firstChild.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+St.Constants.DOM_PREFIX+t.defsID)):B(r,i.fillColor))}this.updateRenderSvg=function(n,i,t){var r,s,u=!(!n.getSVGTemplate()&&!n.$D),h=n.getEvaluatedSvgContent();n.XD?(r=v,(s=this.clearSymbol(t))&&(v=s),this.renderSvg(n,i),v=r):"g"==(t=t.E5).tagName&&(M(i.transform
)!=t.getAttribute("transform")&&O(t,i),u?n.qD||((u=t.firstChild).getAttribute("height")!=i.height&&D(u,i),u.getAttribute("width")!=i.width&&D(u,i),n.XD=!1):k(t,i,function(t){t.removeAttribute("transform"),D(t,i),t.style.overflow=w?"visible":"",U(h,n,i,t)}))},this.renderSvgPreview=function(i,r,t){t=t.E5;if(t&&"g"==t.tagName){var n=t.cloneNode(!0);if(i.getSVGTemplate()||i.$D){var s=g("g");for(r.transform&&s.setAttribute("transform",M(r.transform)),i.qD||((t=n.firstChild).getAttribute("height")!=r.height&&t.setAttribute("height",r.height),t.getAttribute("width")!=r.width&&t.setAttribute("width",r.width));n.firstChild;)s.appendChild(n.firstChild);v.appendChild(s)}else n.setAttribute("transform",M(r.transform)),k(n,r,function(t){t.removeAttribute("transform"),t.setAttribute("height",r.height),t.setAttribute("width",r.width);var n=i.getSvgContent();n&&U(n,i,r,t)}),v.appendChild(n)}},this.renderSvgContent=function(t,n,i){var r=this.getCurrentCanvas();if(i&&i.E5){for(;i.E5.firstChild;
)i.E5.removeChild(i.E5.firstChild);v=i.E5}c.innerHTML=t;var s=c.children[0];s.getAttribute("width")||s.setAttribute("width",n.width),s.getAttribute("height")||s.setAttribute("height",n.height),c.removeChild(s),C("g",n,function(t){t.appendChild(s)}),v=r},this.renderBitmap=function(r,s){var u,h;r&&s&&(u=St.Constants.DOM_PREFIX+r.guid,this.updateSymbolCache(u,r),h=z(u,r),X(r,h),C("svg",s,function(t){if(D(t,s),r.isCached()){var n=g("use");n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+u),t.removeAttribute("transform"),O(t.parentNode,s),t.appendChild(n)}else{t.removeAttribute("transform"),O(t.parentNode,s);for(var i=h.dom.cloneNode(!0);i.firstChild;)t.appendChild(i.firstChild)}}))},this.updateRenderBitmap=function(t,n,i){t.SVGTemplate;if(t.XD){var r=v;if(i){var s=i.E5;if(s){for(S(s);s.firstChild;)s.removeChild(s.firstChild);v=s}}this.renderBitmap(t,n),t.XD=!1,v=r}else{i=i.E5;"g"==i.tagName&&(O(i,n),k(i,n,function(t){t.removeAttribute("transform"),D(t,n)}))}},
this.renderBitmapUsingOriginalSize=function(t,n,i,r){if(t.KD&&t.JD)G(i,n,t.KD,t.JD,null,t,r);else{var s,u,h=t.getContent();if(h){var e=new Image;if(e.src=h,s=e.width,u=e.height,s&&u)return G(i,n,s,u,null,t,r),t.KD=s,void(t.JD=u);var o=this.getCurrentCanvas();e.onload=function(){t.KD&&t.JD||(t.KD=e.width,t.JD=e.height,G(i,n,e.width,e.height,o,t,r))}}}};var G=function(s,u,h,e,o,f,a){C("svg",s,function(t){D(t,s);var n="0,0,"+s.width+","+s.height;t.setAttribute("viewBox",n),c.innerHTML='<svg xmlns:xlink="http://www.w3.org/1999/xlink"></svg>';var i=c.children[0];if(c.removeChild(i),i.setAttribute("height",e),i.setAttribute("width",h),t.appendChild(i),f.isCached()){n=g("use");n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+St.Constants.DOM_PREFIX+u),t.removeAttribute("transform"),i.appendChild(n),o&&o.appendChild(t),O(t.parentNode,s)}else{t.removeAttribute("transform"),O(t.parentNode,s);for(var r=a.dom.cloneNode(!0);r.firstChild;)i.appendChild(r.firstChild);o&&o.appendChild(
t)}})};this.renderBitmapNoScale=function(t,n){var i,r;t&&n&&(i=t.guid,this.updateSymbolCache(i,t),r=z(i,t),X(t,r),this.renderBitmapUsingOriginalSize(t,i,n,r))};var X=function(t,n){var i,r=t.getContent();n&&n.symbol&&(n.dom||((i=g("image")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r),i.setAttribute("height","100%"),i.setAttribute("width","100%"),i.setAttribute("preserveAspectRatio","none meet"),(t=g("g",t.guid)).appendChild(i),l.appendChild(t),n.dom=t))};this.updateRenderBitmapNoScale=function(i,r,t){if(i.XD){i.KD=0,i.JD=0;var n=v;if(t){var s=t.E5;if(s){for(S(s);s.firstChild;)s.removeChild(s.firstChild);v=s}}this.renderBitmap(i,r),i.XD=!1,v=n}else i.KD&&i.JD&&("g"==(t=t.E5).tagName&&(O(t,r),k(t,r,function(t){t.removeAttribute("transform"),D(t,r);var n="0,0,"+r.width+","+r.height;t.setAttribute("viewBox",n);t=(t.children||t.childNodes)[0];t&&(t.setAttribute("height",i.JD),t.setAttribute("width",i.KD))})))},this.renderGrid=function(t,n,i,r){var s=n.j5();this.getCanvas(
).W5(s);var u,h=n.E5,e=n.isVisible()?"":"hidden";n.QD||!h?(s=n.t_(this),c.innerHTML=s,s=c.children[0],c.removeChild(s),s.setAttribute("visibility",e),n.E5=s,h?((u=h.parentNode).setAttribute("transform",M(t.transform)),u.removeChild(h)):(u=g("g")).setAttribute("transform",M(t.transform)),u.appendChild(s),v.appendChild(u)):"hidden"!=e&&(h.setAttribute("height",t.height),h.setAttribute("width",t.width),(e=h.lastChild).setAttribute("transform","translate("+i+","+r+")"),e.setAttribute("width","100%"),e.setAttribute("height","100%"),(e=h.parentNode)&&document.body.contains(e)?e.setAttribute("transform",M(t.transform)):((u=g("g")).setAttribute("transform",M(t.transform)),u.appendChild(h),v.appendChild(u)))},this.beginAnimateRender=function(t,n,i){this.beginRender(t,!1,i)},this.endAnimateRender=function(){this.setCurrentCanvas(null)},this.adjustStrokeWidthWithZoomRatio=function(t){t.vectorEffect=!1,t.lineWidth=t.lineWidth/r};function $(t){if(t){t=t.getOwner();if(t){t=t.getOwner();if(!(
t instanceof _t.Sheet))return t}}return null}function q(t,n){for(;t.parentNode!==a;)if(null==(t=t.parentNode))return;J(t,n)}function K(t,n){J(t,n)}var J=function(t,n){t.parentNode.insertBefore(n,t.nextSibling)};this.adjustConnectionDomOrder=function(t){var n,i,r,s,u=t.E5;u&&(i=t.getStart(),r=t.getEnd(),(n=$(i))===(s=$(r))?null!==n?n.isExpanded()&&n.E5.appendChild(u):a.insertBefore(u,a.firstChild):n&&s?(t=n.E5,i=s.E5,4===(r=t.compareDocumentPosition(i))?q(i,u):2===r?q(t,u):8==(8&r)?K(t,u):16==(16&r)&&K(i,u)):(s=(n||s).E5,q(s,u)))},this.pushOpacity=function(t){var n=g("g","preview");n.style.opacity=t,v.appendChild(n),v=n},this.popOpacity=function(){var t=St.Constants.DOM_PREFIX+St.Constants.DOM_OVERLAY_CANVAS;v=St.CommonUtil.queryDomBySdfId(t,u)},this.clearSymbolByLod=function(t){var n;t&&((n=this.clearSymbol(t))&&n.parentNode&&n.parentNode.removeChild(n),t.E5=null)},this.checkDomOutOfDate=function(t,n,i){
n.previousLod===St.LODType.DetailLevel&&n.currentLod===St.LODType.IntermediateLevel||n.previousLod===St.LODType.IntermediateLevel&&n.currentLod===St.LODType.DetailLevel?i.getIntermediateLevelSymbol()&&(i.jD=!0):n.previousLod===St.LODType.DetailLevel&&n.currentLod===St.LODType.OverviewLevel||n.previousLod===St.LODType.OverviewLevel&&n.currentLod===St.LODType.DetailLevel?i.getOverviewLevelSymbol()&&(i.jD=!0):n.previousLod===St.LODType.IntermediateLevel&&n.currentLod===St.LODType.OverviewLevel?(i.getOverviewLevelSymbol()||i.getIntermediateLevelSymbol())&&(i.jD=!0):n.previousLod===St.LODType.OverviewLevel&&n.currentLod===St.LODType.IntermediateLevel&&(i.getIntermediateLevelSymbol()||i.getOverviewLevelSymbol())&&(i.jD=!0),(t.n_(n,i,"arrowHead")||t.n_(n,i,"marker"))&&(i.jD=!0)}}function Gi(t,n,i){Li.call(this,t),this.i_=null,this.r_=n,this.s_=i,this.u_=null}Ti.inheritedBy(Ai),Li.prototype.getObjectByPoint=function(t,n,i){Dt.common.ExceptionHelper.throwNotImplemented(t)},
Li.prototype.h_=function(t){var n=t;return n=this.ZO===St.ElementCoordinateMode.Device?this.ex.getSheetToScreenTransform().transformPoint(t):n},Li.prototype.e_=function(t){return this.ZO===St.ElementCoordinateMode.Sheet&&(t/=this.ex.getSheetConfigurationData().viewData.getScaleFactor()),t},Dt.common.IdentifiableObject.inheritedBy(Li),Ii.prototype.o_=function(t,n,i,r,s,u,h){return console.log("PreciseSelectionTester.__selectByRendering is not implemented!"),!0},Ii.prototype.f_=function(t,n){for(var i=[],r=n.length,s=0;s<r;s++){var u=n[s];u.a_(t,this.o_.bind(this))&&i.push(u)}return i},Fi.prototype.c_=function(t,n,i){var r=this.ex.getIndexManager();if(r){n=r.uE(t,n,this.ZO);return St.CommonUtil.retrieveSheetElements(n,i)}return null},Fi.prototype.getObjectsByPoint=function(t,n,i){var r=this.e_(n),n=this.h_(t),t=this.c_(n,r,i);if(t){i=this.ex.getSheetSession();if(i&&i.l_){this.preciseSelectionTester||(this.preciseSelectionTester=new Ii);r=this.ensureContext(n,r)
;return this.preciseSelectionTester.f_(r,t)}}return t},Fi.prototype.getObjectByPoint=function(t,n,i){n=this.e_(n);if(t&&i){var t=this.h_(t),r=this.ensureContext(t,n);if(this.currentSelected&&this.currentSelected.select(r))return r.parent||(r.parent=this.currentSelected),void i.call(this,r);var s=this.c_(t,n);if(s&&0<s.length)for(var u=s.length-1;0<=u;u--){var h=s[u];if((r.parent=h).select(r))return this.currentSelected=h,void i.call(this,r)}i.call(this,r)}},Li.inheritedBy(Fi),Vi.prototype.clear=function(){this.CD={},this.ND=new ci,this.tM=null},Vi.prototype.visit=function(t,n){for(var i=d.prototype.visit.call(this,t,n);i.length;){var r=i.pop();if(r.isBackground){var s=r.guid;switch(r.wM){case Dt.ChangeType.Remove:(this.CD[s]=r).v_=Dt.ChangeType.Remove;break;case Dt.ChangeType.Add:(this.CD[s]=r).v_!==Dt.ChangeType.Remove&&(r.v_=Dt.ChangeType.Add);break;case Dt.ChangeType.Property:n.needsToRedrawSheet()&&(this.CD[s]=r).v_!==Dt.ChangeType.Remove&&r.v_!==Dt.ChangeType.Add&&(
r.v_=Dt.ChangeType.Property)}}}},Vi.prototype.cM=function(){for(var t in this.CD){t=this.CD[t];this.w_(t,t.v_),delete t.v_}this.d_()},Vi.prototype.w_=function(t,n){var i=t.getRenderCanvas(),r=this.ED.uD(t);if(this.ED.J5(i))if(r)if(n!==Dt.ChangeType.Remove)if(r!==i)for(var s=this.m_(t),u=0,h=s.length;u<h;u++){var e=s[u];this.g_(r,e,Dt.ChangeType.Remove),this.g_(i,e,Dt.ChangeType.Add)}else this.g_(i,t,n);else this.g_(r,t,Dt.ChangeType.Remove);else n!==Dt.ChangeType.Remove?this.g_(i,t,Dt.ChangeType.Add):this.g_(i,t,Dt.ChangeType.Remove);else;},Vi.prototype.m_=function(t){for(var n=[t],i=t.M_(),r=i?i.length:0,s=0;s<r;s++){var u=i[s];u instanceof _t.SheetElement&&(u=this.m_(u),n=n.concat(u))}return n},Vi.prototype.g_=function(t,n,i){var r="add";switch(i){case Dt.ChangeType.Add:r="add";break;case Dt.ChangeType.Remove:r="remove";break;case Dt.ChangeType.Property:r="update";break;default:Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,
"Invalid change type: "+i)}this.ND.iO(n,t,r)},Vi.prototype.hO=function(){return this.ND.hO()},Vi.prototype.d_=function(){var t,n=this.tM,i=this.ND.sO();for(t in i)if(Object.prototype.hasOwnProperty.call(i,t)){var r=i[t].NN.getCanvasOption();switch(r){case St.CanvasOption.ElementCanvas:case St.CanvasOption.SheetFeatureCanvas:n.needsToRedrawSheet=!0;break;case St.CanvasOption.ViewFeatureCanvas:n.p_=!0;break;default:Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,"Invalid canvas option: "+r)}}},Vi.prototype.i5=function(){return this.ND.sO()},d.inheritedBy(Vi),ji.prototype.clear=function(){Vi.prototype.clear.call(this)},Vi.inheritedBy(ji),Wi.prototype.destroy=function(){this.getSession().b_(this.getVisitor()),this.fN().k_(this),di.prototype.destroy.call(this)},Wi.prototype.render=function(t){this.y_(t),mi.prototype.render.call(this,t)},Wi.prototype.y_=function(t){di.VO(this,t)},Wi.createContext=function(t,n){var i=t.getSymbolCache();return new Ai(new Si(n
,t.fN()),i)},Wi.prototype.UO=function(){var t;return this.OD||(t=this.getManager(),this.OD=new Fi(t),this.OD.ZO=St.ElementCoordinateMode.Device),this.OD},mi.inheritedBy(Wi),zi.prototype.JO=function(){return this.renderingMode},zi.prototype.yO=function(t,a){var c=this,l=this.getSession(),v=this.getManager(),w=this.getContext(),d=l.ok(),m=!(d.currentLod===St.LODType.None),g=new St.Rect(0,0,w.width(),w.height());St.CommonUtil.waitUntil(function(){return!0!==w.isRendering()},function(){var t=a.NN,n=a.iM,i=a.rM,r=a.nM;c.x_(i),v.getSheet().getSession().E_||(St.CommonUtil.sortSheetElements(n),St.CommonUtil.sortSheetElements(r));for(var s={createdList:[],modifiedList:[],overlayList:[]},u=0,h=n.length;u<h;++u)(e=n[u]).C_()&&(o=c.FO(e,g,m,d,l),s.createdList.push({candidate:e,inScreen:o,isCreate:!0}),e.wM=2);for(var e,o,f=0,h=r.length;f<h;++f)(e=r[f]).C_()&&(o=c.FO(e,g,m,d,l),s.modifiedList.push({candidate:e,inScreen:o,isCreate:!1}));c.N_(w,s,l,t)})},zi.prototype.O_=function(t){
t.createdList.forEach(function(t){t.candidate.D_=t.inScreen}),t.modifiedList.forEach(function(t){t.candidate.D_=t.inScreen})},zi.prototype.N_=function(t,n,i,r){i.mO()?(this.ik(t,n),this.n5(n)):(this.__(t,n),this.S_(n,r)),this.O_(n)},zi.prototype.n5=function(t){this.T_(t);this.pO().SN(t)},zi.prototype.T_=function(t){var r=[];return t.createdList.forEach(function(t){var n=t.inScreen,i=t.candidate.D_;!n&&i&&(t.inScreen=!0,r.push(t))}),t.modifiedList.forEach(function(t){var n=t.inScreen,i=t.candidate.D_;!n&&i&&(t.inScreen=!0,r.push(t))}),r},zi.prototype.ik=function(n,t){(t.createdList.length||t.modifiedList.length)&&(t.createdList.forEach(function(t){t.candidate.ME(n)}),t.modifiedList.forEach(function(t){t.candidate.ME(n)}))},zi.prototype.__=function(n,t){(t.createdList.length||t.modifiedList.length)&&(t.createdList.forEach(function(t){t.candidate.A_(n)}),t.modifiedList.forEach(function(t){t.candidate.A_(n)}))},zi.prototype.S_=function(t,n){var i=this.getContext();i.beginRender(n,!1,null),
(t.createdList.length||t.modifiedList.length)&&(t.createdList.forEach(function(t){i.renderElement(t.candidate,t.inScreen)}),t.modifiedList.forEach(function(t){i.updateElement(t.candidate,t.inScreen,!0)})),i.endRender()},zi.prototype.l5=function(t){this.renderElements({duringFitAnimation:!0},function(t){return t.ZO===St.ElementCoordinateMode.Device}),t&&t()},zi.prototype.YN=function(t){for(var n in t){var i,r;Object.prototype.hasOwnProperty.call(t,n)&&(r=i=t[n],(i=(n=i.tarCanvas).getCanvasOption())===St.CanvasOption.ElementCanvas?this.S_(r,n):i!==St.CanvasOption.OverlayCanvas||0<(r=r.createdList).length&&this.MO(r,n))}},zi.prototype.renderViewFeaturesOnCanvas=function(t,r){var s=this.getContext(),u=this.getSession().ok();St.CommonUtil.waitUntil(function(){return!0!==s.isRendering()},function(){s.beginRender(r,!1,null);var t=r.vO();if(t&&0<t.length)for(var n=0;n<t.length;n++){var i=t[n];u.isChanged&&(u.currentLod!==St.LODType.OverviewLevel&&u.previousLod!==St.LODType.OverviewLevel||(
i.QD=!0)),i.render(s)}s.endRender()})},zi.prototype.renderElementsOnCanvas=function(c,l){var v=this,w=this.getContext(),d=this.getManager(),m=v.getSession(),g=m.ok(),M=!(g.currentLod===St.LODType.None);St.CommonUtil.waitUntil(function(){return!0!==w.isRendering()},function(){var t=c.updateFlags&Dt.RenderUpdateFlags.AllElements,n={};n.start=c.updateFlags&Dt.RenderUpdateFlags.ExportStart,n.end=c.updateFlags&Dt.RenderUpdateFlags.ExportEnd,w.beginRender(l,!1,null,n);var i=d.getSheet(),r=(d.getIndexManager(),l.vO()),s={createdList:[],modifiedList:[]};if(r){var u=i.getSession().E_||c.duringFitAnimation;r.sort(St.CommonUtil.compareElementsByCachedZDepth);for(var h=new St.Rect(0,0,w.width(),w.height()),e=r.length,o=0;o<e;o++){var f,a=r[o];a.C_()&&(f=void 0,n.start&&(a.ID()&&(f=!1),a.LD()&&(f=!0)),void 0===f&&(f=!!t||v.FO(a,h,M,g,m)),a.E5?(g.isChanged&&w.dirtyRenderByLod(m,g,a),s.modifiedList.push({candidate:a,inScreen:f,updateDomFlag:u})):s.createdList.push({candidate:a,inScreen:f}),a.wM=2)}
c.isAnimation&&c.fitAnimation&&v.T_(s),v.R_(w,s)}w.endRender()})},zi.prototype.R_=function(n,t){this.ik(n,t),t.modifiedList.forEach(function(t){n.updateElement(t.candidate,t.inScreen,t.updateDomFlag)}),t.createdList.forEach(function(t){n.renderElement(t.candidate,t.inScreen)})},zi.prototype.x_=function(t){for(var n=this.getContext(),i=0,r=t.length;i<r;++i){var s=t[i];n.removeElement(s)}},zi.prototype.render=function(t){var n=this.getVisitor().i5();this.clearVisitor(),this.renderRun(t,n)},zi.prototype.renderRun=function(t,n){var i=this.getContext(),r=this.getSession();i.setStylePreference(r);var s=this.AO(t);s.RO&&this.TO(),t.isAnimation&&t.fitAnimation&&this.getManager().getAnimation().doAnimate([],i,this.renderingMode);n=this.NO(n);n&&this.kO(t,n),s.HO&&this.renderViewFeatures(t),s.PO&&this.renderElements(t),s.LO&&this.renderOverlays(t),r.mO()?(t=this.gE.bind(this),this.pO().HN(i,r,t)):this.gE()},zi.prototype.clearVisitor=function(){this.getVisitor().clear()},di.inheritedBy(zi),
Yi.prototype.YO=function(t){this.TD.YO(t),this.AD.YO(t);t=this.TD.fN();this.ED.P_(t)},Dt.common.IdentifiableObject.inheritedBy(Yi),Bi.prototype.setSize=function(t,n){Oi.prototype.setSize.call(this,t,n);var i=this.getWrapper();i.style.width=t+"px",i.style.height=n+"px";for(var r=[this.getSymbolDefs()],s=this.Nx(),u=0,h=s.length;u<h;u++){var e=s[u].E5;r.push(e)}for(u=0,h=r.length;u<h;u++){var o=function(t,n){for(var i=null;t;){var r=t.parentNode;if(r&&r.tagName===n){i=r;break}}return i}(r[u],"svg");o?(o.style.width=t+"px",o.style.height=n+"px"):Dt.DebugFlags.CheckRendering&&window.console&&window.console.error("There is no <svg> for <g> canvas: "+u)}},Bi.prototype.getRenderingMode=function(){return St.RenderingMode.Svg},Bi.prototype.yD=function(){return this.getSymbolDefs()},Bi.prototype.vD=function(t){return new Di(t,this.getRenderingMode())},Bi.prototype.mD=function(t,n){n=n?n.E5:this.yD();this.getSvgRoot()?Oi.xD(t.E5,n):("svg"!==(n=n.parentNode
).tagName&&Dt.DebugFlags.CheckRendering&&window.console&&window.console.error("pre-dom parent is not <svg>"),(t=t.E5).parentNode&&"svg"===t.parentNode.tagName||Bi.H_(St.CommonUtil.getSdfIdOnDom(t)+"_gWrapper",n,t),Oi.xD(t.parentNode,n))},Bi.prototype.eD=function(t){t=t.E5;this.getSvgRoot()?t.parentNode.removeChild(t):(t=t.parentNode).parentNode.removeChild(t)},Bi.prototype.dD=function(t,n){var i=Zi("g",n);switch(t){case St.CanvasOption.ViewFeatureCanvas:i.style.pointerEvents="none";break;case St.CanvasOption.SheetFeatureCanvas:case St.CanvasOption.ElementCanvas:this.L_(i);break;case St.CanvasOption.OverlayCanvas:i.style.pointerEvents="none",this.L_(i);break;default:Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,"Invalid Canvas Option: "+t)}return i},Bi.prototype.L_=function(t){("function"==typeof window.webkitConvertPointFromNodeToPage||(window.chrome||window.Intl&&Intl.v8BreakIterator)&&"CSS"in window)&&(t.style.outline="3px solid transparent")},
Bi.H_=function(t,n,i){n=n.cloneNode(!1);return n&&(St.CommonUtil.setSdfIdOnDom(n,St.Constants.DOM_PREFIX+t),n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.appendChild(i)),n},Oi.inheritedBy(Bi),Ui.prototype.endRender=function(){Ti.prototype.endRender.call(this),this.setCurrentCanvas(null),this.setInExporting(!1,!1)},Ui.prototype.dirtyRenderByLod=function(t,n,i){this.checkDomOutOfDate(t,n,i)},Ui.prototype.BO=function(t,n){t=Ti.prototype.BO.call(this,t,n),n=this.getSheetToScreenTransform();this.A5(t,n)},Ti.inheritedBy(Ui);function Xi(t,n,i){i=Xi.createContext(n,i);zi.call(this,t,n,i);i=new Vi(i.getCanvas());this.setVisitor(i),n.$C(i);i=new Fi(t);t.setSelectionStrategy(i);i=this.fN();this.OD=null,i.DD()&&(this.OD=this.UO(),i._D(this.OD)),i.SD(this),di.hookCanvasEvents(this.getCanvas(),t)}function $i(t,n,i){Oi.call(this,t),this.I_=n,this.F_=i,this.hc(t),this.width=function(){return this.F_.width()},this.height=function(){return this.F_.height()},this.setSize=function(t,n
){this.I_.setSize(t,n),this.F_.setSize(t,n)},this.getOverlayDiv=function(){return this.I_.getOverlayDiv()},this.getInteractionCanvas=function(){return this.F_.getInteractionCanvas()},this.getWrapper=function(){return this.F_.getWrapper()}}function qi(t){Vi.call(this,t),this.V_=[]}function Ki(t,n,i){Dt.common.IdentifiableObject.call(this),this.j_=t,this.r_=n,this.TD=this.W_(i),this.AD=this.z_(i);var r=this.Y_();this.TD.SO(r),this.AD.SO(r);var s=this.TD.getCanvas(),r=this.AD.getCanvas();this.B_=new $i(i,s,r),this.Z_=new Yi(this.TD,this.AD,this.B_),this.U_=new qi(this.B_),n.$C(this.U_);r=new Fi(t);t.setSelectionStrategy(r);n=n.fN();this.OD=null,n.DD()&&(this.OD=this.UO(),n._D(this.OD)),this.G_(),n.SD(this.Z_),di.hookCanvasEvents(this.B_,t)}function Ji(t,i,n,r){var s,u=null,h=null,e=i.CM(),o=(u=new(r==St.RenderingMode.Svg?Xi:r==St.RenderingMode.Hybrid?Ki:Wi)(t,i,n)).getCanvas();i.dN=_n.initialize(o),e&&e.register(Dt.messages.RedrawMessage,this,function(t){var n;!i||(
n=i.getPerformanceCounter())&&n.preRendering(),s=t.renderData,u.render(s),h&&h.render(s)}),this.setSize=function(t,n){u.setSize(t,n)},this.X_=function(t){h=t},this.getCanvas=function(){return o},this.clear=function(){u.clear(),h&&h.clear()},this.destroy=function(){u.destroy(),h&&h.destroy();var t=i.CM();t&&t.tN(Dt.messages.RedrawMessage,this),i.dN=null}}function Qi(t){this.connection=t,this.Ck=null,this.q_=0,this.K_=0,this.yk=0,this.pk=!1,this.startPoint=null,this.xk=null,this.J_=null,this.endPoint=null,this.Ek=null,this.Lk=null,this.Sk=null,this.Tk=null,this.Ik=!1,this.Q_=null,this.sS=null,this.Ok=0,this.Nk=null,this._k=null,this.Dk=null,this.uS=null}function tr(){this.minSegmentLength=20}Gi.prototype.hS=function(t){for(var n=this.s_.getSvgRoot(),i=t;i&&i!==n;){if(null!=i.id&&void 0!==i.id&&""!==i.id){var r=i.FD||this.r_.getBaseObject(i.id);if(r&&r instanceof _t.SheetElement)return r}i=i.parentNode}},Gi.prototype.eS=function(t){for(var n=[],i=this.s_.getSvgRoot(),r=t.point,
t=this.s_.offset(),s=document.elementsFromPoint(r.x+t.left,r.y+t.top),u=0,h=s.length;u<h;u++){var e=s[u];!function(t,n){if("function"==typeof t.contains)return t!==n&&t.contains(n);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(n));var i=n.parentNode;do{if(i===t)return!0}while(null!==(i=i.parentNode));return!1}(i,e)||(e=this.hS(e))&&n.push(e)}return 1<n.length&&St.CommonUtil.sortSheetElements(n),n},Gi.prototype.getObjectsByPoint=function(t,n,i){var r=this.e_(n),n=this.h_(t),t=this.ensureContext(n,r),n=this.eS(t);if(n){r=this.r_;if(r&&r.l_)return this.u_||(this.u_=new Ii),this.u_.f_(t,n)}return n},Gi.prototype.getObjectByPoint=function(t,n,i){n=this.e_(n);if(t&&i){var t=this.h_(t),r=this.ensureContext(t,n);if(this.i_&&this.i_.select(r))return r.parent||(r.parent=this.i_),void i.call(this,r);var s=this.eS(r);if(s&&0<s.length)for(var u=s.length-1;0<=u;u--){var h=s[u];if((r.parent=h).select(r))return this.i_=h,void i.call(this,r)}}},Li.inheritedBy(Gi)
,Xi.prototype.destroy=function(){this.getSession().b_(this.getVisitor()),this.fN().k_(this),di.prototype.destroy.call(this)},Xi.prototype.render=function(t){this.y_(t),zi.prototype.render.call(this,t)},Xi.prototype.y_=function(t){di.VO(this,t)},Xi.createContext=function(t,n){var i=t.getSymbolCache();return new Ui(new Bi(n,i,t.fN()),i)},Xi.prototype.UO=function(){var t;return this.OD||(t=this.getManager(),this.OD=new Fi(t),this.OD.ZO=St.ElementCoordinateMode.Device),this.OD},zi.inheritedBy(Xi),$i.prototype.hc=function(t){var n=this.I_,i=this.F_,r=n.getWrapper(),s=i.getWrapper(),u=n.getSymbolDefs(),h=(n.getSvgImageDiv(),n.getViewFeatureCanvas()),e=n.getSheetFeatureCanvas(),o=n.getMainCanvas(),f=n.getOverlayCanvas(),a=(i.getSvgImageDiv(),i.getViewFeatureCanvas()),c=i.getSheetFeatureCanvas(),l=i.getMainCanvas(),v=i.getOverlayCanvas(),w=n.getSvgRoot();r.removeChild(w),n.PD(null);i=St.CommonUtil,u=Bi.H_(i.getSdfIdOnDom(u)+"_gWrapper",w,u),h=Bi.H_(i.getSdfIdOnDom(h)+"_gWrapper",w,h),e=Bi.H_(
i.getSdfIdOnDom(e)+"_gWrapper",w,e),o=Bi.H_(i.getSdfIdOnDom(o)+"_gWrapper",w,o),f=Bi.H_(i.getSdfIdOnDom(f)+"_gWrapper",w,f);for(s.insertBefore(u,a),s.insertBefore(h,a),s.insertBefore(e,c),s.insertBefore(o,l),s.insertBefore(f,v);r.firstChild;)s.appendChild(r.firstChild);t.removeChild(r),n.HD(s)},$i.prototype.P_=function(t){for(var n=t.oN(),i=null,r=0,s=n.length;r<s;r++){var u=n[r];u.cO()||(this.oS(u,i),i=u)}},$i.prototype.oS=function(t,n){var i=this.I_,r=this.F_,s=null;s=n?(n=r.CO(n))[n.length-1].E5:(s=i.yD()).parentNode;for(var u=i.CO(t),h=0,e=u.length;h<e;h++){var o=(a=u[h].E5).parentNode;Oi.xD(o,s),s=o}for(var f=r.CO(t),h=0,e=f.length;h<e;h++){var a=f[h].E5;Oi.xD(a,s),s=a}},$i.prototype.uD=function(t){return this.I_.uD(t)||this.F_.uD(t)},$i.prototype.J5=function(t){return this.I_.J5(t)},$i.prototype.fS=function(t){return t===St.RenderingMode.Svg?this.I_:t===St.RenderingMode.Canvas?this.F_:null},Oi.inheritedBy($i),qi.prototype.clear=function(){this.V_=[],Vi.prototype.clear.call(this)}
,qi.prototype.aS=function(t,n,i){var r=this.ED.fS(n).K5(t);this.V_.push({rcCanvas:t,fromMode:n,toMode:i,objList:r})},qi.prototype.cS=function(t){return this.lS(t).sO()},qi.prototype.lS=function(t){for(var n=this.hO(),i=this.V_,r=0,s=i.length;r<s;r++){var u=i[r],h=u.rcCanvas,e="add";if(u.fromMode===t)e="remove";else{if(u.toMode!==t){Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,"switch mode has incorrect data");continue}e="add"}for(var o=u.objList,f=0,a=o.length;f<a;f++){var c=o[f];n.iO(c,h,e)}}return n},Vi.inheritedBy(qi),Ki.prototype.W_=function(t){var n=this.j_,i=this.r_;return new zi(n,i,Xi.createContext(i,t))},Ki.prototype.z_=function(t){var n=this.j_,i=this.r_;return new mi(n,i,Wi.createContext(i,t))},Ki.prototype.getSession=function(){return this.r_},Ki.prototype.getManager=function(){return this.j_},Ki.prototype.render=function(t){this.y_(t);var n=this.U_,i=n.cS(St.RenderingMode.Svg);this.TD.renderRun(t,i),i=n.cS(St.RenderingMode.Canvas),
this.AD.renderRun(t,i),n.clear()},Ki.prototype.getCanvas=function(){return this.B_},Ki.prototype.setSize=function(t,n){this.B_.setSize(t,n)},Ki.prototype.clear=function(){this.TD.clear(),this.AD.clear()},Ki.prototype.destroy=function(){this.TD.destroy(),this.AD.destroy(),this.getSession().b_(this.U_),this.r_.fN().k_(this)},Ki.prototype.y_=function(t){di.VO(this,t),this.vS(t)},Ki.prototype.vS=function(t){var n=this.r_,i=this.U_,r=null,s=n.ok();if(s.isChanged&&(s.currentLod===St.LODType.OverviewLevel?r=St.RenderingMode.Canvas:s.previousLod===St.LODType.OverviewLevel&&(r=St.RenderingMode.Svg)),null!==r)for(var u=n.fN().oN(),h=0,e=u.length;h<e;h++){var o,f=u[h];f.wS()&&((o=f.dS())!==r&&(i.aS(f,o,r),f.mS(r),t.updateFlags|=Dt.RenderUpdateFlags.SheetElements))}},Ki.prototype.Y_=function(){return function(t,n,i){return n.dS()===i.JO()?t:[]}},Ki.prototype.UO=function(){var t;return this.OD||(t=this.j_,this.OD=new Fi(t),this.OD.ZO=St.ElementCoordinateMode.Device),this.OD},
Ki.prototype.G_=function(){function t(){return n.UO()}var n=this;this.TD.UO=t,this.AD.UO=t,this.Z_.UO=t},Dt.common.IdentifiableObject.inheritedBy(Ki),Qi.prototype.gS=function(){var t=this.Nk;return[(t=t||this.startPoint).x,t.y]},Qi.prototype.MS=function(){var t=this._k;return 1<(t=t||this.xk).length?[0,0]:[t[0].x,t[0].y]},Qi.prototype.pS=function(){var t=this.Dk;return[(t=t||this.endPoint).x,t.y]},Qi.prototype.bS=function(){var t=this.uS;return 1<(t=t||this.Ek).length?[0,0]:[t[0].x,t[0].y]},Qi.prototype.kS=function(){if(this.Sk&&this.Sk.XM()&_t.HighlightFlags.Focused)return!0;return!1},Qi.prototype.yS=function(){if(this.Tk&&this.Tk.XM()&_t.HighlightFlags.Focused)return!0;return!1},Qi.prototype.xS=function(){if(this.connection&&this.connection.XM()&_t.HighlightFlags.Focused)return!0;return!1},tr.prototype.mk=function(){return{}},tr.prototype.gk=function(t,n){},tr.prototype.findPaths=function(t){for(var n={},i=0,r=t.length;i<r;i++){var s=t[i];n[s.connection.guid]=this.Mk(s)}return n},
tr.prototype.Mk=function(t){var n=t.yk,i=t.connection.getSession().getSheetConfigurationData().minNodeToEdgeDist,i=i>this.minSegmentLength?i:this.minSegmentLength;return n==St.RoutingReason.Created?this.ES(t,i):this.CS(t,i)},tr.prototype.generateRoute=function(t,n,i,r,s,u){var h=[i];0===i.x&&0===i.y&&(h=[new St.Vector(1,0),new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)]);i=[s];return 0===s.x&&0===s.y&&(i=[new St.Vector(1,0),new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)]),this.NS(t,n,h,0,r,i,0,u)};function nr(t,n,i,r){var s,u,h;return t.equal(St.Vector.PositiveX)?(!n||!i||0!==St.MathUtil.doubleCompare(n.y,i.y))&&n&&i&&n.y>i.y?[new St.Vector(1,0),new St.Vector(0,-1),new St.Vector(0,1)]:[new St.Vector(1,0),new St.Vector(0,1),new St.Vector(0,-1)]:t.equal(St.Vector.PositiveY)?n&&i&&0===St.MathUtil.doubleCompare(n.x,i.x)||n&&i&&n.x>i.x?[new St.Vector(0,1),new St.Vector(-1,0),new St.Vector(1,0)]:[new St.Vector(0,1),new St.Vector(1,0),new St.Vector(-1,0)]:t.equal(
St.Vector.NegativeX)?n&&i&&0===St.MathUtil.doubleCompare(n.y,i.y)||n&&i&&n.y>i.y?[new St.Vector(-1,0),new St.Vector(0,-1),new St.Vector(0,1)]:[new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)]:t.equal(St.Vector.NegativeY)?(!n||!i||0!==St.MathUtil.doubleCompare(n.x,i.x))&&n&&i&&n.x>i.x?[new St.Vector(0,-1),new St.Vector(-1,0),new St.Vector(1,0)]:[new St.Vector(0,-1),new St.Vector(1,0),new St.Vector(-1,0)]:0<t.x?[new St.Vector(1,0),new St.Vector(0,1),new St.Vector(0,-1)]:0<t.y?[new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)]:(h=0<(s=i.x-n.x)?1:-1,t=0<(u=i.y-n.y)?1:-1,n=i=void 0,n=Math.abs(u)>Math.abs(s)?(i=new St.Vector(0,t),new St.Vector(h,0)):(i=new St.Vector(h,0),new St.Vector(0,t)),r&&n.equal(r)&&(n=i,i=r),[i,n,i.negate(),n.negate()])}function ir(t,n,i,r){var s;if(1==n.length&&(s=n[0],0===St.MathUtil.doubleCompare(s.x,0)&&0===St.MathUtil.doubleCompare(s.y,0)&&(n=nr(s,t,i))),1==r.length&&(s=r[0],0===St.MathUtil.doubleCompare(s.x,0)&&0===St.MathUtil.doubleCompare(
s.y,0)&&(r=nr(s,i,t))),0===St.MathUtil.doubleCompare(t.x,i.x)||0===St.MathUtil.doubleCompare(t.y,i.y))for(var u=n.length,h=r.length,e=(e=new St.Vector(i.x-t.x,i.y-t.y)).normalize(),o=0;o<u;o++){var f=n[o].normalize();if(e.equal(f))for(var a=0;a<h;a++){var c=r[a].normalize();if(e.equal(c.negate()))return[t,i]}}return null}tr.prototype.CS=function(t,n){var i=t.startPoint.clone(),r=t.endPoint.clone();if(0===St.MathUtil.doubleCompare(i.x,r.x)&&0===St.MathUtil.doubleCompare(i.y,r.y))return[i,r];var s=t.connection;if(!s.isInCreating&&!t.Ik&&!function(t){if(t&&1<t.length)for(var n=t.length,i=0;i<n-1;i++){var r=t[i],s=t[i+1];if(0!==St.MathUtil.doubleCompare(r.x,s.x)&&0!==St.MathUtil.doubleCompare(r.y,s.y))return!0}return!1}(t.Ck)){var u=void 0;if(t.yk&St.RoutingReason.StartPointMoved?u=ir(r,t.Ek,t.Nk,t.xk):t.yk&St.RoutingReason.EndPointMoved&&(u=ir(t.Nk,t.Ek,i,t.xk)),u)return t.yk=St.RoutingReason.EndPointMoved,t.Ok=0,u}var h=t.Nk.clone(),e=t._k,o=t.Dk.clone(),f=t.uS,a=t.q_,c=t.K_,u=t.Q_,
t=t.sS;return this.NS(s,h,e,a,o,f,c,n,i,r,u,t)};function rr(t,n,i){if(St.CommonUtil.removeCollinearPoints(t),2<=(s=t.length)){var r=new St.Vector(t[1].x-t[0].x,t[1].y-t[0].y).normalize(),s=new St.Vector(t[s-2].x-t[s-1].x,t[s-2].y-t[s-1].y).normalize();if((0===n.x&&0===n.y||r.equal(n))&&(0===i.x&&0===i.y||s.equal(i)))return t}return null}function sr(t){var n=(this.OS=t).getSheetConfigurationData(),i=n.minNodeToEdgeDist||20,t=n.minSegmentLength||20;this.minSegmentLength=t,this.minPortExtensionDist=n.minPortExtensionDist,this.nodeDist={x:2*i,y:2*i},this.DS={x:t,y:t},this._S={w:5,h:5},this.minNodeSize={w:0,h:0},this.SS=!1,this.Li={up:"up",down:"down",left:"left",right:"right"}}function ur(t,n){this.TS=[],this.AS=[],this.RS=[],this.PS=[],this.HS=[],this.LS=[],this.OS=t,this.IS=n,this.FS()}tr.prototype.VS=function(t,n,i,r,s,u){for(var h=[],e=n.length,o=r.length,f=0;f<e;f++)for(var a=n[f].normalize(),c=0;c<o;c++){var l=r[c].normalize(),v=u?s:0;if(1==a.x&&0==l.x&&i.x>t.x){if(
-1!==St.MathUtil.doubleCompare(l.y*(t.y-i.y),v))return[t,new St.Point(i.x,t.y),i]}else if(-1==a.x&&0==l.x&&i.x<t.x){if(-1!==St.MathUtil.doubleCompare(l.y*(t.y-i.y),v))return[t,new St.Point(i.x,t.y),i]}else if(1==a.y&&0==l.y&&i.y>t.y){if(-1!==St.MathUtil.doubleCompare(l.x*(t.x-i.x),v))return[t,new St.Point(t.x,i.y),i]}else if(-1==a.y&&0==l.y&&i.y<t.y&&-1!==St.MathUtil.doubleCompare(l.x*(t.x-i.x),v))return[t,new St.Point(t.x,i.y),i]}for(var w,d,f=0;f<e;f++)for(a=n[f].normalize(),c=0;c<o;c++){var m,g,M,p,l=r[c].normalize(),b=new St.Point(t.x+s*a.x,t.y+s*a.y),k=new St.Point(i.x+s*l.x,i.y+s*l.y);if(0===St.MathUtil.doubleCompare(b.x,k.x)){if(m=rr(m=[t,b,k,i],a,l)){if(2===m.length)return m;h.push(m)}var y=0<a.y?1:-1,x=[t,b,new St.Point(b.x-y*s,b.y),new St.Point(b.x-y*s,k.y),k,i];if(x=rr(x,a,l)){if(2===x.length)return x;h.push(x)}var E=[t,b,new St.Point(b.x+y*s,b.y),new St.Point(b.x+y*s,k.y),k,i];if(E=rr(E,a,l)){if(2===E.length)return E;h.push(E)}}else if(0===St.MathUtil.doubleCompare(b.y,k.y)
){if(m=rr(m=[t,b,k,i],a,l)){if(2===m.length)return m;h.push(m)}var C=0<a.x?1:-1,x=[t,b,new St.Point(b.x,b.y-C*s),new St.Point(k.x,k.y-C*s),k,i];if(x=rr(x,a,l)){if(2===x.length)return x;h.push(x)}E=[t,b,new St.Point(b.x,b.y+C*s),new St.Point(k.x,k.y+C*s),k,i];if(E=rr(E,a,l)){if(2===E.length)return E;h.push(E)}}else 0<s?(M=new St.Point(b.x,k.y),p=new St.Vector(b.x-M.x,b.y-M.y),y=new St.Vector(k.x-M.x,k.y-M.y),p=p.normalize(),y=y.normalize(),p.equal(a)||y.equal(l)||(g=rr(g=[t,b,M,k,i],a,l))&&h.push(g),C=new St.Point(k.x,b.y),p=new St.Vector(b.x-C.x,b.y-C.y),y=new St.Vector(k.x-C.x,k.y-C.y),p=p.normalize(),y=y.normalize(),p.equal(a)||y.equal(l)||(g=rr(g=[t,b,C,k,i],a,l))&&h.push(g),M=new St.Point((b.x+k.x)/2,b.y),p=new St.Point((b.x+k.x)/2,k.y),y=new St.Vector(b.x-M.x,b.y-M.y),C=new St.Vector(k.x-p.x,k.y-p.y),y=y.normalize(),C=C.normalize(),y.equal(a)||C.equal(l)||(g=rr(g=[t,b,M,p,k,i],a,l))&&h.push(g),y=new St.Point(b.x,(b.y+k.y)/2),C=new St.Point(k.x,(b.y+k.y)/2),M=new St.Vector(b.x-y.x,
b.y-y.y),p=new St.Vector(k.x-C.x,k.y-C.y),M=M.normalize(),p=p.normalize(),M.equal(a)||p.equal(l)||(g=rr(g=[t,b,y,C,k,i],a,l))&&h.push(g)):(h.push([t,b,new St.Point(b.x,k.y),k,i]),h.push([t,b,new St.Point(k.x,b.y),k,i]),h.push([t,b,new St.Point((b.x+k.x)/2,b.y),new St.Point((b.x+k.x)/2,k.y),k,i]),h.push([t,b,new St.Point(b.x,(b.y+k.y)/2),new St.Point(k.x,(b.y+k.y)/2),k,i]))}if(!h||0===h.length)return[t,i];for(var f=0,N=h.length;f<N;f++){var O=h[f];St.CommonUtil.removeCollinearPoints(O);var D,_,S,T,A=O.length;2!==A?(D=O[2],_=O[1],S=O[0],null==D&&console.log("Error!"),T=D.x*_.y+D.y*S.x+_.x*S.y-(D.x*S.y+D.y*_.x+_.y*S.x),0===St.MathUtil.doubleCompare(T,0)&&S.x<=Math.max(D.x,_.x)&&S.x>=Math.min(D.x,_.x)&&S.y<=Math.max(D.y,_.y)&&S.y>=Math.min(D.y,_.y)||(D=O[A-3],_=O[A-2],S=O[A-1],T=D.x*_.y+D.y*S.x+_.x*S.y-(D.x*S.y+D.y*_.x+_.y*S.x),0===St.MathUtil.doubleCompare(T,0)&&S.x<=Math.max(D.x,_.x)&&S.x>=Math.min(D.x,_.x)&&S.y<=Math.max(D.y,_.y)&&S.y>=Math.min(D.y,_.y)||(
St.CommonUtil.removeCollinearPoints(O),(void 0===d||O.length<d)&&(d=(w=O).length)))):(w=O,d=2)}return w},tr.prototype.NS=function(t,n,i,r,s,u,h,e,o,f,a,c){var l=n,v=i,n=s,i=u;if(0===St.MathUtil.doubleCompare(l.x,n.x)&&0===St.MathUtil.doubleCompare(l.y,n.y))return[l,n];s=ir(l,v,n,i);if(s)return s;var w,u=l.clone(),s=n.clone();0<r&&(w=v[0],l.x=u.x+r*w.x,l.y=u.y+r*w.y,v=[w]),0<h&&(w=i[0],n.x=s.x+h*w.x,n.y=s.y+h*w.y,i=[w]);f=o&&o.equal(n)||f&&f.equal(n),f=this.VS(l,v,n,i,e,f);return f?((0<r||0<e)&&f.unshift(u),0<h&&f.push(s)):f=[u,s],t&&(l=t.getStartRect()||new St.Rect(l.x,l.y,0,0),n=t.getEndRect()||new St.Rect(n.x,n.y,0,0),f=_t.Connection.roundRect(l,n,f,e)),f},tr.prototype.jS=function(t,n){t.length<3||(n.getStartRect(),n.getEndRect())},tr.prototype.ES=function(t,n){var i=t.connection,r=t.Sk,s=t.Tk,u=t.startPoint,h=t.endPoint;if(0===St.MathUtil.doubleCompare(u.x,h.x)&&0===St.MathUtil.doubleCompare(u.y,h.y))return[u,h];var e=t.xk,o=t.Ek;if(e&&0<e.length&&o&&0<o.length){var f=ir(u,t.xk,h,
t.Ek);if(f)return f}var a=u.clone(),c=h.clone(),l=[];l.push(u);var v=e,w=o,d=n,f=new St.Vector(1,0);if(e&&0<e.length&&(f=e[0]),r?(g=(f=r.getResolvedConnectionDirection()).distance,M=_t.Connection.getReversedConnectionDirection(r,f,u,h),a.x=u.x+(d=g)*(f=M?M:f).x,a.y=u.y+d*f.y,l.push(a),v=[f]):e&&1<e.length||((a=new St.Point).x=u.x+n*f.x,a.y=u.y+n*f.y,v=[f]),s){var m=s.getResolvedConnectionDirection();if((M=_t.Connection.getReversedConnectionDirection(s,m,h,u))&&(m=M),(p=new St.Vector(h.x-u.x,h.y-u.y)).equal(f)&&p.equal(m.negate()))return l.push(h),l}else if((p=new St.Vector(h.x-u.x,h.y-u.y)).normalize(),p.equal(f))return l.push(h),l;var g,M,p=new St.Vector(1,0);o&&0<o.length&&(p=o[0]),s?(g=(p=s.getResolvedConnectionDirection()).distance,(M=_t.Connection.getReversedConnectionDirection(s,p,h,u))&&(m=M),M=_t.Connection.getReversedConnectionDirection(s,p,h,u),c.x=h.x+(d=g)*(p=M?M:p).x,c.y=h.y+d*p.y,w=[p]):o&&1<o.length||((c=new St.Point).x=h.x+n*p.x,c.y=h.y+n*p.y,w=[p]);for(var p=ir(a,
v=v||[f],c,w=w||[p]),b=p||this.VS(a,v,c,w,n,!0),k=b.length,y=0;y<k;y++)l.push(b[y]);l.push(h);n=_t.Connection.roundRect(t.J_,t.Lk,l,n);return i.Fk(n),n},sr.prototype.WS=function(t){return this.minSegmentLength},sr.prototype.zS=function(t){this.DS=t},sr.prototype.getEdgeToEdgeDist=function(){return this.DS},sr.prototype.YS=function(t){this._S=t},sr.prototype.getStandardPortSize=function(){return this._S},sr.prototype.setMinNodeSize=function(t){this.minNodeSize=t},sr.prototype.getMinSegmentLength=function(){return{x:this.minSegmentLength,y:this.minSegmentLength}},sr.prototype.BS=function(){return{x:0,y:0}},sr.prototype.nl=function(){var t=this.getEdgeToEdgeDist(),n=this.getMinSegmentLength(),i=n.x,r=n.y,n=this._c(),i=Math.max(i,n.x),r=Math.max(r,n.y);return{x:Math.max(1,Math.ceil(i/t.x))*t.x,y:Math.max(1,Math.ceil(r/t.y))*t.y}},sr.prototype.el=function(){var t=this.getEdgeToEdgeDist(),n=this.BS(),i=n.x,r=n.y,n=this._c(),i=Math.max(i,n.x),r=Math.max(r,n.y);return{x:Math.max(1,Math.ceil(
i/t.x))*t.x,y:Math.max(1,Math.ceil(r/t.y))*t.y}},sr.prototype._c=function(){var t=this.getEdgeToEdgeDist(),n=this.getStandardPortSize(),i=this.BS(),r=this.getMinSegmentLength(),s=0,u=0;return 0===i.x&&0===r.x?s=Math.round(n.w/2/t.x)*t.x+t.x:(s=t.x*Math.max(1,Math.ceil(n.w/2/t.x)))===n.w/2&&(s+=t.x),0===i.y&&0===r.y?u=Math.round(n.h/2/t.y)*t.y+t.y:(u=t.y*Math.max(1,Math.ceil(n.h/2/t.y)))===n.h/2&&(u+=t.y),{x:s,y:u}},sr.prototype.getGroupNodeKeepOutArea=function(t,n){if(!this.SS)return null;return{x:0,y:0,w:n.w,h:Math.min(this.minNodeSize.h,n.h)}},sr.prototype.ZS=function(t){return 1==t.x?this.Li.right:-1==t.x?this.Li.left:1==t.y?this.Li.down:-1==t.y?this.Li.up:this.Li.right},sr.prototype.US=function(t){var n=this.Li;return t==n.right?{x:1,y:0}:t==n.left?{x:-1,y:0}:t==n.down?{x:0,y:1}:t==n.up?{x:0,y:-1}:{x:1,y:0}};function hr(t){(t=t.renderData)&&t.updateFlags&&(((t=t.updateFlags)&Dt.RenderUpdateFlags.Sheet)!==Dt.RenderUpdateFlags.Sheet&&(t&Dt.RenderUpdateFlags.AllElements
)!==Dt.RenderUpdateFlags.AllElements||(t=this.recipient)&&t.GS&&t.GS())}function er(t){var n;t&&(t.getMessageCount()<1||(n=this.recipient)&&n.XS&&n.XS(t))}ur.prototype.FS=function(){var t=this.OS.CM();t.register(Dt.messages.ModelChangeMessage,this,er),t.register(Dt.messages.RedrawMessage,this,hr)},ur.prototype.GS=function(t){this.IS&&(this.IS.$S=!1)},ur.prototype.XS=function(t){for(var n=t.getMessages(),i=t.getMessageCount(),r=this.AS,s=this.PS,u=this.LS,h=this.TS,e=this.RS,o=this.HS,f=0;f<i;f++){var a=n[f],c=a.owner;a.getChangeType()!==Dt.ChangeType.Remove?a.affectIndexing()&&(c instanceof _t.Node&&h.indexOf(c)<0?h.push(c):c instanceof _t.Port&&e.indexOf(c)<0?e.push(c):c instanceof _t.Connection&&o.indexOf(c)<0&&o.push(c)):c&&1==c.wM&&(c instanceof _t.Node&&r.indexOf(c)<0?r.push(c):c instanceof _t.Port&&s.indexOf(c)<0?s.push(c):c instanceof _t.Connection&&u.indexOf(c)<0&&u.push(c))}},ur.prototype.clear=function(){this.TS=[],this.AS=[],this.RS=[],this.PS=[],this.HS=[],this.LS=[]}
;function or(t,n){if(t.Jh)for(var i=t._n,r=i.length,s=0;s<r;s++){var u=i[s];n.push(u),or(u,n)}}function fr(t,n,i){this.OS=t,this.qS=new sr(t),this.reportError=i,this.KS=n,this.IS=new Dt.common.ObjectHelper.rootNamespace.Routing.aStarModelManager(t,this.qS,null,null,i),this.JS=new ur(t,this.IS),this.ci=new Dt.common.ObjectHelper.rootNamespace.Routing.aStarSimpleHVPaths(this.IS,this.qS,i),this.edgeDist=this.qS.getEdgeToEdgeDist(),this.zo=this.qS.getStandardPortSize(),this.Li=this.qS.Li,this.QS=[this.Li.right,this.Li.up,this.Li.left,this.Li.down],this.li=null,this.lc=null,this.ho=null}ur.prototype.tT=function(){for(var t=this.IS,n=this.TS,i=n.length,r=[],s=[],u=0;u<i;u++){var h=n[u],e=t.Fi(h);e?(f=h.getBBox(),t.$S&&(t.$S=e.x===f.x&&e.y===f.y&&e.w===f.width&&e.h===f.height),e.x=f.x,e.y=f.y,e.w=f.width,e.h=f.height,e.Jh?h.isNestedViewMode()||t.convertGroupNodeToNode(h):h.isNestedViewMode()&&(t.convertNodeToGroupNode(h),s.push(e))):(e=t.addNewNode(h)).Jh&&s.push(e),t._e(h),or(e,r)}for(
var o=r.length,u=0;u<o;u++){var f=(h=(e=r[u]).hostNode).getBBox();t.$S&&(t.$S=e.x===f.x&&e.y===f.y&&e.w===f.width&&e.h===f.height),e.x=f.x,e.y=f.y,e.w=f.width,e.h=f.height}for(var a=this.RS,c=a.length,u=0;u<c;u++){var l,v=a[u],w=t.ru(v);w?(f=v.getBBox(),w.x=f.x,w.y=f.y,w.w=f.width,w.h=f.height,l=v.getResolvedSymbolConnectionPoint(),w.nT=l.x,w.iT=l.y):v.getOwner()instanceof _t.Node&&t.addNewPort(v)}for(var d=this.AS,m=d.length,u=0;u<m;u++)t.removeNode(d[u]);for(var g=this.LS,M=g.length,u=0;u<M;u++)t.removeConnection(g[u]);for(var p=this.PS,b=p.length,u=0;u<b;u++)t.removePort(p[u]);0<m+M+b&&(t.$S=!1);for(var k=s.length,u=0;u<k;u++)for(var y=(h=(e=s[u]).hostNode).getChildNodes(),x=y.length,E=0;E<x;E++){var C=y[E];t.Fi(C)&&t._e(C)}this.clear()};fr.prototype.rT=function(t){if(t){var n=t.getOwner(),i=this.IS,r=this.zw,s=i.Fi(n);if(s){r&&r.sT(s,!1),s.Jh?n.isNestedViewMode()||i.convertGroupNodeToNode(n):n.isNestedViewMode()&&i.convertNodeToGroupNode(n),i.C2(s);var u=n.getBBox();if(s.x=u.x,
s.y=u.y,s.w=u.width,s.h=u.height,s.Jh)for(var h=n.getChildNodes(),e=h.length,o=0;o<e;o++){var f=h[o];i.Fi(f)&&i._e(f)}}else s=i.addNewNode(n);n=i.ru(t);n?i.W2(n):t.getOwner()instanceof _t.Node&&(n=i.addNewPort(t)),r&&r.sT(s,!0)}},fr.prototype.uT=function(t){var n=[],i=[];!function(t,n,i){for(var r=t.getSheetElements(),s=r.length,u=0;u<s;u++){var h=r[u];h instanceof _t.Node?n.push(h):h instanceof _t.Connection&&i.push(h)}}(t,n,i),this.IS.initialize(n,i),this.JS.clear()},fr.prototype.findPaths=function(t){if(t.length<1)return{};var n=this.OS.hT(),i=this.OS.getSheetConfigurationData().minNodeToEdgeDist,r=(i>this.minSegmentLength||this.minSegmentLength,this.IS);r.eT()||this.uT(n);for(var s=t.length,u=0;u<s;u++){var h=(f=t[u]).connection;this.rT(f.Sk),f.Tk?this.rT(f.Tk):f.attachingTargetPort&&this.rT(f.attachingTargetPort),(a=r.Gi(h))?(r.D2(a),r.ye.indexOf(a)<0&&r.ye.push(a)):a=r.addNewConnection(h)}for(var e={},o=[],u=0;u<s;u++){var f=t[u];try{this.fs(f)}catch(t){o.push(f);continue}(
h=f.connection).isInCreating||(f.yk=St.RoutingReason.Created);var a,c=(a=r.Gi(h)).su;e[h.guid]=c}if(this.KS&&0<o.length){var l,v=this.KS().findPaths(o);for(l in v)e[l]=v[l]}return e},fr.prototype.mk=function(){return{}},fr.prototype.gk=function(t,n){},fr.prototype.oT=function(t){var n=this.JS,i=this.IS;n.TS.length+n.AS.length>=i.nList.length?(i.xi(),this.uT(t),this.IS.$S=!1,n.clear()):n.tT(),this.IS.$S||((t=new Dt.common.ObjectHelper.rootNamespace.Routing.aStarPathPlanning(this.qS,this.reportError)).i2(this.IS,this.edgeDist,this.zo),this.IS.$S=!0,this.zw=t,n.pathPlanning=t)},fr.prototype.fs=function(t){this.gi(t);t=this.IS.Gi(t.connection);this.fT(t)};function ar(t,n){var i=t.x,r=t.y,s=t.w,u=t.h,t=n.x,n=n.y;return i<t&&t<i+s&&r<n&&n<r+u}function cr(t,n,i){if(!t)return null;var r=t.x,s=t.y,u=t.w,h=t.h,e=0,t=0;if(i)e=i.x,t=i.y;else{if(!n)return null;e=n.nT,t=n.iT}return n=Math.abs(t-s),h=Math.abs(s+h-t),t=Math.abs(e-r),e=Math.abs(r+u-e),{dir:(e=Math.min(n,h,t,e)
)==t?"right":e==h?"up":e==n?"down":"left",dis:0}}function lr(t,n){var i=t.x,r=t.y,s=t.width,u=t.height,h=n.x,t=n.y,n=Math.abs(t-r),u=Math.abs(r+u-t),t=Math.abs(h-i),i=Math.abs(i+s-h),s=Math.min(n,u,t,i);return(h={}).distance=s,h.dirs=[],s==n&&h.dirs.push("up"),s==u&&h.dirs.push("down"),s==t&&h.dirs.push("left"),s==i&&h.dirs.push("right"),h}function vr(t,n,i){this.OS=t,this.KS=n,this.qS=new sr(t),this.r=i,this.IS=new Dt.common.ObjectHelper.rootNamespace.Routing.aStarModelManager(t,this.qS,null,null,this.r),this.JS=new ur(t,this.IS),this.aT=null,this.cT=null}fr.prototype.lT=function(t){if(!t)return this.QS;var n,i=t.length;if(1==i&&(!(n=t[0])||0===n.x&&0===n.y))return this.QS;for(var r=[],s=0;s<i;s++)n=this.qS.ZS(t[s]),r.push(n);return r},fr.prototype.gi=function(t){var n=this.IS,i=t.connection,r=n.Gi(i),s=r.bi,u=r.yi,h=r.mi,e=r.pi,o=t.attachingTargetPort;o?(v=o.getOwner(),e=n.ru(o),u=n.Fi(v)):t.attachingTargetNode&&(v=t.attachingTargetNode,u=n.Fi(v));var f,a,c,l,r=t.startPoint,
o=t.endPoint,v=i.isInCreating;!v||(!(d=t.Ck)||d.length<2||2==d.length&&d[0].equal(d[1]))&&(v=!1);var w,d=!1;if(v){if(t.Dk&&t.Nk?(r=t.Dk,o=t.Nk,c=this.lT(t.uS),l=this.lT(t._k),d=!0):(c=this.lT(t.xk),l=this.lT(t.Ek)),f=t.Sk?t.xk[0].distance:0,a=t.Tk?t.Ek[0].distance:0,r.equal(o))return void(n.Gi(i).Bi=[r,o]);s&&s.Jh&&ar(s,o)&&(w=cr(s,h,r))&&(f=w.dis,c=[w.dir]);var m,g=!1;u&&u.Jh&&ar(u,r)&&(m=cr(u,e,o))&&(a=m.dis,l=[m.dir],g=!0),g||(p=t.Lk)&&0<(M=lr(p,o)).dirs.length&&(l=M.dirs,a=M.distance)}else{if(t.yk&St.RoutingReason.StartPointMoved?r=t.Nk:t.yk&St.RoutingReason.EndPointMoved&&(o=t.Nk),r.equal(o))return void(n.Gi(i).Bi=[r,o]);f=t.Sk?t.xk[0].distance:0,a=t.Tk?t.Ek[0].distance:0,c=this.lT(t.xk),l=this.lT(t.Ek),s&&s.Jh&&ar(s,o)&&(w=cr(s,h,r))&&(f=w.dis,c=[w.dir]),u&&u.Jh&&ar(u,r)&&(m=cr(u,e,o))&&(a=m.dis,l=[m.dir]),i.isInCreating&&(g=!1,u&&u!=s&&u&&u.Jh&&ar(u,r)&&(m=cr(u,e,o))&&(a=m.dis,l=[m.dir],g=!0),g||(p=t.Lk)&&0<(M=lr(p,o)).dirs.length&&(l=M.dirs,a=M.distance))}var M,p=null;s&&u&&(
this.IS.jl(s,u),M=this.qS.minPortExtensionDist,p=this.ci.$t(r,c[0],f||M,o,l[0],a||M)),p||(t=(i=t.connection).getOwningSheet(),this.oT(t),this.zw.vT(s,u,!1),p=this.zw.findOnePath(r,c,f,o,l,a),this.zw.vT(s,u,!0)),d&&p&&p.reverse(),n.Gi(i).Bi=p},fr.prototype.fT=function(t){var n=t.Bi;if(null!==n){for(var i,r=[],s=n.length,u=0;u<s;++u)i=n[u],r.push(new St.Point(i.x,i.y));St.CommonUtil.removeCollinearPoints(r),t.su=r}else this.reportError("aStarRouter: unable to create path for connection")},fr.prototype.clear=function(){this.IS.xi()};function wr(t){this.session=t,this.wT=null,this.dT=null,this.mT=[],this.gT=null,this.MT=[],this.minSegmentLength=20,this.pk=!1,this.pT=!1,this.bT=void 0,this.kT=void 0,this.yT=void 0}vr.prototype.rT=function(t,n){if(t){var i=t.getOwner(),r=this.IS,s=this.zw,u=r.Fi(i);if(u){s&&s.sT(u,!1),u.Jh?i.isNestedViewMode()||r.convertGroupNodeToNode(i):i.isNestedViewMode()&&r.convertNodeToGroupNode(i),r.C2(u);var h=i.getBBox();if(u.x=h.x,u.y=h.y,u.w=h.width,u.h=h.height,
u.Jh)for(var e=i.getChildNodes(),o=e.length,f=0;f<o;f++){var a=e[f];r.Fi(a)&&r._e(a)}}else u=r.addNewNode(i);i=r.ru(t);i?r.W2(i):i=r.addNewPort(t),n&&r.setPortInfo(i,{portBehavior:"generalPort"}),s&&s.sT(u,!0)}},vr.prototype.uT=function(t){var n=[],i=[];!function(t,n,i){for(var r=t.getSheetElements(),s=r.length,u=0;u<s;u++){var h=r[u];h instanceof _t.Node?n.push(h):h instanceof _t.Connection&&i.push(h)}}(t,n,i),this.IS.xi(),this.IS.initialize(n,i),this.JS.clear()},vr.prototype.xT=function(n){if(!this.cT)try{this.cT=new fr(this.OS,this.KS,this.r)}catch(t){if(this.KS)return this.KS().findPaths(n)}return this.cT.findPaths(n)},vr.prototype.findPaths=function(t){if(t.length<1)return{};if(t[0].connection.isInCreating)return this.xT(t);var n=this.OS.hT();this.uT(n),this.aT=new Dt.common.ObjectHelper.rootNamespace.Routing.HVPathsAlgorithm(this.IS,this.r);n=this.qS.getEdgeToEdgeDist();this.aT.setOptimalConnectionDistance(n.x),this.aT.setOptimalConnectionToNodeDistance(n.x),
this.aT.setOptimalPortSegmentLength(0);for(var i={},r=[],s=[],u=0,h=t.length;u<h;u++){var e=t[u],o=e.connection,f=this.IS.Gi(o),a=f.mi,c=f.pi;if(a&&c)if(e.xS())s.push(e);else{if(e.yk===St.RoutingReason.Created){var c=e.startPoint,l=e.endPoint;if(c.equal(l)){i[o.guid]=[c,l],f.Bi=[c,l];continue}}l=e.kS()||e.yS();this.rT(e.Sk,l),e.Tk&&this.rT(e.Tk,l),o.isInCreating||(e.yk=St.RoutingReason.Created),r.push(f)}else s.push(e)}if(0<s.length){var v,w=this.xT(s);for(v in w)i[v]=w[v]}return 0<r.length&&(this.aT.generatePaths(r),this.ET(r,i)),i},vr.prototype.ET=function(t,n){for(var i=0,r=t.length;i<r;i++){for(var s=[],u=t[i],h=u.Si,e=u.Bi.length,o=0;o<e;o++){var f=u.Bi[o];s.push(new St.Point(f.x,f.y))}n[h.guid]=s}},vr.prototype.mk=function(){for(var t=[],n=this.IS.cList,i=0,r=n.length;i<r;i++){var s=n[i];s.CT&&t.push(s)}var u={};return this.ET(t,u),u},vr.prototype.gk=function(t,n){for(var i,r,s,u,h=0,e=t.length;h<e;h++)t[h].kS()||t[h].yS()||t[h].xS()||(i=(s=n[(u=t[h].connection).guid])[0],
r=s[s.length-1],(s=u.getStart())&&(s.getProxy()||s).setAnchorPosition(i.x,i.y),(u=u.getEnd())&&(u.getProxy()||u).setAnchorPosition(r.x,r.y))};function dr(t){return t.getSheetConfigurationData().contextData.getConnectionCreationRoutingType()}function mr(){return Mr}function gr(t,n){Dt.common.ExceptionHelper.throwException(n||Dt.common.ExceptionTypes.RoutingError.id,t||Dt.common.ExceptionTypes.RoutingError.message)}var Mr=new tr,pr=new ft,br=St.ConnectionBendControlOption.NonOrthogonal;wr.prototype.initialize=function(t){var n=this.session.getSheetConfigurationData();if(this.minSegmentLength=n.minSegmentLength,t||dr(this.session)==br)this.wT=pr;else{n=this.pk?n.autoRoutingTypeForPreview:n.autoRoutingType;if(n===St.ConnectionAutoRoutingType.OrthogonalSimple)this.wT=Mr;else if(n===St.ConnectionAutoRoutingType.OrthogonalAvoidObstacle1){if(!this.bT)try{var i=Dt.common.ObjectHelper.rootNamespace.Routing.HadlockRouter;this.bT=new i,window.console.log("Hadlock Routing initialized successfully."
)}catch(t){window.console.log("Can not initialize Hadlock Routing, will use simpleOrthogonal router. msg : "+t.message),this.bT=Mr}this.wT=this.bT}else if(n===St.ConnectionAutoRoutingType.OrthogonalAvoidObstacle2){if(!this.kT)try{this.kT=new fr(this.session,mr,gr),window.console.log("aStar Routing initialized successfully.")}catch(t){window.console.log("Can not initialize aStar Routing, will use simpleOrthogonal router. msg : "+t.message),this.kT=Mr}this.wT=this.kT}else if(n===St.ConnectionAutoRoutingType.OrthogonalAvoidObstacle3){if(!this.yT)try{this.yT=new vr(this.session,mr,gr),window.console.log("OrthogonalRouter initialized successfully.")}catch(t){window.console.log("Can not initialize OrthogonalRouter, will use simpleOrthogonal router. msg : "+t.message),this.yT=Mr}this.wT=this.yT}else this.wT=pr}},wr.prototype.NT=function(){return this.kT},wr.prototype.OT=function(t,n,i){var r=!1;if(t){var s=t.getResolvedConnectionDirection();if(s.equal(new St.Vector(0,0)))return r;i=(
i=new St.Vector(i.x-n.x,i.y-n.y)).normalize(),n=s.normalize();t.connectionDirectionReversible?0!==St.MathUtil.doubleCompare(St.Vector.cross(n,i),0)&&(r=!0):i.equal(n)?r=!1:1==n.x&&s.xVariable||1==n.y&&s.yVariable?i.equal(n.negate())&&(r=!1):r=!0}return r},wr.prototype.DT=function(t,n,i,r){if(!t){if(n&&i){var s=i.x-n.x,u=i.y-n.y,h=0<s?1:-1,e=0<u?1:-1,o=void 0,f=void 0,f=Math.abs(u)>Math.abs(s)?(o=new St.Vector(0,e),new St.Vector(h,0)):(o=new St.Vector(h,0),new St.Vector(0,e));return r&&f.equal(r)&&(f=o,o=r),[o,f,o.negate(),f.negate()]}return[new St.Vector(1,0),new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)]}f=t.getResolvedConnectionDirection();return 0===St.MathUtil.doubleCompare(f.x,0)&&0!==f.x&&(f.x=0),0===St.MathUtil.doubleCompare(f.y,0)&&0!==f.y&&(f.y=0),0!==f.x||0!==f.y?t.connectionDirectionReversible?[f,f.negate()]:0!==f.x&&f.xVariable?(n&&i&&(f.x=n.x>i.x?-1:1,f.y=0),[f,f.negate()]):0!==f.y&&f.yVariable?(n&&i&&(f.y=n.y>i.y?-1:1,f.x=0),[f,f.negate()]):[f]:[
new St.Vector(1,0),new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)]},wr.prototype._T=function(t,n){t=new St.Vector(n.x-t.x,n.y-t.y),t=(t=t.normalize()).equal(St.Vector.PositiveX)||t.equal(St.Vector.PositiveY)||t.equal(St.Vector.NegativeX)||t.equal(St.Vector.NegativeY)?[t]:[new St.Vector(1,0),new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)];return t},wr.prototype.ST=function(t,n,i,r){t=new St.Vector(n.x-t.x,n.y-t.y);return 0!=(t=t.normalize()).x&&0!=t.y||0==t.x&&0==t.y?[new St.Vector(0,0)]:t.equal(St.Vector.PositiveX)?(!i||!r||0!==St.MathUtil.doubleCompare(i.y,r.y))&&i&&r&&i.y>r.y?[new St.Vector(1,0),new St.Vector(0,-1),new St.Vector(0,1)]:[new St.Vector(1,0),new St.Vector(0,1),new St.Vector(0,-1)]:t.equal(St.Vector.PositiveY)?i&&r&&0===St.MathUtil.doubleCompare(i.x,r.x)||i&&r&&i.x>r.x?[new St.Vector(0,1),new St.Vector(-1,0),new St.Vector(1,0)]:[new St.Vector(0,1),new St.Vector(1,0),new St.Vector(-1,0)]:t.equal(St.Vector.NegativeX
)?i&&r&&0===St.MathUtil.doubleCompare(i.y,r.y)||i&&r&&i.y>r.y?[new St.Vector(-1,0),new St.Vector(0,-1),new St.Vector(0,1)]:[new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)]:t.equal(St.Vector.NegativeY)?(!i||!r||0!==St.MathUtil.doubleCompare(i.x,r.x))&&i&&r&&i.x>r.x?[new St.Vector(0,-1),new St.Vector(-1,0),new St.Vector(1,0)]:[new St.Vector(0,-1),new St.Vector(1,0),new St.Vector(-1,0)]:0<t.x?[new St.Vector(1,0),new St.Vector(0,1),new St.Vector(0,-1)]:0<t.y?[new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)]:[new St.Vector(1,0),new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)]};function kr(t,n){if(!t||!n)return 1;var i=(i=new St.Vector(n.x-t.x,n.y-t.y)).normalize();return!!(0===St.MathUtil.doubleCompare(t.x,n.x)||0===St.MathUtil.doubleCompare(t.y,n.y)||i.equal(St.Vector.PositiveX)||i.equal(St.Vector.PositiveY)||i.equal(St.Vector.NegativeX)||i.equal(St.Vector.NegativeY))}function yr(t,n){if(t&&1<t.length){if(n)return!kr(t[0],t[1]);n=t.length;return!kr(t[n-2],
t[n-1])}return!1}wr.prototype.TT=function(t,n,i,r,s){var u=n.length,h=r?n[0]:n[u-1],e=new St.Rect(Math.min(h.x,s.x),Math.min(h.y,s.y),Math.abs(s.x-h.x),Math.abs(s.y-h.y)),h=t.getStartRect(),t=t.getEndRect(),t=r?h:t;t&&(t.inflate(i-2,i-2),e.union(t));for(var o=!1,f=[],a=0,c=n.length-1;a<c;a++){var l=n[a],v=n[a+1],v=new St.Line(l,v);f.push(v),r?o||0===a||(o=v.isPointOnLine(s)):o||a===c-1||(o=v.isPointOnLine(s))}r||f.reverse();for(var w,d,m,g,M=0,p=0,b=f.length;p<b;p++)o?(w=Math.min(f[p].start.x,f[p].end.x),g=Math.min(f[p].start.y,f[p].end.y),d=Math.max(f[p].start.x,f[p].end.x),m=Math.max(f[p].start.y,f[p].end.y),g=new St.Rect(w,g,d-w,m-g),e.hasOverlap(g)&&(M=p+1)):(e.isPointInside(f[p].start)||e.isPointInside(f[p].end))&&(M=p+1);var k,y,t=0;return u-1===M?t=r?u-1:0:r?(k=n[t=M],y=n[M+1],0!=St.MathUtil.doubleCompare(k.x,y.x)&&0!=St.MathUtil.doubleCompare(k.y,y.y)||(t+=1)):(k=n[t=u-M-1],y=n[t-1],0!=St.MathUtil.doubleCompare(k.x,y.x)&&0!=St.MathUtil.doubleCompare(k.y,y.y)||--t),t},
wr.prototype.Pk=function(t,n,i,r,s){var u=new Qi(t);u.yk=St.RoutingReason.Created,u.startPoint=n,u.endPoint=i,u.Sk=r,u.Tk=s,u.J_=t.getStartRect()||new St.Rect(n.x,n.y,0,0),u.Lk=t.getEndRect()||new St.Rect(i.x,i.y,0,0);var h=t.getGeometry(),e=h?h.getPoints():void 0;return e&&1<e.length&&(t=e.length,h=new St.Vector(e[1].x-e[0].x,e[1].y-e[0].y),t=new St.Vector(e[t-2].x-e[t-1].x,e[t-2].y-e[t-1].y),h=h.normalize(),t=t.normalize(),u.Ck=e,u.Q_=h,u.sS=t),u.xk=this.DT(r,n,i,u.Q_),u.Ek=this.DT(s,i,n,u.sS),u};function xr(t,n,i){var r=t.getResolvedConnectionDirection();return(i=_t.Connection.getReversedConnectionDirection(t,r,n,i))&&(i.distance||(i.distance=r.distance),r=i),r}function Er(t,n,i){var r=[t];return r=t&&0===t.x&&0===t.y&&n&&i?(i=(i=new St.Vector(n.x-i.x,n.y-i.y)).normalize()).equal(St.Vector.PositiveX)?[St.Vector.PositiveX,St.Vector.NegativeX,St.Vector.PositiveY,St.Vector.NegativeY]:i.equal(St.Vector.PositiveY)?[St.Vector.PositiveY,St.Vector.NegativeY,St.Vector.PositiveX,
St.Vector.NegativeX]:i.equal(St.Vector.NegativeX)?[St.Vector.NegativeX,St.Vector.PositiveX,St.Vector.PositiveY,St.Vector.NegativeY]:i.equal(St.Vector.NegativeY)?[St.Vector.NegativeY,St.Vector.PositiveY,St.Vector.PositiveX,St.Vector.NegativeX]:[new St.Vector(1,0),new St.Vector(-1,0),new St.Vector(0,1),new St.Vector(0,-1)]:r}function Cr(t,n,i){Y.call(this,t,n,i)}function Nr(t,n,i){Y.call(this,t,n,i)}wr.prototype.AT=function(t,n,i,r,s){var u=n.length,h=t.connection,e=i||t.startPoint,o=t.endPoint,f=t.Sk,a=t.Tk;t.Ck=n;var c=yr(n,!0),l=1,l=(t.Ik=c)||dr(this.session)==br||c?1:this.TT(h,n,this.minSegmentLength,!0,e);return(t.Ok=l)===u-1&&i&&r?(t.yk=St.RoutingReason.Created,t.startPoint=e,t.xk=Er(r,n[0],n[1]),t.Sk=void 0,t.J_=s||new St.Rect(i.x,i.y,0,0)):(t.yk=St.RoutingReason.StartPointMoved,t.Nk=e,t._k=r?Er(r,n[0],n[1]):this._T(n[0],n[1]),t.q_=0,!r&&f&&(f=xr(f,e,n[l]),t._k=[f],t.q_=f.distance),t.Dk=n[l],t.uS=l!==u-1?this.ST(n[l+1],n[l],t.Dk,e):this._T(n[u-1],n[u-2]),t.K_=0,l===u-1&&a&&(e=xr(a
,o,e),t.uS=[e],t.K_=e.distance)),t},wr.prototype.Hk=function(t,n,i,r,s){var u=n.length,h=t.connection,e=t.startPoint,o=i||t.endPoint,f=t.Sk,a=t.Tk;t.Ck=n;var c=0;if(h.isInCreating)c=u-1;else if(dr(this.session)==br)c=u-2;else{var l=yr(n,!1);if(0===(c=(t.Ik=l)?u-2:this.TT(h,n,this.minSegmentLength,!1,o))&&i&&r)return t.yk=St.RoutingReason.Created,t.Ok=c,t.endPoint=o,t.Ek=Er(r,n[u-2],n[u-1]),t.Tk=void 0,t.Lk=s||new St.Rect(o.x,o.y,0,0),t}return t.Ok=c,t.yk=St.RoutingReason.EndPointMoved,t.Nk=o,t._k=r?Er(r,n[u-1],n[u-2]):this._T(n[u-1],n[u-2]),t.q_=0,!r&&a&&(a=xr(a,o,n[c]),t._k=[a],t.q_=a.distance),t.Dk=n[c],t.uS=0!==c?this.ST(n[c-1],n[c],t.Dk,o):this._T(n[0],n[1]),(t.K_=0)===c&&f&&(o=xr(f,e,o),t.uS=[o],t.K_=o.distance),t},wr.prototype.ix=function(t,n,i,r,s,u){var h,e,o,t=this.Pk(t,t.getStartPoint(),t.getEndPoint(),t.getStart(),t.getEnd()),t=n==St.RoutingReason.StartPointMoved?this.AT(t,t.Ck,i,r,u):this.Hk(t,t.Ck,i,r,u);return s&&r&&t&&!t.Ik&&(0===r.x&&0===r.y||(s=t.Ck)&&1<s.length&&(
n==St.RoutingReason.StartPointMoved?(h=s[0],e=s[1],(o=new St.Vector(e.x-h.x,e.y-h.y))&&!o.normalize().equal(r)&&(t.yk=St.RoutingReason.Created,t.startPoint=i,t.xk=[r],t.Sk=void 0,u&&(t.J_=u))):n==St.RoutingReason.EndPointMoved&&(h=s[(n=s.length)-1],e=s[n-2],(o=new St.Vector(e.x-h.x,e.y-h.y))&&!o.normalize().equal(r)&&(t.yk=St.RoutingReason.Created,t.endPoint=i,t.Ek=[r],t.Tk=void 0,u&&(t.Lk=u))))),t},wr.prototype.RT=function(t){var n=t.getStartPoint(),i=t.getEndPoint();if(!n||!i)return null;var r=t.getStart(),s=t.getEnd(),u=this.Pk(t,n,i,r,s);if(!u.Ck||0===u.Ck.length)return u;var h=u.Ck,e=h.length,o=h[0],f=h[1],a=h[e-1],c=h[e-2],l=this.OT(r,o,f),v=this.OT(s,a,c);if(r&&l&&(!(2<e)||kr(o,f))||s&&v&&(!(2<e)||kr(a,c)))return u;t=(t=t.isInCreating)&&2<h.length,o=l||0!==St.MathUtil.doubleCompare(n.distanceToPoint(o),0),a=v||0!==St.MathUtil.doubleCompare(i.distanceToPoint(a),0);if(!o&&(!a||t))return null;t=null;if(o){t=this.AT(u,h);return a&&(t.yk|=St.RoutingReason.EndPointMoved),t}
return a?this.Hk(u,h):null},wr.prototype.PT=function(){var t=this.dT;if(!t)return 0<this.mT.length;var n,i=[],r={};for(n in t){var s,u=t[n];u instanceof _t.Connection&&((s=this.RT(u))?i.push(s):r[u.guid]=!0)}for(var h=this.mT,e=h.length-1;0<=e;e--)r[h[e].connection.guid]&&h.splice(e,1);return i.forEach(function(t){h.push(t)}),!(this.dT=null)},wr.prototype.HT=function(t){var n=this.session;if(!n||n.suppressRoutingOnConnectionChanged||n.E_&&!0===n.E_||n.isInUpdateProcess())return!1;var i=(i=this.dT)||(this.dT={}),n=t.guid;i[n]=t,!this.gT||(t=this.gT)[n]&&(t[n]=void 0)},wr.prototype.nx=function(t){var n=this.dT;n&&(n[t.guid]=null);n=this.gT;n&&n[t.guid]&&(n[t.guid]=void 0)},wr.prototype.mM=function(t){if(this.MT=[],!this.PT())return!1;if(this.LT(this.mT))return this.mT=[],!0;for(var n=this.mT,i=(i=this.gT)||(this.gT={}),r=[],s=n.length-1;0<=s;s--){var u=n[s];if(t){if(u.connection.guid!=t)continue;if(u.yk==St.RoutingReason.Created){u.Ck;var h=u.startPoint,e=u.endPoint;if(h.equal(e)
)return i[u.connection.guid]=[h,e],void n.splice(s,1)}return i[u.connection.guid]=this.fs(u),void n.splice(s,1)}r.push(u)}return 0<r.length&&(this.gT=this.IT(r)),t||(this.mT=[]),!0},wr.prototype.FT=function(t,n){for(var i=0,r=n.length;i<r;i++){var s=n[i];t.addConnectionToRouting(s.connection,s.yk,s.gS(),s.MS(),s.pS(),s.bS())}},wr.prototype.LT=function(t){if(0==t.length)return!1;if(this.pT=!0,t[0].connection.isDefaultAutoRoutingOn())return!1;var n=new At.ConnectionRoutingEventArgs(this.pk);this.FT(n,t);var i=new Dt.messages.EventMessage(n,At.EventType.OnConnectionRouting);return!!this.session.CM().BM(i)&&(this.VT(n.getConnectionRoutingResult(),t),!0)},wr.prototype.jT=function(t,n){if(!n)return null;var i=t.yk;if(i&St.RoutingReason.Created||0==t.Ck.length)return n;if(i&St.RoutingReason.StartPointMoved){var r=t.Ok;(u=t.Ck).splice(0,r+1);for(var s=n.length-1;0<=s;s--)u.unshift(n[s]);return St.CommonUtil.removeCollinearPoints(u),u}if(i&St.RoutingReason.EndPointMoved){var u,r=t.Ok;(u=t.Ck
).splice(r,u.length-r);for(s=n.length-1;0<=s;s--)u.push(n[s]);return St.CommonUtil.removeCollinearPoints(u),u}},wr.prototype.VT=function(t,n){var i=n.length;if(0<i){var r=this.gT;null===r&&(r=this.gT={});for(var s=0;s<i;s++){var u=n[s],h=u.connection,e=t[h.guid];e&&(e=this.jT(u,e),r[h.guid]=e)}}},wr.prototype.WT=function(t){var n=void 0;this.pT=!1;var i=this.gT,t=t.guid;return i||(this.mM(t),i=this.gT),i&&(i[t]||(this.mM(t),i=this.gT),n=i[t]),n},wr.prototype.zT=function(t){this.pT=!1;var n=this.RT(t);return n&&this.LT([n])?this.gT[t.guid]:this.fs(n)},wr.prototype.fs=function(t){var n,i,r=void 0;return this.session.YT=!0,t&&(n=t.Ik,this.initialize(n),t.pk=this.pk,i=this.wT.findPaths([t]),r=this.jT(t,i[t.connection.guid]),t.yk&St.RoutingReason.StartPointMoved&&t.yk&St.RoutingReason.EndPointMoved&&(r&&0!==r.length||(r=t.Ck),n!=(t=this.Hk(t,r)).Ik&&this.initialize(t.Ik),i=this.wT.findPaths([t]),r=this.jT(t,i[t.connection.guid]))),this.session.YT=!1,r},wr.prototype.BT=function(t,n){for(
var i in t){for(var r=t[i].routerObj,s=t[i].connectionDefs,u=0,h=s.length;u<h;u++)s[u].pk=this.pk;for(var e=r.findPaths(s),u=0,h=s.length;u<h;u++){var o=s[u].connection.guid,f=this.jT(s[u],e[o]);n[o]=f}r.gk(s,n);var a=r.mk();for(i in a)n[i]=a[i],this.MT.push(i)}},wr.prototype.IT=function(t){if(!(t&&0<t.length))return{};for(var n={},i=0,r=t.length;i<r;i++){var s=t[i];this.initialize(s.Ik),n[e=this.wT.constructor.name]||(n[e]={routerObj:this.wT,connectionDefs:[]}),n[e].connectionDefs.push(s)}var u={},h={};this.session.YT=!0,this.BT(n,u);for(i=0,r=t.length;i<r;i++){var e,o=(s=t[i]).Ik,f=u[s.connection.guid];s.yk&St.RoutingReason.StartPointMoved&&s.yk&St.RoutingReason.EndPointMoved&&(f&&0!==f.length||(f=s.Ck),o!=(s=this.Hk(s,f)).Ik&&this.initialize(s.Ik),h[e=this.wT.constructor.name]||(h[e]={routerObj:this.wT,connectionDefs:[]}),h[e].connectionDefs.push(s))}return this.BT(h,u),this.session.YT=!1,u},wr.prototype.ze=function(){for(var t=[],n=this.MT,i=0,r=n.length;i<r;i++){
var s=this.session.getBaseObjectByGuid(parseInt(n[i]),_t.Connection);s&&t.push(s)}return t},wr.prototype.reportError=function(t){window.console&&window.console.log(t)},wr.prototype.clear=function(){this.wT=null,this.dT=null,this.mT=[],this.gT=null,this.pk=!1},wr.prototype.destroy=function(){this.clear(),this.kT&&(this.kT.clear&&this.kT.clear(),this.kT=null)},wr.prototype.IE=function(){this.clear(),this.pk=!0},Cr.prototype.uk=function(t,n,i,r){var s=n.clone(),n=this.getOwner(),n=r?new St.Point(r.x,r.y):n.getRenderingPosition();n&&(s.x=s.x-n.x,s.y=s.y-n.y),t.renderEllipse(s,i)},Cr.prototype.select=function(t){if(this.isSelectable()){var n=t.point,i=this.getStyle().transform;i&&(n=i.invert().transformPoint(t.point));var r=this.getGeometry();if(r){i=this.getOwner().getRenderingPosition();if(i&&(r.x=r.x-i.x,r.y=r.y-i.y),r.isPointInside(n,t.tolerance))return t.target=this,!0}}return!1},Cr.prototype.hk=function(){var t=this.getGeometry(),n=this.getStyle();return t&&n.lineWidth?(t.inflate(
n.lineWidth/2,n.lineWidth/2),t):null},Y.inheritedBy(Cr),Nr.prototype.uk=function(t,n,i,r){var s=n.clone(),n=this.getOwner(),n=r?new St.Point(r.x,r.y):n.getRenderingPosition();n&&(s.x=s.x-n.x,s.y=s.y-n.y);s=[new St.Line(new St.Point(s.x,s.y),new St.Point(s.x+s.width,s.y+s.height)),new St.Line(new St.Point(s.x+s.width,s.y),new St.Point(s.x,s.y+s.height))];t.renderLines(s,i)},Nr.prototype.select=function(t){if(this.isSelectable()){var n=t.point,i=this.getStyle().transform;i&&(n=i.invert().transformPoint(t.point));var r=this.getGeometry();if(r){i=this.getOwner().getRenderingPosition();if(i&&(r.x=r.x-i.x,r.y=r.y-i.y),r.isPointInside(n,t.tolerance))return t.target=this,!0}}return!1},Nr.prototype.hk=function(){var t=this.getGeometry(),n=this.getStyle();return t&&n.lineWidth?(t.inflate(n.lineWidth/2,n.lineWidth/2),t):null},Y.inheritedBy(Nr);var Or={};function Dr(){var t=new _t.ViewData;this.viewData=t;t=new _t.OverviewWindowData;this.overviewWindowData=t,this.maxZoomRatio=10,
this.minZoomRatio=.1,this.initViewportWidth=841,this.initViewportHeight=594,this.gridPreferencesData=new _t.GridPreferencesData,this.snapPointsPerMinor=1;t=new _t.RenderingProperties;t.setStrokeColor(St.Color.Black),t.setStrokeWidth(1),this.connectionStyleProperties=t,this.defaultArrowheadShape=St.ArrowType.OPEN_ARROW,this.defaultNodeWidth=50,this.defaultNodeHeight=50,this.autoRoutingType=St.ConnectionAutoRoutingType.OrthogonalSimple,this.autoRoutingTypeForPreview=St.ConnectionAutoRoutingType.OrthogonalSimple,this.minNodeToEdgeDist=20,this.minPortExtensionDist=20,this.minSegmentLength=20,this.allowSimpleDrag=!1,this.tooltipLocationOffset=2,this.tooltipLocationXYOffset=null,this.tooltipObjects=["Node","Connection","Annotation","Port"],this.rolloverDelay={1:150,2:300,3:450,4:600,5:750},this.tooltipStayTime=3e3,this.showConnectionSelectionHandles=!0,this.showConnectionHoverHandles=!0,this.handleStyle={moveHandler:{isVisible:!1,strokeWidth:1,strokeColor:new St.Color(255,0,255),
strokeDashArray:[]},resizeHandler:{isVisible:!0,boundaryDashArray:[4,4],shape:Or.Square,size:5,strokeWidth:1,strokeColor:new St.Color(255,0,255),strokeDashArray:[],fillColor:null},rotateHandler:{isVisible:!0,boundaryDashArray:[4,4],shape:Or.Circle,size:5,strokeWidth:1,strokeColor:new St.Color(255,0,255),strokeDashArray:[],fillColor:new St.Color(255,0,255)},rotateBarHandler:{barLength:15,strokeWidth:1,strokeColor:new St.Color(255,0,255),strokeDashArray:[3,3]},rotateCenterHandler:{isVisible:!0,shape:Or.Cross,size:5,strokeWidth:1,strokeColor:new St.Color(255,0,255),strokeDashArray:[],fillColor:null},nestedNodeAddingHandler:{isVisible:!0,strokeWidth:3,strokeColor:new St.Color(255,102,102),strokeDashArray:[]},connectionEndHandler:{isVisible:!0,shape:Or.Square,size:5,strokeWidth:1,strokeColor:new St.Color(255,0,255),strokeDashArray:[],fillColor:null},connectionBendingHandler:{isVisible:!0,shape:Or.Circle,size:5,strokeWidth:1,strokeColor:new St.Color(255,0,255),strokeDashArray:[],
fillColor:new St.Color(255,0,255)},curveConnectionHandler:{strokeColor:new St.Color(63,72,207),storkeWidth:1,strokeDashArray:[4,4]}},this.visualizationPreferencesData=new _t.VisualizationPreferencesData,this.nodePaddings={top:22,right:10,bottom:10,left:10},this.nestedNodeCollapsedWidth=50,this.nestedNodeCollapsedHeight=50,this.defaultNestedNodeSettings={backgroundColor:new St.Color(204,204,204),titleBarColor:new St.Color(0,153,204),titleBarHeight:12,statusSymbolColor:St.Color.Orange},this.nestedNodeResizeMinimumWidth=this.defaultNestedNodeSettings.titleBarHeight,this.nestedNodeResizeMinimumHeight=this.nestedNodeCollapsedHeight+1,this.resizeMinimumWidth=2*this.handleStyle.resizeHandler.size,this.resizeMinimumHeight=2*this.handleStyle.resizeHandler.size,this.overviewStyle={geometryStyle:{overviewStrokeWidth:1,overviewStrokeColor:new St.Color(0,0,0),overviewFillColor:new St.Color(128,128,128)},connectionStyle:null,controlBoxStyle:{defaultCursor:"default",moveCursor:"move",
resizeCursor:"se-resize",strokeWidthCoefficient:.5,fill:"rgb(153,204,255)",fillOpacity:.3,stroke:"rgb(51,153,255)",strokeOpacity:1,shapeRendering:"crispEdges",strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10},controlHandlerStyle:{fill:"rgb(0,0,0)",fillOpacity:1}};t=new _t.ContextData;t.setNodeCreationContext(!1),t.setConnectionCreationContext(!1),this.contextData=t,this.bendVerticaltolerance=Math.ceil(.6*St.Constants.arrowWidth),this.portIndicatorWidth=10,this.portIndicatorHeight=10,this.portIndicatorColor=new St.Color(255,0,0),this.portIndicatorLineWidth=2,this.connectToNodeCenterIfNoPort=!0,this.connectionCaptureAlignmentTolerance=5,this.defaultAnchorX=.5,this.defaultAnchorY=.5,this.selectionPreferencesData=new _t.SelectionPreferencesData,this.highlightData=new _t.HighlightData,this.previewOpacity=1,this.allowObjectArrangement=!0,this.alignableObjectTypes=["Node","Port","Connection"],this.autoAlignmentEnabled=!0,this.autoAlignmentSides=St.AutoAlignmentSides.ALL,
this.alignToSegmentEnabled=!0,this.alignmentTolerance=10,this.alignmentLineExtension=15,this.scaleBasedAlignmentTolerances={.5:15,"2.0":5},this.enableScaleBasedAlignment=!1,this.keyboardMoveStepOffset=2,this.alignmentStrokeColor=new St.Color(255,127,39),this.alignmentLineWidth=1,this.alignmentLineDashArray=[5,5],this.snapToGridByAnchorPoint=!0,this.movePriority=[St.MoveConstraintType.Alignment,St.MoveConstraintType.Snap],this.separateGridSnapAndAlignment=!0,this.alignmentPriority=[St.AlignmentType.PortToPort,St.AlignmentType.NodeToNode,St.AlignmentType.PortToSegmentEndPoint,St.AlignmentType.AnnotationToAnnotation],this.disabledHotkey=[new St.KeyObject(St.KeyCode.F5),new St.KeyObject(St.KeyCode.O,!0),new St.KeyObject(St.KeyCode.S,!0)],this.enableConnectionTrim=!0,this.enableConnectionPreciseTrim=!1,this.trimMode=St.ConnectionTrimMode.NodeAndPort,this.attachableTargets={Connection:["Node","Connection","Port"]},this.attachingLineIndicatorColor=new St.Color(205,55,55),
this.attachingLineIndicatorWidth=3,this.doubleClickSpeed=300,this.clickSpeed=300,this.clickTolerance=10,this.rotationSnappingAngle=90,this.rotationSnappingTolerance=45,this.resizeAspectRatio=0,this.textInputUnfocusCommit=!1,this.textEditAutoSelect=!0,this.inlineTextEditor=!0,this.inlineTextEditorAutoResize=!0,this.inlineTextEditorBackgroundColor=new St.Color(0,0,0,0),this.inlineTextEditorBorder=!0,this.inlineTextEditorBorderColor=new St.Color(112,128,144),this.inlineTextEditorBorderWidth=1,this.inlineTextEditorBorderLineType="dashed",this.truncationMode=0,this.transformPreviewOption={labelPreviewEnabled:!0,connectionPreviewEnabled:!0,referencingElementsPreviewEnabled:!0,nestedNodeParentPreviewEnabled:!0,nestedNodeChildPreviewEnabled:!0},this.transformImmediateUpdate=!1,this.highlightOnPreview=!0,this.connectionEditPreviewStyle={strokeColor:"rgba(0,0,0,1)",lineWidth:1,lineDashArray:[5,5]},this.vectorEffectOption=1,this.danglingConnectionAllowed=!1,this.enableQuadrantIndicator=!1,
this.quadrantIndicatorStyle={width:30,height:30,lineWidth:1},this.touchSettings={holdTime:300,jitterTolerance:4,selectionRadius:40,doubleTapSpeed:300},this.autoLeaderLine=!1,this.minimumLeaderLineLength=10,this.stubBoundingBoxDistance=.5,this.defaultTextBoxLineGapFactor=.2,this.defaultTextCapHeightFactor=.7,this.defaultTextBoxLineGapFactor=.2,this.defaultTextCapHeightFactor=.7,this.svgOverflowVisible=!0,this.preventBrowserDragDropDefault=!0,this.preventBrowserContextMenuDefault=!1,this.connectionPointsComparisonTolerance=.001,this.attachingEventControlOption=St.AttachingEventControlOptions.SINGLE,this.assistantKeysForMultipleSelect=[[St.KeyCode.CTRL],[St.KeyCode.SHIFT]],this.assistantKeysForRectSelect=[],this.assistantKeysForKeyboardMove=[],this.useDefaultPortMoveStrategy=!1,this.defaultLocationIndicatorSettings={str:"<rect x='0' y='0' width='10' height='10' stroke='blue' fill='none'/>",anchor:[.5,.5],size:[10,10],snapTolerance:null},this.autoPanningSettings={distanceToBoundary:10,
timeInterval:100,translateStep:10,stopIfLeaveCanvas:!1,isDynamicStepping:!0},this.pixelCompareTolerance=.005,this.angleDegreeCompareTolerance=.1,this.maxAlignmentSourceCount=30,this.simplifyNodeHandler=!1,this.svgTemplateSettings=null,this.initialize()}function _r(){this[St.CursorID.IMMEDIATE]=St.Constants.CURSOR_STANDARD,this[St.CursorID.DEFAULT]=St.Constants.CURSOR_STANDARD,this[St.CursorID.VIEWONLY]=St.Constants.CURSOR_STANDARD,this[St.CursorID.SELECT]=St.Constants.CURSOR_MOVE,this[St.CursorID.PRESELECT]=St.Constants.CURSOR_MOVE,this[St.CursorID.MOVE]=St.Constants.CURSOR_MOVE,this[St.CursorID.ERESIZE]=St.Constants.CURSOR_ERESIZE,this[St.CursorID.NERESIZE]=St.Constants.CURSOR_NERESIZE,this[St.CursorID.NWRESIZE]=St.Constants.CURSOR_NWRESIZE,this[St.CursorID.NRESIZE]=St.Constants.CURSOR_NRESIZE,this[St.CursorID.SWRESIZE]=St.Constants.CURSOR_SWRESIZE,this[St.CursorID.SERESIZE]=St.Constants.CURSOR_SERESIZE,this[St.CursorID.SRESIZE]=St.Constants.CURSOR_SRESIZE,
this[St.CursorID.WRESIZE]=St.Constants.CURSOR_WRESIZE,this[St.CursorID.PAN]=St.Constants.CURSOR_POINTER,this[St.CursorID.MOVEHSEG]=St.Constants.CURSOR_ERESIZE,this[St.CursorID.MOVEVSEG]=St.Constants.CURSOR_NRESIZE,this[St.CursorID.MOVENWSEG]=St.Constants.CURSOR_NWRESIZE,this[St.CursorID.MOVENESEG]=St.Constants.CURSOR_NERESIZE,this[St.CursorID.LINK]=St.Constants.CURSOR_MOVE,this[St.CursorID.BRKLINK]=St.Constants.CURSOR_MOVE,this[St.CursorID.MOVECEND]=St.Constants.CURSOR_MOVE,this[St.CursorID.MOVEENTIRECON]=St.Constants.CURSOR_MOVE,this[St.CursorID.CREATECON]=St.Constants.CURSOR_STANDARD,this[St.CursorID.CONNECTIONLINKSTART]=St.Constants.CURSOR_CROSSHAIR,this[St.CursorID.CONNECTIONNODESIDESTART]=St.Constants.CURSOR_CROSSHAIR,this[St.CursorID.CONNECTIONSEGMENTSTART]=St.Constants.CURSOR_CROSSHAIR,this[St.CursorID.CREATENODE]=St.Constants.CURSOR_STANDARD,this[St.CursorID.EAC]=St.Constants.CURSOR_STANDARD,this[St.CursorID.ZOOM]=St.Constants.CURSOR_STANDARD,
this[St.CursorID.PREMULTISELECT]=St.Constants.CURSOR_CROSSHAIR,this[St.CursorID.MULTISELECT]=St.Constants.CURSOR_MOVE,this[St.CursorID.RECTSELECT]=St.Constants.CURSOR_CROSSHAIR,this[St.CursorID.RECTZOOM]=St.Constants.CURSOR_STANDARD,this[St.CursorID.SINGLESELECT]=St.Constants.CURSOR_MOVE,this[St.CursorID.TEXTEDIT]=St.Constants.CURSOR_STANDARD,this[St.CursorID.UNAVAIL]=St.Constants.CURSOR_STOP,this[St.CursorID.ATTACH]=St.Constants.CURSOR_MOVE,this[St.CursorID.TEE]=St.Constants.CURSOR_MOVE,this[St.CursorID.ROTATEHOV]=St.Constants.CURSOR_POINTER,this[St.CursorID.ROTATECLICK]=St.Constants.CURSOR_POINTER,this[St.CursorID.DRAGMOVE]=St.Constants.CURSOR_CROSSHAIR,this[St.CursorID.DRAGCOPY]=St.Constants.CURSOR_CROSSHAIR,this[St.CursorID.DROPREJECT]=St.Constants.CURSOR_STOP,this[St.CursorID.MOVEREJECT]=St.Constants.CURSOR_STOP}function Sr(){this.fitMargin=5,this.fitPercentage=100,this.animationNumberSteps=10,this.fitAnimationDuration=200,this.animationHideConnection=!1,this.fitAnimation=!0,
this.keepZoomRatio=!1,this.svgObjectTypes=["Node","Annotation","Table"]}function Tr(){var t=new _t.RenderingProperties;this.symbolRenderProperties=t;t=new _t.TextRenderingProperties;t.setFillColor(St.Color.Black),t.setStrokeColor(void 0),this.textRenderProperties=t}function Ar(){var i=new Dt.Map,r=new Dt.Map,s=new Dt.Map,u=new Dt.Map;this.RD=null,this.addSymbol=function(t){var n=t.guid;n&&(i.containsKey(n)||i.put(n,t),this.addRenderingSymbolCanvas(n,{symbol:t}),this.addRenderingSymbolSvg(n,{symbol:t}))},this.removeSymbol=function(t){t=t.guid;t&&(i.removeByKey(t),this.removeRenderingSymbol(t))},this.ZT=function(t){if(t){var n=t.dom;if(n)if(n instanceof SVGElement)(r=n.parentNode)&&r.removeChild(n),t.dom=null;else{for(var i in n){var r,s=n[i];s&&s instanceof SVGElement&&((r=s.parentNode)&&r.removeChild(s),n[i]=null)}t.dom=null}}},this.removeRenderingSymbol=function(t){r.removeByKey(t);var n=s.get(t);this.ZT(n),s.removeByKey(t)},this.addRenderingSymbol=function(t,n,i){
i==St.RenderingMode.Svg?s.containsKey(t)||s.put(t,n):r.containsKey(t)||r.put(t,n)},this.addRenderingSymbolSvg=function(t,n){s.containsKey(t)||s.put(t,n)},this.addRenderingSymbolCanvas=function(t,n){r.containsKey(t)||r.put(t,n)},this.getRenderingSymbol=function(t,n){return(n==St.RenderingMode.Svg?s:r).get(t)},this.getRenderingSymbolSvg=function(t){return s.get(t)},this.getRenderingSymbolCanvas=function(t){return r.get(t)},this.getSymbol=function(t){return i.get(t)},this.clearRenderingSymbolCache=function(){this.clearRenderingSymbolCacheCanvas(),this.clearRenderingSymbolCacheSvg()},this.clearRenderingSymbolCacheSvg=function(){for(var t=s.values(),n=0,i=t.length;n<i;n++)this.ZT(t[n]);s.clear()},this.clearRenderingSymbolCacheCanvas=function(){r.clear()},this.addRenderingSvgContentCache=function(t,n){u.containsKey(t)||u.put(t,n)},this.getRenderingSvgContentCache=function(t){return u.get(t)},this.clearRenderingSvgContentCache=function(){u.clear()},this.clear=function(){this.RD=null,
this.clearRenderingSymbolCache(),this.clearRenderingSvgContentCache(),i.clear()}}function Rr(){this.handleTextChange=function(t,n,i){var r=t.getReferencings(),s=r.length,u=new x(u=0<s?r[s-1]:u,t,n,St.TextChangeEventPhase.PreUpdate),t=i.CM();if(t){i=new Dt.messages.EventMessage(u,_.OnTextChange);if(t.BM(i)){if(u.isCancelled())return null;u.isHandled()&&(n=u.getValue())}}return n},this.handleSelectionChanged=function(n,i){function t(){var t=new k([],[this.sheetElement||n]),t=new Dt.messages.EventMessage(t,_.OnSelectionChanged);(this.sheetSession||i).CM().BM(t),this.sheetElement=null,this.sheetSession=null}Dt.MicroTaskHelper.queueMicroTask(t.bind?t.bind({sheetElement:n,sheetSession:i}):t)}}function Pr(t,n,i){var r,s,u,h;Y.call(this,t,n,i),this.UT=function(t){r=t},this.iC=function(){return r},this.GT=function(t){s=t},this.rC=function(){return s},this.XT=function(t){u=t},this.sC=function(){return u},this.KM=function(t){h=t},this.$T=function(){return h}}function Hr(t,n,i){Y.call(this,t)
;var r,s=!1,u=null;this.qT=function(){return s},this.oC=function(t){s=t},this.KT=function(t){u=t},this.getPort=function(){return u},this.JT=function(){return n},this.QT=function(){return i},this.KM=function(t){r=t},this.$T=function(){return r}}function Lr(){this.JM=function(t){for(var n=t.getVariablePortSides(),i=t.getBBox(),r=[new St.Line(new St.Point(i.x,i.y),new St.Point(i.x+i.width,i.y)),new St.Line(new St.Point(i.x+i.width,i.y),new St.Point(i.x+i.width,i.y+i.height)),new St.Line(new St.Point(i.x,i.y+i.height),new St.Point(i.x+i.width,i.y+i.height)),new St.Line(new St.Point(i.x,i.y),new St.Point(i.x,i.y+i.height))],s=[St.AllowedSides.TOP,St.AllowedSides.RIGHT,St.AllowedSides.BOTTOM,St.AllowedSides.LEFT],u=[n&St.AllowedSides.TOP,n&St.AllowedSides.RIGHT,n&St.AllowedSides.BOTTOM,n&St.AllowedSides.LEFT],n=t.getSession().getSheetConfigurationData(),h=n.attachingLineIndicatorColor,e=n.attachingLineIndicatorWidth,n=t.getRenderingPosition(),o=t.getEvaluatedTransform(1,1,n),f=0;f<4;f++
)t.tA[f]?t.tA[f].setGeometry(r[f]):t.tA[f]=new Pr(r[f],h,e),t.tA[f].getStyle().transform=o,t.tA[f].setVisible(u[f]),t.tA[f].setSelectable(u[f]),t.tA[f].UT(s[f]),t.tA[f].setOwner(t);return t.tA};function B(t){var n=!0;return n=t.getAllowedTransformations()===St.AllowedTransformations.NONE?!1:n}this.getConnectionOverlays=function(t,n){var i=t.XM(),r=t.nA(),s=t.getResizeLocationData(t),u=t.getSession(),h=u.getSheetConfigurationData(),e=t._M(),o=h.showConnectionSelectionHandles,f=!!(h.showConnectionHoverHandles&&e&St.ConnectionHandleOption.SEGMENTS),a=h.selectionPreferencesData,c=a.isHighlightWithThickWidth(),l=a.highlightThickWidth,v=t.Jk(t.getStyleProvider()),w=v.getStrokeColor(),d=v.getStrokeWidth(),m=h.vectorEffectOption,g=t.getRenderingPosition(),M=t.getEvaluatedTransform(1,1,g),p=null,b=null,k=t.vk(),v=t.QC;v?(C=v.path,t.Fk(C)):C=t.getConnectionRender().getPointsAfterTrim();var g=k?C:[],v=(i&_t.HighlightFlags.EntireConnectionHover)==_t.HighlightFlags.EntireConnectionHover?C.concat(
):[],y=0,x=!!(i&_t.HighlightFlags.Selected);if(x||(i&_t.HighlightFlags.EntireConnectionHover)==_t.HighlightFlags.EntireConnectionHover&&f){if(V=B(t)){var E=a.getMultipleSelectionHandleDisplayOption(),C=t.getAllowedTransformations(),N=n;null==N&&(N=t.getOwningSheet().isMultipleSelection());var O=(C&St.AllowedTransformations.TRANSLATION)===St.AllowedTransformations.TRANSLATION&&(u.ax&St.AllowedTransformations.TRANSLATION)===St.AllowedTransformations.TRANSLATION;if(k)(p=new et(g)).getStyle().strokeColor=h.visualizationPreferencesData.getSelectionColor(),p.getStyle().lineWidth=c?d<l?l:d+1:d,p.vectorEffect=m,p.setVisible(f&&a.isChangeColorOnSelection()&&x),p.setSelectable(f&&O),p.setId(Tt.ConnectionMove),p.setOwner(t),p.jM=Cn.ConnectionSelect;else if((i&_t.HighlightFlags.EntireConnectionHover)==_t.HighlightFlags.EntireConnectionHover&&((b=new et(v)).getStyle().strokeColor=x?h.visualizationPreferencesData.getSelectionColor():h.visualizationPreferencesData.getPreSelectionColor(),b.getStyle(
).lineWidth=c?d<l?l:d+1:d,b.vectorEffect=m,b.setVisible(f&&a.isChangeColorOnSelection()&&O),b.setSelectable(f&&O),b.setId(Tt.ConnectionMove),b.setOwner(t),b.jM=Cn.ConnectionSelect,!x))return[b];for(var D=s.length,_=0;_<D;_++){var S=y++,T=h.handleStyle.connectionEndHandler,A=h.handleStyle.connectionBendingHandler,R=0===_||_===D-1,P=R?T:A,H=R?E&St.MultipleSelectionHandleDisplayOptions.CONNECTION_END:E&St.MultipleSelectionHandleDisplayOptions.CONNECTION_BENDING,L=!1;R?(0===_&&e&St.ConnectionHandleOption.START_HANDLE||_==D-1&&e&St.ConnectionHandleOption.END_HANDLE)&&(L=!0):e&St.ConnectionHandleOption.BENDPOINTS&&(L=!0),t.iA[S]&&t.iA[S]instanceof P.shape?t.iA[S].setGeometry(s[_]):t.iA[S]=new P.shape(s[_]),t.iA[S].getStyle().transform=M,t.iA[S].getStyle().vectorEffect=1,t.iA[S].getStyle().lineWidth=P.strokeWidth,t.iA[S].getStyle().strokeColor=P.strokeColor,t.iA[S].getStyle().lineDashArray=P.strokeDashArray,t.iA[S].getStyle().fillColor=P.fillColor,L?(t.iA[S].setVisible(o&&P.isVisible&&x&&(
!N||H)),t.iA[S].setSelectable(o&&P.isVisible&&x&&(!N||H))):(t.iA[S].setVisible(!1),t.iA[S].setSelectable(!1)),t.iA[S].setOwner(t);var I=Tt.ConnectionBendingDrag;if(0===_?I=Tt.ConnectionStartDrag:_===s.length-1&&(I=Tt.ConnectionEndDrag),t.iA[S]||0===S&&k){if(t.iA[S]&&(t.iA[S].setId(I),t.iA[S].jM=Cn.ConnectionPointDrag),_===D-1)break;H=h.handleStyle.curveConnectionHandler;S=y++,t.iA[S]&&t.iA[S]instanceof Zt?t.iA[S].setGeometry([r[_]]):t.iA[S]=new Zt([r[_]]),t.iA[S].getStyle().transform=M,k?e&St.ConnectionHandleOption.BENDPOINTS&&(t.iA[S].getStyle().strokeColor=H.strokeColor,t.iA[S].getStyle().lineDashArray=H.strokeDashArray):(t.iA[S].getStyle().strokeColor=h.visualizationPreferencesData.getSelectionColor(),t.iA[S].getStyle().lineDashArray=[]);var F=d;t.iA[S].getStyle().vectorEffect=m,c&&(F<l?F=l:F+=1),t.iA[S].getStyle().lineWidth=k?H.storkeWidth:F,k?e&St.ConnectionHandleOption.BENDPOINTS?(t.iA[S].setVisible(a.isChangeColorOnSelection()&&x),t.iA[S].setSelectable(O&&o)):(
t.iA[S].setVisible(!1),t.iA[S].setSelectable(!1)):(t.iA[S].setVisible(o&&a.isChangeColorOnSelection()&&x),t.iA[S].setSelectable(O&&o)),t.iA[S].setOwner(t),t.iA[S].setId(Tt.ConnectionMove),t.iA[S].jM=Cn.ConnectionSelect}}}else for(D=t.iA.length,_=0;_<D;_++)t.iA[_].setVisible(!1);t.iA.splice(s.length+r.length,t.iA.length-(s.length+r.length))}else{if((i&_t.HighlightFlags.Hover)!=_t.HighlightFlags.Hover||!f)return[];var V=B(t);if(k)return(p=new et(g)).getStyle().strokeColor=h.visualizationPreferencesData.getPreSelectionColor(),p.getStyle().lineWidth=2,p.getStyle().vectorEffect=1,p.setVisible(f&&a.isHighlightSelectionOnRollover()&&V),p.setSelectable(f&&V),p.setId(Tt.ConnectionMove),p.setOwner(t),p.jM=Cn.Hover,[p];if(V)for(D=s.length,_=0;_<D;_++){S=y++,T=h.handleStyle.connectionEndHandler,A=h.handleStyle.connectionBendingHandler,P=0===_||_===D-1?T:A;t.iA[S]&&t.iA[S]instanceof P.shape?(t.iA[S].setGeometry(s[_]),t.iA[S]===t.rA?(t.iA[S].getStyle(
).strokeColor=h.visualizationPreferencesData.getPreSelectionColor(),t.iA[S].getStyle().vectorEffect=1,t.iA[S].getStyle().lineWidth=2,t.iA[S].setVisible(f)):(t.iA[S].setVisible(!1),t.iA[S].setSelectable(!1))):(t.iA[S]=new P.shape(s[_],h.visualizationPreferencesData.getPreSelectionColor(),2),t.iA[S].setVisible(!1)),t.iA[S].getStyle().transform=M,t.iA[S].setSelectable(!1),t.iA[S].setOwner(t);I=Tt.ConnectionBendingDrag;if(0===_?I=Tt.ConnectionStartDrag:_===s.length-1&&(I=Tt.ConnectionEndDrag),t.iA[S].setId(I),t.iA[S].jM=Cn.ConnectionPointDrag,_===D-1)break;F=d;S=y++,t.iA[S]&&t.iA[S]instanceof Zt?(t.iA[S].setGeometry([r[_]]),t.iA[S]===t.rA?(t.iA[S].getStyle().strokeColor=h.visualizationPreferencesData.getPreSelectionColor(),t.iA[S].getStyle().vectorEffect=m,c&&(F<l?F=l:F+=1),t.iA[S].getStyle().lineWidth=F,t.iA[S].setVisible(f&&a.isHighlightSelectionOnRollover())):(t.iA[S].getStyle().strokeColor=w,t.iA[S].getStyle().lineWidth=F,t.iA[S].setVisible(!1))):(t.iA[S]=new Zt([r[_]],w,F),
t.iA[S].setVisible(!1)),t.iA[S].getStyle().transform=M,t.iA[S].getStyle().lineDashArray=[],t.iA[S].setSelectable(f),t.iA[S].setOwner(t),I=Tt.None;var j=r[_].getAngle();0===St.MathUtil.angleCompare(j,0)||0===St.MathUtil.angleCompare(j,180)?I=Tt.ConnectionSegNorthSouthDrag:0===St.MathUtil.angleCompare(j,90)||0===St.MathUtil.angleCompare(j,270)?I=Tt.ConnectionSegEastWestDrag:1===St.MathUtil.angleCompare(j,0)&&-1===St.MathUtil.angleCompare(j,90)||1===St.MathUtil.angleCompare(j,180)&&-1===St.MathUtil.angleCompare(j,270)?I=Tt.ConnectionSegNorthWestDrag:(1===St.MathUtil.angleCompare(j,90)&&-1===St.MathUtil.angleCompare(j,180)||1===St.MathUtil.angleCompare(j,270)&&-1===St.MathUtil.angleCompare(j,360))&&(I=Tt.ConnectionSegNorthEastDrag),t.iA[S].setId(I),t.iA[S].jM=Cn.ConnectionSegHover}else for(D=t.iA.length,_=0;_<D;_++)t.iA[_].setVisible(!1);t.iA.splice(s.length+r.length,t.iA.length-(s.length+r.length))}for(var W=[],z=[],Y=t.iA.length,_=0;_<Y;_++)(t.iA[_]instanceof Zt?W:z).push(t.iA[_])
;V=W.concat(z);return p&&V.unshift(p),b&&V.unshift(b),V},this.nC=function(t){var n=t.getSession().getSheetConfigurationData(),i=n.attachingLineIndicatorColor,r=n.attachingLineIndicatorWidth;if(t.vk()){var s=new et(t.getConnectionRender().getPointsAfterTrim());return s.getStyle().strokeColor=i,s.getStyle().lineWidth=r,s.setVisible(!0),s.setSelectable(!0),s.setOwner(t),[s]}for(var s=t.getRenderingPosition(),u=t.getEvaluatedTransform(1,1,s),h=t.getLines(),e=h.length,o=0;o<e;o++)t.sA[o]?t.sA[o].setGeometry(h[o]):t.sA[o]=new Pr(h[o],i,r),t.sA[o].getStyle().transform=u,t.sA[o].setVisible(!0),t.sA[o].setSelectable(!0),t.sA[o].UT(o),t.sA[o].setOwner(t);return t.sA.splice(e,t.sA.length-e),t.sA},this.eC=function(t){var n=t.getSession();Dt.common.ExceptionHelper.throwIfInvalid(n,"SheetSession");var i=n.getSheetConfigurationData(),r=i.portIndicatorWidth,s=i.portIndicatorWidth,u=i.portIndicatorLineWidth,h=i.portIndicatorColor,n=i.visualizationPreferencesData.getPreSelectionColor(),i=t.getBBox(
).clone();i.width<=0&&(i.x-=r/2,i.width=r),i.height<=0&&(i.y-=s/2,i.height=s),t.uA?t.uA.setGeometry(i):t.uA=new Hr(i,h,n);n=t.getRenderingPosition(),n=t.getEvaluatedTransform(1,1,n);return t.uA.getStyle().transform=n,t.uA.getStyle().lineWidth=u,t.uA.oC(!1),t.uA.setOwner(t.getOwner()),t.uA.KT(t),t.uA};function E(t){for(var n=!0,i=t.getSymbols(),r=0,s=i.length;r<s;r++){if(!0===i[r].getSymbol().hA()){n=!0;break}n=!1}return n}this.getElementOverlays=function(t,n,i){var r=[],s=t.XM(),u=t.getSession();Dt.common.ExceptionHelper.throwIfInvalid(u,"SheetSession");var h=u.getSheetConfigurationData();if((s&_t.HighlightFlags.NodePreview)==_t.HighlightFlags.NodePreview){var e=h.handleStyle.nestedNodeAddingHandler;a=i&&i[t.guid]||t.getBBox().clone();var o=t.getEvaluatedTransform(1,1,new St.Point(a.x,a.y),i),f=new Nn(a);(r[0]=f).getStyle().transform=o,f.getStyle().lineWidth=e.strokeWidth,f.getStyle().strokeColor=e.strokeColor,f.getStyle().lineDashArray=e.strokeDashArray,f.setVisible(e.isVisible),
f.setSelectable(!0),f.setId(Tt.None),f.setOwner(t),f.jM=Cn.Preview}else if((s&_t.HighlightFlags.Selected)==_t.HighlightFlags.Selected){var a,c=h.selectionPreferencesData.getMultipleSelectionHandleDisplayOption(),l=n;null==l&&(l=t.getOwningSheet().isMultipleSelection()),a=i&&i[t.guid]||t.getBBox().clone();var v=t.getResizeLocationData(t,i),w=t.getAllowedTransformations(),o=t.getEvaluatedTransform(1,1,new St.Point(a.x,a.y),i),d=h.handleStyle.moveHandler,e=h.selectionPreferencesData.isChangeColorOnSelection(),f=(w&St.AllowedTransformations.TRANSLATION)===St.AllowedTransformations.TRANSLATION&&(u.ax&St.AllowedTransformations.TRANSLATION)===St.AllowedTransformations.TRANSLATION&&(!l||c&St.MultipleSelectionHandleDisplayOptions.TRANSLATION),n=new Nn(a);(r[0]=n).getStyle().transform=o,n.getStyle().lineWidth=d.strokeWidth,n.getStyle().strokeColor=d.strokeColor,n.getStyle().lineDashArray=d.strokeDashArray,n.setId(Tt.Move),n.setOwner(t),n.setVisible(f&&e&&d.isVisible),n.setSelectable(f),
n.jM=Cn.Move;for(var m=h.handleStyle.resizeHandler,g=(w&St.AllowedTransformations.SCALE)===St.AllowedTransformations.SCALE&&(u.ax&St.AllowedTransformations.SCALE)===St.AllowedTransformations.SCALE&&(!l||c&St.MultipleSelectionHandleDisplayOptions.SCALE),M=v.length,p=!1,b=0;b<M-2;b++){var k=new m.shape(v[b]);r[1+b]=k;var y=b+2,x=t.eA(y);k.getStyle().transform=o,k.getStyle().lineWidth=m.strokeWidth,k.getStyle().strokeColor=m.strokeColor,k.getStyle().lineDashArray=m.strokeDashArray,k.getStyle().fillColor=m.fillColor,k.setId(y),k.setOwner(t);y=!0;h.simplifyNodeHandler&&(a.width<2*v[b].width||a.height<2*v[b].height?p=!(y=!1):(a.width<4*v[b].width&&(1!==b&&5!==b||(y=!1)),a.height<4*v[b].height&&(3!==b&&7!==b||(y=!1)))),k.setVisible(g&&m.isVisible&&x&&y),k.setSelectable(g&&m.isVisible&&x&&y),k.jM=Cn.Resize}!1===d.isVisible&&!0===m.isVisible&&(n.getStyle().lineWidth=m.strokeWidth,n.getStyle().strokeColor=m.strokeColor,n.getStyle().lineDashArray=m.boundaryDashArray,n.setVisible(g))
;e=h.handleStyle.rotateHandler,f=h.handleStyle.rotateBarHandler,u=(w&St.AllowedTransformations.ROTATION)===St.AllowedTransformations.ROTATION&&(u.ax&St.AllowedTransformations.ROTATION)===St.AllowedTransformations.ROTATION&&(!l||c&St.MultipleSelectionHandleDisplayOptions.ROTATION),l=t.eA(Tt.Rotate),c=new Zt([new St.Line(new St.Point(v[8].x+v[8].width/2,v[8].y+v[8].height),new St.Point(v[9].x+v[9].width/2,v[9].y))]);(r[1+v.length-2]=c).getStyle().transform=o,c.getStyle().lineWidth=f.strokeWidth,c.getStyle().strokeColor=f.strokeColor,c.getStyle().lineDashArray=f.strokeDashArray,c.setId(Tt.None),c.setOwner(t),c.setVisible(u&&e.isVisible&&l&&!p),c.setSelectable(!1),c.jM=Cn.Rotate;f=h.handleStyle.rotateCenterHandler,c=new f.shape(v[9]);(r[1+v.length-1]=c).getStyle().transform=o,c.getStyle().lineWidth=f.strokeWidth,c.getStyle().strokeColor=f.strokeColor,c.getStyle().lineDashArray=f.strokeDashArray,c.getStyle().fillColor=f.fillColor,c.setId(Tt.None),c.setOwner(t),c.setVisible(
u&&f.isVisible&&l&&!p),c.setSelectable(!1),c.jM=Cn.Rotate;c=new e.shape(v[8]);(r[1+v.length]=c).getStyle().transform=o,c.getStyle().lineWidth=e.strokeWidth,c.getStyle().strokeColor=e.strokeColor,c.getStyle().lineDashArray=e.strokeDashArray,c.getStyle().fillColor=e.fillColor,c.setId(Tt.Rotate),c.setOwner(t),c.setVisible(u&&e.isVisible&&l&&!p),c.setSelectable(u&&e.isVisible&&!p),c.jM=Cn.Rotate,!1===d.isVisible&&!0===e.isVisible&&(n.getStyle().lineWidth=e.strokeWidth,n.getStyle().strokeColor=e.strokeColor,n.getStyle().lineDashArray=e.boundaryDashArray,n.setVisible(u)),E(t)||n.setVisible(!0)}else(s&_t.HighlightFlags.Hover)==_t.HighlightFlags.Hover&&(a=i&&i[t.guid]||t.getBBox().clone(),o=t.getEvaluatedTransform(1,1,new St.Point(a.x,a.y),i),s=new Nn(a),r.push(s),s.getStyle().transform=o,i=!E(t),s.setVisible(i),s.setSelectable(!0),s.jM=Cn.Hover,s.setId(Tt.Preselection),s.setOwner(t));return r},this.eA=function(t,n){t=t.getAvailableScaleHandles();if(void 0===t||null==t)return!0;if(
t===St.Transform.NONE)return!1;if(t===St.Transform.HANDLES_ALL)return!0;var i=0;switch(n){case Tt.NorthwestResize:i=St.Transform.HANDLES_TOP_LEFT;break;case Tt.NorthResize:i=St.Transform.HANDLES_TOP_MIDDLE;break;case Tt.NortheastResize:i=St.Transform.HANDLES_TOP_RIGHT;break;case Tt.WestResize:i=St.Transform.HANDLES_MIDDLE_LEFT;break;case Tt.EastResize:i=St.Transform.HANDLES_MIDDLE_RIGHT;break;case Tt.SouthwestResize:i=St.Transform.HANDLES_BOTTOM_LEFT;break;case Tt.SouthResize:i=St.Transform.HANDLES_BOTTOM_MIDDLE;break;case Tt.SoutheastResize:i=St.Transform.HANDLES_BOTTOM_RIGHT;break;case Tt.Rotate:i=St.Transform.HANDLES_ROTATE}return!!(t&i)}}function Ir(t,n){this.renderMode=t,this.exportSetup=n,this.askPrintPage=0,this.askSvgDomString=1,this.viewportRect=null,this.dataModelMgr,this.returnType}Or.Square=Nn,Or.Circle=Cr,Or.Cross=Nr,Dr.prototype.initialize=function(){},Dr.prototype.remove=function(){this.viewData&&this.viewData.remove(),
this.overviewWindowData&&this.overviewWindowData.remove(),this.selectionPreferencesData&&this.selectionPreferencesData.remove(),this.gridPreferencesData&&this.gridPreferencesData.remove(),this.contextData&&this.contextData.remove(),this.visualizationPreferencesData&&this.visualizationPreferencesData.remove(),this.connectionStyleProperties&&this.connectionStyleProperties.remove()},Tr.prototype.remove=function(){this.symbolRenderProperties.remove(),this.textRenderProperties.remove()},Pr.prototype.uk=function(t,n,i,r){var s=n.clone(),n=this.getOwner(),n=r?new St.Point(r.x,r.y):n.getRenderingPosition();n&&(s.start.x-=n.x,s.start.y-=n.y,s.end.x-=n.x,s.end.y-=n.y);n=this.$T();n&&(n=i.transform.invert().transformVector(new St.Vector(n.x,n.y)),s.start.x+=n.x,s.start.y+=n.y,s.end.x+=n.x,s.end.y+=n.y),t.renderLines([s],i)},Pr.prototype.select=function(t,n){if(this.isSelectable()){var i=t.clone(),r=this.getStyle().transform;r&&(i=r.invert().transformPoint(t));var s=this.getGeometry().clone();if(s
){r=this.getOwner().getRenderingPosition();r&&(s.start.x-=r.x,s.start.y-=r.y,s.end.x-=r.x,s.end.y-=r.y);t=this.$T();t&&(u=this.getStyle().transform.invert().transformVector(new St.Vector(t.x,t.y)),s.start.x+=u.x,s.start.y+=u.y,s.end.x+=u.x,s.end.y+=u.y);r=n||0;if(s.distanceFromPoint(i)<=r){var u,h,t=s.getProjectionPoint(i);if(s.isPointOnLine(t))return s=s.isVertical()?(h=0,(t.y-s.start.y)/(s.end.y-s.start.y)):s.isHorizontal()?(h=(t.x-s.start.x)/(s.end.x-s.start.x),0):(u=(s.end.y-s.start.y)/(s.end.x-s.start.x),n=s.end.y-u*s.end.x,(r=i.clone()).y=u*r.x+n,(t=i.clone()).x=(t.y-n)/u,h=((t=i.distanceToPoint(r)<=i.distanceToPoint(t)?r:t).x-s.start.x)/(s.end.x-s.start.x),(t.y-s.start.y)/(s.end.y-s.start.y)),this.GT(h),this.XT(s),!0}}}return!1},Y.inheritedBy(Pr),Hr.prototype.uk=function(t,n,i,r){var s,u,h,e=n.clone();e.width<=0||e.height<=0||(u=this.getPort(),n=this.getOwner(),!(n=u||n)||(s=r?new St.Point(r.x,r.y):n.getRenderingPosition())&&(e.x-=s.x,e.y-=s.y),(s=this.$T())&&(
h=i.transform.invert().transformVector(new St.Vector(s.x,s.y)),e.x+=h.x,e.y+=h.y),0===u.getSymbols().length&&(h=e.clone(),u=i.lineWidth,h.inflate(-u,-u),h=[new St.Line(new St.Point(h.x,h.y),new St.Point(h.x+h.width,h.y+h.height)),new St.Line(new St.Point(h.x+h.width,h.y),new St.Point(h.x,h.y+h.height))],i.strokeColor=this.QT(),t.renderLines(h,i)),this.qT()&&(i.strokeColor=this.JT(),t.renderRect(e,i)))},Hr.prototype.select=function(t,n){if(this.isSelectable()){var i=t.clone(),r=this.getStyle().transform;r&&(i=r.invert().transformPoint(t));var s=this.getGeometry().clone();if(s){r=this.getPort(),t=this.getOwner(),t=(r||t).getRenderingPosition();t&&(s.x-=t.x,s.y-=t.y);t=this.$T();if(t&&(t=this.getStyle().transform.invert().transformVector(new St.Vector(t.x,t.y)),s.x+=t.x,s.y+=t.y),s.isPointInside(i,n))return!0}}return!1},Hr.prototype.getRenderingBBox=function(){var t=this.getGeometry(),n=this.getStyle().transform.transformRect(new St.Rect(0,0,t.width,t.height)),t=this.$T();return t&&(
n.x+=t.x,n.y+=t.y),n},Y.inheritedBy(Hr),Ir.prototype.runExport=function(t,n){var i,r=t,s=(this.renderMode,this.exportSetup);this.dataModelMgr=n,!0!==s.returnSvgDomString&&(s.createPrintPage?i=0:Dt.common.ExceptionHelper.throwIfInvalid(null,"DiagramExportSettings.returnSvgDomString or Utils.DiagramExportSettings.createPrintPage")),!0!==s.createPrintPage&&(s.returnSvgDomString?i=1:Dt.common.ExceptionHelper.throwIfInvalid(null,"DiagramExportSettings.returnSvgDomString or Utils.DiagramExportSettings.createPrintPage")),this.returnType=i;var u=s.allSheetElements||0<=s.usedLODtype||Fr(r);u&&Br(n,!0,s.allSheetElements,s.usedLODtype);var h=this.extractCloths(r),e=[];s.includeParentDoms&&(e=this.extractParents(r));var o,f="";!s.exportCss&&i!==this.askPrintPage||(f=this.getOutsideCss());t=s.svgIconClassName;t&&(o=this.extractSvgIcons(t));s=null;return i===this.askPrintPage?s=this.createWindow(r,h,e,f,o):i===this.askSvgDomString&&(s=this.exportDomAsString(r,h,f,null,o,t)),u&&Br(n,!1),s}
;var Fr=function(t){var n=t.getManager().getSheet().getCollections();if(!(n&&0<n.length))return!1;for(var i=0,r=n.length;i<r;i++){var s=n[i].getInteractiveSettings();if(s){var u=n[i].getSheetElements();if(u&&0<u.length){s=s.getPrintStatus();if(s===St.PrintStatus.NEVER||s===St.PrintStatus.ALWAYS)return!0}}}return!1};Ir.prototype.domToString=function(t){return(new XMLSerializer).serializeToString(t)},Ir.prototype.getOutsideCss=function(){function t(t){for(var n=t.length,i=0;i<n;i++)r=t[i].cssText,h=h.concat(r)}var r,n=document.styleSheets,i=n[0],s=n.length,u="",h="";if(i)for(var e,o,f=0;f<s;f++)(o=n[f].ownerNode.href)?(e=ss(o,!0))&&(u=u.concat(e)):void 0!==n[f]&&n[f].cssRules?t(n[f].cssRules):void 0!==i[f]&&i[f].rules&&t(n[f].rules);return h=h.concat(u)},Ir.prototype.domArrayToString=function(t){for(var n,i=t.length,r=[],s=0;s<i;s++)n=this.domToString(t[s]),r.push(n);return r};Ir.prototype.extractCloths=function(t){var n=[],i=this.exportSetup,r=t.getVirtualCanvas(),t=r.getSvgRoot(
).cloneNode(!0);Zr(t);for(var s=t.childNodes,u=St.CommonUtil.getSdfIdOnDom(r.getViewFeatureCanvas()),h=St.CommonUtil.getSdfIdOnDom(r.getSheetFeatureCanvas()),e=St.CommonUtil.getSdfIdOnDom(r.getOverlayCanvas()),o=0,f=s.length;o<f;o++){var a=s[o];if(St.CommonUtil.getSdfIdOnDom(a)===u){if(!i.viewFeaturesInclude)continue;!function(t){for(var n,i,r=t.getElementsByTagName("pattern"),s=r.length,u=[],h=[],e=0;e<s;e++)0<(n=r[e].getAttribute("id")).length&&(i=n.slice(0),u.push(i),h.push(n=i+"_print"),r[e].setAttribute("id",n));for(var o,f=t.getElementsByTagName("rect"),e=0;e<f.length;e++)for(var a=f[e].getAttribute("fill"),c=0;c<u.length;c++)-1<a.search(u[c])&&(o=a.replace(u[c],h[c]),f[e].setAttribute("fill",o))}(a)}else if(St.CommonUtil.getSdfIdOnDom(a)===h){if(!i.sheetFeaturesInclude)continue}else if(St.CommonUtil.getSdfIdOnDom(a)===e&&!i.overlayFeaturesInclude)continue;n.push(a)}return n},Ir.prototype.extractParents=function(t){var n=t.getVirtualCanvas().getMainCanvas().parentNode,i=[];for(
i.push(n);n.parentNode;)i.push(n.parentNode),n=n.parentNode;for(var r,s=i.length,u=document.body,h=0;h<s;h++)i[h]===u&&(r=h);for(var e,o=s-(s-r),f=[],a=0;a<o;a++)e=i[a].cloneNode(!1),f.push(e);return f},Ir.prototype.extractSvgIcons=function(t,n){var i=[],r=document.body.getElementsByClassName(t);if(n===this.askSvgDomString)return this.domArrayToString(r);for(var s,u=r.length,h=0;h<u;h++)s=r[h].cloneNode(!0),i.push(s);return i};function Vr(t,n){var i=n.getSheet().getSession().CM();if(i){var r=new At.DiagramExportingEventArgs(t),n=new Dt.messages.EventMessage(r,At.EventType.OnDiagramExporting);return i.BM(n)&&r.isHandled()?r.getDomElement():t}}function jr(){var t=St.Constants.DOM_PREFIX+"printDiv",n=document.createElement("div");n.style.cssText="visibility:hidden; position: fixed; width:100%; height:100%; overflow:hidden; top:0px; left:0px ",n.setAttribute("id",t);var i=document.body,t=i.firstChild;return i.insertBefore(n,t),n}function Wr(t){var n=St.Constants.DOM_PREFIX+"divWrapper",
i=document.createElement("div");return i.setAttribute("id",n),i.style.cssText=t,i}function zr(t,n){for(var i=n.length,r=0;r<i;r++)t.appendChild(n[r])}function Yr(t,n){for(var i=t.firstChild,r=n.length,s=0;s<r;s++)t.insertBefore(n[s],i)}var Br=function(n,t,i,r){var s=n,u=s.getSheetSession(),n=u.isPersistentDataTraceable();u.setPersistentDataTraceable(!1);try{s.renderExportElements(t,i,r),u.setPersistentDataTraceable(n)}catch(t){u.setPersistentDataTraceable(n),window.console&&window.console.log(t)}},Zr=function(t){for(var n,i=t.getElementsByTagName("tspan"),r=i.length-1;0<=r;r--)n=(n=(n=i[r].textContent.replace(new RegExp(/\u00a0/g)," ")).replace(new RegExp(/\u003E/g),">")).replace(new RegExp(/\u003C/g),"<"),i[r].textContent=n};Ir.prototype.assignViewBox=function(t,n){var i,r=this.exportSetup;s=n,i=St.Constants.DOM_PREFIX+St.Constants.DOM_TEXT_MEASUREMENT+St.Constants.DOM_TEXT_MEASUREMENT_CONTAINER,(s=St.CommonUtil.queryDomBySdfId(i,s))&&s.parentNode.removeChild(s);var s,u,s=(s=(t=(s=t
).getSheetConfigurationData().viewData).getViewport(),{x:0,y:0,width:(t=t.getScaleFactor())*s.width,height:t*s.height});return r.topLeftOrigin&&!r.allSheetElements?(u=function(t){for(var n,i,r=St.Constants.DOM_PREFIX+St.Constants.DOM_SVG_SHEET_DEFS,s=St.Constants.DOM_PREFIX+St.Constants.DOM_VIEW_FEATURE,u=St.Constants.DOM_PREFIX+St.Constants.DOM_OVERLAY_CANVAS,h=t.childNodes,e=0,o=h.length;e<o;e++){var f=h[e];St.CommonUtil.getSdfIdOnDom(f)!==s&&St.CommonUtil.getSdfIdOnDom(f)!==r&&St.CommonUtil.getSdfIdOnDom(f)!==u&&(0<(f=f.getBoundingClientRect()).width&&(n=void 0===n||n>f.left?f.left:n),0<f.height&&(i=void 0===i||i>f.top?f.top:i))}var a=0,c=0;return void 0!==n&&void 0!==i&&(a=n-(t=t.getBoundingClientRect()).left-3,c=i-t.top-3),{deltaX:a,deltaY:c}}(n),s.x=s.x+u.deltaX,s.y=s.y+u.deltaY,s.width=s.width-u.deltaX,s.height=s.height-u.deltaY,u=s.x+" "+s.y+" "+s.width+" "+s.height,n.setAttributeNS(null,"viewBox",u),n.setAttribute("preserveAspectRatio","xMinYMin meet")
):r.allSheetElements?this.returnType===this.askSvgDomString&&!r.topLeftOrigin||(u=(s=function(t){for(var n,i=St.Constants.DOM_PREFIX+St.Constants.DOM_SVG_SHEET_DEFS,r=St.Constants.DOM_PREFIX+St.Constants.DOM_VIEW_FEATURE,s=St.Constants.DOM_PREFIX+St.Constants.DOM_OVERLAY_CANVAS,u=t.childNodes,h=0,e=u.length;h<e;h++){var o=u[h];St.CommonUtil.getSdfIdOnDom(o)!==r&&St.CommonUtil.getSdfIdOnDom(o)!==i&&St.CommonUtil.getSdfIdOnDom(o)!==s&&(0<(o=o.getBoundingClientRect()).width&&0<o.height&&(void 0===n?(n=new St.Rect).copyFrom(o):n.union(o)))}return void 0!==n?(t=t.getBoundingClientRect(),n.x-=t.x,n.y-=t.y,n.width+=t.x,n.height+=t.y,n.inflate(5,5)):n={x:0,y:0,width:0,height:0},n}(n)).x+" "+s.y+" "+s.width+" "+s.height,n.setAttributeNS(null,"viewBox",u),n.setAttribute("preserveAspectRatio","xMinYMin meet"),this.returnType===this.askSvgDomString&&r.clipSvgDomElements&&this.changeViewPortForClip(n,s)):r.allSheetElements||r.topLeftOrigin||this.returnType===this.askSvgDomString||(
u=s.x+" "+s.y+" "+s.width+" "+s.height,n.setAttributeNS(null,"viewBox",u)),s},Ir.prototype.exportDomAsString=function(t,n,i,r,s){this.exportSetup.includeParentDoms&&Dt.common.ExceptionHelper.throwNotImplemented(),this.renderMode!=St.RenderingMode.Svg&&Dt.common.ExceptionHelper.throwNotImplemented(),this.exportSetup.processHref&&Gr(n);var u,h,e,o,f=jr(),n=this.manipulateDoms(f,n,t);try{s&&Yr(n,s),this.exportSetup.exportCss&&i&&(u=i.replace(new RegExp(/(\/\*)([\S\s]*?)(\*\/)/g),""),h=document.createTextNode(u),(e=document.createElement("style")).appendChild(h),o=n.firstChild,n.insertBefore(e,o));this.assignViewBox(t,n);var a=this.exportSetup.graphSize;a&&0<a.length&&(n.style.width=a[0]+"px",n.style.height=a[1]+"px"),this.exportSetup.processHref&&ts(n),this.exportSetup.fireDiagramExportingEvent&&Vr(n,this.dataModelMgr);var c=this.domToString(n);return f.parentNode.removeChild(f),c}catch(t){return f.parentNode.removeChild(f),console.log(t),null}},Ir.prototype.manipulateDoms=function(t,n,i
){var r=i,i=Wr("width:100%; height:100%; margin: auto; overflow:hidden;"),r=r.getVirtualCanvas().getMainCanvas().parentNode.cloneNode(!1);return zr(r,n),i.appendChild(r),t.appendChild(i),r},Ir.prototype.fixParentDoms=function(t){var n=this.exportSetup.graphSize,i="100%",r="100%";n&&0<n.length&&(i=n[0]+"px",r=n[1]+"px",t.style.position="absolute"),t.style.width=i,t.style.height=r,t.style.position="",t.style.padding="0px",t.style.margin="0px"},Ir.prototype.insertParentDoms=function(t,n,i){for(var r,s=n.length,u=n[s-1],h=n[s-1],e=n[0],o=(n[1],s-1);0<o;o--)r=n[o-1],this.fixParentDoms(r),u.appendChild(r),u=r;return this.fixParentDoms(h),t.appendChild(h),zr(e,i),e},Ir.prototype.createPrintSvg=function(t,n){var i=Wr("margin: auto; overflow:hidden;"),r="100%",s="100%",u=this.exportSetup.graphSize;u&&0<u.length&&(r=u[0]+"px",s=u[1]+"px",i.style.position="absolute"),i.style.width=r,i.style.height=s;r=document.createElementNS("http://www.w3.org/2000/svg","svg"),
s=St.Constants.DOM_PREFIX+St.Constants.DOM_SVG_ROOT;return St.CommonUtil.setSdfIdOnDom(r,s),r.setAttributeNS(null,"fill","none"),r.style.cssText="overflow: hidden; display: block; margin: auto; -moz-user-select: none; width: 100%; height: 100%;",zr(r,n),i.appendChild(r),t.appendChild(i),r},Ir.prototype.assignClipAndBackground=function(t,n,i){var r,s,u,h=this.exportSetup,e="http://www.w3.org/2000/svg",o=n.x,f=n.y,a=n.width,c=n.height,l=i.right+10,v=i.bottom+10,n=document.body,i=window.getComputedStyle(n,null).getPropertyValue("background-color").toLowerCase();/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(i)&&(4<i.length?(r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i))&&(d=[],s=parseInt(r[1],16),u=parseInt(r[2],16),w=parseInt(r[3],16),d.push(s),d.push(u),d.push(w),m="rgb("+d.join(", ")+")"):(n=i.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,n,i,r){return n+n+i+i+r+r}),(r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n))&&(d=[],s=parseInt(r[1],16),u=parseInt(r[2],16),
w=parseInt(r[3],16),d.push(s),d.push(u),d.push(w),m="rgb("+d.join(", ")+")")),i=m);var w=h.backgroundColor;null!==w?i=w:"transparent"!==w&&"rgba(0, 0, 0, 0)"!==w&&"transparent"!==i&&"rgba(0, 0, 0, 0)"!==i||(i="white");var d=document.createElementNS(e,"rect");d.setAttributeNS(null,"x",o),d.setAttributeNS(null,"y",f);var m=a+l;m<a&&(m=a);w=c+v;w<c&&(w=c),(h.allSheetElements||h.graphSize&&0<h.graphSize.length)&&(m=a,w=c),d.setAttributeNS(null,"width",m),d.setAttributeNS(null,"height",w),d.style.fill=i;m=t.firstElementChild;t.insertBefore(d,m),(h.clipSvgDomElements||h.allSheetElements)&&(w=!1,d=o+a,m=f+c,h.allSheetElements?w=!0:(0<l&&(d=l+o+a,w=!0),0<v&&(m=v+f+c,w=!0)),w&&(e=document.createElementNS(e,"path"),m=d=o+" "+f+" "+d+" "+f+" "+d+" "+m+" "+o+" "+m,h.allSheetElements||(m=o+" "+f+" "+(o+a)+" "+f+" "+(o+a)+" "+(f+c)+" "+o+" "+(f+c)),e.setAttributeNS(null,"d","M "+d+" M "+m),e.setAttributeNS(null,"fill-rule","evenodd"),e.setAttributeNS(null,"fill",i),t.appendChild(e)))},
Ir.prototype.changeViewPortForClip=function(t,n){var i=n.width/n.height,r=t.getBoundingClientRect(),s=r.width,u=r.height,n=s,r=u;i<s/u?n=r*i:r=n/i,t.style||(t.style=document.createElement("style")),t.style.width=n+"px",t.style.height=r+"px",t.setAttributeNS(null,"width",n+"px"),t.setAttributeNS(null,"height",r+"px")};Ir.prototype.getClippedAmt=function(t,n){var i,r={right:0,bottom:0},s=t.getVirtualCanvas().getSvgRoot();this.exportSetup.topLeftOrigin?((i={}).right=n.x+n.width,i.bottom=n.y+n.height):i=s.getBoundingClientRect();for(var u,h,e=St.Constants.DOM_PREFIX+St.Constants.DOM_SVG_SHEET_DEFS,o=St.Constants.DOM_PREFIX+St.Constants.DOM_VIEW_FEATURE,f=St.Constants.DOM_PREFIX+St.Constants.DOM_OVERLAY_CANVAS,a=s.childNodes,c=0,l=a.length;c<l;c++){var v,w=a[c];St.CommonUtil.getSdfIdOnDom(w)!==e&&St.CommonUtil.getSdfIdOnDom(w)!==f&&void 0!==(v=St.CommonUtil.getSdfIdOnDom(w)!==o||t.getSheetConfigurationData().gridPreferencesData.isShowGrid()?w.getBoundingClientRect():v
)&&0<v.width&&0<v.height&&(u=void 0===u||u<v.right?v.right:u,h=void 0===h||h<v.bottom?v.bottom:h)}return void 0!==u&&(r.right=u-i.right),void 0!==h&&(r.bottom=h-i.bottom),r},Ir.prototype.createWindow=function(t,n,i,r,s){this.renderMode===St.RenderingMode.Canvas&&Dt.common.ExceptionHelper.throwNotImplemented();var u=jr(),h=this.exportSetup,n=0<i.length?this.insertParentDoms(u,i,n):this.createPrintSvg(u,n);s&&Yr(u,s);s=this.assignViewBox(t,n);n.setAttribute("preserveAspectRatio","xMinYMin meet");t=this.getClippedAmt(t,s);this.assignClipAndBackground(n,s,t),h.fireDiagramExportingEvent&&Vr(n,this.dataModelMgr);t="#SDF_divWrapper{ position:absolute;}body{overflow:hidden}@media print {html, body{ height:97%; }#SDF_divWrapper{ position:static;}}";h.includeParentDoms&&(t="@media print {html, body{ height:97%; }}");n="";r&&(n=r);var e,r="<!DOCTYPE html><html><head><meta http-equiv='X-UA-Compatible' content='IE=Edge' /></head><body>"+u.innerHTML+"</body></html>";try{var o=window.open("",
"print_preview"),f=o.document;f.open();var a,c=f.createElement("style");c.innerHTML=t+n,f.write(r),f.head.appendChild(c),h.jsAutoTest?(e=this.domToString(f.documentElement),o.close()):f.close(),(a=u.parentNode).removeChild(u)}catch(t){(a=u.parentNode).removeChild(u)}if(h.jsAutoTest&&e)return(a=u.parentNode)&&a.removeChild(u),e};function Ur(t,n){for(var i,r,s=t.getElementsByTagName("g"),u=s.length,h=0;h<u;h++)i=s[h].getAttribute("id"),r=s[h].cloneNode(!0),n[i]=r;return n}Ir.prototype.replaceUseTags=function(t,n){var i,r,s,u,h={};t?(r=St.Constants.DOM_PREFIX+St.Constants.DOM_SVG_SHEET_DEFS,s=St.CommonUtil.queryDomBySdfId(r,t),Ur(s,h),r=St.Constants.DOM_PREFIX+St.Constants.DOM_MAIN_CANVAS,i=St.CommonUtil.queryDomBySdfId(r,t)):(r=St.Constants.DOM_PREFIX+St.Constants.DOM_SVG_SHEET_DEFS,s=St.CommonUtil.queryDomBySdfId(r,document),Ur(s,h));for(var e,o,f=(u=(i||n).getElementsByTagName("use")).length-1;0<=f;f--)o=u[f].parentNode,h[e=(e=u[f].getAttributeNS("http://www.w3.org/1999/xlink","href")
).replace("#","")]&&(e=h[e].cloneNode(!0),o.appendChild(e),o.removeChild(u[f]));return t||n},Ir.getSheetElementDom=function(t,n,i,r,s){var u,h=(h=t.E5).cloneNode(!0),e=r.length;if(r&&0<e)for(var o,f=0;f<e;f++)o="["+St.Constants.DOM_SDF_DATA_APP_ID+"='"+r[f]+"']",(o=h.querySelector(o))&&o.parentNode.removeChild(o);i&&((u=(u=t.getRenderingPosition()).clone()).x=-1*u.x,u.y=-1*u.y,i="translate("+u.x+","+u.y+")",(u=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttributeNS(null,"transform",i)),s&&(h=(a=new Ir).replaceUseTags(null,h));s=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.getSession().getSheetConfigurationData().svgOverflowVisible&&(s.style.overflow="visible"),u?(u.appendChild(h),s.appendChild(u)):s.appendChild(h),n){var a;(a=a||new Ir).domToString(s);return a.domToString(s)}return s};var Gr=function(t){for(var n={},i={},r={},s={},u=0,h=t.length;u<h;u++)for(var e=t[u],o=Xr(e),f=0,a=o.length;f<a;f++){var c,l,v=o[f];$r(v,t,r)||("inDefs"===(l=(c=qr(
v,s)).type)?n[v]=c.dom:"symbol"===l&&(i[v]=c.dom))}var w=Qr(n),d=Qr(i);Jr(t,w,d)},Xr=function(t){for(var n=[],i=t.querySelectorAll("use"),r=i?i.length:0,s=0;s<r;s++){var u=i[s],u=u.href?u.href.baseVal:null;u&&"#"===u[0]&&(u=u.slice(1),n.push(u))}return n},$r=function(t,n,i){if(void 0===(r=i[t])){for(var r=!1,s=0,u=n.length;s<u;s++)if(n[s].querySelector("#"+t)){r=!0;break}i[t]=r}return r},qr=function(t,n){var i,r,s=n[t];return void 0===s&&(i=null,(r=document.querySelector("#"+t))&&(Kr(r,"defs")?i="inDefs":"symbol"===r.tagName&&(i="symbol"),n[t]=s={dom:r,type:i})),s},Kr=function(t,n){for(var i=!1,r=t.parentNode;r;){if(r.tagName===n){i=!0;break}r=r.parentNode}return i},Jr=function(t,n,i){for(var r=0,s=i.length;r<s;r++){var u=i[r];t.unshift(u.cloneNode(!0))}if(0<n.length){for(var h=null,r=0,s=t.length;r<s;r++)if("defs"===(e=t[r]).tagName){h=e;break}h||(h=document.createElement("defs"),t.unshift(h));for(r=0,s=n.length;r<s;r++){var e=n[r];h.appendChild(e.cloneNode(!0))}}},Qr=function(t){
var n,i,r=[];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i=t[n],r.push(i));return r},ts=function(t){for(var n={},i=t.getElementsByTagName("image"),r=0,s=i.length;r<s;r++){var u=i[r],h=u.href?u.href.baseVal:null,h=ns(h,n);h&&(u.href.baseVal=h)}},ns=function(t,n){if(!t)return null;var i=t.trim(),t=n?n[i]:void 0;if(void 0===t){n=i.match(new RegExp(/(\.png$)|(\.jpg$)|(\.jpeg$)|(\.svg$)|(\.bmp$)/gi)),n=n?n[0]:null;n&&0<n.length&&(n=(n=n.slice(1)).toLowerCase()),t=null;try{/(png)|(jpg)|(jpeg)|(bmp)/i.test(n)?t=is(i,n):"svg"===n&&(t=rs(i))}catch(t){}}return t},is=function(t,n){var i=null;if("png"===(n=n.toLowerCase())?i="image/png":"jpg"===n||"jpeg"===n?i="image/jpeg":"bmp"===n&&(i="image/png"),!i)return null;var r=new Image;r.src=t;var s=r.width,n=r.height,t=document.createElement("canvas");return t.width=s,t.height=n,t.getContext("2d").drawImage(r,0,0),t.toDataURL(i)},rs=function(t){var n=null,t=ss(t);return n=t&&0<t.length?"data:image/svg+xml;base64,"+window.btoa(unescape(
encodeURIComponent(t))):n},ss=function(t,u){var n=null;return Q.ajax({url:t,type:"GET",async:!1,dataType:"text",success:function(t){n=t},error:function(t,n,i){var r,s;u&&(r=t.status,s=t.statusText,0!==r&&(t=Dt.common.ExceptionTypes.ServerError.id,Dt.common.ExceptionHelper.throwException(t,"HTTP Server Error Code Received = "+r+"; Error Text = "+s+".")))}}),n};function us(){this.getSheetElementDom=function(t,n,i,r){return Ir.getSheetElementDom(t,n,i,r)}}function hs(t){this.element=t,this.stopMove=!1,this.previewManger=null}function es(t){hs.call(this,t)}function os(t,n){hs.call(this,t),this.maxDistance=n}function fs(t){hs.call(this,t),this.maxDistance=1/0}function as(){this.createAlongPathMoveStrategy=function(t){return new es(t)},this.createPortMoveStrategy=function(t){return new fs(t)}}function cs(){Dt.AppSession.addSheetSession(this),this.oA={},this.suppressRoutingOnConnectionChanged=!1,this.suppressBoundaryUpdateOnNestedNodeChanged=!1,this.layoutIncludesLabel=!1,this.fA=null,
this.aA=null,this.cA=null,this.lA=null,this.vA={},this.wA=!1;var i=[],s={},h={},r=new Dr,t=new _r,n=new Sr,u=new Dt.Messenger(this),e=new Ar,o=null,f=new W(u),a=!1,c=!1,l=new St.Point(0,0),v=new St.Point(0,0),w=null,d=new wr(this);this.dA=new St.PerformanceCounter,this.iN=null,this.uN=null,this.dN=null,this.ax=St.AllowedTransformations.TRANSLATION|St.AllowedTransformations.ROTATION|St.AllowedTransformations.SCALE,this.e5=500,this.l_=!1,this.a5=!1,this.mA=0,this.gA=0,this.MA=new _t.RenderCanvasManager(this,null),this.pA=function(t){return this.MA.pA(t)},this.lk=function(t){return this.MA.lk(t)},this.fN=function(){return this.MA},this.bA={},this.kA={},this.c5={ctrlKey:!1,altKey:!1,shiftKey:!1},this.yA=new Rr,this.xA=new Lr,this.EA=new us,this.CA=new as,this.NA=!1,this.OA=function(t){this.bA[t.guid]=t},this.DA=function(t){this.kA[t.guid]=t};var m=null,g=void 0;this.WO=function(t){g=t},this._A=function(){return g},this.ok=function(){return m},this.zO=function(t){m=t},this.jO=function(t){
var n=this.getSheetConfigurationData(),i=n.viewData.getScaleFactor(),n=n.visualizationPreferencesData,r=this._A(),s={isChanged:!1,previousLod:r,currentLod:void 0};if(n.getEnableLod())if(void 0===t)i<n.getIntermediateLevelThresholdRatio()&&i>=n.getOverviewLevelThresholdRatio()?(void 0===r?s.isChanged=!1:r!==St.LODType.IntermediateLevel&&(s.isChanged=!0),s.currentLod=St.LODType.IntermediateLevel):i<n.getOverviewLevelThresholdRatio()?(void 0===r?s.isChanged=!1:r!==St.LODType.OverviewLevel&&(s.isChanged=!0),s.currentLod=St.LODType.OverviewLevel):(void 0===r?s.isChanged=!1:r!==St.LODType.DetailLevel&&(s.isChanged=!0),s.currentLod=St.LODType.DetailLevel);else{switch(t){case St.LODType.DetailLevel:case St.LODType.IntermediateLevel:case St.LODType.OverviewLevel:void 0===r?s.isChanged=!1:r!==t&&(s.isChanged=!0)}s.currentLod=t}else void 0===r?s.isChanged=!1:r!==St.LODType.None&&(s.isChanged=!0),s.currentLod=St.LODType.None;return s},this.n_=function(t,n,i){var r,s;"arrowHead"===i?(
r=St.LODVisibleOptions.HideArrowHeadOnIntermediateLevel,s=St.LODVisibleOptions.HideArrowHeadOnOverviewLevel):"marker"===i?(r=St.LODVisibleOptions.HideMarkerOnIntermediateLevel,s=St.LODVisibleOptions.HideMarkerOnOverviewLevel):"cellContent"===i&&(r=St.LODVisibleOptions.HideTableContentOnIntermediateLevel,s=St.LODVisibleOptions.HideTableContentOnOverviewLevel);var u=!1,h=n.getLodVisibleOption();if(t.currentLod===St.LODType.DetailLevel)switch(t.previousLod){case St.LODType.IntermediateLevel:(h&r)===r&&(u=!0);break;case St.LODType.OverviewLevel:(h&s)===s&&(u=!0)}else if(t.currentLod===St.LODType.IntermediateLevel)switch(t.previousLod){case St.LODType.DetailLevel:(h&r)===r&&(u=!0);break;case St.LODType.OverviewLevel:((h&s)===s&&(h&r)!==r||(h&s)!==s&&(h&r)===r)&&(u=!0)}else if(t.currentLod===St.LODType.OverviewLevel)switch(t.previousLod){case St.LODType.DetailLevel:(h&s)===s&&(u=!0);break;case St.LODType.IntermediateLevel:((h&s)===s&&(h&r)!==r||(h&s)!==s&&(h&r)===r)&&(u=!0)}return u},
this.SA=function(t,n,i){var r,s;"arrowHead"===i?(r=St.LODVisibleOptions.HideArrowHeadOnIntermediateLevel,s=St.LODVisibleOptions.HideArrowHeadOnOverviewLevel):"marker"===i?(r=St.LODVisibleOptions.HideMarkerOnIntermediateLevel,s=St.LODVisibleOptions.HideMarkerOnOverviewLevel):"cellContent"===i&&(r=St.LODVisibleOptions.HideTableContentOnIntermediateLevel,s=St.LODVisibleOptions.HideTableContentOnOverviewLevel);i=!1,n=n.getLodVisibleOption();return t.currentLod===St.LODType.IntermediateLevel?(n&r)===r&&(i=!0):t.currentLod===St.LODType.OverviewLevel&&(n&s)===s&&(i=!0),i},this.ek=function(t,n){var i=!1,n=n.getLodVisibleOption();return t.currentLod===St.LODType.IntermediateLevel?(n&St.LODVisibleOptions.HideOnIntermediateLevel)===St.LODVisibleOptions.HideOnIntermediateLevel&&(i=!0):t.currentLod===St.LODType.OverviewLevel&&(n&St.LODVisibleOptions.HideOnOverviewLevel)===St.LODVisibleOptions.HideOnOverviewLevel&&(i=!0),i},this.getSymbolCache=function(){return e},this.addObject=function(t){
Dt.AppSession.addObject(t)},this.deleteObject=function(t){Dt.AppSession.deleteObject(t)},this.getBaseObject=function(t,n){return Dt.AppSession.getBaseObject(t,n)},this.getBaseObjectByGuid=function(t,n){return Dt.AppSession.getBaseObjectByGuid(t,n)},this.TA=function(t){return t===this.fA||t===this.cA},this.AA=function(t){return t===this.aA},this.RA=function(t){return t===this.lA},this.clear=function(){for(var t in Dt.AppSession.clearUpdateList(),d.destroy(),i=[],s={},this.PA&&this.PA.remove(),r.remove(),e.clear(),this.HA(),this.fA&&(this.fA.remove(),this.fA=null),this.aA&&(this.aA.remove(),this.aA=null),this.cA&&(this.cA.remove(),this.cA=null),this.lA&&(this.lA.remove(),this.lA=null),this.bA)Object.prototype.hasOwnProperty.call(this.bA,t)&&this.bA[t].remove();for(var n in this.bA={},this.kA)Object.prototype.hasOwnProperty.call(this.kA,n)&&this.kA[n].remove();this.kA={},Dt.AppSession.removeSheetSession(this)},this.getElementsByType=function(t){return Dt.AppSession.getElementsByType(t)},
this.$C=function(t){i.indexOf(t)<0&&i.push(t)},this.b_=function(t){t=i.indexOf(t);0<=t&&i.splice(t,1)},this.LA=function(){return i},this.getSheetConfigurationData=function(){return r},this.getCursorConfiguration=function(){return t},this.getViewConfig=function(){return n},this.IA=function(t){o=t},this.FA=function(){return o},this.getConnectionTrimmer=function(){return(w=w||new St.ConnectionTrimmer).enableTrim=r.enableConnectionTrim,w},this.CM=function(){return u},this.getEventDispatcher=function(){return f},this.setInUpdateProcess=function(t){a=t},this.isInUpdateProcess=function(){return a},this.setPersistentDataTraceable=function(t){c=t},this.isPersistentDataTraceable=function(){return c},this.clearUpdateList=function(){Dt.AppSession.clearUpdateList(),s={},d.clear()},this.isNewObject=function(t){return Dt.AppSession.isNewObject(t)},this.isDeletedObject=function(t){return Dt.AppSession.isDeletedObject(t)},this.addUpdateCandidate=function(t){void 0===s[t.guid]&&(s[t.guid]=t)}
;function M(t,n){return t.VA()-n.VA()}var p=function(t){return t?t.jA()?t:(n=t.getOwner?t.getOwner():n)?n.jA()?n:void p(n):null:null;var n};this.update=function(){var t,n={},i=[];for(t in s){var r=p(s[t]);r&&1!==r.wM&&void 0===n[r.guid]&&(i.push(r),n[r.guid]=r)}i.sort(M),i.forEach(function(t){t.update(),t.WA()}),s={}},this.setMousePostion=function(t,n){t&&(l.x=t.x,l.y=t.y),n&&(v.x=n.x,v.y=n.y)},this.getMousePosition=function(){return l},this.getMousePositionOnScreen=function(){return v},this.isInEventLoop=function(){return f.inEventLoop},this.enableAsynchronousRendering=function(t){u.NM=t},this.dM=function(){return d},this.zA=function(){St.MathUtil.doubleTolerance=r.pixelCompareTolerance,St.MathUtil.angleTolerance=r.angleDegreeCompareTolerance};this.YA=function(t,n){var i,r,s=t||"...",u="suffix:"+s+(i=n,r="",["class","font-family","font-size","font-weight","font-style"].forEach(function(t){var n=i[t];n&&(r=r+t+":"+n+";")}),r),t=h[u];if(t)return t;n=St.CommonUtil.measureTextSize(s,n)
;return h[u]=n},this.PA=new Tr}hs.prototype.getElementOriginalBBox=function(t){var n=this.previewManger;if(n)return n.getElementOriginalBBox(t);t=t.getBBox();return t?t.clone():void 0},hs.prototype.getOriginalRenderingPosition=function(t){var n=this.getElementOriginalBBox(t);return n?new St.Point(n.x,n.y):t.getRenderingPosition()},hs.prototype.getOriginalAnchorPosition=function(t){return t.translateRenderingToAnchorPosition(this.getOriginalRenderingPosition(t))},hs.prototype.getOriginalSegmentIdentifier=function(t){var n=this.previewManger;if(n)return n.getElementOriginalSegmentIdentifier(t);t=t.getLocation();return t&&t.getSegmentIdentifier?t.getSegmentIdentifier():void 0},hs.prototype.setTarget=function(t){this.element=t},hs.prototype.getTarget=function(){return this.element},hs.prototype.setStopMove=function(t){this.stopMove=t},hs.prototype.getStopMove=function(){return this.stopMove},hs.prototype.getFinalTransformation=function(t,n){return this.getStopMove()?{dx:0,dy:0,angle:void 0
}:{dx:t,dy:n,angle:void 0}},_t.BaseObject.inheritedBy(hs),es.prototype.getFinalTransformation=function(t,n){var i=t,r=n,s=this.getTarget(),u=this.getOriginalAnchorPosition(s),h=u.x+t,e=u.y+n,o=new St.Point(h,e),f=s.getLocation(),a=f.isLockX(),c=f.isLockY(),l=f.getReference().getLines(),v=0,w=l.length;if(0<w){for(var d=l[0].distanceFromPoint(o),m=1;m<w;++m){var g=l[m].distanceFromPoint(o);g<d&&(d=g,v=m)}var M,p,b=l[v],k=b.isVertical(),s=(b.getLength(),this.getOriginalSegmentIdentifier(s)),f=(f=f.getMarginToPoints?f.getMarginToPoints():0)||0;k?(M=Math.max(b.start.y,b.end.y),p=Math.min(b.start.y,b.end.y),M-f<e?(e=M-f,this.setStopMove(!0)):e<p+f?(e=p+f,this.setStopMove(!0)):this.setStopMove(!1)):(M=Math.max(b.start.x,b.end.x),p=Math.min(b.start.x,b.end.x),M-f<h?(h=M-f,this.setStopMove(!0)):h<p+f?(h=p+f,this.setStopMove(!0)):this.setStopMove(!1));t=t,n=n,r=s!=v?(n=k?(t=b.start.x-u.x,e-u.y):(t=h-u.x,b.start.y-u.y),i=t,n):(k?n=e-u.y:t=h-u.x,k&&(k=a,a=c,c=k),i=a?0:t,c?0:n)}return{dx:i,dy:r,
angle:void 0}},hs.inheritedBy(es),os.prototype.getFinalTransformation=function(t,n){return hs.prototype.getFinalTransformation.call(this,t,n)},hs.inheritedBy(os),fs.prototype.getFinalTransformation=function(t,n){for(var i=t,r=n,s=0,u=this.getTarget(),h=this.getOriginalAnchorPosition(u),e=u.getOwner(),o=this.getOriginalRenderingPosition(e),f=e.getEvaluatedTransform(1,1,o),o=f.invert().transformVector(new St.Vector(t,n)),t=h.x+o.x,n=h.y+o.y,a=new St.Point(t,n),o=this.getElementOriginalBBox(e),c=u.getParentSides()&e.getVariablePortSides(),l=[new St.Line(new St.Point(o.x,o.y),new St.Point(o.x+o.width,o.y)),new St.Line(new St.Point(o.x+o.width,o.y),new St.Point(o.x+o.width,o.y+o.height)),new St.Line(new St.Point(o.x,o.y+o.height),new St.Point(o.x+o.width,o.y+o.height)),new St.Line(new St.Point(o.x,o.y),new St.Point(o.x,o.y+o.height))],v=[St.AllowedSides.TOP,St.AllowedSides.RIGHT,St.AllowedSides.BOTTOM,St.AllowedSides.LEFT],w=[],d=[],m=0;m<4;m++)c&v[m]&&(w.push(l[m]),d.push(v[m]));for(
var g=0,M=St.AllowedSides.NONE,m=0;m<4;m++)if(l[m].isPointOnLine(h)){M=v[m],g=m;break}if(M){var p=w.length;if(0<p){var b,k,y=w[0].distanceFromPoint(a);y<=this.maxDistance&&(b=d[0],k=0);for(var x,E,m=1;m<p;m++){var C=w[m].distanceFromPoint(a);C<=this.maxDistance&&C<y&&(y=C,b=d[m],k=m)}b&&(b===St.AllowedSides.TOP||b===St.AllowedSides.BOTTOM?(t<o.x?t=o.x:t>o.x+o.width&&(t=o.x+o.width),x=t-h.x,b===St.AllowedSides.TOP?E=o.y-h.y:b===St.AllowedSides.BOTTOM&&(E=o.y+o.height-h.y)):b!==St.AllowedSides.RIGHT&&b!==St.AllowedSides.LEFT||(n<o.y?n=o.y:n>o.y+o.height&&(n=o.y+o.height),E=n-h.y,b===St.AllowedSides.RIGHT?x=o.x+o.width-h.x:b===St.AllowedSides.LEFT&&(x=o.x-h.x)),i=(E=f.transformVector(new St.Vector(x,E))).x,r=E.y,u.getTransformPolicy()===St.PortTransformPolicy.RotateOnOwnerOutline&&(s=90*(k-g)))}}return{dx:i,dy:r,angle:s}},hs.inheritedBy(fs),cs.prototype.getPerformanceCounter=function(){return this.dA},cs.prototype.BA=function(t){if(t)for(var n in this.vA||(this.vA={}),t
)Object.prototype.hasOwnProperty.call(t,n)&&(this.vA[n]=t[n])},cs.prototype.FN=function(){this.vA=null},cs.prototype.mO=function(){return this.vA?this.vA.duration:0},cs.prototype.hT=function(){for(var t=this.getElementsByType(_t.Sheet),n=0,i=t.length;n<i;n++)if(this===t[n].getSession())return t[n];return null},cs.prototype.makeWorkSession=function(){this!==Dt.AppSession.workSheetSession&&(Dt.AppSession.workSheetSession=this),this.zA()},cs.prototype.LN=function(){this.a5=!0},cs.prototype.VN=function(){this.a5=!1};function ls(t,n,i){t.getAttribute("data-sdf-index")||t.setAttribute("data-sdf-index",vs++);for(var r=t.attributes,s=r.length,u=0;u<s;u++){var h=r[u],e=h.value,h=h.name;e&&(0<=e.indexOf("Binding")||"data-sdf-content"===h)&&((c=new n(null,e,null)).ZA[0]=t.getAttribute("data-sdf-index"),c.ZA[1]=2,c.ZA[2]=h,i.push(c))}for(var o=t.childNodes,f=o.length,a=0;a<f;a++){var c,l=o[a].nodeType;3===l?(e=o[a].nodeValue)&&0<=e.indexOf("Binding")&&((c=new n(null,e,null)).ZA[0]=t.getAttribute(
"data-sdf-index"),c.ZA[1]=3,i.push(c)):8===l?(e=o[a].text)&&0<=e.indexOf("Binding")&&((c=new n(null,e,null)).ZA[0]=t.getAttribute("data-sdf-index"),c.ZA[1]=3,i.push(c)):1===o[a].nodeType&&ls(o[a],n,i)}}var vs=1;function ws(){_t.BaseObject.call(this),ds.setRawValue(this,!0);var s=new St.Rect(0,0,0,0),o=St.GridType.LINE,f=new St.Color(50,50,50,.4),a=new St.Color(50,50,50,.8),c=50,l=5,v=!0,w=!0,u=new St.Rect(0,0,0,0),h=new St.Rect(0,0,0,0),e=new St.RenderStyle,d=0,m=0,g=0,M=0,n=this.getSession().getSheetConfigurationData().gridPreferencesData;this.QD=!0;var i=function(t){u.copyFrom(s),h.width=t.width(),h.height=t.height();var n=h.width/h.height,i=s.width/s.height;0<St.MathUtil.doubleCompare(n,i)?(t=.5*(n*s.height-s.width),u.inflate(t,0)):St.MathUtil.doubleCompare(n,i)<0&&(r=.5*(s.width/n-s.height),u.inflate(0,r));i=u.x,n=u.y;u.x=0,u.y=0;var r=St.Matrix.sheetToScreenTransform(u,h);u.x=i,u.y=n,e.transform=r},r=function(){var t;d=u.x%c,m=u.y%c,d=d<0?c+d:d,m=m<0?c+m:m,o===St.GridType.POINT&&(
d-=t=c/l/2,m-=t),d*=-1,m*=-1};this.V5=function(t){i(t),c=n.getMajorGridSpacing(),l=n.getMinorLinesPerMajor(),a=n.getGridColor(),f.copyFrom(a),f.alpha/=2,v=n.isShowMajorLines(),w=n.isShowMinorLines(),o=n.getGridType(),g=u.width+c,M=u.height+c,r()},this.t_=function(t){this.V5(t);var n=c,i=c/l,r=i/2,s=f.toString(),u=a.toString(),h="<svg xmlns='http://www.w3.org/2000/svg' width='"+g+"' height='"+M+"'>";h+="<defs>";var e,t=this.getSession().ok();w&&t.currentLod!==St.LODType.OverviewLevel&&(h+="<pattern id='"+(e=p(St.Constants.DOM_MINOR_GRID,this))+"' width='"+i+"' height='"+i+"' patternUnits='userSpaceOnUse'>",o===St.GridType.LINE?h+="<path d='M "+i+" 0 L 0 0 0 "+i+"' fill='none' stroke='"+s+"' stroke-width='1' vector-effect='non-scaling-stroke'/>":o===St.GridType.POINT&&(h+="<circle cx='"+r+"' cy='"+r+"' r='1' fill='"+s+"' stroke='none' vector-effect='non-scaling-stroke'/>"),h+="</pattern>");s=p(St.Constants.DOM_MAJOR_GRID,this)
;return h+="<pattern id='"+s+"' width='"+n+"' height='"+n+"' patternUnits='userSpaceOnUse'>",w&&(h+="<rect width='"+n+"' height='"+n+"' fill='url(#"+e+")' vector-effect='non-scaling-stroke'/>"),v&&(o===St.GridType.LINE?h+="<path d='M "+n+" 0 L 0 0 0 "+n+"' fill='none' stroke='"+u+"' stroke-width='1' vector-effect='non-scaling-stroke'/>":o===St.GridType.POINT&&(h+="<circle cx='"+(r=n-r)+"' cy='"+r+"' r='1' fill='"+u+"' stroke='none' vector-effect='non-scaling-stroke'/>")),h+="</pattern>",h+="</defs>",h+="<rect width='100%' height='100%' fill='url(#"+s+")' transform='translate("+d+","+m+")'/>",h+="</svg>"};var p=function(t,n){t=St.Constants.DOM_PREFIX+t;return Dt.DebugFlags.UseNativeDomId||(t+="_"+n.guid),t};this.isVisible=function(){return n.isShowGrid()},this.j5=function(){return n.isBringGridToTop()},this.setViewport=function(t){s.copyFrom(t)},this.isBackground=function(){return!0},this.L5=function(){return a},this.I5=function(){return f},this.getMajorGridSpacing=function(){return c},
this.getMinorLinesPerMajor=function(){return l},this.getGridWidth=function(){return g},this.getGridHeight=function(){return M},this.isShowMajorLines=function(){return v},this.isShowMinorLines=function(){return w},this.P5=function(){return d},this.H5=function(){return m},this.render=function(t){this.QD||(i(t),c=n.getMajorGridSpacing(),l=n.getMinorLinesPerMajor(),g=u.width+c,M=u.height+c,r(),e.width=g,e.height=M),t.renderGrid(e,this,d,m),this.QD=!1}}cs.prototype.UA=function(t,n,i){if(s=this.oA[t]){var r=s.evaluatedDom;return r?r:s.domReference}i=i||document.getElementById(t);if(!i)return null;var s=this.oA[t]={domReference:i},t=[];return ls(i,n,t),s.templateInstances=t,i},cs.prototype.GA=function(t){t=this.oA[t];return t?t.templateInstances:null},cs.prototype.XA=function(t,n){t=this.oA[t];t&&!t.evaluatedDom&&(t.evaluatedDom=n)},cs.prototype.$A=function(t,n,i){var r,s=this.oA[t];s&&((r=s.propToTemplatesMap)?(t=r[n])?t.indexOf(i)<0&&t.push(i):r[n]=[i]:((r={})[n]=[i],s.propToTemplatesMap=r)
)},cs.prototype.qA=function(t){t=this.oA[t];return t?t.propToTemplatesMap:null},cs.prototype.HA=function(){var t=this.oA;if(t){for(var n in t){n=t[n];if(n){var i=n.templateInstances;if(i)for(var r=0,s=i.length;r<s;r++)i[r].remove();n.evaluatedDom=null,n.templateInstances=null,n.domReference=null,n.propToTemplatesMap=null}}this.oA=null}};ws.prototype.update=function(){var t=ds.getValue(this);ds.setValue(this,!t)},ws.prototype.getRenderCanvas=function(){var t=this.getSession(),n=St.Constants.CANVAS_ID_PREFIX_FOR_SYSTEM+St.Constants.CANVAS_ID_FOR_VIEWFEATURE+St.Constants.CANVAS_ID_FOR_SIZE_ON_SHEET+St.Constants.CANVAS_ID_SUFFIX;return t.lk(n)},_t.BaseObject.inheritedBy(ws);var ds=Dt.Property.define(ws,"m_updateMask",Boolean,Dt.PropertyFlags.NotifyChange|Dt.PropertyFlags.AffectRender,function(t,n,i,r){t.QD=!0});function ms(t,n){function i(t,n){return t=document.createElementNS("http://www.w3.org/2000/svg",t),St.CommonUtil.setSdfIdOnDom(t,St.Constants.DOM_PREFIX+n),t}var r=null,s=null,
u=null,h=null,e=null,o=null,f=null,a=null,c=n;t&&(r=document.createElement("div"),St.CommonUtil.setSdfIdOnDom(r,St.Constants.DOM_PREFIX+St.Constants.DOM_OVERVIEW_CANVAS_WRAPPER),r.style.width="100%",r.style.height="100%",r.style.background="transparent",r.style.overflow="hidden",r.style.position="relative",(s=document.createElement("canvas"))&&(s.style.position="absolute",s.style.left="0px",s.style.top="0px",r.appendChild(s)),(u=document.createElement("canvas"))&&(u.style.position="absolute",u.style.left="0px",u.style.top="0px",r.appendChild(u)),h=document.createElement("div"),St.CommonUtil.setSdfIdOnDom(h,St.Constants.DOM_PREFIX+St.Constants.DOM_OVERVIEW_SVG_IMAGE_DIV),h.style.width="100%",h.style.height="100%",h.style.position="absolute",r.appendChild(h),t.appendChild(r),(e=i("svg",St.Constants.DOM_OVERVIEW_SVG_ROOT)).style.display="block",e.style.width="100%",e.style.height="100%",h.appendChild(e),o=i("g",St.Constants.DOM_OVERVIEW_VIEWPORT_GROUP),e.appendChild(o),n=i("g",
St.Constants.DOM_OVERVIEW_VIEWPORT),f=i("rect",St.Constants.DOM_OVERVIEW_VIEWPORT_RECT),t=St.Constants.DOM_PREFIX+St.Constants.DOM_CLASS_OVERVIEW_CONTROL_BOX,f.setAttribute("class",t),f.setAttribute("fill",c.controlBoxStyle.fill),f.setAttribute("fill-opacity",c.controlBoxStyle.fillOpacity),f.setAttribute("stroke",c.controlBoxStyle.stroke),f.setAttribute("stroke-opacity",c.controlBoxStyle.strokeOpacity),f.setAttribute("shape-rendering",c.controlBoxStyle.shapeRendering),f.setAttribute("stroke-linecap",c.controlBoxStyle.strokeLineCap),f.setAttribute("stroke-linejoin",c.controlBoxStyle.strokeLineJoin),f.setAttribute("stroke-miterlimit",c.controlBoxStyle.strokeMiterLimit),n.appendChild(f),o.appendChild(n),n=i("g",St.Constants.DOM_OVERVIEW_RESIZE_VIEWPORT),a=i("rect",St.Constants.DOM_OVERVIEW_RESIZE_VIEWPORT_RECT),t=St.Constants.DOM_PREFIX+St.Constants.DOM_CLASS_OVERVIEW_RESIZE_HANDLE,a.setAttribute("class",t),a.setAttribute("fill",c.controlHandlerStyle.fill),a.setAttribute("fill-opacity",
c.controlHandlerStyle.fillOpacity),n.appendChild(a),o.appendChild(n),Q(e).css("-moz-user-select","none"),Q(e).css("user-select","none"),Q(e).css("-ms-user-select","none"),Q(e).css("-khtml-user-select","none"),Q(e).css("-webkit-user-select","none"),Q(e).css("-ms-touch-action","none")),this.width=function(){return Q(r).width()},this.height=function(){return Q(r).height()},this.setSize=function(t,n){s.width=t,s.height=n,u.width=t,u.height=n},this.KA=function(t){f.setAttribute("stroke-width",t)},this.JA=function(t){f.setAttribute("x",t.x),f.setAttribute("y",t.y),f.setAttribute("width",t.width),f.setAttribute("height",t.height);var n=t.x+t.width,t=t.y+t.height;a.setAttribute("transform","translate("+n+","+t+")")},this.QA=function(t){var n=t.x;n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY||a.setAttribute("x",t.x),(n=t.y)===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY||a.setAttribute("y",t.y),(n=t.width
)===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY||a.setAttribute("width",t.width),(n=t.height)===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY||a.setAttribute("height",t.height)},this.tR=function(){return c},this.getInteractionCanvas=function(){return r},this.getSheetFeatureCanvas=function(){return s},this.nR=function(){return u},this.iR=function(){return h},this.rR=function(){return o},this.getViewport=function(){return f},this.sR=function(){return a},this.offset=function(){return Q(u).offset()},this.destroy=function(){r&&Q(r).remove()}}function gs(i){Ti.call(this,i);var t=i.getSheetFeatureCanvas(),n=i.nR(),r=i.rR(),s=t.getContext("2d"),u=n.getContext("2d"),h=St.Matrix.identity,e=new St.RenderStyle,o=i.tR();s._5=0,u._5=0;var f=u,a=this;this.setStyle=function(t){e=t},this.getStyle=function(){return e};function c(t,n,i){n.transform&&l(n.transform);var r=!1;n.owStrokeColor&&(f.strokeStyle=n.owStrokeColor,r=!0),n.owLineWidth&&(f.lineWidth=n.owLineWidth),n.owLineCap&&(
f.lineCap=n.owLineCap),n.owLineJoin&&(f.lineJoin=n.owLineJoin),n.owLineDash&&f.setLineDash(n.owLineDash),n.owFont&&(f.font=n.owFont);var s=!1;n.owFillColor&&(f.fillStyle=n.owFillColor,s=!0),i.call(a,r,s),n.transform&&v()}var l=function(t){f.save(),f.transform(t.getM0(),t.getM1(),t.getM3(),t.getM4(),t.getM6(),t.getM7())},v=function(){f.restore()};this.isRendering=function(){return 0!==s._5||0!==u._5},this.setSheetToScreenTransform=function(t){t="matrix("+(n=h=t).getM0()+","+n.getM1()+","+n.getM3()+","+n.getM4()+","+n.getM6()+","+n.getM7()+")",r.setAttribute("transform",t);var n=o.controlBoxStyle.strokeWidthCoefficient/h.getM0(),t=5/h.getM0();i.KA(n),i.QA(new St.Rect(-t/2,-t/2,t,t))},this.clear=function(){s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,t.width,t.height),u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,n.width,n.height)},this.beginRender=function(t,n,i){!function(t){switch(t){case St.CanvasOption.OverviewSheetFeatureCanvas:f=s;break;case St.CanvasOption.OverviewCanvas:f=u}}(t),
f.save(),n&&(i?(f.clearRect(0,0,this.width(),this.height()),f.beginPath(),f.rect(i.x,i.y,i.width,i.height)):(f.clearRect(0,0,this.width(),this.height()),f.rect(0,0,this.width(),this.height())));i=h;f.setTransform(i.getM0(),i.getM1(),i.getM3(),i.getM4(),i.getM6(),i.getM7()),f._5=0},this.endRender=function(){0===f._5&&f.restore()},this.renderElement=function(t){t.renderOverview(this)},this.renderRect=function(i){c(0,e,function(t,n){t&&f.strokeRect(i.x,i.y,i.width,i.height),n&&f.fillRect(i.x,i.y,i.width,i.height)})},this.uR=function(i){c(0,e,function(t,n){t&&f.strokeRect(i.x,i.y,i.width,i.height)})},this.getSheetToScreenTransform=function(){return h},this.renderLines=function(u){c(0,e,function(t,n){f.beginPath();for(var i=0;i<u.length;i++){var r=u[i].start,s=u[i].end;f.moveTo(r.x-.5,r.y-.5),f.lineTo(s.x-.5,s.y-.5)}t&&f.stroke()})}}function Ms(t,n){function u(t,n){t.getAttribute("cursor")!=n&&t.setAttribute("cursor",n)}var i=n,h=t,e=h.getSheetConfigurationData(
).overviewStyle.controlBoxStyle,t=i.getInteractionCanvas(),o=i.nR(),f=i.iR(),a=i.getViewport(),s=i.sR(),c=new St.Point(0,0),l=new St.Point(0,0),v=new St.Point(0,0),w=new St.Point(0,0),d=null,m=1,g=!1,M=!1,p=!1,b=!1,k=null;Q(o).on("mousedown touchstart",function(t){"touchstart"===t.type&&(t.preventDefault(),t=t.originalEvent.changedTouches[0]),g=!0,v.x=t.pageX,v.y=t.pageY,d=h.getViewport().clone(),k=i.offset()}),Q(o).on("mouseup touchend",function(t){var n;g&&(M||("touchend"===t.type&&(t.preventDefault(),t=t.originalEvent.changedTouches[0]),w.x=t.pageX-k.left,w.y=t.pageY-k.top,n=h.getOverviewScreenToSheetTransform(),w=n.transformPoint(w),t=d.getCenterX(),n=d.getCenterY(),t=t-w.x,n=n-w.y,h.translateViewport(new St.Vector(t,n)))),b=M=g=!1,u(o,e.defaultCursor)}),Q(o).on("mousemove touchmove",function(t){var n,i,r,s;u(o,e.defaultCursor),"touchmove"===t.type&&(t.preventDefault(),t=t.originalEvent.changedTouches[0]),g&&(u(o,e.defaultCursor),M=!0,w.x=t.pageX,w.y=t.pageY),p&&(u(o,e.moveCursor),
w.x=t.pageX,w.y=t.pageY,r=v.x-w.x,s=v.y-w.y,n=(i=h.getOverviewScreenToSheetTransform()).transformVector(new St.Vector(r,s)),h.translateViewport(n),v.x=w.x,v.y=w.y),b&&(u(o,e.resizeCursor),w.x=t.pageX-k.left,w.y=t.pageY-k.top,i=h.getOverviewScreenToSheetTransform(),w=i.transformPoint(w),t=d.getCenterX(),i=d.getCenterY(),r=w.x-t,s=w.y-i,r=r/(d.width/2),s=(s=s/(d.height/2))<r?1/r:1/s,s*=m,h.setCurrentZoomFactor(new St.Point(t,i),s))}),Q(f).on("mousedown touchstart",function(t){"touchstart"===t.type&&(t.preventDefault(),t=t.originalEvent.changedTouches[0]),g=!0,v.x=t.pageX,v.y=t.pageY,c.x=t.screenX,c.y=t.screenY,d=h.getViewport().clone(),k=i.offset()}),Q(f).on("mouseup touchend",function(t){var n;g&&(M||("touchend"===t.type&&(t.preventDefault(),t=t.originalEvent.changedTouches[0]),w.x=t.pageX-k.left,w.y=t.pageY-k.top,n=h.getOverviewScreenToSheetTransform(),w=n.transformPoint(w),t=d.getCenterX(),n=d.getCenterY(),t=t-w.x,n=n-w.y,h.translateViewport(new St.Vector(t,n)))),b=M=g=!1,u(f,
e.defaultCursor)}),Q(f).on("mousemove touchmove",function(t){var n,i,r,s;u(f,e.defaultCursor),"touchmove"===t.type&&(t.preventDefault(),t=t.originalEvent.changedTouches[0]),g&&(u(f,e.defaultCursor),w.x=t.pageX,w.y=t.pageY,l.x=t.screenX,l.y=t.screenY,l.equal(c)||(M=!0)),p&&(u(f,e.moveCursor),w.x=t.pageX,w.y=t.pageY,r=v.x-w.x,s=v.y-w.y,n=(i=h.getOverviewScreenToSheetTransform()).transformVector(new St.Vector(r,s)),h.translateViewport(n),v.x=w.x,v.y=w.y),b&&(u(f,e.resizeCursor),w.x=t.pageX-k.left,w.y=t.pageY-k.top,i=h.getOverviewScreenToSheetTransform(),w=i.transformPoint(w),t=d.getCenterX(),i=d.getCenterY(),r=w.x-t,s=w.y-i,r=r/(d.width/2),s=(s=s/(d.height/2))<r?1/r:1/s,s*=m,h.setCurrentZoomFactor(new St.Point(t,i),s))}),Q(a).on("mousedown touchstart",function(t){"touchstart"===t.type&&(t.preventDefault(),t=t.originalEvent.changedTouches[0]),p=!0,v.x=t.pageX,v.y=t.pageY,k=i.offset()}),Q(a).on("mouseup touchend",function(t){b=p=!1,u(a,e.defaultCursor)}),Q(a).on("mousemove touchmove",
function(t){var n,i,r,s;u(a,e.moveCursor),"touchmove"===t.type&&(t.preventDefault(),t=t.originalEvent.changedTouches[0]),g&&u(a,e.defaultCursor),p&&(u(a,e.moveCursor),w.x=t.pageX,w.y=t.pageY,r=v.x-w.x,s=v.y-w.y,n=(i=h.getOverviewScreenToSheetTransform()).transformVector(new St.Vector(r,s)),h.translateViewport(n),v.x=w.x,v.y=w.y),b&&(u(a,e.resizeCursor),w.x=t.pageX-k.left,w.y=t.pageY-k.top,i=h.getOverviewScreenToSheetTransform(),w=i.transformPoint(w),t=d.getCenterX(),i=d.getCenterY(),r=w.x-t,s=w.y-i,r=r/(d.width/2),s=(s=s/(d.height/2))<r?1/r:1/s,s*=m,h.setCurrentZoomFactor(new St.Point(t,i),s))}),Q(s).on("mousedown touchstart",function(t){var n=h.getSheetConfigurationData();m=n.viewData.getScaleFactor(),d=h.getViewport().clone(),b=!0,k=i.offset()}),Q(s).on("mouseup touchend",function(t){b=!1,u(s,e.defaultCursor)}),Q(s).on("mousemove touchmove",function(t){var n,i,r;u(s,e.resizeCursor),g&&u(s,e.defaultCursor),p&&u(s,e.moveCursor),b&&(u(s,e.resizeCursor),"touchmove"===t.type&&(
t.preventDefault(),t=t.originalEvent.changedTouches[0]),w.x=t.pageX-k.left,w.y=t.pageY-k.top,r=h.getOverviewScreenToSheetTransform(),w=r.transformPoint(w),n=d.getCenterX(),i=d.getCenterY(),t=w.x-n,r=w.y-i,t=t/(d.width/2),r=(r=r/(d.height/2))<t?1/t:1/r,r*=m,h.setCurrentZoomFactor(new St.Point(n,i),r))});Q(t).on("mousewheel DOMMouseScroll wheel",function(t,n){var i=St.CommonUtil.getMouseWheelDelta(t.originalEvent||t),r=h.getViewport(),s=r.getCenterX(),t=r.getCenterY(),r=h.getSheetConfigurationData().viewData.getScaleFactor();r*=0<i?Math.pow(1.2,i):Math.pow(.8,-1*i),h.setCurrentZoomFactor(new St.Point(s,t),r)})}function ps(n,r,t){Dt.common.ObjectBase.call(this);var i=null,s=null,u=null,h=null,e=!1;this.getContext=function(){return i=i||this.createContext(r)},this.getCanvas=function(){var t=this.getContext();return t?t.getCanvas():null},this.setStyle=function(t){var n=this.getContext();n&&n.setStyle(t)},this.getStyle=function(){var t=this.getContext();return t?t.getStyle():null},
this.clear=function(){i&&i.clear()},this.destroy=function(){this.clear(),e=!(i=null),s&&(s.destroy(),s=null),h=u=null},this.getManager=function(){return n},this.createContext=function(t){t=new ms(t,n.getSheetConfigurationData().overviewStyle);return u=t.width(),h=t.height(),new gs(s=t)},this.updateViewport=function(){var t=this.getContext(),n=this.getManager(),i=new St.Rect(0,0,t.width(),t.height()),i=St.Matrix.sheetToScreenTransform(n.getOverviewRect(),i);t.setSheetToScreenTransform(i),n.setOverviewSheetToScreenTransform(i);n=n.getViewport();this.getCanvas().JA(n)},this.renderSheetFeatures=function(){},this.renderElements=function(r){var s=this.getContext(),u=this.getManager(),h=r||u.getOverviewRect();St.CommonUtil.waitUntil(function(){return!0!==s.isRendering()},function(){s.beginRender(St.CanvasOption.OverviewCanvas,!0,h);var t=r?u.getVisibleElements(r):u.getSheet().getVisibleElements();if(t)for(var n=t.length,i=0;i<n;i++)(t[i].getElementType(
)===St.ElementType.DEFAULT||t[i]instanceof _t.Connection&&-999==t[i].getLineTypePriorityValue())&&s.renderElement(t[i]);s.endRender()})},this.render=function(t){var n;t.updateFlags!=Dt.RenderUpdateFlags.Overlays&&((t.updateFlags&Dt.RenderUpdateFlags.Viewport)==Dt.RenderUpdateFlags.Viewport&&this.updateViewport(),(t.updateFlags&Dt.RenderUpdateFlags.Features)==Dt.RenderUpdateFlags.Features&&this.renderSheetFeatures(t),(t.updateFlags&Dt.RenderUpdateFlags.SheetElements)==Dt.RenderUpdateFlags.SheetElements&&(n=t.dirtyRect,this.renderElements(n)),(t.updateFlags&Dt.RenderUpdateFlags.Overview)==Dt.RenderUpdateFlags.Overview&&(this.updateViewport(),this.renderSheetFeatures(),t=t.dirtyRect,this.renderElements(t)))},this.initialize=function(){var i=this;e=!1,St.CommonUtil.waitUntil(function(){if(!0===e)return!0;var t=Q(r).width(),n=Q(r).height();return(t!==u||n!==h)&&(i.getCanvas().setSize(t,n),i.getManager().getViewportManager().Vk(),i.updateViewport(),i.renderSheetFeatures(),i.renderElements(),
u=t,h=n),!1},function(){}),Ms(n,this.getCanvas())},this.initialize()}function bs(){this.hR=null}function ks(t){this.eR=t,this.oR=null,this.fR=null,this.aR=null,this.cR=null,this.m_mgr=null,this.lR=new bs,this.vR=null,this.wR={left:20,top:20,right:20,bottom:20},this.lR.wR=this.wR,this.reset=function(){this.vR&&this.vR.reset()},this.iD=function(){return this.oR||(this.oR=this.eR.getSession()),this.oR},this.dR=function(){return this.aR||(this.aR=this.iD().getSheetConfigurationData()),this.aR},this.mR=function(){return this.cR||(this.cR=this.iD().getViewConfig()),this.cR},this.gR=function(){return this.m_mgr||(this.m_mgr=this.eR.getManager()),this.m_mgr};function d(t){var n,i=Array.prototype.slice.apply(arguments);1<i.length&&(n=i.slice(1)),Dt.common.ObjectHelper.rootNamespace.Layout.EngineLayerWrapper?(r=Dt.common.ObjectHelper.rootNamespace.Layout.EngineLayerWrapper,m.vR||(m.vR=new r(m.lR),(i=m.vR.getLayoutOptions()).minNodeToEdgeDist=m.dR().minNodeToEdgeDist,i.minPortExtensionDist=m.dR(
).minPortExtensionDist),t.apply(this,n)):alert("Layout is not loaded.")}var r,m=this;this.getLayoutOptions=function(){if(m.vR)return m.vR.getLayoutOptions();d(m.getLayoutOptions)},this.MR=function(t){m.vR?m.getLayoutOptions().ch=t:d(m.MR,t)},this.pR=function(t){m.vR?(m.dR().minNodeToEdgeDist=t,m.getLayoutOptions().minNodeToEdgeDist=t):d(m.pR,t)},this.bR=function(t){m.vR?m.getLayoutOptions().lh=t:d(m.bR,t)},this.kR=function(t){m.vR?(m.dR().minPortExtensionDist=t,m.getLayoutOptions().minPortExtensionDist=t):d(m.kR,t)},this.yR=function(t){m.vR?m.getLayoutOptions().vh=t:d(m.yR,t)},this.xR=function(t){m.vR?m.getLayoutOptions().wh=t:d(m.xR,t)},this.ER=function(t,n,i,r){this.wR.left=t,this.wR.top=n,this.wR.right=i,this.wR.bottom=r},this.CR=function(t,n){var i;m.vR?((i=m.getLayoutOptions()).gh=t,i.yh=n):d(m.CR,t,n)},this.enableGlobalLayout=function(t){m.vR?m.getLayoutOptions().enableGlobalLayout=t:d(m.enableGlobalLayout,t)},this.mh=function(t){m.vR?m.getLayoutOptions().mh=t:d(m.mh,t)}
;function g(t,n,i,r){if(t instanceof _t.Node){n.push(t);var s=t.getPorts();if(s&&0<s.length)for(var u=s.length,h=0;h<u;h++){var e=s[h];!e.isProxy()&&0<e.getConnectionNum()&&i.push(e)}var o=t.getGroupMembers();if(o)for(h=0;h<o.length;h++)g(o[h],n,i,r)}else t instanceof _t.Connection&&r.push(t)}this.NR=function(t,n,i){for(var r=t.length,s=0;s<r;s++)this.vR.addNode(t[s]);for(var u=n.length,s=0;s<u;s++)this.vR.addPort(n[s]);for(var h=i.length,s=0;s<h;s++)this.vR.addEdge(i[s])},this.OR=function(t,n){for(var i=t.length,r=0;r<i;r++){var s=this.th(t[r]);t[r].modifyBoundingBox(s.x,s.y,s.width,s.height)}for(var u=n.length,r=0;r<u;r++){var h=this.nh(n[r]);n[r].setPath(h)}},this.DR=function(){m.iD().E_=!1},this.layout=function(t,n,i,r,s,u){if(m.vR){var h=m.gR().getLayoutCandidates();if(h&&0<h.length){m.iD().E_=!0,m.reset();var e=m.vR.getLayoutOptions();e.fh=t,e.Ft=n,e.ah=i,e.bh=r,e.gh=s,e.yh=u,r&&(v=m.gR().getSheet().getDefaultSheetRect(),s=isNaN(s)?v.getCenterX():s,v=isNaN(u)?v.getCenterY():u,
m.CR(s,v));for(var o=h.length,f=[],a=[],c=[],l=0;l<o;l++)g(h[l],f,a,c);m.NR(f,a,c);var v=m.iD().getPerformanceCounter();v.preLayoutCb&&v.preLayout({ElementCount:o}),this.eR.beginTransaction(),m.vR.layout(),v.postLayoutCb&&v.postLayout({ElementCount:o}),m.OR(f,c),this.eR.endTransaction(),m.reset(),m.DR()}}else d(m.layout,t,n,i,r)},this.Yh=function(t,n,i,r,s,u,h){if(m.vR){var e=t?[t]:m.gR().getLayoutCandidates();if(e&&0<e.length){m.iD().E_=!0,m.reset();var o=m.vR.getLayoutOptions();o.fh=n,o.Ft=i,o.ah=r,o.bh=s,o.gh=u,o.yh=h,s&&(w=m.gR().getSheet().getDefaultSheetRect(),u=isNaN(u)?w.getCenterX():u,w=isNaN(h)?w.getCenterY():h,m.CR(u,w));for(var f=e.length,a=[],c=[],l=[],v=0;v<f;v++)g(e[v],a,c,l);m.NR(a,c,l);var w=m.iD().getPerformanceCounter();w.preLayoutCb&&w.preLayout({ElementCount:f}),this.eR.beginTransaction(),m.vR.Yh(t),w.postLayoutCb&&w.postLayout({ElementCount:f}),m.OR(a,l),this.eR.endTransaction(),m.reset(),m.DR()}}else d(m.Yh,t,n,i,r,s)},this.Fh=function(t,n,i,r,s,u,h){if(m.vR){
var e=t?[t]:m.gR().getLayoutCandidates();if(e&&0<e.length){m.iD().E_=!0,m.reset();var o=m.vR.getLayoutOptions();o.fh=n,o.Ft=i,o.ah=r,o.bh=s,o.gh=u,o.yh=h,s&&(w=m.gR().getSheet().getDefaultSheetRect(),u=isNaN(u)?w.getCenterX():u,w=isNaN(h)?w.getCenterY():h,m.CR(u,w));for(var f=e.length,a=[],c=[],l=[],v=0;v<f;v++)g(e[v],a,c,l);m.NR(a,c,l);var w=m.iD().getPerformanceCounter();w.preLayoutCb&&w.preLayout({ElementCount:f}),this.eR.beginTransaction(),m.vR.Fh(t),w.postLayoutCb&&w.postLayout({ElementCount:f}),m.OR(a,l),this.eR.endTransaction(),m.reset(),m.DR()}}else d(m.Fh,t,n,i,r,s)},this.Kh=function(){var t=this.vR.Kh();return new St.Rect(t.x,t.y,t.width,t.height)},this.th=function(t){t=this.vR.th(t);return new St.Rect(t.x,t.y,t.width,t.height)},this.ih=function(t){t=this.vR.ih(t);return new St.Point(t.x,t.y)},this.nh=function(t){var n=[],i=this.vR.nh(t);if(i)for(var r=0,s=i.length;r<s;++r){var u=i[r];n.push(new St.Point(u.x,u.y))}return n}}function ys(t,n,i,r){function s(){
var t=o.overviewWindowData.getOverviewWrapper(),n=document.createElement("div");St.CommonUtil.setSdfIdOnDom(n,St.Constants.DOM_PREFIX+St.Constants.DOM_OVERVIEW_CONTAINER),n.className=St.Constants.DOM_PREFIX+St.Constants.DOM_CLASS_DIAGRAM_OVERVIEW,h=n,e=t?(t.appendChild(n),t):((t=c.parentNode).appendChild(n),t),u=new ps(f,n),l(),u.updateViewport(),u.renderSheetFeatures(),u.renderElements(),o.overviewWindowData.setOverviewWindowDom(n)}var u=null,h=null,e=null,t=t,o=t.getSheetConfigurationData(),f=n,a=i,c=r,l=function(){var t=u.getStyle();t&&(n=o.overviewStyle.geometryStyle,t.owLineWidth=n.overviewStrokeWidth,t.owStrokeColor=n.overviewStrokeColor,t.owFillColor=n.overviewFillColor),a.X_(u),h.parentNode||e.appendChild(h);var t=Q(h).width(),n=Q(h).height();0!=t&&0!=n||(h.style.width="100%",h.style.height="100%",t=Q(h).width(),n=Q(h).height());t-=2,n-=2;u.getCanvas().setSize(t,n)};this.initOverviewWindow=function(t){o.overviewWindowData.getDisplayWindow()&&(u?(t&&u.initialize(),l(),
u.updateViewport(),u.renderSheetFeatures(),u.renderElements()):s())},this.closeOverviewWindow=function(){u&&(u.destroy(),u=null,a.X_(null),e&&e.removeChild(h),e=h=null,o.overviewWindowData.setOverviewWindowDom(null))},this.refreshOverview=function(){u&&(u.updateViewport(),u.renderSheetFeatures(),u.renderElements())},this.update=function(){this.closeOverviewWindow(),o.overviewWindowData.getDisplayWindow()&&(s(),f.getViewportManager().Vk())}}function xs(i,t,n,r){var s=new cs,u=s.CM(),h=s.getEventDispatcher(),e=s.getSheetConfigurationData(),o=(s.getViewConfig(),new ui(s));s.fN()._R(o);var f=new Ji(o,s,i,r),a=f.getCanvas(),c=new ys(s,o,f,i);e.overviewWindowData.SR(c);var l=new ks(this);s.IA(l),e.initViewportWidth=t&&0<t?t:Q(i).width(),e.initViewportHeight=n&&0<n?n:Q(i).height(),f.setSize(e.initViewportWidth,e.initViewportHeight),o.initializeMoveConstraint(a);var v=o.getCommandManager(a),w=new ws;e.gridPreferencesData.TR.push(w),o.setViewFeatures([w]);var d=new Dt.messages.RedrawMessage(
null),m=function(){a.bind("keydown",function(t){var n=e.disabledHotkey;if(n)for(var i=n.length,r=0;r<i;r++)if(n[r].isEqual(t.keyCode,t.ctrlKey,t.altKey,t.shiftKey))return 0<navigator.userAgent.indexOf("MSIE")?(window.event.keyCode=0,window.event.returnValue=!1):(t.preventDefault(),t.stopPropagation()),!1},!1)};m();var g=function(){f||(f=new Ji(o,s,i,r),a=f.getCanvas(),o.hN(a),m())};this.getSheetConfigurationData=function(){return e},this.getSessionConfiguration=function(){return s.PA},this.getSession=function(){return s},this.getBaseObject=function(t){return s.getBaseObject(t)};var M=function(t){g();var n=a.width(),i=a.height();n==e.initViewportWidth&&i==e.initViewportHeight||(f.setSize(e.initViewportWidth,e.initViewportHeight),n=e.initViewportWidth,i=e.initViewportHeight),o.initialize(t,n,i,a),c.initOverviewWindow(!0)};this.render=function(t){M(t)},this.clear=function(){u.clear(),o.clear(),v&&v.unregisterAll(),f.destroy();var t=s.dM().NT();t&&t.clear(),f=null},
this.clearBaseData=function(t){o.eN(t)},this.destroy=function(){c.closeOverviewWindow(),w.remove(),o.destroy(),u.reset(),s.clear(),f.destroy(),h.clear()};function p(){var t;f||(t=o.getSheet())&&M(t)}this.updateViewFeatures=function(t){d.renderData.updateFlags=Dt.RenderUpdateFlags.Features,u.BM(d)},this.updateSheetFeatures=function(t){o.updateSheetFeatures(t)},this.enableAsynchronousRendering=function(t){s.enableAsynchronousRendering(t)},this.getPerformanceCounter=function(){return s.getPerformanceCounter()},this.isSuppressAutoRouting=function(){return s.suppressRoutingOnConnectionChanged},this.isSuppressNestedNodeAutoEnlarge=function(){return s.suppressBoundaryUpdateOnNestedNodeChanged},this.suppressAutoRouting=function(t){s.suppressRoutingOnConnectionChanged=t},this.suppressNestedNodeAutoEnlarge=function(t){s.suppressBoundaryUpdateOnNestedNodeChanged=t},this.beginTransaction=function(){s.makeWorkSession(),u.beginTransaction(Dt.messages.ModelChangeMessage)},
this.endTransaction=function(t){s.BA(t),u.endTransaction()},this.beginSuspension=function(){s.makeWorkSession(),u.beginSuspension()},this.endSuspension=function(){u.endSuspension()},this.transformPoint=function(t,n){var i=o.getScreenToSheetTransform();return null===i?null:i.transformPoint(new St.Point(t,n))},this.getVirtualCanvas=function(){return a},this.getManager=function(){return o},this.registerEventListener=function(t,n){h.addEventListener(t,n)},this.unregisterEventListener=function(t,n){h.removeEventListener(t,n)},this.registerCommandByType=function(t,n,i){v.registerCommand(t,n,i)},this.registerCommandByInstance=function(t){v.registerCommandInstance(t)},this.unregisterCommand=function(t){v.unregisterCommand(t)},this.enableCommand=function(t){v.enableCommand(t,!0)},this.disableCommand=function(t){v.enableCommand(t,!1)},this.disableAllCommands=function(){v.disableAll()},this.enableAllCommands=function(){v.enableAll()},this.setViewportSize=function(t,n){f&&(
void 0!==t&&t<=0||void 0!==n&&n<=0||(n=n,t=(t=t)||Q(i).width(),n=n||Q(i).height(),0===t&&(window.console&&window.console.log("Error: the width of the container is 0."),t=e.initViewportWidth),0===n&&(window.console&&window.console.log("Error: the height of the container is 0."),n=e.initViewportHeight),f.setSize(t,n),this.getManager().resizeViewport(t,n,!0)))},this.fit=function(){o.fit(null,null,!0)},this.zoomToSelectedItems=function(t){o.fit(t,null,!0)},this.zoomToRectangle=function(t){o.fitToRectangle(t,!0)},this.setCurrentZoomRatio=function(t){o.setCurrentZoomFactor(null,t,!0)},this.getCurrentZoomRatio=function(){return e.viewData.getScaleFactor()},this.setSelected=function(t,n){p(),o.setSelectedElements(t,n,!0)},this.setVisible=function(t,n){if(t){var i=t.length;if(!(i<1)){this.beginTransaction();for(var r=0;r<i;r++)t[r].setVisible(n);this.endTransaction()}}},this.getElementsByType=function(t,n){return o.getElementsByType(t,n)},this.getBaseDatasByType=function(t){
return o.getBaseDatasByType(t)},this.getAllBaseObjectsByType=function(t){return o.getAllBaseObjectsByType(t)},this.getSelectedElements=function(){return o.getSelectedElements()},this.isSelected=function(t){return o.isSelected(t)},this.selectAllByType=function(t){o.selectAllByType(t)},this.refreshSheet=function(t){o.refresh(!0),c.initOverviewWindow(!1)},this.deleteElements=function(t){p(),o.removeSheetElements(t,!0)},this.deleteAll=function(t){p(),o.deleteAll(t),o.clear()},this.setLayoutMinNodeToNodeDist=function(t){l.MR(t)},this.setLayoutMinNodeToEdgeDist=function(t){l.pR(t)},this.setLayoutMinEdgeToEdgeDist=function(t){l.bR(t)},this.setLayoutMinPortExtensionDist=function(t){l.kR(t)},this.setLayoutMinSegmentDist=function(t){l.yR(t)},this.setLayoutSubGraphMoveFlag=function(t){l.xR(t)},this.setLayoutGroupNodePadding=function(t,n,i,r){l.ER(t,n,i,r)},this.setLayoutCenterPoint=function(t,n){l.CR(t,n)},this.enableGlobalLayout=function(t){l.enableGlobalLayout(t)},
this.getLayoutOptions=function(){return l.getLayoutOptions()},this.doLayout=function(t,n,i,r,s,u){l.layout(t,n,i,r,s,u)},this.doLayoutGroupAllLevels=function(t,n,i,r,s,u,h){l.Yh(t,n,i,r,s,u,h)},this.doLayoutGroupOneLevel=function(t,n,i,r,s,u,h){l.Fh(t,n,i,r,s,u,h)},this.onModelChanged=function(t){o.Xk(this,t)},this.offModelChanged=function(t){o.$k(this,t)},this.openOverviewWindow=function(t){var n=s.getSheetConfigurationData().overviewWindowData;return n.setOverviewWrapper(t),n.setDisplayWindow(!0),n.getOverviewWindowDom()},this.closeOverviewWindow=function(){s.getSheetConfigurationData().overviewWindowData.setDisplayWindow(!1)},this.refreshOverview=function(){c.refreshOverview()},this.setCursor=function(t,n){t?o.setCursor(t,n,a):a.setCursor(n)},this.getSheetToViewTransform=function(){var t=o.getSheetToScreenTransform();return t?t.clone():null},this.getViewToPageTransform=function(){var t=a.offset();return t?new St.Matrix(1,0,0,1,t.left,t.top):null},this.panElementInView=function(t,n,i
){o.panElementInView(t,n,i)};function b(t){var n,i=new St.DiagramExportSettings;if(t)for(n in t)void 0!==i[n]&&(i[n]=t[n]);return i}this.createPrintPage=function(t){(n=b(t)).createPrintPage=!0,n.viewFeaturesInclude=!0,n.allSheetElements&&(n.viewFeaturesInclude=!1);var t=new Ir(r,n).runExport(this,o),n=null;if(t)return t},this.exportSvgAsString=function(t){(n=b(t)).returnSvgDomString=!0,n.viewFeaturesInclude=!1;var t=new Ir(r,n).runExport(this,o),n=null;return t},this.quickAlignment=function(t,n,i){o.moveConstraint.getAlignment().multipleObjectsAlignment(t,n,i)},this.switchGroupViewMode=function(t){o.switchGroupViewMode(t)},this.bringFront=function(t){return this.beginTransaction(),t=t.length<2?o.bringNodeFront(t[0]):o.bringNodesFront(t),this.endTransaction(),t},this.bringForward=function(t){return this.beginTransaction(),t=t.length<2?o.bringNodeForward(t[0]):o.bringNodesForward(t),this.endTransaction(),t},this.sendBack=function(t){return this.beginTransaction(),
t=t.length<2?o.sendNodeBack(t[0]):o.sendNodesBack(t),this.endTransaction(),t},this.sendBackward=function(t){return this.beginTransaction(),t=t.length<2?o.sendNodeBackward(t[0]):o.sendNodesBackward(t),this.endTransaction(),t},this.getSheet=function(){return o.getSheet()}}function Es(t,n,i,r){var s=null,u=r;t?(r=t.target,u=u||t.type,s=Cs(r)):i&&u&&(s=Cs(i));i=s?s.getSession():Dt.AppSession.workSheetSession;i&&i.a5||(t&&(i.c5.ctrlKey=t.ctrlKey,i.c5.shiftKey=t.shiftKey,i.c5.altKey=t.altKey),n=new At.SVGCallbackEventArgs(s,u,n),n=new Dt.messages.EventMessage(n,n.getType()),i.CM().BM(n))}Ti.inheritedBy(gs),Dt.common.ObjectBase.inheritedBy(ps),bs.prototype.getNodeRect=function(t){return t.getBBox()},bs.prototype.getParentNode=function(t){if(null==t)return null;t=t.getOwner();return t&&t instanceof _t.Node?t:null},bs.prototype.isGroupNode=function(t){return!!t.isGroupingAllowed&&t.isGroupingAllowed()},bs.prototype.isExpanded=function(t){return!(!t.isGroupingAllowed||!0!==t.isGroupingAllowed()
)&&t.isExpanded()},bs.prototype.getGroupNodePadding=function(t){return this.wR||{left:20,top:20,right:20,bottom:20}},bs.prototype.getNodeOfPort=function(t){return t.getOwner()},bs.prototype.cr=function(t){return t.getRenderingPosition()},bs.prototype.vr=function(t){this.hR||(Dt.common.ObjectHelper.rootNamespace.Layout.YfPortDirection||alert("YfPortDirection is not defined yet."),this.hR=Dt.common.ObjectHelper.rootNamespace.Layout.YfPortDirection);var n=this.hR.Any,t=t.getConnectionDirection();return St.CommonUtil.isNumberClose(t.x,0,St.MathUtil.doubleTolerance)?St.CommonUtil.isNumberGreaterThan(t.y,0,St.MathUtil.doubleTolerance)?n=this.hR.Down:St.CommonUtil.isNumberLessThan(t.y,0,St.MathUtil.doubleTolerance)&&(n=this.hR.Up):St.CommonUtil.isNumberClose(t.y,0,St.MathUtil.doubleTolerance)&&(St.CommonUtil.isNumberGreaterThan(t.x,0,St.MathUtil.doubleTolerance)?n=this.hR.Right:St.CommonUtil.isNumberLessThan(t.x,0,St.MathUtil.doubleTolerance)&&(n=this.hR.Left)),n},
bs.prototype.getSourcePort=function(t){return t.getStart()},bs.prototype.getTargetPort=function(t){return t.getEnd()},bs.prototype.wr=function(t){var n=[],t=t.getGeometry();if(t)for(var i=t.getPoints(),r=0;r<i.length;++r)n.push(new St.Point(i[r].x,i[r].y));return n},bs.prototype.Dr=function(t){var n=null,t=t.getOwner();return n=parent instanceof _t.Node?t:n},bs.prototype.jr=function(t){var n={x:0,y:0},t=t.getStartLocation();return n=t?{x:(t=t.getEvaluatedLocation()).x,y:t.y}:n},bs.prototype.Ur=function(t){var n={x:0,y:0},t=t.getEndLocation();return n=t?{x:(t=t.getEvaluatedLocation()).x,y:t.y}:n},bs.prototype.pr=function(t,n,i,r,s){t.AR&&t.AR()||(t.modifyBoundingBox(t.getAnchorPositionX()+n,t.getAnchorPositionY()+i,t.getWidthValue()+r,t.getHeightValue()+s),t.isLayouted=!0)},bs.prototype.yr=function(t,n,i){},bs.prototype.kr=function(t,n){var i=t.getGeometry().getPoints();if(n.length==i.length)for(var r=0;r<i.length;++r)i[r].x=n[r].x,i[r].y=n[r].y;else{for(var s=[],r=0;r<n.length;++r
)s.push(new St.Point(n[r].x,n[r].y));var u=new _t.Polyline;u.setPoints(s),t.setGeometry(u)}},bs.prototype.reportError=function(t){var n=Dt.common.ExceptionTypes.LayoutError.id,t=t.toString();Dt.common.ExceptionHelper.throwException(n,t)};function Cs(t){for(var n=St.CommonUtil,i=(St.Constants.DOM_SDF_DATA_APP_ID,null),r=St.Constants.DOM_PREFIX+St.Constants.DOM_SVG_ROOT;!i;){var s=n.getSdfIdOnDom(t)||t.getAttribute("id");if(s&&s===r)break;if(t.DF_SVG_Object){i=t.DF_SVG_Object;break}if(s){var u=St.Constants.DOM_PREFIX.length,u=s.substr(u,s.length-u),u=parseInt(u),u=Dt.AppSession.getBaseObjectByGuid(u);if(u){if(u.getSymbol){i=u.getSymbol();break}u.getSymbols&&(i=u.getSymbols()[0].getSymbol())}}t=t.parentNode}return i}function Ns(t,n){this.m_x=t||0,this.m_y=n||0,this.m_point=void 0,this.m_distanceToStart=0,this.m_detourNumber=0,this.m_obstacle=0,this.m_tempObstacle=!1,this.m_routed=!1,this.m_visited=!1,this.m_queuePriority=0,this.m_queueCount=0}function Os(t,n,i,r){this.m_sheetWidth=t||0,
this.m_sheetHeight=n||0,this.m_gridSize=i||1,this.m_gridOrigin=r,this.m_width=Math.round(t/this.m_gridSize+.5),this.m_height=Math.round(n/this.m_gridSize+.5),this.m_grid=[];for(var s=this.m_width,u=this.m_height,h=r.x,e=r.y,o=0;o<s;++o){for(var f=[],a=0;a<u;++a){var c=new Ns(o,a);c.setPointValue(o*i+h,a*i+e),f.push(c)}this.m_grid.push(f)}}function Ds(){this.m_minSegment=0,this.m_hadlockGridSize=0,this.m_numGridCellsToExtend=1,this.m_queueCounter=0,this.m_hadlockGrid=void 0}Ns.prototype.getX=function(){return this.m_x},Ns.prototype.setX=function(t){this.m_x=t},Ns.prototype.getY=function(){return this.m_y},Ns.prototype.setY=function(t){this.m_y=t},Ns.prototype.getPoint=function(){return this.m_point},Ns.prototype.setPointValue=function(t,n){this.m_point||(this.m_point=new St.Point),this.m_point.x=t,this.m_point.y=n},Ns.prototype.setPoint=function(t){this.m_point=t},Ns.prototype.getDistanceToStart=function(){return this.m_distanceToStart},Ns.prototype.setDistanceToStart=function(t){
this.m_distanceToStart=t},Ns.prototype.getDetourNumber=function(){return this.m_detourNumber},Ns.prototype.setDetourNumber=function(t){this.m_detourNumber=t},Ns.prototype.isObstacle=function(){return 0<this.m_obstacle||this.m_tempObstacle},Ns.prototype.setObstacle=function(t){t?++this.m_obstacle:(--this.m_obstacle,this.m_obstacle<0&&(this.m_obstacle=0))},Ns.prototype.resetObstacle=function(){this.m_obstacle=0},Ns.prototype.isTempObstacle=function(){return this.m_tempObstacle},Ns.prototype.setTempObstacle=function(t){this.m_tempObstacle=t},Ns.prototype.isRouted=function(){return this.m_routed},Ns.prototype.setRouted=function(t){this.m_routed=t},Ns.prototype.isVisited=function(){return this.m_visited},Ns.prototype.setVisited=function(t){this.m_visited=t},Ns.prototype.getQueuePriority=function(){return this.m_queuePriority},Ns.prototype.setQueuePriority=function(t){this.m_queuePriority=t},Ns.prototype.getQueueCount=function(){return this.m_queueCount},Ns.prototype.setQueueCount=function(t
){this.m_queueCount=t},Ns.prototype.reset=function(){this.m_distanceToStart=0,this.m_detourNumber=0,this.m_tempObstacle=!1,this.m_routed=!1,this.m_visited=!1,this.m_queuePriority=0,this.m_queueCount=0},Ns.prototype.equalTo=function(t){return!!t&&(this.m_x==t.getX()&&this.m_y==t.getY())},Os.prototype.clone=function(){return new Os(this.m_sheetWidth,this.m_sheetHeight,this.m_gridSize,this.m_gridOrigin)},Os.prototype.getOrigin=function(){return this.m_gridOrigin},Os.prototype.setOrigin=function(t){this.m_gridOrigin=t},Os.prototype.getGridWidth=function(){return this.m_sheetWidth},Os.prototype.getGridHeight=function(){return this.m_sheetHeight},Os.prototype.clearHadlockGrid=function(){for(var t=this.m_width,n=this.m_height,i=this.m_grid,r=0;r<t;++r)for(var s=0;s<n;++s)i[r][s].reset()},Os.prototype.getGridPointAt=function(t,n){if(!(t<0||t>=this.m_width||n<0||n>=this.m_height))return this.m_grid[t][n]},Os.prototype.getGridPointAtCoord=function(t,n){var i=this.m_gridOrigin,r=this.m_gridSize
;return this.getGridPointAt(Math.round((t-i.x)/r),Math.round((n-i.y)/r))},Os.prototype.calculateManhattanDistance=function(t,n){return Math.abs(t.getX()-n.getX())+Math.abs(t.getY()-n.getY())},Os.prototype.getWestNeighbor=function(t){return this.getGridPointAt(t.getX()-1,t.getY())},Os.prototype.getEastNeighbor=function(t){return this.getGridPointAt(t.getX()+1,t.getY())},Os.prototype.getNorthNeighbor=function(t){return this.getGridPointAt(t.getX(),t.getY()-1)},Os.prototype.getSouthNeighbor=function(t){return this.getGridPointAt(t.getX(),t.getY()+1)},Os.prototype.setObstructions=function(t){this.setGridObstructions(t,!1)},Os.prototype.setTempObstructions=function(t){this.setGridObstructions(t,!0)},Os.prototype.setGridObstructions=function(t,n){var i=this.convertCoordinatesToGridIndexes(t),t=i.x,r=i.x+i.width,s=i.y,u=i.y+i.height;r>=this.m_width&&(r=this.m_width-1),s<0&&(s=0),u>=this.m_height&&(u=this.m_height-1);for(var h=this.m_grid,e=t=t<0?0:t;e<r;++e)for(var o=s;o<u;++o
)n?h[e][o].setTempObstacle(!0):h[e][o].setObstacle(!0)},Os.prototype.clearObstructions=function(t){var n=this.convertCoordinatesToGridIndexes(t),t=n.x,i=n.x+n.width,r=n.y,s=n.y+n.height;i>=this.m_width&&(i=this.m_width-1),r<0&&(r=0),s>=this.m_height&&(s=this.m_height-1);for(var u=this.m_grid,h=t=t<0?0:t;h<i;++h)for(var e=r;e<s;++e)u[h][e].setObstacle(!1)},Os.prototype.convertCoordinatesToGridIndexes=function(t){var n=this.m_gridOrigin.x,i=this.m_gridOrigin.y,r=this.m_gridSize,s=Math.round((t.x-n)/r),n=Math.round(t.width/r),i=Math.round((t.y-i)/r),r=Math.round(t.height/r);return new St.Rect(s,i,n,r)};function _s(t,n){return t.getDetourNumber()==n.getDetourNumber()?t.getQueuePriority()==n.getQueuePriority()?t.getQueueCount()<n.getQueueCount():t.getQueuePriority()<n.getQueuePriority():t.getDetourNumber()>n.getDetourNumber()}var Ss=0,Ts=1,As=2,Rs=3,Ps=4;function Hs(t,n){this.m_classIdGuid=t||0,this.m_bbox=n||void 0}function Ls(t){this.session=t,this.m_hadlockAlgorithm=new Ds,this.m_sheet,
this.m_sheetGridSpacing=1,this.m_tempLinePadding=0,this.m_nodePadding=1,this.m_obstructionExclusionList=[],this.m_sheetElementObstructionMap=[]}Ds.prototype.getMinSegment=function(){return this.m_minSegment},Ds.prototype.setMinSegment=function(t){this.m_minSegment=t},Ds.prototype.getHadlockGridSize=function(){return this.m_hadlockGridSize},Ds.prototype.setHadlockGridSize=function(t){this.m_hadlockGridSize=t},Ds.prototype.getNumGridCellsToExtend=function(){return this.m_numGridCellsToExtend},Ds.prototype.setNumGridCellsToExtend=function(t){this.m_numGridCellsToExtend=t},Ds.prototype.getHadlockGrid=function(){return this.m_hadlockGrid},Ds.prototype.generateHadlockGrid=function(t,n,i,r){this.setHadlockGridSize(i),this.m_hadlockGrid=new Os(t,n,i,r)},Ds.prototype.clearHadlockGrid=function(t,n,i,r){this.m_hadlockGrid.clearHadlockGrid()},Ds.prototype.getHadlockGridOrigin=function(){return this.m_hadlockGrid.getOrigin()},Ds.prototype.getHadlockGridWidth=function(){
return this.m_hadlockGrid.getGridWidth()},Ds.prototype.getHadlockGridHeight=function(){return this.m_hadlockGrid.getGridHeight()},Ds.prototype.generateRoute=function(t,n,i,r){this.m_queueCounter=0;var s=Ps,u=[],h=this.m_hadlockGrid;if(!h)return u;var e=h.getGridPointAtCoord(t.x,t.y);if(!e)return u;e.setPoint(t);h=h.getGridPointAtCoord(i.x,i.y);if(!h)return u;if(h.setPoint(i),e==h)return u;var s=this.extractDirection(n),o=this.extendGridPoint(this.getNumGridCellsToExtend(),s,e),f=this.extendGridPoint(this.getNumGridCellsToExtend(),this.extractDirection(r),h);if(!this.doHadlockExpansion(o,s,f))return u;var a,c=[],l=f;for(c.push(h),h.setRouted(!0),c.push(f),f.setRouted(!0),s=this.extractDirection(r),s=this.calibrateDirection(f,o,s);l!=o;)if(a=this.getNeighbor(l,s),this.processNeighborTraceback(a,l))(l=a).setRouted(!0);else{l!=f&&(this.calibrateCoordinates(c[c.length-1],l),c.push(l),l.setRouted(!0));for(var v=Ss;v<Ps;++v)if(s!=v&&(a=this.getNeighbor(l,v),this.processNeighborTraceback(a,l))
){s=v,(l=a).setRouted(!0);break}}this.are3PointsAligned(c[c.length-1],o,e)||(this.calibrateCoordinates(o,c[[c.length-1]]),c.push(o),o.setRouted(!0)),this.calibrateCoordinates(e,c[[c.length-1]]),c.push(e),this.are3PointsAligned(c[0],c[1],c[2])&&c.splice(1,1);for(var w=c.length-1;0<=w;--w)u.push(c[w].getPoint());return u},Ds.prototype.doHadlockExpansion=function(t,n,i){if(!t||!i)return!1;var r,s,u=!1,h=new Dt.PriorityQueue(_s),e=void 0,o=n,f=void 0;for(t.setVisited(!0),h.push(t),o=this.calibrateDirection(t,i,o);!h.empty()&&!u;){r=h.pop(),(s=this.findDirection(e,r))!=o&&s!=Ps&&(o=s);for(var a=Ss;!u&&a<Ps;++a)(f=this.getNeighbor(r,a))&&o==a&&f.setQueuePriority(1),u=this.processNeighborExpansion(r,t,i,f,h);e=r}return u},Ds.prototype.findDirection=function(t,n){var i,r=Ps;return t&&(i=n.getX()-t.getX(),t=n.getY()-t.getY(),0==i?0<t?r=Rs:t<0&&(r=As):0==t&&(0<i?r=Ts:i<0&&(r=Ss))),r},Ds.prototype.processNeighborExpansion=function(t,n,i,r,s){if(r&&!r.isVisited()&&!r.isObstacle()){if(
r.setDistanceToStart(t.getDistanceToStart()+1),this.m_hadlockGrid.calculateManhattanDistance(t,i)<this.m_hadlockGrid.calculateManhattanDistance(r,i)?r.setDetourNumber(t.getDetourNumber()+1):r.setDetourNumber(t.getDetourNumber()),r.setVisited(!0),r==i)return!0;r.setQueueCount(++this.m_queueCounter),s.push(r)}return!1},Ds.prototype.processNeighborTraceback=function(t,n){var i=!1;return i=t&&t.isVisited()&&!t.isObstacle()&&!t.isRouted()&&t.getDistanceToStart()<n.getDistanceToStart()?!0:i},Ds.prototype.getNeighbor=function(t,n){var i;switch(n){case Ss:i=this.m_hadlockGrid.getWestNeighbor(t);break;case Ts:i=this.m_hadlockGrid.getEastNeighbor(t);break;case As:i=this.m_hadlockGrid.getNorthNeighbor(t);break;case Rs:i=this.m_hadlockGrid.getSouthNeighbor(t);break;case Ps:i=void 0;break;default:i=void 0,this.m_hadlockGrid&&(this.m_hadlockGrid=void 0),Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentError.id,"Invalid direction enum value!")}return i},
Ds.prototype.extractDirection=function(t){var n=Ps;switch(t.x){case-1:0==t.y&&(n=Ss);break;case 0:switch(t.y){case-1:n=As;break;case 0:n=Ps;break;case 1:n=Rs;break;default:n=Ps}break;case 1:0==t.y&&(n=Ts);break;default:n=Ps}return n},Ds.prototype.calibrateDirection=function(t,n,i){return As==i&&n.getY()>t.getY()||Rs==i&&n.getY()<t.getY()?i=n.getX()<t.getX()?Ss:Ts:(Ss==i&&n.getX()>t.getX()||Ts==i&&n.getX()<t.getX())&&(i=n.getY()<t.getY()?As:Rs),i},Ds.prototype.calibrateCoordinates=function(t,n){var i=!1,r=t.getPoint(),s=n.getPoint();return t.getX()==n.getX()?(s.x=r.x,i=!0):t.getY()==n.getY()&&(s.y=r.y,i=!0),i&&n.setPoint(s),i},Ds.prototype.extendGridPoint=function(t,n,i){var r=i,s=i;s.setTempObstacle(!0);for(var u=0;u<t;++u)!(r=this.getNeighbor(s,n))||r.isVisited()||r.isObstacle()&&!r.isTempObstacle()?r=s:(r.setTempObstacle(!0),this.calibrateCoordinates(s,r),s=r);return(r=!i.equalTo(r)&&r.getPoint().distanceToPoint(i.getPoint())<this.getMinSegment()?this.extendGridPoint(t+1,n,i):r
).setTempObstacle(!1),r},Ds.prototype.are3PointsAligned=function(t,n,i){return t.getX()==n.getX()&&n.getX()==i.getX()||t.getY()==n.getY()&&n.getY()==i.getY()},Hs.prototype.getClassIdGuid=function(){return this.m_classIdGuid},Hs.prototype.setClassIdGuid=function(t){this.m_classIdGuid=t},Hs.prototype.getBbox=function(){return this.m_bbox},Hs.prototype.setBbox=function(t){this.m_bbox=t};var Is=0,Fs=1,Vs=2,js=4,Ws=8,zs=16;Ls.prototype.setLinePadding=function(t){0<(this.m_tempLinePadding=t)&&(t=Math.round(t/this.m_sheetGridSpacing+.5),this.m_hadlockAlgorithm.setNumGridCellsToExtend(t=0==t?1:t))},Ls.prototype.setNodePadding=function(t){this.m_nodePadding=t},Ls.prototype.setMinSegment=function(t){Dt.common.ExceptionHelper.throwNotImplemented()},Ls.prototype.mk=function(){return{}},Ls.prototype.gk=function(t,n){},Ls.prototype.findPaths=function(t){for(var n={},i=0,r=t.length;i<r;i++){var s=t[i];n[s.connection.guid]=this.Mk(s)}return n},Ls.prototype.Mk=function(t){return t.Ck=[],
t.yk=St.RoutingReason.Created,this.generateRoute(t.connection)},Ls.prototype.generateRoute=function(t){var n=this.extractConnectionStartEndInfo(t),i=n.start,r=n.startPoint,s=n.startDirection,u=n.end,h=n.endPoint,n=n.endDirection;return this.setupGridObstructions(t,r,h),n=this.m_hadlockAlgorithm.generateRoute(r,s,h,n),i.equal(r)||n.unshift(i),u.equal(h)||n.push(u),n},Ls.prototype.extractConnectionStartEndInfo=function(t){var n,i,r=!1,s=!1,u=!1,h=!1,e=0,o=0,f=t.getStartPoint(),a=f||new St.Point(0,0),f=t.getStart();f?(0<(c=f.getResolvedConnectionDirection()).distance&&(c.distance+=this.m_sheetGridSpacing),i=new St.Vector(c.x,c.y),e=c.distance,r=c.xVariable,s=c.yVariable):(i=new St.Vector(0,0),n=new St.Point(a.x,a.y));var c,l,f=t.getEndPoint(),f=f||new St.Point(0,0),t=t.getEnd();return t?(0<(c=t.getResolvedConnectionDirection()).distance&&(c.distance+=this.m_sheetGridSpacing),l=new St.Vector(c.x,c.y),new St.Point(f.x+c.x*c.distance,f.y+c.y*c.distance),o=c.distance,u=c.xVariable,
h=c.yVariable):(l=new St.Vector(0,0),new St.Point(f.x,f.y)),0!=i.x?r&&(a.x<f.x?i.x=1:i.x=-1):0!=i.y&&s&&(a.y<f.y?i.y=1:i.y=-1),n=new St.Point(a.x+i.x*e,a.y+i.y*e),0!=l.x?u&&(a.x>f.x?l.x=1:l.x=-1):0!=l.y&&h&&(a.y>f.y?l.y=1:l.y=-1),{start:a,startPoint:n,startDirection:i,end:f,endPoint:new St.Point(f.x+l.x*o,f.y+l.y*o),endDirection:l}},Ls.prototype.setupGridObstructions=function(t,n,i){var r=0,s=0,u=new St.Point(0,0),h=this.m_hadlockAlgorithm;this.setObstructionExclusionTypes(zs);var e,o,f,a=t.getOwningSheet();this.m_sheet=void 0,this.m_sheet!=a?(r=(this.m_sheet=a).getWidth(),s=a.getHeight(),o=t.getSession(),Dt.common.ExceptionHelper.throwIfInvalid(o,"SheetSession"),e=o.getSheetConfigurationData().gridPreferencesData.getMajorGridSpacing(),this.m_sheetGridSpacing=e,this.setNodePadding(e),o=a.getSheetElements(),r&&s||(r=(f=this.recalculateGridSize(o)).width,s=f.height,u=f.origin),h.generateHadlockGrid(r,s,e,u),(this.isPointOutsideGrid(n)||this.isPointOutsideGrid(i))&&(r=(
f=this.recalculateGridSize(o)).width,s=f.height,u=f.origin,h.generateHadlockGrid(r,s,e,u)),0===h.getMinSegment()&&h.setMinSegment(e),this.processObstructions(o)):this.isPointOutsideGrid(n)||this.isPointOutsideGrid(i)?(o=a.getSheetElements(),r=(f=this.recalculateGridSize(o)).width,s=f.height,u=f.origin,h.generateHadlockGrid(r,s,e,u),this.processObstructions(o)):h.clearHadlockGrid(),0!=this.m_tempLinePadding&&(o=a.getSheetElements(),this.processTempObstructions(o))},Ls.prototype.recalculateGridSize=function(t){for(var n=0,i=0,r=0,s=0,u=0,h=t.length,e=0,e=0;e<h;++e){var o,f=t[e];if(!this.inObstructionExclusionList(f.getTypeName()))if(o=f.getRenderingBBox()){n=o.x,i=o.x+o.width,r=o.y,s=o.y+o.height;break}}for(;e<h;++e)this.inObstructionExclusionList(f.getTypeName())||(f=t[e])instanceof _t.Connection||(n>(o=f.getRenderingBBox()).x&&(n=o.x),i<o.x+o.width&&(i=o.x+o.width),r>o.y&&(r=o.y),s<o.y+o.height&&(s=o.y+o.height));return u=2*(this.m_nodePadding+this.m_tempLinePadding),
0===this.m_tempLinePadding&&(u+=6*this.m_sheetGridSpacing),{width:Math.abs(i-n+2*u),height:Math.abs(s-r+2*u),origin:new St.Point(n-u,r-u)}},Ls.prototype.isPointOutsideGrid=function(t){var n=t.x,i=t.y,r=this.m_hadlockAlgorithm,s=r.getHadlockGridOrigin(),u=s.x,t=s.y,s=u+r.getHadlockGridWidth(),r=t+r.getHadlockGridHeight();return n<u||s<n||i<t||r<i},Ls.prototype.processDeletedItems=function(t){for(var n=t.length,i=0;i<n;i++){var r=t[i],s=r.getTypeName(),r=r.guid;this.inObstructionExclusionList(s)||(s=this.m_sheetElementObstructionMap,this.clearObstructions(s[r]),s[r]=void 0)}},Ls.prototype.processObstructions=function(t){for(var n,i=this.m_sheetElementObstructionMap,r=this.m_nodePadding,s=t.length,u=0;u!=s;++u){var h=t[u],e=h.getTypeName();this.inObstructionExclusionList(e)||(n=h.guid,h=h.getRenderingBBox(),this.addPaddingToBbox(r,h),h=new Hs(n,h),i[n]&&this.clearObstructions(i[n]),i[n]=h,this.setObstructions(h))}},Ls.prototype.processTempObstructions=function(t){for(
var n=this.m_nodePadding,i=this.m_tempLinePadding,r=t.length,s=0;s<r;++s){var u,h=(u=t[s]).getTypeName();this.inObstructionExclusionList(h)||(u=u.getRenderingBBox(),this.addPaddingToBbox(n,u),this.addTempPaddingToBbox(i,u),this.setTempObstructions(u))}},Ls.prototype.setObstructionExclusionTypes=function(t){var n,i;Is!=t?(n=this.m_obstructionExclusionList,t&Fs&&(n.indexOf(i="Node")<0&&n.push(i)),t&Vs&&(n.indexOf(i="Annotation")<0&&n.push(i)),t&js&&(n.indexOf(i="Port")<0&&n.push(i)),t&Ws&&(n.indexOf(i="Table")<0&&n.push(i)),t&zs&&(n.indexOf(i="Connection")<0&&n.push(i))):this.m_obstructionExclusionList=[]},Ls.prototype.inObstructionExclusionList=function(t){return 0<=this.m_obstructionExclusionList.indexOf(t)},Ls.prototype.setObstructions=function(t){var n=this.m_hadlockAlgorithm.getHadlockGrid();n?n.setObstructions(t.getBbox()):Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.NullReferenceError.id,"Hadlock Grid not set!")},Ls.prototype.setTempObstructions=function(t){
var n=this.m_hadlockAlgorithm.getHadlockGrid();n?n.setTempObstructions(t):Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.NullReferenceError.id,"Hadlock Grid not set!")},Ls.prototype.clearObstructions=function(t){var n=this.m_hadlockAlgorithm.getHadlockGrid();n?n.clearObstructions(t.getBbox()):Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.NullReferenceError.id,"Hadlock Grid not set!")},Ls.prototype.addPaddingToBbox=function(t,n){t<0&&(t=0,Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentOutOfRangeError.id,"Negative padding value!"));var i=n.x,r=n.x+n.width,s=n.y,u=n.y+n.height,h=this.m_sheetGridSpacing;n.x=i-t+h,n.width=r-i+2*t-h,n.y=s-t+h,n.height=u-s+2*t-h},Ls.prototype.addTempPaddingToBbox=function(t,n){t<0&&(t=0,Dt.common.ExceptionHelper.throwException(Dt.common.ExceptionTypes.ArgumentOutOfRangeError.id,"Negative padding value!")),n.x=n.x-t,n.y=n.y-t,n.width=n.width+2*t,n.height=n.height+2*t},
Dt.common.ObjectHelper.rootNamespace=Dt.common.ObjectHelper.rootNamespace||{};var Ys=Dt.common.ObjectHelper.rootNamespace;Ys.Routing=Ys.Routing||{};var Bs=Ys.Routing;Bs.PathFinding=wr,Bs.PathFindingDefinition=Qi,Bs.HadlockRouter=Ls,Bs.aStarRouter=fr,Bs.OrthogonalRouter=vr;var Zs={Tree:0,Hierarchical:1,Balloon:2,Orthogonal:3,Compact:4,Circular:5,Organic:6,Snake:7,Group:8,SimpleTree:9,SimpleBalloon:10,NoLayout:11,OrthogonalGroup:13};Dt.common.ObjectHelper.rootNamespace=Dt.common.ObjectHelper.rootNamespace||{};Ys=Dt.common.ObjectHelper.rootNamespace;Ys.Layout=Ys.Layout||{},Ys.Layout.LayoutType=Zs,Ys.Layout.LayoutDirection={TopToBottom:0,LeftToRight:1,BottomToTop:2,RightToLeft:3},Ys.Layout.RoutingType={Organic:0,Polyline1:1,Polyline2:2,Orthogonal:3,StraightLine:4,HVPaths:5,Default:6},Ys.Layout.SubGraphRoutingType={Organic:0,Orthogonal:1,Line:2};var Zs=Ys.Layout,Us={};function Gs(){_t.PlacementRule.call(this),$s.setRawValue(this,Us.ROTATION)}Us.NONE=0,Us.FLIP=1,Us.ROTATION=2,
Gs.prototype.resetPosition=function(){var t=this.getReferencings(),n=t.length;if(0<n)for(var i=0;i<n;i++){var r=t[i];!r||(r=r.getLocation())&&(r.setInputValueX(0),r.setInputValueY(0),r.RR=void 0,r.PR=void 0,r.HR=0,r.LR=void 0)}},Gs.prototype.setFlipOption=function(t){$s.setRawValue(this,t)},Gs.prototype.getFlipOption=function(){return $s.getValue(this)},Gs.DONOT_KNOW=0,Gs.LEFT=1,Gs.RIGHT=2,Gs.TOP=3,Gs.BOTTOM=4,Gs.prototype.getPort=function(t){if(t){t=t.getLocation();if(t)return t.getReference()}};function Xs(t,n){var i=n.getFlipOption(),r=n.getPort(t),s=r.getRenderingBBox(),u=(e=t.getLocation()).KC,h=e.JC;if(i===Us.FLIP){var e,o=s.x,f=s.width,a=o,c=o+f,l=t.getAnchor(),v=t.getWidthValue(),w=t.getHeightValue(),n=u-v*l.x+v/2,u=h-w*l.y+w/2,d=.5,h=o+f/2,w=s.y+s.height/2;if(d=0===St.MathUtil.doubleCompare(v,0)?n<h?1:0:(o=n-f/2,s=n+f/2,v<=f&&(s=o=n),c<o?0:s<a?1:.5),(e=t.getLocation()).RR=n-h,e.PR=u-w,d!==t.IR.x){var m=v*(d-t.IR.x);t.IR.x=d;for(var g=(p=t.getSymbols()).length,M=0;M<g;M++)(
b=p[M].getSymbol())&&b.setAnchorX(d);m=e.KC+m;e.KC=m,e.setEvaluatedX(m)}}else if(i===Us.ROTATION){m=r.getLocation(),i=m.getInputPercentX(),r=m.getInputValueX(),m=m.getInputPercentY(),l=t.getAnchor(),d=0;switch(0===St.MathUtil.doubleCompare(i,1)?Gs.RIGHT:0===St.MathUtil.doubleCompare(m,1)?Gs.BOTTOM:0===St.MathUtil.doubleCompare(i,0)&&0===St.MathUtil.doubleCompare(r,0)?Gs.LEFT:Gs.TOP){case Gs.LEFT:d=1;break;case Gs.RIGHT:case Gs.TOP:d=0;break;case Gs.BOTTOM:d=1}if(t.IR.x!==d){t.IR.x=d;for(var p,b,g=(p=t.getSymbols()).length,M=0;M<g;M++)(b=p[M].getSymbol())&&b.setAnchorX(d)}}}Gs.prototype.getDefaultPosition=function(t){var n=this.getPort(t);if(n){var i=n.getRenderingBBox(),r=n.getLocation(),s=r.getInputPercentX(),u=r.getInputValueX(),h=r.getInputPercentY(),e=t.getWidthValue(),o=t.getHeightValue(),f=0,a=t.getAnchor(),n=this.getFlipOption(),r=i.x+i.width+e*a.x,t=i.y-o*(1-a.y),f=0===St.MathUtil.doubleCompare(s,1)?(r=i.x+i.width+e*a.x,t=i.y-o*(1-a.y),Gs.RIGHT):0===St.MathUtil.doubleCompare(h,
1)?(n===Us.FLIP?(r=i.x+i.width+e*a.x,t=i.y+i.height+o*a.y):n===Us.ROTATION&&(r=i.x-o*(1-a.y),t=i.y+i.height+e*(1-a.x)),Gs.BOTTOM):0===St.MathUtil.doubleCompare(s,0)&&0===St.MathUtil.doubleCompare(u,0)?(r=i.x-e*(1-a.x),t=i.y-o*(1-a.y),Gs.LEFT):(t=n===Us.FLIP?(r=i.x+i.width+e*a.x,i.y-o*(1-a.y)):(r=i.x-o*(1-a.y),i.y-e*a.x),Gs.TOP);return{x:r,y:t,callback:Xs,portSide:f}}},Gs.prototype.evaluate=function(t){var n,i,r,s,u=this.getPort(t),h=t.getWidthValue(),e=t.getHeightValue();Xs(t,this),h&&(n=t.getAnchor(),r=(i=u.getRenderingBBox()).x+i.width/2,s=i.y+i.height/2);var o=this.getDefaultPosition(t);if(o){var f=t.getLocation(),a=f.HR,c=o.portSide,l=!1,v=!1,w=f.getInputValueX();void 0!==w&&!isNaN(w)||(w=0);var d=f.getInputValueY();void 0!==d&&!isNaN(d)||(d=0);var m,g,u=this.getFlipOption();if(u===Us.FLIP){if(c&&a&&a!==c&&(a!=Gs.BOTTOM&&c!=Gs.BOTTOM||(v=!0,e&&(4==a&&f.PR<0||4==c&&0<f.PR)&&(d=s+f.PR-e/2+e*n.y-o.y,v=!1),v&&(d=-d),f.LR=!0,f.setInputValueY(d)),a!=Gs.LEFT&&c!=Gs.LEFT||(l=!0,
h&&void 0!==f.RR&&(1==a&&0<f.RR&&(w=r+f.RR-h/2+h*n.x-o.x,l=!1),1==c&&f.RR<0&&(w=r+f.RR-h/2+h*n.x-o.x,l=!1)),l&&(w=-w),f.LR=!0,f.setInputValueX(w)),h&&e))switch(c){case Gs.LEFT:(m=o.x+w+h*(1-n.x))>i.x&&(w-=m-i.x,f.LR=!0,f.setInputValueX(w));break;case Gs.RIGHT:(g=o.x+w-h*n.x)<i.x+i.width&&(w+=i.x+i.width-g,f.LR=!0,f.setInputValueX(w));break;case Gs.TOP:(m=o.y+d+e*(1-n.y))>i.y&&(d-=m-i.y,f.LR=!0,f.setInputValueY(d));break;case Gs.BOTTOM:(g=o.y+d-e*n.y)<i.y+i.height&&(d+=i.y+i.height-g,f.LR=!0,f.setInputValueY(d))}}else if(u===Us.ROTATION){if(c&&a&&a!==c)switch(a!==Gs.BOTTOM&&c!==Gs.BOTTOM||(d=-d,f.LR=!0,f.setInputValueY(d)),a!==Gs.LEFT&&c!==Gs.LEFT||(w=-w,f.LR=!0,f.setInputValueX(w)),c){case Gs.LEFT:(m=o.x+w+h*(1-n.x))>i.x&&(w-=m-i.x,f.LR=!0,f.setInputValueX(w));break;case Gs.RIGHT:(g=o.x+w-h*n.x)<i.x+i.width&&(w+=i.x+i.width-g,f.LR=!0,f.setInputValueX(w));break;case Gs.TOP:(m=o.y+d+h*n.x)>i.y&&(d-=m-i.y,f.LR=!0,f.setInputValueY(d));break;case Gs.BOTTOM:(g=o.y+d-h*(1-n.x)
)<i.y+i.height&&(d+=i.y+i.height-g,f.LR=!0,f.setInputValueY(d))}c===Gs.TOP||c===Gs.BOTTOM?t.setRotation(-90):t.setRotation(0)}return f.HR=c,o.x+=w,o.y+=d,o}},Gs.prototype.startPreview=function(t){t=t.getLocation();t&&(t.LR=void 0)},_t.PlacementRule.inheritedBy(Gs);var $s=Dt.Property.define(Gs,"m_placementPosition",Number,Dt.PropertyFlags.Persistent|Dt.PropertyFlags.NotifyChange|Dt.PropertyFlags.AffectRender|Dt.PropertyFlags.SupportsShallowCopy);function qs(t,n){os.call(this,t,n)}Gs.getDefaultRule=function(){var t=Dt.AppSession.workSheetSession;if(!t)return null;var n=t.cA;return n||(n=new Gs,t.cA=n),n},qs.prototype.getFinalTransformation=function(t,n){var i=this.getTarget(),r=this.getOriginalAnchorPosition(i),s=r.x+t,u=r.y+n,h=i.getLocation().getReference(),e=this.getElementOriginalBBox(h),o=this.getElementOriginalBBox(i),f=new St.Point(e.x,e.y),t=new St.Point(e.x+e.width,e.y),n=new St.Point(e.x,e.y+e.height),h=(new St.Point(e.x+e.width,e.y+e.height),this.maxDistance),i=Math.max(f.x-h,
t.x+h-o.width),e=Math.min(f.x-h,t.x+h-o.width),t=Math.max(f.y-h,n.y+h-o.height),o=Math.min(f.y-h,n.y+h-o.height);return i<s||s<e||t<u||u<o?(s=r.x,u=r.y,this.setStopMove(!0)):this.setStopMove(!1),{dx:s-r.x,dy:u-r.y,angle:void 0}},os.inheritedBy(qs);Ys=Dt.common.ObjectHelper.rootNamespace;Ys.Models=_t,(Ys.Models.SymbolCache=Ar).__typeName__="SymbolCache",(Ys.Models.PortLabelPlacementRule=Gs).__typeName__="PortLabelPlacementRule",Ys.Utils=St,Ys.Utils.PortLabelPositionOption=Us,Ys.Utils.Alignment=zn,Ys.Utils.AttachingUtil=Vn,Ys.Utils.ClipBoard=Fn,Ys.Utils.DiagramExporter=Ir,Ys.Utils.MouseEventsUtil=yi,Ys.Utils.MoveConnectionUtil=Xt,Ys.Utils.MoveConstraint=si,Ys.Utils.MoveStrategy=hs,Ys.Utils.Snap=Pn,Ys.Utils.TouchEventsUtil=Ei,Ys.Utils.AlongPathMoveStrategy=es,Ys.Utils.InsideBoundaryMoveStrategy=qs,Ys.Utils.BoundaryMoveStrategy=os,Ys.Utils.PortMoveStrategy=fs,Ys.ChangeType=Dt.ChangeType,Ys.Map=Dt.Map,Ys.ExceptionTypes=Dt.common.ExceptionTypes,Ys.RenderingMode=St.RenderingMode,
Ys.DiagramView=xs,Ys.Command=ht,Ys.EventType=_,Ys.ObjectBase=Dt.common.ObjectBase,Ys.JsonUtility=Dt.common.JsonUtility,Ys.StringHelper=Dt.common.StringHelper,Ys.ObjectHelper=Dt.common.ObjectHelper,Ys.ArrayHelper=Dt.common.ArrayHelper,Ys.ExceptionHelper=Dt.common.ExceptionHelper,Ys.SvgTemplateEvent=Es,Ys.Routing=Bs,Ys.Layout=Zs,Ys.SheetConfigurationData=Dr,Ys.AppRawEventMap=at,Ys.Commands=xn,Ys.Events=At,Ys.CursorControl=Mi,Ys.OverlayOperationFlags=Tt,Ys.RectOverlay=Nn,Ys.LineOverlay=Zt,Ys.ImmediateRenderContext=Ai,Ys.SvgRenderContext=Ui;Ys={};return Ys.Models=_t,(Ys.Models.SymbolCache=Ar).__typeName__="SymbolCache",(Ys.Models.PortLabelPlacementRule=Gs).__typeName__="PortLabelPlacementRule",Ys.Utils=St,Ys.Utils.PortLabelPositionOption=Us,Ys.Utils.Alignment=zn,Ys.Utils.AttachingUtil=Vn,Ys.Utils.ClipBoard=Fn,Ys.Utils.DiagramExporter=Ir,Ys.Utils.MouseEventsUtil=yi,Ys.Utils.MoveConnectionUtil=Xt,Ys.Utils.MoveConstraint=si,Ys.Utils.MoveStrategy=hs,Ys.Utils.Snap=Pn,Ys.Utils.TouchEventsUtil=Ei
,Ys.Utils.AlongPathMoveStrategy=es,Ys.Utils.InsideBoundaryMoveStrategy=qs,Ys.Utils.BoundaryMoveStrategy=os,Ys.Utils.PortMoveStrategy=fs,Ys.ChangeType=Dt.ChangeType,Ys.Map=Dt.Map,Ys.ExceptionTypes=Dt.common.ExceptionTypes,Ys.RenderingMode=St.RenderingMode,Ys.DiagramView=xs,Ys.Command=ht,Ys.EventType=_,Ys.ObjectBase=Dt.common.ObjectBase,Ys.JsonUtility=Dt.common.JsonUtility,Ys.StringHelper=Dt.common.StringHelper,Ys.ObjectHelper=Dt.common.ObjectHelper,Ys.ArrayHelper=Dt.common.ArrayHelper,Ys.ExceptionHelper=Dt.common.ExceptionHelper,Ys.SvgTemplateEvent=Es,Ys.Routing=Bs,Ys.Layout=Zs,Ys.SheetConfigurationData=Dr,Ys.AppRawEventMap=at,Ys.Commands=xn,Ys.Events=At,Ys.CursorControl=Mi,Ys.OverlayOperationFlags=Tt,Ys.RectOverlay=Nn,Ys.LineOverlay=Zt,Ys.ImmediateRenderContext=Ai,Ys.SvgRenderContext=Ui,Ys},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("jquery"),require("@diagramming/core"),require("@diagramming/models"),require("@diagramming/utils")
):"function"==typeof define&&define.amd?define(["jquery","@diagramming/core","@diagramming/models","@diagramming/utils"],n):(t=t||self).diagramfoundation=n(t.$,t.diagramfoundation.core,t.diagramfoundation.models,t.diagramfoundation.utils);